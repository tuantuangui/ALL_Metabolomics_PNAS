<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 19 Figure 4 | ALL metabolism analysis</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 19 Figure 4 | ALL metabolism analysis" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 19 Figure 4 | ALL metabolism analysis" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Tuantuan Gui" />


<meta name="date" content="2024-12-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="figure-3.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ALL Metabolimics PNAS</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> the ALL metabolism analysis</a></li>
<li class="chapter" data-level="2" data-path="serum-2020-data-preprocess.html"><a href="serum-2020-data-preprocess.html"><i class="fa fa-check"></i><b>2</b> serum: 2020 data preprocess</a>
<ul>
<li class="chapter" data-level="2.1" data-path="serum-2020-data-preprocess.html"><a href="serum-2020-data-preprocess.html#positive"><i class="fa fa-check"></i><b>2.1</b> positive</a></li>
<li class="chapter" data-level="2.2" data-path="serum-2020-data-preprocess.html"><a href="serum-2020-data-preprocess.html#negative"><i class="fa fa-check"></i><b>2.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="serum-2021-data-preprocess.html"><a href="serum-2021-data-preprocess.html"><i class="fa fa-check"></i><b>3</b> serum: 2021 data preprocess</a>
<ul>
<li class="chapter" data-level="3.1" data-path="serum-2021-data-preprocess.html"><a href="serum-2021-data-preprocess.html#positive-1"><i class="fa fa-check"></i><b>3.1</b> positive</a></li>
<li class="chapter" data-level="3.2" data-path="serum-2021-data-preprocess.html"><a href="serum-2021-data-preprocess.html#negative-1"><i class="fa fa-check"></i><b>3.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="serum-metid-data-anatation.html"><a href="serum-metid-data-anatation.html"><i class="fa fa-check"></i><b>4</b> serum: metID data anatation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="serum-metid-data-anatation.html"><a href="serum-metid-data-anatation.html#serum-2020"><i class="fa fa-check"></i><b>4.1</b> serum 2020</a></li>
<li class="chapter" data-level="4.2" data-path="serum-metid-data-anatation.html"><a href="serum-metid-data-anatation.html#serum-2021"><i class="fa fa-check"></i><b>4.2</b> serum 2021</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="serum-combine-data-from-ab-metid-and-metdna-of-serum-2020-and-serum-2021.html"><a href="serum-combine-data-from-ab-metid-and-metdna-of-serum-2020-and-serum-2021.html"><i class="fa fa-check"></i><b>5</b> serum: combine data from AB, metID and metDNA of serum 2020 and serum 2021</a></li>
<li class="chapter" data-level="6" data-path="serum-combine-data-from-positive-and-negative.html"><a href="serum-combine-data-from-positive-and-negative.html"><i class="fa fa-check"></i><b>6</b> serum: combine data from positive and negative</a></li>
<li class="chapter" data-level="7" data-path="serum-batch-effection-of-data-from-serum-2020-and-serum-2021-using-sva.html"><a href="serum-batch-effection-of-data-from-serum-2020-and-serum-2021-using-sva.html"><i class="fa fa-check"></i><b>7</b> serum: batch effection of data from serum 2020 and serum 2021 using sva</a></li>
<li class="chapter" data-level="8" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html"><i class="fa fa-check"></i><b>8</b> Cell: AB data process</a>
<ul>
<li class="chapter" data-level="8.1" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#filter-the-metabolites-too-much-na-and-impute-the-na"><i class="fa fa-check"></i><b>8.1</b> filter the metabolites (too much NA) and impute the NA</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#positive-2"><i class="fa fa-check"></i><b>8.1.1</b> positive</a></li>
<li class="chapter" data-level="8.1.2" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#negative-2"><i class="fa fa-check"></i><b>8.1.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#transform-the-metabolite-name-to-refmet-name"><i class="fa fa-check"></i><b>8.2</b> transform the metabolite name to refmet name</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#positive-3"><i class="fa fa-check"></i><b>8.2.1</b> positive</a></li>
<li class="chapter" data-level="8.2.2" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#negative-3"><i class="fa fa-check"></i><b>8.2.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#filter-the-metabolite-based-on-the-library-hit"><i class="fa fa-check"></i><b>8.3</b> filter the metabolite based on the library hit</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#positive-4"><i class="fa fa-check"></i><b>8.3.1</b> positive</a></li>
<li class="chapter" data-level="8.3.2" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#negative-4"><i class="fa fa-check"></i><b>8.3.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#filter-metabolite-by-manual-check"><i class="fa fa-check"></i><b>8.4</b> filter metabolite by manual check</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cell-annotation.html"><a href="cell-annotation.html"><i class="fa fa-check"></i><b>9</b> Cell: annotation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="cell-annotation.html"><a href="cell-annotation.html#metid"><i class="fa fa-check"></i><b>9.1</b> metID</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="cell-annotation.html"><a href="cell-annotation.html#positive-5"><i class="fa fa-check"></i><b>9.1.1</b> positive</a></li>
<li class="chapter" data-level="9.1.2" data-path="cell-annotation.html"><a href="cell-annotation.html#negative-5"><i class="fa fa-check"></i><b>9.1.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="cell-annotation.html"><a href="cell-annotation.html#metdna"><i class="fa fa-check"></i><b>9.2</b> metDNA</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="cell-annotation.html"><a href="cell-annotation.html#positive-6"><i class="fa fa-check"></i><b>9.2.1</b> positive</a></li>
<li class="chapter" data-level="9.2.2" data-path="cell-annotation.html"><a href="cell-annotation.html#negative-6"><i class="fa fa-check"></i><b>9.2.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="cell-annotation.html"><a href="cell-annotation.html#combine-the-data-from-metid-and-metdna"><i class="fa fa-check"></i><b>9.3</b> combine the data from metID and metDNA</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="cell-annotation.html"><a href="cell-annotation.html#positive-7"><i class="fa fa-check"></i><b>9.3.1</b> positive</a></li>
<li class="chapter" data-level="9.3.2" data-path="cell-annotation.html"><a href="cell-annotation.html#negative-7"><i class="fa fa-check"></i><b>9.3.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="cell-annotation.html"><a href="cell-annotation.html#transform-metabolite-name-to-refmet-name"><i class="fa fa-check"></i><b>9.4</b> transform metabolite name to refmet name</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="cell-annotation.html"><a href="cell-annotation.html#positive-8"><i class="fa fa-check"></i><b>9.4.1</b> positive</a></li>
<li class="chapter" data-level="9.4.2" data-path="cell-annotation.html"><a href="cell-annotation.html#negative-8"><i class="fa fa-check"></i><b>9.4.2</b> negative</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="cell-combine-the-data-from-ab-and-xcms.html"><a href="cell-combine-the-data-from-ab-and-xcms.html"><i class="fa fa-check"></i><b>10</b> Cell: combine the data from AB and xcms</a>
<ul>
<li class="chapter" data-level="10.1" data-path="cell-combine-the-data-from-ab-and-xcms.html"><a href="cell-combine-the-data-from-ab-and-xcms.html#combine-the-data-from-ab-and-xcms"><i class="fa fa-check"></i><b>10.1</b> combine the data from AB and xcms</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="cell-combine-the-data-from-ab-and-xcms.html"><a href="cell-combine-the-data-from-ab-and-xcms.html#positive-9"><i class="fa fa-check"></i><b>10.1.1</b> positive</a></li>
<li class="chapter" data-level="10.1.2" data-path="cell-combine-the-data-from-ab-and-xcms.html"><a href="cell-combine-the-data-from-ab-and-xcms.html#negative-9"><i class="fa fa-check"></i><b>10.1.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="cell-combine-the-data-from-ab-and-xcms.html"><a href="cell-combine-the-data-from-ab-and-xcms.html#transform-the-format-to-serrf"><i class="fa fa-check"></i><b>10.2</b> transform the format to serrf</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="cell-combine-the-data-from-ab-and-xcms.html"><a href="cell-combine-the-data-from-ab-and-xcms.html#positive-10"><i class="fa fa-check"></i><b>10.2.1</b> positive</a></li>
<li class="chapter" data-level="10.2.2" data-path="cell-combine-the-data-from-ab-and-xcms.html"><a href="cell-combine-the-data-from-ab-and-xcms.html#negative-10"><i class="fa fa-check"></i><b>10.2.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="cell-combine-the-data-from-ab-and-xcms.html"><a href="cell-combine-the-data-from-ab-and-xcms.html#rsd"><i class="fa fa-check"></i><b>10.3</b> RSD</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="cell-combine-positive.html"><a href="cell-combine-positive.html"><i class="fa fa-check"></i><b>11</b> Cell: combine positive</a></li>
<li class="chapter" data-level="12" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html"><i class="fa fa-check"></i><b>12</b> Cell: metabolite info</a>
<ul>
<li class="chapter" data-level="12.1" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#ab"><i class="fa fa-check"></i><b>12.1</b> AB</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#positive-11"><i class="fa fa-check"></i><b>12.1.1</b> positive</a></li>
<li class="chapter" data-level="12.1.2" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#negative-11"><i class="fa fa-check"></i><b>12.1.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#metid-1"><i class="fa fa-check"></i><b>12.2</b> metID</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#positive-12"><i class="fa fa-check"></i><b>12.2.1</b> positive</a></li>
<li class="chapter" data-level="12.2.2" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#negative-12"><i class="fa fa-check"></i><b>12.2.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#metdna-1"><i class="fa fa-check"></i><b>12.3</b> metDNA</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#positive-13"><i class="fa fa-check"></i><b>12.3.1</b> positive</a></li>
<li class="chapter" data-level="12.3.2" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#negative-13"><i class="fa fa-check"></i><b>12.3.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#combine-the-data-from-abmetid-and-metdna"><i class="fa fa-check"></i><b>12.4</b> combine the data from AB,metID and metDNA</a></li>
<li class="chapter" data-level="12.5" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#compare-with-the-local-cas-id"><i class="fa fa-check"></i><b>12.5</b> compare with the local CAS ID</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="cell-qc.html"><a href="cell-qc.html"><i class="fa fa-check"></i><b>13</b> Cell: QC</a>
<ul>
<li class="chapter" data-level="13.1" data-path="cell-qc.html"><a href="cell-qc.html#pca"><i class="fa fa-check"></i><b>13.1</b> PCA</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="cell-qc.html"><a href="cell-qc.html#positive-14"><i class="fa fa-check"></i><b>13.1.1</b> positive</a></li>
<li class="chapter" data-level="13.1.2" data-path="cell-qc.html"><a href="cell-qc.html#negative-14"><i class="fa fa-check"></i><b>13.1.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="cell-qc.html"><a href="cell-qc.html#the-distribution-of-every-metabolite"><i class="fa fa-check"></i><b>13.2</b> the distribution of every metabolite</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="cell-qc.html"><a href="cell-qc.html#positive-15"><i class="fa fa-check"></i><b>13.2.1</b> positive</a></li>
<li class="chapter" data-level="13.2.2" data-path="cell-qc.html"><a href="cell-qc.html#negative-15"><i class="fa fa-check"></i><b>13.2.2</b> negative</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="cell-filter-metabolites-and-samples.html"><a href="cell-filter-metabolites-and-samples.html"><i class="fa fa-check"></i><b>14</b> Cell: filter metabolites and samples</a>
<ul>
<li class="chapter" data-level="14.1" data-path="cell-filter-metabolites-and-samples.html"><a href="cell-filter-metabolites-and-samples.html#filter-out-c053"><i class="fa fa-check"></i><b>14.1</b> filter out C053</a></li>
<li class="chapter" data-level="14.2" data-path="cell-filter-metabolites-and-samples.html"><a href="cell-filter-metabolites-and-samples.html#filter-compound"><i class="fa fa-check"></i><b>14.2</b> filter compound</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="cell-filter-metabolites-and-samples.html"><a href="cell-filter-metabolites-and-samples.html#filter-compound-in-2023.11.08"><i class="fa fa-check"></i><b>14.2.1</b> filter compound in 2023.11.08</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="cell-rsd.html"><a href="cell-rsd.html"><i class="fa fa-check"></i><b>15</b> Cell: RSD</a>
<ul>
<li class="chapter" data-level="15.1" data-path="cell-rsd.html"><a href="cell-rsd.html#after"><i class="fa fa-check"></i><b>15.1</b> after</a></li>
<li class="chapter" data-level="15.2" data-path="cell-rsd.html"><a href="cell-rsd.html#rsd-1"><i class="fa fa-check"></i><b>15.2</b> RSD</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="figure-1.html"><a href="figure-1.html"><i class="fa fa-check"></i><b>16</b> Figure 1</a>
<ul>
<li class="chapter" data-level="16.1" data-path="figure-1.html"><a href="figure-1.html#b-annotated-metabolites"><i class="fa fa-check"></i><b>16.1</b> (B) Annotated metabolites</a></li>
<li class="chapter" data-level="16.2" data-path="figure-1.html"><a href="figure-1.html#c-comprehensive-metabolome-overview"><i class="fa fa-check"></i><b>16.2</b> (C) Comprehensive metabolome overview</a></li>
<li class="chapter" data-level="16.3" data-path="figure-1.html"><a href="figure-1.html#s1-a-clinical-characteristics"><i class="fa fa-check"></i><b>16.3</b> (S1 A) Clinical characteristics</a></li>
<li class="chapter" data-level="16.4" data-path="figure-1.html"><a href="figure-1.html#s1-b-venn-plot"><i class="fa fa-check"></i><b>16.4</b> (S1 B) Venn plot</a></li>
<li class="chapter" data-level="16.5" data-path="figure-1.html"><a href="figure-1.html#s1-c-waterfall-plot"><i class="fa fa-check"></i><b>16.5</b> (S1 C) Waterfall plot</a></li>
<li class="chapter" data-level="16.6" data-path="figure-1.html"><a href="figure-1.html#s1-d-scatter-plot"><i class="fa fa-check"></i><b>16.6</b> (S1 D) Scatter plot</a></li>
<li class="chapter" data-level="16.7" data-path="figure-1.html"><a href="figure-1.html#s2-a-pca"><i class="fa fa-check"></i><b>16.7</b> (S2 A) PCA</a></li>
<li class="chapter" data-level="16.8" data-path="figure-1.html"><a href="figure-1.html#s2-b-volcano-plot"><i class="fa fa-check"></i><b>16.8</b> (S2 B) Volcano Plot</a></li>
<li class="chapter" data-level="16.9" data-path="figure-1.html"><a href="figure-1.html#s2-c-msea"><i class="fa fa-check"></i><b>16.9</b> (S2 C) MSEA</a></li>
<li class="chapter" data-level="16.10" data-path="figure-1.html"><a href="figure-1.html#s2-d-ageing-related-metabolites"><i class="fa fa-check"></i><b>16.10</b> (S2 D) Ageing-related metabolites</a></li>
<li class="chapter" data-level="16.11" data-path="figure-1.html"><a href="figure-1.html#s2-e-box-plot"><i class="fa fa-check"></i><b>16.11</b> (S2 E) Box plot</a></li>
<li class="chapter" data-level="16.12" data-path="figure-1.html"><a href="figure-1.html#s2-f-overall-survival-analysis"><i class="fa fa-check"></i><b>16.12</b> (S2 F) Overall Survival analysis</a></li>
<li class="chapter" data-level="16.13" data-path="figure-1.html"><a href="figure-1.html#s2-g-box-plot"><i class="fa fa-check"></i><b>16.13</b> (S2 G) Box plot</a></li>
<li class="chapter" data-level="16.14" data-path="figure-1.html"><a href="figure-1.html#s2-h-metabolism-set-enrichment-analysis"><i class="fa fa-check"></i><b>16.14</b> (S2 H) Metabolism Set Enrichment Analysis</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="figure-2.html"><a href="figure-2.html"><i class="fa fa-check"></i><b>17</b> Figure 2</a>
<ul>
<li class="chapter" data-level="17.1" data-path="figure-2.html"><a href="figure-2.html#a-3d-pca"><i class="fa fa-check"></i><b>17.1</b> (A) 3D PCA</a></li>
<li class="chapter" data-level="17.2" data-path="figure-2.html"><a href="figure-2.html#b-all-vs-hc"><i class="fa fa-check"></i><b>17.2</b> (B) ALL vs HC</a></li>
<li class="chapter" data-level="17.3" data-path="figure-2.html"><a href="figure-2.html#c-intracellular-metabolome-landscape"><i class="fa fa-check"></i><b>17.3</b> (C) Intracellular Metabolome Landscape</a></li>
<li class="chapter" data-level="17.4" data-path="figure-2.html"><a href="figure-2.html#e-bcp-all-vs-t-all"><i class="fa fa-check"></i><b>17.4</b> (E) BCP-ALL vs T-ALL</a></li>
<li class="chapter" data-level="17.5" data-path="figure-2.html"><a href="figure-2.html#s3-a-correlation-within-bmmc-samples"><i class="fa fa-check"></i><b>17.5</b> (S3 A) Correlation Within BMMC Samples</a></li>
<li class="chapter" data-level="17.6" data-path="figure-2.html"><a href="figure-2.html#s3-b-correlation-between-hc-pmmc-and-all-bmmc-mrd-"><i class="fa fa-check"></i><b>17.6</b> (S3 B) Correlation Between HC PMMC And ALL BMMC MRD-</a></li>
<li class="chapter" data-level="17.7" data-path="figure-2.html"><a href="figure-2.html#s3-c-correlation-between-bmmc-and-pbmc"><i class="fa fa-check"></i><b>17.7</b> (S3 C) Correlation Between BMMC And PBMC</a></li>
<li class="chapter" data-level="17.8" data-path="figure-2.html"><a href="figure-2.html#s3-d-differential-analyses"><i class="fa fa-check"></i><b>17.8</b> (S3 D) Differential Analyses</a></li>
<li class="chapter" data-level="17.9" data-path="figure-2.html"><a href="figure-2.html#s3-e-volcano-plot-of-bmmc-d0-vs.-mrd-"><i class="fa fa-check"></i><b>17.9</b> (S3 E) Volcano Plot of BMMC-D0 vs. MRD-</a></li>
<li class="chapter" data-level="17.10" data-path="figure-2.html"><a href="figure-2.html#s3-f-abundance-boxplot"><i class="fa fa-check"></i><b>17.10</b> (S3 F) Abundance Boxplot</a></li>
<li class="chapter" data-level="17.11" data-path="figure-2.html"><a href="figure-2.html#s3-g-wgcna"><i class="fa fa-check"></i><b>17.11</b> (S3 G) WGCNA</a></li>
<li class="chapter" data-level="17.12" data-path="figure-2.html"><a href="figure-2.html#s3-h-bar-plot"><i class="fa fa-check"></i><b>17.12</b> (S3 H) bar plot</a></li>
<li class="chapter" data-level="17.13" data-path="figure-2.html"><a href="figure-2.html#s3-i-venn-diagram"><i class="fa fa-check"></i><b>17.13</b> (S3 I) Venn Diagram</a></li>
<li class="chapter" data-level="17.14" data-path="figure-2.html"><a href="figure-2.html#s3-j-boxplot"><i class="fa fa-check"></i><b>17.14</b> (S3 J) Boxplot</a></li>
<li class="chapter" data-level="17.15" data-path="figure-2.html"><a href="figure-2.html#s3-k-pathway-based-analysis"><i class="fa fa-check"></i><b>17.15</b> (S3 K) Pathway-based Analysis</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="figure-3.html"><a href="figure-3.html"><i class="fa fa-check"></i><b>18</b> Figure 3</a>
<ul>
<li class="chapter" data-level="18.1" data-path="figure-3.html"><a href="figure-3.html#a-gsva-scores-for-metabolic-pathways"><i class="fa fa-check"></i><b>18.1</b> (A) GSVA Scores for Metabolic Pathways</a></li>
<li class="chapter" data-level="18.2" data-path="figure-3.html"><a href="figure-3.html#b-mutations-and-metabolites"><i class="fa fa-check"></i><b>18.2</b> (B) Mutations and Metabolites</a></li>
<li class="chapter" data-level="18.3" data-path="figure-3.html"><a href="figure-3.html#c-idh12-and-etv6-mutations"><i class="fa fa-check"></i><b>18.3</b> (C) IDH1/2 and ETV6 Mutations</a></li>
<li class="chapter" data-level="18.4" data-path="figure-3.html"><a href="figure-3.html#d-fusions-and-metabolites"><i class="fa fa-check"></i><b>18.4</b> (D) Fusions and Metabolites</a></li>
<li class="chapter" data-level="18.5" data-path="figure-3.html"><a href="figure-3.html#e-bcr-abl1-fusion"><i class="fa fa-check"></i><b>18.5</b> (E) BCR-ABL1 Fusion</a></li>
<li class="chapter" data-level="18.6" data-path="figure-3.html"><a href="figure-3.html#s4-a-metabolic-gene-heatmap"><i class="fa fa-check"></i><b>18.6</b> (S4 A) Metabolic Gene Heatmap</a></li>
<li class="chapter" data-level="18.7" data-path="figure-3.html"><a href="figure-3.html#s4-b-correlation-within-bmmc-samples"><i class="fa fa-check"></i><b>18.7</b> (S4 B) Correlation Within BMMC Samples</a></li>
<li class="chapter" data-level="18.8" data-path="figure-3.html"><a href="figure-3.html#s4-c-correlation-of-mrna-expression-of-metabolic-genes"><i class="fa fa-check"></i><b>18.8</b> (S4 C) Correlation of mRNA Expression of Metabolic Genes</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="figure-4.html"><a href="figure-4.html"><i class="fa fa-check"></i><b>19</b> Figure 4</a>
<ul>
<li class="chapter" data-level="19.1" data-path="figure-4.html"><a href="figure-4.html#a-schematic-workflow"><i class="fa fa-check"></i><b>19.1</b> (A) Schematic Workflow</a></li>
<li class="chapter" data-level="19.2" data-path="figure-4.html"><a href="figure-4.html#b-discrimination-of-bcp-all-clusters"><i class="fa fa-check"></i><b>19.2</b> (B) Discrimination of BCP-ALL Clusters</a></li>
<li class="chapter" data-level="19.3" data-path="figure-4.html"><a href="figure-4.html#c-os-in-75-bcp-all-patients"><i class="fa fa-check"></i><b>19.3</b> (C) OS in 75 BCP-ALL patients</a></li>
<li class="chapter" data-level="19.4" data-path="figure-4.html"><a href="figure-4.html#d-multivariate-cox-analysis"><i class="fa fa-check"></i><b>19.4</b> (D) Multivariate Cox Analysis</a></li>
<li class="chapter" data-level="19.5" data-path="figure-4.html"><a href="figure-4.html#e-subnetwork-between-bc3-and-bc12"><i class="fa fa-check"></i><b>19.5</b> (E) Subnetwork between BC3 and BC1/2</a></li>
<li class="chapter" data-level="19.6" data-path="figure-4.html"><a href="figure-4.html#f-discrimination-of-t-all-clusters"><i class="fa fa-check"></i><b>19.6</b> (F) Discrimination of T-ALL Clusters</a></li>
<li class="chapter" data-level="19.7" data-path="figure-4.html"><a href="figure-4.html#g-os-of-tc12"><i class="fa fa-check"></i><b>19.7</b> (G) OS of TC1/2</a></li>
<li class="chapter" data-level="19.8" data-path="figure-4.html"><a href="figure-4.html#h-subnetwork-between-tc2-and-tc1"><i class="fa fa-check"></i><b>19.8</b> (H) Subnetwork between TC2 and TC1</a></li>
<li class="chapter" data-level="19.9" data-path="figure-4.html"><a href="figure-4.html#s5-a-clusters-of-bcp-all"><i class="fa fa-check"></i><b>19.9</b> (S5 A) Clusters of BCP-ALL</a></li>
<li class="chapter" data-level="19.10" data-path="figure-4.html"><a href="figure-4.html#s5-e-waterfall-plot-of-bc123"><i class="fa fa-check"></i><b>19.10</b> (S5 E) Waterfall plot of BC1/2/3</a></li>
<li class="chapter" data-level="19.11" data-path="figure-4.html"><a href="figure-4.html#s5-h-da-score-of-bc3-cluster"><i class="fa fa-check"></i><b>19.11</b> (S5 H) DA-score of BC3 cluster</a></li>
<li class="chapter" data-level="19.12" data-path="figure-4.html"><a href="figure-4.html#s5-i-j-msea-of-bc123"><i class="fa fa-check"></i><b>19.12</b> (S5 I-J) MSEA of BC1/2/3</a></li>
<li class="chapter" data-level="19.13" data-path="figure-4.html"><a href="figure-4.html#s6-a-clusters-of-t-all"><i class="fa fa-check"></i><b>19.13</b> (S6 A) Clusters of T-ALL</a></li>
<li class="chapter" data-level="19.14" data-path="figure-4.html"><a href="figure-4.html#s6-e-f-rfs-and-efs-of-tc12"><i class="fa fa-check"></i><b>19.14</b> (S6 E-F) RFS and EFS of TC1/2</a></li>
<li class="chapter" data-level="19.15" data-path="figure-4.html"><a href="figure-4.html#s6-h-multivariate-cox-analysis-of-tc12"><i class="fa fa-check"></i><b>19.15</b> (S6 H) Multivariate Cox Analysis of TC1/2</a></li>
<li class="chapter" data-level="19.16" data-path="figure-4.html"><a href="figure-4.html#s6-i-heatmap-of-tc12"><i class="fa fa-check"></i><b>19.16</b> (S6 I) Heatmap of TC1/2</a></li>
<li class="chapter" data-level="19.17" data-path="figure-4.html"><a href="figure-4.html#s6-j-da-score-of-tc12"><i class="fa fa-check"></i><b>19.17</b> (S6 J) DA score of TC1/2</a></li>
<li class="chapter" data-level="19.18" data-path="figure-4.html"><a href="figure-4.html#s6-k-l-msea-of-tc12"><i class="fa fa-check"></i><b>19.18</b> (S6 K-L) MSEA of TC1/2</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank"></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">ALL metabolism analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="figure-4" class="section level1 hasAnchor" number="19">
<h1><span class="header-section-number">Chapter 19</span> Figure 4<a href="figure-4.html#figure-4" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><img src="Figure-1025/4_Figure4.png" width="1860" style="display: block; margin: auto;" /></p>
<p><strong>Figure 4: Metabolic information yields an independent prognostic clustering classification for BCP-ALL and T-ALL.</strong></p>
<p>A. The schematic workflow following SNF integration analysis. The BMMC omics data were inputted to generate a fused similarity network, which was subsequently utilized for sample clustering in this study.</p>
<p>B. The discrimination of three BCP-ALL clusters (BC1, BC2 and BC3) generated from SNF method.</p>
<p>C. The association of the three metabolic clusters with clinical overall survival (OS) in 75 BCP-ALL patients (P-value from log rank test).</p>
<p>D. The multivariate Cox analysis reveals that the metabolic clusters was an independent prognostic value for OS and event-free survival (EFS), respectively. In the genetic-based risk stratification, BCR-ABL1, ETV6-RUNX1, DUX4-IGH andTCF3-PBX1 fusion were categorized into standard risk group.</p>
<p>E. A core metabolism-based subnetwork that best explains the difference between BC3 and BC1/2. Each circle node represents one metabolite (labeled with KEGG ID), and each square node represents one gene. The colors represent the logFC (logarithm of fold change) of genes, with red and green indicating different expression levels, while yellow and blue represent the logFC of metabolites, indicating varying levels. Highlighted labels belong to cholesterol metabolism and nicotinate and nicotinamide metabolism.</p>
<p>F. The discrimination of two T-ALL clusters (TC1 and TC2) based on SNF method.</p>
<p>G. The association of the two metabolic clusters with clinical OS outcomes in 24 T-ALL patients (P-value from log rank test). The result suggested TC1 was of significantly poorer prognosis than TC2.</p>
<p>H. A core metabolism-based subnetwork that best explains the difference between TC2 and TC1. Each circle node represents one metabolite (labeled with KEGG ID), and each square node represents one gene. The colors represent the logFC (logarithm of fold change) of genes, with red and green indicating different expression levels, while yellow and blue represent the logFC of metabolites, indicating varying levels. Highlighted labels belong to citrate cycle oxidative phosphorylation.</p>
<div id="a-schematic-workflow" class="section level2 hasAnchor" number="19.1">
<h2><span class="header-section-number">19.1</span> (A) Schematic Workflow<a href="figure-4.html#a-schematic-workflow" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The schematic workflow following integrated analysis. The BMMC omics data are inputted to generate a fused similarity network, which is subsequently utilized for sample clustering in this study.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="figure-4.html#cb86-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb86-2"><a href="figure-4.html#cb86-2" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb86-3"><a href="figure-4.html#cb86-3" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb86-4"><a href="figure-4.html#cb86-4" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb86-5"><a href="figure-4.html#cb86-5" tabindex="-1"></a></span>
<span id="cb86-6"><a href="figure-4.html#cb86-6" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb86-7"><a href="figure-4.html#cb86-7" tabindex="-1"></a><span class="co">#  Step 1: Cox regression of metabolomics of BCP-ALL</span></span>
<span id="cb86-8"><a href="figure-4.html#cb86-8" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb86-9"><a href="figure-4.html#cb86-9" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-10"><a href="figure-4.html#cb86-10" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-11"><a href="figure-4.html#cb86-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(METc_BM_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb86-12"><a href="figure-4.html#cb86-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Lineage<span class="sc">==</span><span class="st">&quot;B&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-13"><a href="figure-4.html#cb86-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">bianhao=</span><span class="fu">gsub</span>(<span class="st">&quot;RJ-&quot;</span>,<span class="st">&quot;A&quot;</span>,Pid)) <span class="sc">%&gt;%</span></span>
<span id="cb86-14"><a href="figure-4.html#cb86-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(bianhao,METc_BM_D0_ID)</span>
<span id="cb86-15"><a href="figure-4.html#cb86-15" tabindex="-1"></a></span>
<span id="cb86-16"><a href="figure-4.html#cb86-16" tabindex="-1"></a>dat_cell <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-17"><a href="figure-4.html#cb86-17" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-18"><a href="figure-4.html#cb86-18" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-19"><a href="figure-4.html#cb86-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(sample_info<span class="sc">$</span>METc_BM_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb86-20"><a href="figure-4.html#cb86-20" tabindex="-1"></a>  <span class="fu">log1p</span>()</span>
<span id="cb86-21"><a href="figure-4.html#cb86-21" tabindex="-1"></a><span class="fu">names</span>(dat_cell) <span class="ot">&lt;-</span> sample_info<span class="sc">$</span>bianhao</span>
<span id="cb86-22"><a href="figure-4.html#cb86-22" tabindex="-1"></a></span>
<span id="cb86-23"><a href="figure-4.html#cb86-23" tabindex="-1"></a>clinical <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/08 队列病人生存资料-v231026.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-24"><a href="figure-4.html#cb86-24" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-25"><a href="figure-4.html#cb86-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(bianhao,OS_stat,OS) <span class="sc">%&gt;%</span></span>
<span id="cb86-26"><a href="figure-4.html#cb86-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(sample_info,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;bianhao&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb86-27"><a href="figure-4.html#cb86-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">match</span>(bianhao,sample_info<span class="sc">$</span>bianhao)) <span class="sc">%&gt;%</span></span>
<span id="cb86-28"><a href="figure-4.html#cb86-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>METc_BM_D0_ID) <span class="sc">%&gt;%</span></span>
<span id="cb86-29"><a href="figure-4.html#cb86-29" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb86-30"><a href="figure-4.html#cb86-30" tabindex="-1"></a></span>
<span id="cb86-31"><a href="figure-4.html#cb86-31" tabindex="-1"></a>dat_t <span class="ot">&lt;-</span> <span class="fu">t</span>(dat_cell) <span class="sc">%&gt;%</span></span>
<span id="cb86-32"><a href="figure-4.html#cb86-32" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-33"><a href="figure-4.html#cb86-33" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-34"><a href="figure-4.html#cb86-34" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(clinical,<span class="at">by=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-35"><a href="figure-4.html#cb86-35" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(OS,OS_stat,<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb86-36"><a href="figure-4.html#cb86-36" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-37"><a href="figure-4.html#cb86-37" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;time&quot;</span><span class="ot">=</span><span class="st">&quot;OS&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-38"><a href="figure-4.html#cb86-38" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;status&quot;</span><span class="ot">=</span><span class="st">&quot;OS_stat&quot;</span>)</span>
<span id="cb86-39"><a href="figure-4.html#cb86-39" tabindex="-1"></a>metabolite_name <span class="ot">&lt;-</span> <span class="fu">names</span>(dat_t)[<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(dat_t)]</span>
<span id="cb86-40"><a href="figure-4.html#cb86-40" tabindex="-1"></a></span>
<span id="cb86-41"><a href="figure-4.html#cb86-41" tabindex="-1"></a>dat_t_raw <span class="ot">&lt;-</span> <span class="fu">t</span>(dat_cell) <span class="sc">%&gt;%</span></span>
<span id="cb86-42"><a href="figure-4.html#cb86-42" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-43"><a href="figure-4.html#cb86-43" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-44"><a href="figure-4.html#cb86-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(clinical,<span class="at">by=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-45"><a href="figure-4.html#cb86-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(OS,OS_stat,<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb86-46"><a href="figure-4.html#cb86-46" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-47"><a href="figure-4.html#cb86-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;time&quot;</span><span class="ot">=</span><span class="st">&quot;OS&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-48"><a href="figure-4.html#cb86-48" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;status&quot;</span><span class="ot">=</span><span class="st">&quot;OS_stat&quot;</span>)</span>
<span id="cb86-49"><a href="figure-4.html#cb86-49" tabindex="-1"></a>metabolite_name_raw <span class="ot">&lt;-</span> <span class="fu">names</span>(dat_t_raw)[<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(dat_t_raw)]</span>
<span id="cb86-50"><a href="figure-4.html#cb86-50" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name=</span>metabolite_name,<span class="at">name_raw=</span>metabolite_name_raw)</span>
<span id="cb86-51"><a href="figure-4.html#cb86-51" tabindex="-1"></a></span>
<span id="cb86-52"><a href="figure-4.html#cb86-52" tabindex="-1"></a>univ_formulas <span class="ot">&lt;-</span> <span class="fu">lapply</span>(metabolite_name,<span class="cf">function</span>(x) stats<span class="sc">::</span><span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">&#39;survival::Surv(time, status)~&#39;</span>, x)))</span>
<span id="cb86-53"><a href="figure-4.html#cb86-53" tabindex="-1"></a></span>
<span id="cb86-54"><a href="figure-4.html#cb86-54" tabindex="-1"></a>univ_models <span class="ot">&lt;-</span> <span class="fu">lapply</span>( univ_formulas, <span class="cf">function</span>(x){survival<span class="sc">::</span><span class="fu">coxph</span>(x, <span class="at">data =</span> dat_t)})</span>
<span id="cb86-55"><a href="figure-4.html#cb86-55" tabindex="-1"></a></span>
<span id="cb86-56"><a href="figure-4.html#cb86-56" tabindex="-1"></a>univ_results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(univ_models,</span>
<span id="cb86-57"><a href="figure-4.html#cb86-57" tabindex="-1"></a>                       <span class="cf">function</span>(x){</span>
<span id="cb86-58"><a href="figure-4.html#cb86-58" tabindex="-1"></a>                         x <span class="ot">&lt;-</span> <span class="fu">summary</span>(x)</span>
<span id="cb86-59"><a href="figure-4.html#cb86-59" tabindex="-1"></a>                         p.value<span class="ot">&lt;-</span><span class="fu">signif</span>(x<span class="sc">$</span>wald[<span class="st">&quot;pvalue&quot;</span>], <span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb86-60"><a href="figure-4.html#cb86-60" tabindex="-1"></a>                         wald.test<span class="ot">&lt;-</span><span class="fu">signif</span>(x<span class="sc">$</span>wald[<span class="st">&quot;test&quot;</span>], <span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb86-61"><a href="figure-4.html#cb86-61" tabindex="-1"></a>                         beta<span class="ot">&lt;-</span><span class="fu">signif</span>(x<span class="sc">$</span>coef[<span class="dv">1</span>], <span class="at">digits=</span><span class="dv">2</span>);<span class="co">#coeficient beta</span></span>
<span id="cb86-62"><a href="figure-4.html#cb86-62" tabindex="-1"></a>                         HR <span class="ot">&lt;-</span><span class="fu">signif</span>(x<span class="sc">$</span>coef[<span class="dv">2</span>], <span class="at">digits=</span><span class="dv">2</span>);<span class="co">#exp(beta)</span></span>
<span id="cb86-63"><a href="figure-4.html#cb86-63" tabindex="-1"></a>                         HR.confint.lower <span class="ot">&lt;-</span> <span class="fu">signif</span>(x<span class="sc">$</span>conf.int[,<span class="st">&quot;lower .95&quot;</span>], <span class="dv">2</span>)</span>
<span id="cb86-64"><a href="figure-4.html#cb86-64" tabindex="-1"></a>                         HR.confint.upper <span class="ot">&lt;-</span> <span class="fu">signif</span>(x<span class="sc">$</span>conf.int[,<span class="st">&quot;upper .95&quot;</span>],<span class="dv">2</span>)</span>
<span id="cb86-65"><a href="figure-4.html#cb86-65" tabindex="-1"></a>                         HR <span class="ot">&lt;-</span> <span class="fu">paste0</span>(HR, <span class="st">&quot; (&quot;</span>,</span>
<span id="cb86-66"><a href="figure-4.html#cb86-66" tabindex="-1"></a>                                      HR.confint.lower, <span class="st">&quot;-&quot;</span>, HR.confint.upper, <span class="st">&quot;)&quot;</span>)</span>
<span id="cb86-67"><a href="figure-4.html#cb86-67" tabindex="-1"></a>                         name <span class="ot">&lt;-</span> <span class="fu">rownames</span>(x<span class="sc">$</span>coefficients)</span>
<span id="cb86-68"><a href="figure-4.html#cb86-68" tabindex="-1"></a>                         res<span class="ot">&lt;-</span><span class="fu">c</span>(name,beta, HR, wald.test, p.value)</span>
<span id="cb86-69"><a href="figure-4.html#cb86-69" tabindex="-1"></a>                         <span class="fu">names</span>(res)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span>,<span class="st">&quot;beta&quot;</span>, <span class="st">&quot;HR (95% CI for HR)&quot;</span>, <span class="st">&quot;wald.test&quot;</span>,<span class="st">&quot;p.value&quot;</span>)</span>
<span id="cb86-70"><a href="figure-4.html#cb86-70" tabindex="-1"></a>                         <span class="fu">return</span>(res)</span>
<span id="cb86-71"><a href="figure-4.html#cb86-71" tabindex="-1"></a>                       })</span>
<span id="cb86-72"><a href="figure-4.html#cb86-72" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.data.frame</span>(univ_results, <span class="at">check.names =</span> <span class="cn">FALSE</span>))</span>
<span id="cb86-73"><a href="figure-4.html#cb86-73" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(res)</span>
<span id="cb86-74"><a href="figure-4.html#cb86-74" tabindex="-1"></a></span>
<span id="cb86-75"><a href="figure-4.html#cb86-75" tabindex="-1"></a>metabolite_all <span class="ot">&lt;-</span> result <span class="sc">%&gt;%</span></span>
<span id="cb86-76"><a href="figure-4.html#cb86-76" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(dd,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span>))</span>
<span id="cb86-77"><a href="figure-4.html#cb86-77" tabindex="-1"></a></span>
<span id="cb86-78"><a href="figure-4.html#cb86-78" tabindex="-1"></a><span class="fu">write.table</span>(metabolite_all,<span class="st">&quot;result/Figure4/4A_1.cox_metabolite_all_B.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb86-79"><a href="figure-4.html#cb86-79" tabindex="-1"></a></span>
<span id="cb86-80"><a href="figure-4.html#cb86-80" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb86-81"><a href="figure-4.html#cb86-81" tabindex="-1"></a><span class="co">#  Step 2: Cox regression of  transcriptomics of BCP-ALL</span></span>
<span id="cb86-82"><a href="figure-4.html#cb86-82" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb86-83"><a href="figure-4.html#cb86-83" tabindex="-1"></a>gene_metabolite1 <span class="ot">&lt;-</span> gene_metabolite <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(dest_type<span class="sc">==</span><span class="st">&quot;gene&quot;</span>)</span>
<span id="cb86-84"><a href="figure-4.html#cb86-84" tabindex="-1"></a>gene2 <span class="ot">&lt;-</span> PathwayExtendData <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;gene&quot;</span>)</span>
<span id="cb86-85"><a href="figure-4.html#cb86-85" tabindex="-1"></a>gene_filter <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(gene_metabolite1<span class="sc">$</span>gene,gene2<span class="sc">$</span>name))</span>
<span id="cb86-86"><a href="figure-4.html#cb86-86" tabindex="-1"></a><span class="fu">length</span>(gene_filter)</span>
<span id="cb86-87"><a href="figure-4.html#cb86-87" tabindex="-1"></a></span>
<span id="cb86-88"><a href="figure-4.html#cb86-88" tabindex="-1"></a>sample_rna <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-89"><a href="figure-4.html#cb86-89" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-90"><a href="figure-4.html#cb86-90" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Lineage<span class="sc">==</span><span class="st">&quot;B&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb86-91"><a href="figure-4.html#cb86-91" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(RNA_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb86-92"><a href="figure-4.html#cb86-92" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">bianhao=</span><span class="fu">gsub</span>(<span class="st">&quot;RJ-&quot;</span>,<span class="st">&quot;A&quot;</span>,Pid)) <span class="sc">%&gt;%</span></span>
<span id="cb86-93"><a href="figure-4.html#cb86-93" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(bianhao,RNA_id_raw)</span>
<span id="cb86-94"><a href="figure-4.html#cb86-94" tabindex="-1"></a></span>
<span id="cb86-95"><a href="figure-4.html#cb86-95" tabindex="-1"></a>dat_gene <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;raw_data/20231113_RNA_ALL_VST_coding.rds&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-96"><a href="figure-4.html#cb86-96" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-97"><a href="figure-4.html#cb86-97" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample_rna<span class="sc">$</span>RNA_id_raw) <span class="sc">%&gt;%</span></span>
<span id="cb86-98"><a href="figure-4.html#cb86-98" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-99"><a href="figure-4.html#cb86-99" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(label <span class="sc">%in%</span> gene_filter) <span class="sc">%&gt;%</span></span>
<span id="cb86-100"><a href="figure-4.html#cb86-100" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>)</span>
<span id="cb86-101"><a href="figure-4.html#cb86-101" tabindex="-1"></a></span>
<span id="cb86-102"><a href="figure-4.html#cb86-102" tabindex="-1"></a><span class="fu">names</span>(dat_gene) <span class="ot">&lt;-</span> sample_rna<span class="sc">$</span>bianhao</span>
<span id="cb86-103"><a href="figure-4.html#cb86-103" tabindex="-1"></a></span>
<span id="cb86-104"><a href="figure-4.html#cb86-104" tabindex="-1"></a>dat_gene_0 <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(dat_gene<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb86-105"><a href="figure-4.html#cb86-105" tabindex="-1"></a>dat_gene <span class="ot">&lt;-</span> dat_gene <span class="sc">%&gt;%</span></span>
<span id="cb86-106"><a href="figure-4.html#cb86-106" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">num=</span>dat_gene_0) <span class="sc">%&gt;%</span></span>
<span id="cb86-107"><a href="figure-4.html#cb86-107" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(num <span class="sc">&lt;</span> <span class="fl">0.5</span><span class="sc">*</span><span class="fu">ncol</span>(dat_gene)) <span class="sc">%&gt;%</span></span>
<span id="cb86-108"><a href="figure-4.html#cb86-108" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>num)</span>
<span id="cb86-109"><a href="figure-4.html#cb86-109" tabindex="-1"></a></span>
<span id="cb86-110"><a href="figure-4.html#cb86-110" tabindex="-1"></a>clinical <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/08 队列病人生存资料-v231026.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-111"><a href="figure-4.html#cb86-111" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-112"><a href="figure-4.html#cb86-112" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(bianhao_new,OS_stat,OS) <span class="sc">%&gt;%</span></span>
<span id="cb86-113"><a href="figure-4.html#cb86-113" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">bianhao=</span><span class="fu">paste0</span>(<span class="st">&quot;A&quot;</span>,bianhao_new)) <span class="sc">%&gt;%</span></span>
<span id="cb86-114"><a href="figure-4.html#cb86-114" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>bianhao_new) <span class="sc">%&gt;%</span></span>
<span id="cb86-115"><a href="figure-4.html#cb86-115" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb86-116"><a href="figure-4.html#cb86-116" tabindex="-1"></a></span>
<span id="cb86-117"><a href="figure-4.html#cb86-117" tabindex="-1"></a>dat_t <span class="ot">&lt;-</span> <span class="fu">t</span>(dat_gene) <span class="sc">%&gt;%</span></span>
<span id="cb86-118"><a href="figure-4.html#cb86-118" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-119"><a href="figure-4.html#cb86-119" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-120"><a href="figure-4.html#cb86-120" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(clinical,<span class="at">by=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-121"><a href="figure-4.html#cb86-121" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(OS,OS_stat,<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb86-122"><a href="figure-4.html#cb86-122" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-123"><a href="figure-4.html#cb86-123" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;time&quot;</span><span class="ot">=</span><span class="st">&quot;OS&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-124"><a href="figure-4.html#cb86-124" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;status&quot;</span><span class="ot">=</span><span class="st">&quot;OS_stat&quot;</span>)</span>
<span id="cb86-125"><a href="figure-4.html#cb86-125" tabindex="-1"></a>gene_name <span class="ot">&lt;-</span> <span class="fu">names</span>(dat_t)[<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(dat_t)]</span>
<span id="cb86-126"><a href="figure-4.html#cb86-126" tabindex="-1"></a></span>
<span id="cb86-127"><a href="figure-4.html#cb86-127" tabindex="-1"></a>dat_t_raw <span class="ot">&lt;-</span> <span class="fu">t</span>(dat_gene) <span class="sc">%&gt;%</span></span>
<span id="cb86-128"><a href="figure-4.html#cb86-128" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-129"><a href="figure-4.html#cb86-129" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-130"><a href="figure-4.html#cb86-130" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(clinical,<span class="at">by=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-131"><a href="figure-4.html#cb86-131" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(OS,OS_stat,<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb86-132"><a href="figure-4.html#cb86-132" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-133"><a href="figure-4.html#cb86-133" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;time&quot;</span><span class="ot">=</span><span class="st">&quot;OS&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-134"><a href="figure-4.html#cb86-134" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;status&quot;</span><span class="ot">=</span><span class="st">&quot;OS_stat&quot;</span>)</span>
<span id="cb86-135"><a href="figure-4.html#cb86-135" tabindex="-1"></a>gene_name_raw <span class="ot">&lt;-</span> <span class="fu">names</span>(dat_t_raw)[<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(dat_t_raw)]</span>
<span id="cb86-136"><a href="figure-4.html#cb86-136" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name=</span>gene_name,<span class="at">name_raw=</span>gene_name_raw)</span>
<span id="cb86-137"><a href="figure-4.html#cb86-137" tabindex="-1"></a></span>
<span id="cb86-138"><a href="figure-4.html#cb86-138" tabindex="-1"></a>univ_formulas <span class="ot">&lt;-</span> <span class="fu">lapply</span>(gene_name,<span class="cf">function</span>(x) stats<span class="sc">::</span><span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">&#39;survival::Surv(time, status)~&#39;</span>, x)))</span>
<span id="cb86-139"><a href="figure-4.html#cb86-139" tabindex="-1"></a></span>
<span id="cb86-140"><a href="figure-4.html#cb86-140" tabindex="-1"></a>univ_models <span class="ot">&lt;-</span> <span class="fu">lapply</span>(univ_formulas, <span class="cf">function</span>(x){survival<span class="sc">::</span><span class="fu">coxph</span>(x, <span class="at">data =</span> dat_t)})</span>
<span id="cb86-141"><a href="figure-4.html#cb86-141" tabindex="-1"></a></span>
<span id="cb86-142"><a href="figure-4.html#cb86-142" tabindex="-1"></a>univ_results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(univ_models,</span>
<span id="cb86-143"><a href="figure-4.html#cb86-143" tabindex="-1"></a>                       <span class="cf">function</span>(x){</span>
<span id="cb86-144"><a href="figure-4.html#cb86-144" tabindex="-1"></a>                         x <span class="ot">&lt;-</span> <span class="fu">summary</span>(x)</span>
<span id="cb86-145"><a href="figure-4.html#cb86-145" tabindex="-1"></a>                         p.value<span class="ot">&lt;-</span><span class="fu">signif</span>(x<span class="sc">$</span>wald[<span class="st">&quot;pvalue&quot;</span>], <span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb86-146"><a href="figure-4.html#cb86-146" tabindex="-1"></a>                         wald.test<span class="ot">&lt;-</span><span class="fu">signif</span>(x<span class="sc">$</span>wald[<span class="st">&quot;test&quot;</span>], <span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb86-147"><a href="figure-4.html#cb86-147" tabindex="-1"></a>                         beta<span class="ot">&lt;-</span><span class="fu">signif</span>(x<span class="sc">$</span>coef[<span class="dv">1</span>], <span class="at">digits=</span><span class="dv">2</span>);<span class="co">#coeficient beta</span></span>
<span id="cb86-148"><a href="figure-4.html#cb86-148" tabindex="-1"></a>                         HR <span class="ot">&lt;-</span><span class="fu">signif</span>(x<span class="sc">$</span>coef[<span class="dv">2</span>], <span class="at">digits=</span><span class="dv">2</span>);<span class="co">#exp(beta)</span></span>
<span id="cb86-149"><a href="figure-4.html#cb86-149" tabindex="-1"></a>                         HR.confint.lower <span class="ot">&lt;-</span> <span class="fu">signif</span>(x<span class="sc">$</span>conf.int[,<span class="st">&quot;lower .95&quot;</span>], <span class="dv">2</span>)</span>
<span id="cb86-150"><a href="figure-4.html#cb86-150" tabindex="-1"></a>                         HR.confint.upper <span class="ot">&lt;-</span> <span class="fu">signif</span>(x<span class="sc">$</span>conf.int[,<span class="st">&quot;upper .95&quot;</span>],<span class="dv">2</span>)</span>
<span id="cb86-151"><a href="figure-4.html#cb86-151" tabindex="-1"></a>                         HR <span class="ot">&lt;-</span> <span class="fu">paste0</span>(HR, <span class="st">&quot; (&quot;</span>,</span>
<span id="cb86-152"><a href="figure-4.html#cb86-152" tabindex="-1"></a>                                      HR.confint.lower, <span class="st">&quot;-&quot;</span>, HR.confint.upper, <span class="st">&quot;)&quot;</span>)</span>
<span id="cb86-153"><a href="figure-4.html#cb86-153" tabindex="-1"></a>                         name <span class="ot">&lt;-</span> <span class="fu">rownames</span>(x<span class="sc">$</span>coefficients)</span>
<span id="cb86-154"><a href="figure-4.html#cb86-154" tabindex="-1"></a>                         res<span class="ot">&lt;-</span><span class="fu">c</span>(name,beta, HR, wald.test, p.value)</span>
<span id="cb86-155"><a href="figure-4.html#cb86-155" tabindex="-1"></a>                         <span class="fu">names</span>(res)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span>,<span class="st">&quot;beta&quot;</span>, <span class="st">&quot;HR (95% CI for HR)&quot;</span>, <span class="st">&quot;wald.test&quot;</span>,<span class="st">&quot;p.value&quot;</span>)</span>
<span id="cb86-156"><a href="figure-4.html#cb86-156" tabindex="-1"></a>                         <span class="fu">return</span>(res)</span>
<span id="cb86-157"><a href="figure-4.html#cb86-157" tabindex="-1"></a>                       })</span>
<span id="cb86-158"><a href="figure-4.html#cb86-158" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.data.frame</span>(univ_results, <span class="at">check.names =</span> <span class="cn">FALSE</span>))</span>
<span id="cb86-159"><a href="figure-4.html#cb86-159" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(res)</span>
<span id="cb86-160"><a href="figure-4.html#cb86-160" tabindex="-1"></a></span>
<span id="cb86-161"><a href="figure-4.html#cb86-161" tabindex="-1"></a>gene_all <span class="ot">&lt;-</span> result <span class="sc">%&gt;%</span></span>
<span id="cb86-162"><a href="figure-4.html#cb86-162" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(dd,<span class="at">by=</span><span class="st">&quot;name&quot;</span>)</span>
<span id="cb86-163"><a href="figure-4.html#cb86-163" tabindex="-1"></a></span>
<span id="cb86-164"><a href="figure-4.html#cb86-164" tabindex="-1"></a><span class="fu">write.table</span>(gene_all,<span class="st">&quot;result/Figure4/4A_1.cox_gene_all_B.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb86-165"><a href="figure-4.html#cb86-165" tabindex="-1"></a></span>
<span id="cb86-166"><a href="figure-4.html#cb86-166" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb86-167"><a href="figure-4.html#cb86-167" tabindex="-1"></a><span class="co"># Step 3: Cox regression of metabolomics of T-ALL</span></span>
<span id="cb86-168"><a href="figure-4.html#cb86-168" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb86-169"><a href="figure-4.html#cb86-169" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-170"><a href="figure-4.html#cb86-170" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-171"><a href="figure-4.html#cb86-171" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(METc_BM_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb86-172"><a href="figure-4.html#cb86-172" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Lineage<span class="sc">==</span><span class="st">&quot;T&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-173"><a href="figure-4.html#cb86-173" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">bianhao=</span><span class="fu">gsub</span>(<span class="st">&quot;RJ-&quot;</span>,<span class="st">&quot;A&quot;</span>,Pid)) <span class="sc">%&gt;%</span></span>
<span id="cb86-174"><a href="figure-4.html#cb86-174" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(bianhao,METc_BM_D0_ID)</span>
<span id="cb86-175"><a href="figure-4.html#cb86-175" tabindex="-1"></a></span>
<span id="cb86-176"><a href="figure-4.html#cb86-176" tabindex="-1"></a>dat_cell <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-177"><a href="figure-4.html#cb86-177" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-178"><a href="figure-4.html#cb86-178" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-179"><a href="figure-4.html#cb86-179" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(sample_info<span class="sc">$</span>METc_BM_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb86-180"><a href="figure-4.html#cb86-180" tabindex="-1"></a>  <span class="fu">log1p</span>()</span>
<span id="cb86-181"><a href="figure-4.html#cb86-181" tabindex="-1"></a><span class="fu">names</span>(dat_cell) <span class="ot">&lt;-</span> sample_info<span class="sc">$</span>bianhao</span>
<span id="cb86-182"><a href="figure-4.html#cb86-182" tabindex="-1"></a></span>
<span id="cb86-183"><a href="figure-4.html#cb86-183" tabindex="-1"></a>clinical <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/08 队列病人生存资料-v231026.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-184"><a href="figure-4.html#cb86-184" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-185"><a href="figure-4.html#cb86-185" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(bianhao,OS_stat,OS) <span class="sc">%&gt;%</span></span>
<span id="cb86-186"><a href="figure-4.html#cb86-186" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(sample_info,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;bianhao&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb86-187"><a href="figure-4.html#cb86-187" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">match</span>(bianhao,sample_info<span class="sc">$</span>bianhao)) <span class="sc">%&gt;%</span></span>
<span id="cb86-188"><a href="figure-4.html#cb86-188" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>METc_BM_D0_ID) <span class="sc">%&gt;%</span></span>
<span id="cb86-189"><a href="figure-4.html#cb86-189" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb86-190"><a href="figure-4.html#cb86-190" tabindex="-1"></a></span>
<span id="cb86-191"><a href="figure-4.html#cb86-191" tabindex="-1"></a>dat_t <span class="ot">&lt;-</span> <span class="fu">t</span>(dat_cell) <span class="sc">%&gt;%</span></span>
<span id="cb86-192"><a href="figure-4.html#cb86-192" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-193"><a href="figure-4.html#cb86-193" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-194"><a href="figure-4.html#cb86-194" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(clinical,<span class="at">by=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-195"><a href="figure-4.html#cb86-195" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(OS,OS_stat,<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb86-196"><a href="figure-4.html#cb86-196" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-197"><a href="figure-4.html#cb86-197" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;time&quot;</span><span class="ot">=</span><span class="st">&quot;OS&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-198"><a href="figure-4.html#cb86-198" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;status&quot;</span><span class="ot">=</span><span class="st">&quot;OS_stat&quot;</span>)</span>
<span id="cb86-199"><a href="figure-4.html#cb86-199" tabindex="-1"></a>metabolite_name <span class="ot">&lt;-</span> <span class="fu">names</span>(dat_t)[<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(dat_t)]</span>
<span id="cb86-200"><a href="figure-4.html#cb86-200" tabindex="-1"></a></span>
<span id="cb86-201"><a href="figure-4.html#cb86-201" tabindex="-1"></a>dat_t_raw <span class="ot">&lt;-</span> <span class="fu">t</span>(dat_cell) <span class="sc">%&gt;%</span></span>
<span id="cb86-202"><a href="figure-4.html#cb86-202" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-203"><a href="figure-4.html#cb86-203" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-204"><a href="figure-4.html#cb86-204" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(clinical,<span class="at">by=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-205"><a href="figure-4.html#cb86-205" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(OS,OS_stat,<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb86-206"><a href="figure-4.html#cb86-206" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-207"><a href="figure-4.html#cb86-207" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;time&quot;</span><span class="ot">=</span><span class="st">&quot;OS&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-208"><a href="figure-4.html#cb86-208" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;status&quot;</span><span class="ot">=</span><span class="st">&quot;OS_stat&quot;</span>)</span>
<span id="cb86-209"><a href="figure-4.html#cb86-209" tabindex="-1"></a>metabolite_name_raw <span class="ot">&lt;-</span> <span class="fu">names</span>(dat_t_raw)[<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(dat_t_raw)]</span>
<span id="cb86-210"><a href="figure-4.html#cb86-210" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name=</span>metabolite_name,<span class="at">name_raw=</span>metabolite_name_raw)</span>
<span id="cb86-211"><a href="figure-4.html#cb86-211" tabindex="-1"></a></span>
<span id="cb86-212"><a href="figure-4.html#cb86-212" tabindex="-1"></a>univ_formulas <span class="ot">&lt;-</span> <span class="fu">lapply</span>(metabolite_name,<span class="cf">function</span>(x) stats<span class="sc">::</span><span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">&#39;survival::Surv(time, status)~&#39;</span>, x)))</span>
<span id="cb86-213"><a href="figure-4.html#cb86-213" tabindex="-1"></a></span>
<span id="cb86-214"><a href="figure-4.html#cb86-214" tabindex="-1"></a>univ_models <span class="ot">&lt;-</span> <span class="fu">lapply</span>( univ_formulas, <span class="cf">function</span>(x){survival<span class="sc">::</span><span class="fu">coxph</span>(x, <span class="at">data =</span> dat_t)})</span>
<span id="cb86-215"><a href="figure-4.html#cb86-215" tabindex="-1"></a></span>
<span id="cb86-216"><a href="figure-4.html#cb86-216" tabindex="-1"></a>univ_results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(univ_models,</span>
<span id="cb86-217"><a href="figure-4.html#cb86-217" tabindex="-1"></a>                       <span class="cf">function</span>(x){</span>
<span id="cb86-218"><a href="figure-4.html#cb86-218" tabindex="-1"></a>                         x <span class="ot">&lt;-</span> <span class="fu">summary</span>(x)</span>
<span id="cb86-219"><a href="figure-4.html#cb86-219" tabindex="-1"></a>                         p.value<span class="ot">&lt;-</span><span class="fu">signif</span>(x<span class="sc">$</span>wald[<span class="st">&quot;pvalue&quot;</span>], <span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb86-220"><a href="figure-4.html#cb86-220" tabindex="-1"></a>                         wald.test<span class="ot">&lt;-</span><span class="fu">signif</span>(x<span class="sc">$</span>wald[<span class="st">&quot;test&quot;</span>], <span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb86-221"><a href="figure-4.html#cb86-221" tabindex="-1"></a>                         beta<span class="ot">&lt;-</span><span class="fu">signif</span>(x<span class="sc">$</span>coef[<span class="dv">1</span>], <span class="at">digits=</span><span class="dv">2</span>);</span>
<span id="cb86-222"><a href="figure-4.html#cb86-222" tabindex="-1"></a>                         HR <span class="ot">&lt;-</span><span class="fu">signif</span>(x<span class="sc">$</span>coef[<span class="dv">2</span>], <span class="at">digits=</span><span class="dv">2</span>);</span>
<span id="cb86-223"><a href="figure-4.html#cb86-223" tabindex="-1"></a>                         HR.confint.lower <span class="ot">&lt;-</span> <span class="fu">signif</span>(x<span class="sc">$</span>conf.int[,<span class="st">&quot;lower .95&quot;</span>], <span class="dv">2</span>)</span>
<span id="cb86-224"><a href="figure-4.html#cb86-224" tabindex="-1"></a>                         HR.confint.upper <span class="ot">&lt;-</span> <span class="fu">signif</span>(x<span class="sc">$</span>conf.int[,<span class="st">&quot;upper .95&quot;</span>],<span class="dv">2</span>)</span>
<span id="cb86-225"><a href="figure-4.html#cb86-225" tabindex="-1"></a>                         HR <span class="ot">&lt;-</span> <span class="fu">paste0</span>(HR, <span class="st">&quot; (&quot;</span>,</span>
<span id="cb86-226"><a href="figure-4.html#cb86-226" tabindex="-1"></a>                                      HR.confint.lower, <span class="st">&quot;-&quot;</span>, HR.confint.upper, <span class="st">&quot;)&quot;</span>)</span>
<span id="cb86-227"><a href="figure-4.html#cb86-227" tabindex="-1"></a>                         name <span class="ot">&lt;-</span> <span class="fu">rownames</span>(x<span class="sc">$</span>coefficients)</span>
<span id="cb86-228"><a href="figure-4.html#cb86-228" tabindex="-1"></a>                         res<span class="ot">&lt;-</span><span class="fu">c</span>(name,beta, HR, wald.test, p.value)</span>
<span id="cb86-229"><a href="figure-4.html#cb86-229" tabindex="-1"></a>                         <span class="fu">names</span>(res)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span>,<span class="st">&quot;beta&quot;</span>, <span class="st">&quot;HR (95% CI for HR)&quot;</span>, <span class="st">&quot;wald.test&quot;</span>,<span class="st">&quot;p.value&quot;</span>)</span>
<span id="cb86-230"><a href="figure-4.html#cb86-230" tabindex="-1"></a>                         <span class="fu">return</span>(res)</span>
<span id="cb86-231"><a href="figure-4.html#cb86-231" tabindex="-1"></a>                       })</span>
<span id="cb86-232"><a href="figure-4.html#cb86-232" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.data.frame</span>(univ_results, <span class="at">check.names =</span> <span class="cn">FALSE</span>))</span>
<span id="cb86-233"><a href="figure-4.html#cb86-233" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(res)</span>
<span id="cb86-234"><a href="figure-4.html#cb86-234" tabindex="-1"></a></span>
<span id="cb86-235"><a href="figure-4.html#cb86-235" tabindex="-1"></a>metabolite_all <span class="ot">&lt;-</span> result <span class="sc">%&gt;%</span></span>
<span id="cb86-236"><a href="figure-4.html#cb86-236" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(dd,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span>))</span>
<span id="cb86-237"><a href="figure-4.html#cb86-237" tabindex="-1"></a></span>
<span id="cb86-238"><a href="figure-4.html#cb86-238" tabindex="-1"></a><span class="fu">write.table</span>(metabolite_all,<span class="st">&quot;result/Figure4/4A_1.cox_metabolite_all_T.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb86-239"><a href="figure-4.html#cb86-239" tabindex="-1"></a></span>
<span id="cb86-240"><a href="figure-4.html#cb86-240" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb86-241"><a href="figure-4.html#cb86-241" tabindex="-1"></a><span class="co">#  Step 4: Cox regression of  transcriptomics of T-ALL</span></span>
<span id="cb86-242"><a href="figure-4.html#cb86-242" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb86-243"><a href="figure-4.html#cb86-243" tabindex="-1"></a>gene_metabolite1 <span class="ot">&lt;-</span> gene_metabolite <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(dest_type<span class="sc">==</span><span class="st">&quot;gene&quot;</span>)</span>
<span id="cb86-244"><a href="figure-4.html#cb86-244" tabindex="-1"></a>gene2 <span class="ot">&lt;-</span> PathwayExtendData <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;gene&quot;</span>)</span>
<span id="cb86-245"><a href="figure-4.html#cb86-245" tabindex="-1"></a>gene_filter <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(gene_metabolite1<span class="sc">$</span>gene,gene2<span class="sc">$</span>name))</span>
<span id="cb86-246"><a href="figure-4.html#cb86-246" tabindex="-1"></a><span class="fu">length</span>(gene_filter)</span>
<span id="cb86-247"><a href="figure-4.html#cb86-247" tabindex="-1"></a></span>
<span id="cb86-248"><a href="figure-4.html#cb86-248" tabindex="-1"></a>sample_rna <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-249"><a href="figure-4.html#cb86-249" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-250"><a href="figure-4.html#cb86-250" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Lineage<span class="sc">==</span><span class="st">&quot;T&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb86-251"><a href="figure-4.html#cb86-251" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(RNA_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb86-252"><a href="figure-4.html#cb86-252" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">bianhao=</span><span class="fu">gsub</span>(<span class="st">&quot;RJ-&quot;</span>,<span class="st">&quot;A&quot;</span>,Pid)) <span class="sc">%&gt;%</span></span>
<span id="cb86-253"><a href="figure-4.html#cb86-253" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(bianhao,RNA_id_raw)</span>
<span id="cb86-254"><a href="figure-4.html#cb86-254" tabindex="-1"></a></span>
<span id="cb86-255"><a href="figure-4.html#cb86-255" tabindex="-1"></a>dat_gene <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;raw_data/20231113_RNA_ALL_VST_coding.rds&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-256"><a href="figure-4.html#cb86-256" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-257"><a href="figure-4.html#cb86-257" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample_rna<span class="sc">$</span>RNA_id_raw) <span class="sc">%&gt;%</span></span>
<span id="cb86-258"><a href="figure-4.html#cb86-258" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-259"><a href="figure-4.html#cb86-259" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(label <span class="sc">%in%</span> gene_filter) <span class="sc">%&gt;%</span></span>
<span id="cb86-260"><a href="figure-4.html#cb86-260" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>)</span>
<span id="cb86-261"><a href="figure-4.html#cb86-261" tabindex="-1"></a></span>
<span id="cb86-262"><a href="figure-4.html#cb86-262" tabindex="-1"></a><span class="fu">names</span>(dat_gene) <span class="ot">&lt;-</span> sample_rna<span class="sc">$</span>bianhao</span>
<span id="cb86-263"><a href="figure-4.html#cb86-263" tabindex="-1"></a></span>
<span id="cb86-264"><a href="figure-4.html#cb86-264" tabindex="-1"></a>dat_gene_0 <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(dat_gene<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb86-265"><a href="figure-4.html#cb86-265" tabindex="-1"></a>dat_gene <span class="ot">&lt;-</span> dat_gene <span class="sc">%&gt;%</span></span>
<span id="cb86-266"><a href="figure-4.html#cb86-266" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">num=</span>dat_gene_0) <span class="sc">%&gt;%</span></span>
<span id="cb86-267"><a href="figure-4.html#cb86-267" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(num <span class="sc">&lt;</span> <span class="fl">0.5</span><span class="sc">*</span><span class="fu">ncol</span>(dat_gene)) <span class="sc">%&gt;%</span></span>
<span id="cb86-268"><a href="figure-4.html#cb86-268" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>num)</span>
<span id="cb86-269"><a href="figure-4.html#cb86-269" tabindex="-1"></a></span>
<span id="cb86-270"><a href="figure-4.html#cb86-270" tabindex="-1"></a>clinical <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/08 队列病人生存资料-v231026.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-271"><a href="figure-4.html#cb86-271" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-272"><a href="figure-4.html#cb86-272" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(bianhao_new,OS_stat,OS) <span class="sc">%&gt;%</span></span>
<span id="cb86-273"><a href="figure-4.html#cb86-273" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">bianhao=</span><span class="fu">paste0</span>(<span class="st">&quot;A&quot;</span>,bianhao_new)) <span class="sc">%&gt;%</span></span>
<span id="cb86-274"><a href="figure-4.html#cb86-274" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>bianhao_new) <span class="sc">%&gt;%</span></span>
<span id="cb86-275"><a href="figure-4.html#cb86-275" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb86-276"><a href="figure-4.html#cb86-276" tabindex="-1"></a></span>
<span id="cb86-277"><a href="figure-4.html#cb86-277" tabindex="-1"></a>dat_t <span class="ot">&lt;-</span> <span class="fu">t</span>(dat_gene) <span class="sc">%&gt;%</span></span>
<span id="cb86-278"><a href="figure-4.html#cb86-278" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-279"><a href="figure-4.html#cb86-279" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-280"><a href="figure-4.html#cb86-280" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(clinical,<span class="at">by=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-281"><a href="figure-4.html#cb86-281" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(OS,OS_stat,<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb86-282"><a href="figure-4.html#cb86-282" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-283"><a href="figure-4.html#cb86-283" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;time&quot;</span><span class="ot">=</span><span class="st">&quot;OS&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-284"><a href="figure-4.html#cb86-284" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;status&quot;</span><span class="ot">=</span><span class="st">&quot;OS_stat&quot;</span>)</span>
<span id="cb86-285"><a href="figure-4.html#cb86-285" tabindex="-1"></a>gene_name <span class="ot">&lt;-</span> <span class="fu">names</span>(dat_t)[<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(dat_t)]</span>
<span id="cb86-286"><a href="figure-4.html#cb86-286" tabindex="-1"></a></span>
<span id="cb86-287"><a href="figure-4.html#cb86-287" tabindex="-1"></a>dat_t_raw <span class="ot">&lt;-</span> <span class="fu">t</span>(dat_gene) <span class="sc">%&gt;%</span></span>
<span id="cb86-288"><a href="figure-4.html#cb86-288" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-289"><a href="figure-4.html#cb86-289" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-290"><a href="figure-4.html#cb86-290" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(clinical,<span class="at">by=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-291"><a href="figure-4.html#cb86-291" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(OS,OS_stat,<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb86-292"><a href="figure-4.html#cb86-292" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-293"><a href="figure-4.html#cb86-293" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;time&quot;</span><span class="ot">=</span><span class="st">&quot;OS&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-294"><a href="figure-4.html#cb86-294" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;status&quot;</span><span class="ot">=</span><span class="st">&quot;OS_stat&quot;</span>)</span>
<span id="cb86-295"><a href="figure-4.html#cb86-295" tabindex="-1"></a>gene_name_raw <span class="ot">&lt;-</span> <span class="fu">names</span>(dat_t_raw)[<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(dat_t_raw)]</span>
<span id="cb86-296"><a href="figure-4.html#cb86-296" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name=</span>gene_name,<span class="at">name_raw=</span>gene_name_raw)</span>
<span id="cb86-297"><a href="figure-4.html#cb86-297" tabindex="-1"></a></span>
<span id="cb86-298"><a href="figure-4.html#cb86-298" tabindex="-1"></a>univ_formulas <span class="ot">&lt;-</span> <span class="fu">lapply</span>(gene_name,<span class="cf">function</span>(x) stats<span class="sc">::</span><span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">&#39;survival::Surv(time, status)~&#39;</span>, x)))</span>
<span id="cb86-299"><a href="figure-4.html#cb86-299" tabindex="-1"></a></span>
<span id="cb86-300"><a href="figure-4.html#cb86-300" tabindex="-1"></a>univ_models <span class="ot">&lt;-</span> <span class="fu">lapply</span>( univ_formulas, <span class="cf">function</span>(x){survival<span class="sc">::</span><span class="fu">coxph</span>(x, <span class="at">data =</span> dat_t)})</span>
<span id="cb86-301"><a href="figure-4.html#cb86-301" tabindex="-1"></a></span>
<span id="cb86-302"><a href="figure-4.html#cb86-302" tabindex="-1"></a>univ_results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(univ_models,</span>
<span id="cb86-303"><a href="figure-4.html#cb86-303" tabindex="-1"></a>                       <span class="cf">function</span>(x){</span>
<span id="cb86-304"><a href="figure-4.html#cb86-304" tabindex="-1"></a>                         x <span class="ot">&lt;-</span> <span class="fu">summary</span>(x)</span>
<span id="cb86-305"><a href="figure-4.html#cb86-305" tabindex="-1"></a>                         p.value<span class="ot">&lt;-</span><span class="fu">signif</span>(x<span class="sc">$</span>wald[<span class="st">&quot;pvalue&quot;</span>], <span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb86-306"><a href="figure-4.html#cb86-306" tabindex="-1"></a>                         wald.test<span class="ot">&lt;-</span><span class="fu">signif</span>(x<span class="sc">$</span>wald[<span class="st">&quot;test&quot;</span>], <span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb86-307"><a href="figure-4.html#cb86-307" tabindex="-1"></a>                         beta<span class="ot">&lt;-</span><span class="fu">signif</span>(x<span class="sc">$</span>coef[<span class="dv">1</span>], <span class="at">digits=</span><span class="dv">2</span>);<span class="co">#coeficient beta</span></span>
<span id="cb86-308"><a href="figure-4.html#cb86-308" tabindex="-1"></a>                         HR <span class="ot">&lt;-</span><span class="fu">signif</span>(x<span class="sc">$</span>coef[<span class="dv">2</span>], <span class="at">digits=</span><span class="dv">2</span>);<span class="co">#exp(beta)</span></span>
<span id="cb86-309"><a href="figure-4.html#cb86-309" tabindex="-1"></a>                         HR.confint.lower <span class="ot">&lt;-</span> <span class="fu">signif</span>(x<span class="sc">$</span>conf.int[,<span class="st">&quot;lower .95&quot;</span>], <span class="dv">2</span>)</span>
<span id="cb86-310"><a href="figure-4.html#cb86-310" tabindex="-1"></a>                         HR.confint.upper <span class="ot">&lt;-</span> <span class="fu">signif</span>(x<span class="sc">$</span>conf.int[,<span class="st">&quot;upper .95&quot;</span>],<span class="dv">2</span>)</span>
<span id="cb86-311"><a href="figure-4.html#cb86-311" tabindex="-1"></a>                         HR <span class="ot">&lt;-</span> <span class="fu">paste0</span>(HR, <span class="st">&quot; (&quot;</span>,</span>
<span id="cb86-312"><a href="figure-4.html#cb86-312" tabindex="-1"></a>                                      HR.confint.lower, <span class="st">&quot;-&quot;</span>, HR.confint.upper, <span class="st">&quot;)&quot;</span>)</span>
<span id="cb86-313"><a href="figure-4.html#cb86-313" tabindex="-1"></a>                         name <span class="ot">&lt;-</span> <span class="fu">rownames</span>(x<span class="sc">$</span>coefficients)</span>
<span id="cb86-314"><a href="figure-4.html#cb86-314" tabindex="-1"></a>                         res<span class="ot">&lt;-</span><span class="fu">c</span>(name,beta, HR, wald.test, p.value)</span>
<span id="cb86-315"><a href="figure-4.html#cb86-315" tabindex="-1"></a>                         <span class="fu">names</span>(res)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span>,<span class="st">&quot;beta&quot;</span>, <span class="st">&quot;HR (95% CI for HR)&quot;</span>, <span class="st">&quot;wald.test&quot;</span>,</span>
<span id="cb86-316"><a href="figure-4.html#cb86-316" tabindex="-1"></a>                                       <span class="st">&quot;p.value&quot;</span>)</span>
<span id="cb86-317"><a href="figure-4.html#cb86-317" tabindex="-1"></a>                         <span class="fu">return</span>(res)</span>
<span id="cb86-318"><a href="figure-4.html#cb86-318" tabindex="-1"></a>                       })</span>
<span id="cb86-319"><a href="figure-4.html#cb86-319" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.data.frame</span>(univ_results, <span class="at">check.names =</span> <span class="cn">FALSE</span>))</span>
<span id="cb86-320"><a href="figure-4.html#cb86-320" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(res)</span>
<span id="cb86-321"><a href="figure-4.html#cb86-321" tabindex="-1"></a></span>
<span id="cb86-322"><a href="figure-4.html#cb86-322" tabindex="-1"></a>gene_all <span class="ot">&lt;-</span> result <span class="sc">%&gt;%</span></span>
<span id="cb86-323"><a href="figure-4.html#cb86-323" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(dd,<span class="at">by=</span><span class="st">&quot;name&quot;</span>)</span>
<span id="cb86-324"><a href="figure-4.html#cb86-324" tabindex="-1"></a></span>
<span id="cb86-325"><a href="figure-4.html#cb86-325" tabindex="-1"></a><span class="fu">write.table</span>(gene_all,<span class="st">&quot;result/Figure4/4A_1.cox_gene_all_T.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure4/4A.png" width="405" style="display: block; margin: auto;" /></p>
</div>
<div id="b-discrimination-of-bcp-all-clusters" class="section level2 hasAnchor" number="19.2">
<h2><span class="header-section-number">19.2</span> (B) Discrimination of BCP-ALL Clusters<a href="figure-4.html#b-discrimination-of-bcp-all-clusters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <strong>discrimination of three clusters (BC1, BC 2 and BC3)</strong> generated from SNF method.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="figure-4.html#cb87-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb87-2"><a href="figure-4.html#cb87-2" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb87-3"><a href="figure-4.html#cb87-3" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb87-4"><a href="figure-4.html#cb87-4" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb87-5"><a href="figure-4.html#cb87-5" tabindex="-1"></a></span>
<span id="cb87-6"><a href="figure-4.html#cb87-6" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb87-7"><a href="figure-4.html#cb87-7" tabindex="-1"></a><span class="co">#  Step 1: Load data and set parameters</span></span>
<span id="cb87-8"><a href="figure-4.html#cb87-8" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb87-9"><a href="figure-4.html#cb87-9" tabindex="-1"></a>dat_filter <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure2/1.BMMCvsHC.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-10"><a href="figure-4.html#cb87-10" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-11"><a href="figure-4.html#cb87-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(P.Value) <span class="sc">%&gt;%</span></span>
<span id="cb87-12"><a href="figure-4.html#cb87-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.5</span>)</span>
<span id="cb87-13"><a href="figure-4.html#cb87-13" tabindex="-1"></a>dat_filter<span class="sc">$</span>P.Value[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb87-14"><a href="figure-4.html#cb87-14" tabindex="-1"></a></span>
<span id="cb87-15"><a href="figure-4.html#cb87-15" tabindex="-1"></a>dat_cox <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4A_1.cox_metabolite_all_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-16"><a href="figure-4.html#cb87-16" tabindex="-1"></a> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-17"><a href="figure-4.html#cb87-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(p.value) <span class="sc">%&gt;%</span></span>
<span id="cb87-18"><a href="figure-4.html#cb87-18" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n=</span><span class="dv">120</span>)</span>
<span id="cb87-19"><a href="figure-4.html#cb87-19" tabindex="-1"></a>dat_cox<span class="sc">$</span>p.value[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb87-20"><a href="figure-4.html#cb87-20" tabindex="-1"></a>dat_filter <span class="ot">&lt;-</span> dat_filter <span class="sc">%&gt;%</span></span>
<span id="cb87-21"><a href="figure-4.html#cb87-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name <span class="sc">%in%</span> dat_cox<span class="sc">$</span>name_raw)</span>
<span id="cb87-22"><a href="figure-4.html#cb87-22" tabindex="-1"></a></span>
<span id="cb87-23"><a href="figure-4.html#cb87-23" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-24"><a href="figure-4.html#cb87-24" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-25"><a href="figure-4.html#cb87-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(METc_BM_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb87-26"><a href="figure-4.html#cb87-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(RNA_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb87-27"><a href="figure-4.html#cb87-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Lineage<span class="sc">==</span><span class="st">&quot;B&quot;</span>)</span>
<span id="cb87-28"><a href="figure-4.html#cb87-28" tabindex="-1"></a></span>
<span id="cb87-29"><a href="figure-4.html#cb87-29" tabindex="-1"></a>dat_cell <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-30"><a href="figure-4.html#cb87-30" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-31"><a href="figure-4.html#cb87-31" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(label <span class="sc">%in%</span> dat_filter<span class="sc">$</span>name) <span class="sc">%&gt;%</span></span>
<span id="cb87-32"><a href="figure-4.html#cb87-32" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-33"><a href="figure-4.html#cb87-33" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(sample_info<span class="sc">$</span>METc_BM_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb87-34"><a href="figure-4.html#cb87-34" tabindex="-1"></a>  <span class="fu">log1p</span>()</span>
<span id="cb87-35"><a href="figure-4.html#cb87-35" tabindex="-1"></a></span>
<span id="cb87-36"><a href="figure-4.html#cb87-36" tabindex="-1"></a><span class="fu">names</span>(dat_cell) <span class="ot">&lt;-</span> sample_info<span class="sc">$</span>Pid</span>
<span id="cb87-37"><a href="figure-4.html#cb87-37" tabindex="-1"></a></span>
<span id="cb87-38"><a href="figure-4.html#cb87-38" tabindex="-1"></a>cox_gene <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4A_1.cox_gene_all_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-39"><a href="figure-4.html#cb87-39" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-40"><a href="figure-4.html#cb87-40" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(p.value) <span class="sc">%&gt;%</span></span>
<span id="cb87-41"><a href="figure-4.html#cb87-41" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n=</span><span class="dv">600</span>)</span>
<span id="cb87-42"><a href="figure-4.html#cb87-42" tabindex="-1"></a></span>
<span id="cb87-43"><a href="figure-4.html#cb87-43" tabindex="-1"></a>dat_gene <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;raw_data/20231113_RNA_ALL_VST_coding.rds&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-44"><a href="figure-4.html#cb87-44" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-45"><a href="figure-4.html#cb87-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample_info<span class="sc">$</span>RNA_id_raw) <span class="sc">%&gt;%</span></span>
<span id="cb87-46"><a href="figure-4.html#cb87-46" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-47"><a href="figure-4.html#cb87-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(label <span class="sc">%in%</span> cox_gene<span class="sc">$</span>name_raw) <span class="sc">%&gt;%</span></span>
<span id="cb87-48"><a href="figure-4.html#cb87-48" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>)</span>
<span id="cb87-49"><a href="figure-4.html#cb87-49" tabindex="-1"></a></span>
<span id="cb87-50"><a href="figure-4.html#cb87-50" tabindex="-1"></a><span class="fu">names</span>(dat_gene) <span class="ot">&lt;-</span> sample_info<span class="sc">$</span>Pid</span>
<span id="cb87-51"><a href="figure-4.html#cb87-51" tabindex="-1"></a></span>
<span id="cb87-52"><a href="figure-4.html#cb87-52" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb87-53"><a href="figure-4.html#cb87-53" tabindex="-1"></a><span class="co">#  Step 2: SNF of discrimination BCP-ALL clusters</span></span>
<span id="cb87-54"><a href="figure-4.html#cb87-54" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb87-55"><a href="figure-4.html#cb87-55" tabindex="-1"></a><span class="fu">library</span>(SNFtool)</span>
<span id="cb87-56"><a href="figure-4.html#cb87-56" tabindex="-1"></a>metabolite_norm <span class="ot">=</span> <span class="fu">standardNormalization</span>(<span class="fu">t</span>(dat_cell))</span>
<span id="cb87-57"><a href="figure-4.html#cb87-57" tabindex="-1"></a>metgene_norm <span class="ot">=</span> <span class="fu">standardNormalization</span>(<span class="fu">t</span>(dat_gene))</span>
<span id="cb87-58"><a href="figure-4.html#cb87-58" tabindex="-1"></a></span>
<span id="cb87-59"><a href="figure-4.html#cb87-59" tabindex="-1"></a><span class="fu">dim</span>(metabolite_norm)</span>
<span id="cb87-60"><a href="figure-4.html#cb87-60" tabindex="-1"></a><span class="fu">dim</span>(metgene_norm)</span>
<span id="cb87-61"><a href="figure-4.html#cb87-61" tabindex="-1"></a></span>
<span id="cb87-62"><a href="figure-4.html#cb87-62" tabindex="-1"></a><span class="fu">write.table</span>(metabolite_norm,<span class="st">&quot;result/Figure4/4B_metabolite_norm_B.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb87-63"><a href="figure-4.html#cb87-63" tabindex="-1"></a><span class="fu">write.table</span>(metgene_norm,<span class="st">&quot;result/Figure4/4B_metgene_norm_B.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb87-64"><a href="figure-4.html#cb87-64" tabindex="-1"></a></span>
<span id="cb87-65"><a href="figure-4.html#cb87-65" tabindex="-1"></a>Dist1 <span class="ot">=</span> (SNFtool<span class="sc">::</span><span class="fu">dist2</span>(<span class="fu">as.matrix</span>(metabolite_norm),<span class="fu">as.matrix</span>(metabolite_norm)))<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb87-66"><a href="figure-4.html#cb87-66" tabindex="-1"></a>Dist2 <span class="ot">=</span> (SNFtool<span class="sc">::</span><span class="fu">dist2</span>(<span class="fu">as.matrix</span>(metgene_norm),<span class="fu">as.matrix</span>(metgene_norm)))<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb87-67"><a href="figure-4.html#cb87-67" tabindex="-1"></a>W1 <span class="ot">=</span> <span class="fu">affinityMatrix</span>(Dist1, <span class="dv">10</span>, <span class="fl">0.5</span>)</span>
<span id="cb87-68"><a href="figure-4.html#cb87-68" tabindex="-1"></a>W2 <span class="ot">=</span> <span class="fu">affinityMatrix</span>(Dist2, <span class="dv">10</span>, <span class="fl">0.5</span>)</span>
<span id="cb87-69"><a href="figure-4.html#cb87-69" tabindex="-1"></a>W <span class="ot">=</span> <span class="fu">SNF</span>(<span class="fu">list</span>(W1,W2), <span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb87-70"><a href="figure-4.html#cb87-70" tabindex="-1"></a>ec <span class="ot">&lt;-</span> <span class="fu">estimateNumberOfClustersGivenGraph</span>(W, <span class="at">NUMC=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb87-71"><a href="figure-4.html#cb87-71" tabindex="-1"></a></span>
<span id="cb87-72"><a href="figure-4.html#cb87-72" tabindex="-1"></a>Clusters <span class="ot">=</span> <span class="fu">spectralClustering</span>(W,<span class="at">K=</span><span class="dv">3</span>)</span>
<span id="cb87-73"><a href="figure-4.html#cb87-73" tabindex="-1"></a>M_label<span class="ot">=</span><span class="fu">cbind</span>(Clusters,sample_info) <span class="sc">%&gt;%</span></span>
<span id="cb87-74"><a href="figure-4.html#cb87-74" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Clusters=</span><span class="fu">ifelse</span>(Clusters<span class="sc">==</span><span class="dv">1</span>,<span class="st">&quot;BC3&quot;</span>,</span>
<span id="cb87-75"><a href="figure-4.html#cb87-75" tabindex="-1"></a>                         <span class="fu">ifelse</span>(Clusters<span class="sc">==</span><span class="dv">2</span>,<span class="st">&quot;BC2&quot;</span>,</span>
<span id="cb87-76"><a href="figure-4.html#cb87-76" tabindex="-1"></a>                         <span class="fu">ifelse</span>(Clusters<span class="sc">==</span><span class="dv">3</span>,<span class="st">&quot;BC1&quot;</span>,Clusters))))</span>
<span id="cb87-77"><a href="figure-4.html#cb87-77" tabindex="-1"></a></span>
<span id="cb87-78"><a href="figure-4.html#cb87-78" tabindex="-1"></a><span class="cf">if</span> (<span class="dv">0</span>) {</span>
<span id="cb87-79"><a href="figure-4.html#cb87-79" tabindex="-1"></a>  <span class="fu">pdf</span>(<span class="fu">paste0</span>(<span class="st">&quot;result/Figure4/4B_SNF_discrimination_B.pdf&quot;</span>))</span>
<span id="cb87-80"><a href="figure-4.html#cb87-80" tabindex="-1"></a>  <span class="fu">displayClusters</span>(W, Clusters)</span>
<span id="cb87-81"><a href="figure-4.html#cb87-81" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb87-82"><a href="figure-4.html#cb87-82" tabindex="-1"></a>}</span>
<span id="cb87-83"><a href="figure-4.html#cb87-83" tabindex="-1"></a></span>
<span id="cb87-84"><a href="figure-4.html#cb87-84" tabindex="-1"></a><span class="fu">write.table</span>(M_label,<span class="fu">paste0</span>(<span class="st">&quot;result/Figure4/4B_cluster_B.txt&quot;</span>),<span class="at">quote=</span>F,<span class="at">row.names =</span> F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb87-85"><a href="figure-4.html#cb87-85" tabindex="-1"></a></span>
<span id="cb87-86"><a href="figure-4.html#cb87-86" tabindex="-1"></a><span class="fu">library</span>(ComplexHeatmap)</span>
<span id="cb87-87"><a href="figure-4.html#cb87-87" tabindex="-1"></a>l <span class="ot">&lt;-</span> M_label <span class="sc">%&gt;%</span></span>
<span id="cb87-88"><a href="figure-4.html#cb87-88" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(Clusters)</span>
<span id="cb87-89"><a href="figure-4.html#cb87-89" tabindex="-1"></a></span>
<span id="cb87-90"><a href="figure-4.html#cb87-90" tabindex="-1"></a>W_2 <span class="ot">&lt;-</span> W <span class="sc">%&gt;%</span></span>
<span id="cb87-91"><a href="figure-4.html#cb87-91" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-92"><a href="figure-4.html#cb87-92" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(l<span class="sc">$</span>Pid) <span class="sc">%&gt;%</span></span>
<span id="cb87-93"><a href="figure-4.html#cb87-93" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;sample&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-94"><a href="figure-4.html#cb87-94" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">match</span>(sample,l<span class="sc">$</span>Pid)) <span class="sc">%&gt;%</span></span>
<span id="cb87-95"><a href="figure-4.html#cb87-95" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;sample&quot;</span>)</span>
<span id="cb87-96"><a href="figure-4.html#cb87-96" tabindex="-1"></a>W_2[W_2<span class="sc">==</span><span class="fl">0.5</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb87-97"><a href="figure-4.html#cb87-97" tabindex="-1"></a></span>
<span id="cb87-98"><a href="figure-4.html#cb87-98" tabindex="-1"></a>col_fun <span class="ot">=</span> circlize<span class="sc">::</span><span class="fu">colorRamp2</span>(<span class="fu">c</span>( <span class="dv">0</span>, <span class="fl">0.03</span>), <span class="fu">c</span>( <span class="st">&quot;white&quot;</span>,<span class="st">&quot;#F48326&quot;</span>))</span>
<span id="cb87-99"><a href="figure-4.html#cb87-99" tabindex="-1"></a></span>
<span id="cb87-100"><a href="figure-4.html#cb87-100" tabindex="-1"></a>p_metabolite <span class="ot">&lt;-</span> <span class="fu">Heatmap</span>(W_2,<span class="at">height=</span><span class="fu">unit</span>(<span class="dv">10</span>,<span class="st">&quot;cm&quot;</span>),<span class="at">name=</span><span class="st">&quot;Sample Data&quot;</span>,</span>
<span id="cb87-101"><a href="figure-4.html#cb87-101" tabindex="-1"></a>                        <span class="at">cluster_rows =</span> F,<span class="at">cluster_columns =</span> F,</span>
<span id="cb87-102"><a href="figure-4.html#cb87-102" tabindex="-1"></a>                        <span class="at">col =</span> col_fun,</span>
<span id="cb87-103"><a href="figure-4.html#cb87-103" tabindex="-1"></a>                        <span class="at">show_column_names =</span> F,<span class="at">show_row_names =</span> F,</span>
<span id="cb87-104"><a href="figure-4.html#cb87-104" tabindex="-1"></a>                        <span class="at">row_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">3</span>),</span>
<span id="cb87-105"><a href="figure-4.html#cb87-105" tabindex="-1"></a>                        <span class="at">column_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">3</span>))</span>
<span id="cb87-106"><a href="figure-4.html#cb87-106" tabindex="-1"></a></span>
<span id="cb87-107"><a href="figure-4.html#cb87-107" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;result/Figure4/4B_SNF_discrimination_complexheatmap_B.pdf&quot;</span>,<span class="at">width=</span><span class="dv">5</span>,<span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb87-108"><a href="figure-4.html#cb87-108" tabindex="-1"></a>p_metabolite</span>
<span id="cb87-109"><a href="figure-4.html#cb87-109" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p><img src="Figure-1025/Figure4/4B.png" width="356" style="display: block; margin: auto;" /></p>
</div>
<div id="c-os-in-75-bcp-all-patients" class="section level2 hasAnchor" number="19.3">
<h2><span class="header-section-number">19.3</span> (C) OS in 75 BCP-ALL patients<a href="figure-4.html#c-os-in-75-bcp-all-patients" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The association of the three metabolic clusters with <strong>clinical overall survival (OS)</strong> outcomes in 75 BCP-ALL patients (P-value from log rank test).</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="figure-4.html#cb88-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb88-2"><a href="figure-4.html#cb88-2" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb88-3"><a href="figure-4.html#cb88-3" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb88-4"><a href="figure-4.html#cb88-4" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb88-5"><a href="figure-4.html#cb88-5" tabindex="-1"></a></span>
<span id="cb88-6"><a href="figure-4.html#cb88-6" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb88-7"><a href="figure-4.html#cb88-7" tabindex="-1"></a><span class="co">#  Step 1: Load data</span></span>
<span id="cb88-8"><a href="figure-4.html#cb88-8" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb88-9"><a href="figure-4.html#cb88-9" tabindex="-1"></a>clinical_survival <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="fu">paste0</span>(<span class="st">&quot;result/Figure4/4B_cluster_B.txt&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb88-10"><a href="figure-4.html#cb88-10" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb88-11"><a href="figure-4.html#cb88-11" tabindex="-1"></a></span>
<span id="cb88-12"><a href="figure-4.html#cb88-12" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb88-13"><a href="figure-4.html#cb88-13" tabindex="-1"></a><span class="co">#  Step 2: Overall survival analysis</span></span>
<span id="cb88-14"><a href="figure-4.html#cb88-14" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb88-15"><a href="figure-4.html#cb88-15" tabindex="-1"></a>surv_object <span class="ot">&lt;-</span> <span class="fu">Surv</span>(<span class="at">time =</span> clinical_survival<span class="sc">$</span>OS<span class="sc">/</span><span class="dv">30</span>, <span class="at">event =</span> clinical_survival<span class="sc">$</span>OS_stat)</span>
<span id="cb88-16"><a href="figure-4.html#cb88-16" tabindex="-1"></a>fit_cluster <span class="ot">&lt;-</span> <span class="fu">survfit</span>(surv_object <span class="sc">~</span> Clusters, <span class="at">data =</span> clinical_survival)</span>
<span id="cb88-17"><a href="figure-4.html#cb88-17" tabindex="-1"></a></span>
<span id="cb88-18"><a href="figure-4.html#cb88-18" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> survminer<span class="sc">::</span><span class="fu">ggsurvplot</span>(fit_cluster, <span class="at">data =</span> clinical_survival, </span>
<span id="cb88-19"><a href="figure-4.html#cb88-19" tabindex="-1"></a>                            <span class="at">title=</span><span class="st">&quot;OS&quot;</span>,</span>
<span id="cb88-20"><a href="figure-4.html#cb88-20" tabindex="-1"></a>                            <span class="at">palette=</span><span class="fu">c</span>(<span class="st">&quot;#9BD53F&quot;</span>,<span class="st">&quot;#A6CEE3&quot;</span>,<span class="st">&quot;#EA644C&quot;</span>),</span>
<span id="cb88-21"><a href="figure-4.html#cb88-21" tabindex="-1"></a>                            <span class="at">tables.theme =</span> <span class="fu">theme_void</span>(),<span class="at">risk.table =</span> <span class="cn">TRUE</span>,</span>
<span id="cb88-22"><a href="figure-4.html#cb88-22" tabindex="-1"></a>                            <span class="at">risk.table.fontsize=</span><span class="dv">6</span>,</span>
<span id="cb88-23"><a href="figure-4.html#cb88-23" tabindex="-1"></a>                            <span class="at">break.time.by =</span> <span class="dv">12</span>,</span>
<span id="cb88-24"><a href="figure-4.html#cb88-24" tabindex="-1"></a>                            <span class="at">risk.table.y.text =</span> <span class="cn">FALSE</span>, </span>
<span id="cb88-25"><a href="figure-4.html#cb88-25" tabindex="-1"></a>                            <span class="at">tables.height =</span> <span class="fl">0.15</span>,<span class="at">risk.table.col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb88-26"><a href="figure-4.html#cb88-26" tabindex="-1"></a>                            <span class="at">pval =</span> <span class="cn">TRUE</span>,<span class="at">pval.method =</span> F,</span>
<span id="cb88-27"><a href="figure-4.html#cb88-27" tabindex="-1"></a>                            <span class="at">pval.coord=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.1</span>),<span class="at">pval.size=</span><span class="dv">6</span>,</span>
<span id="cb88-28"><a href="figure-4.html#cb88-28" tabindex="-1"></a>                            <span class="at">font.tickslab=</span><span class="fu">c</span>(<span class="dv">14</span>,<span class="st">&quot;plain&quot;</span>,<span class="st">&quot;black&quot;</span>),</span>
<span id="cb88-29"><a href="figure-4.html#cb88-29" tabindex="-1"></a>                            <span class="at">xlab=</span><span class="st">&quot;Time (Months) &quot;</span>,<span class="at">ylab=</span><span class="st">&quot;OS Survival&quot;</span>)</span>
<span id="cb88-30"><a href="figure-4.html#cb88-30" tabindex="-1"></a></span>
<span id="cb88-31"><a href="figure-4.html#cb88-31" tabindex="-1"></a><span class="fu">pdf</span>(<span class="fu">paste0</span>(<span class="st">&quot;result/Figure4/4C_OS_B.pdf&quot;</span>),<span class="at">onefile=</span><span class="cn">FALSE</span>)</span>
<span id="cb88-32"><a href="figure-4.html#cb88-32" tabindex="-1"></a>p1</span>
<span id="cb88-33"><a href="figure-4.html#cb88-33" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p><img src="Figure-1025/Figure4/4C.png" width="50%" style="display: block; margin: auto;" /></p>
</div>
<div id="d-multivariate-cox-analysis" class="section level2 hasAnchor" number="19.4">
<h2><span class="header-section-number">19.4</span> (D) Multivariate Cox Analysis<a href="figure-4.html#d-multivariate-cox-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <strong>multivariate cox analysis</strong> reveals that the metabolic clusters was an independent prognostic value for <strong>OS and event-free survival (EFS)</strong>, respectively. In the genetic-based risk stratification, <em>BCR-ABL1</em>, <em>ETV6-RUNX1</em>, <em>DUX4-IGH</em> and <em>TCF3-PBX1</em> fusion are categorized into standard risk group.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="figure-4.html#cb89-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb89-2"><a href="figure-4.html#cb89-2" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb89-3"><a href="figure-4.html#cb89-3" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb89-4"><a href="figure-4.html#cb89-4" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb89-5"><a href="figure-4.html#cb89-5" tabindex="-1"></a></span>
<span id="cb89-6"><a href="figure-4.html#cb89-6" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb89-7"><a href="figure-4.html#cb89-7" tabindex="-1"></a><span class="co">#  Step 1: Load data and set parameters</span></span>
<span id="cb89-8"><a href="figure-4.html#cb89-8" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb89-9"><a href="figure-4.html#cb89-9" tabindex="-1"></a>tt <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/Sample_RNA_190_fusion_mutation_v1130.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-10"><a href="figure-4.html#cb89-10" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb89-11"><a href="figure-4.html#cb89-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(mutation,fusion,RNA_id,Prediction_Check)</span>
<span id="cb89-12"><a href="figure-4.html#cb89-12" tabindex="-1"></a></span>
<span id="cb89-13"><a href="figure-4.html#cb89-13" tabindex="-1"></a>M_label <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4B_cluster_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-14"><a href="figure-4.html#cb89-14" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb89-15"><a href="figure-4.html#cb89-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Clusters=</span><span class="fu">ifelse</span>(Clusters <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;BC1&quot;</span>,<span class="st">&quot;BC2&quot;</span>),<span class="st">&quot;BC1+BC2&quot;</span>,Clusters)) <span class="sc">%&gt;%</span></span>
<span id="cb89-16"><a href="figure-4.html#cb89-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Clusters=</span><span class="fu">as.factor</span>(Clusters)) <span class="sc">%&gt;%</span></span>
<span id="cb89-17"><a href="figure-4.html#cb89-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Clusters,Pid)</span>
<span id="cb89-18"><a href="figure-4.html#cb89-18" tabindex="-1"></a></span>
<span id="cb89-19"><a href="figure-4.html#cb89-19" tabindex="-1"></a>clinical_survival <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-20"><a href="figure-4.html#cb89-20" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb89-21"><a href="figure-4.html#cb89-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;Sex&quot;</span><span class="ot">=</span><span class="st">&quot;Gender&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-22"><a href="figure-4.html#cb89-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Pid,RNA_id_raw,Age,Sex,WBC,d28CR,ifHSCT,OS,OS_stat,EFS,EFS_stat,RFS,RFS_stat) <span class="sc">%&gt;%</span></span>
<span id="cb89-23"><a href="figure-4.html#cb89-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">d28CR=</span><span class="fu">ifelse</span>(d28CR <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;early death&quot;</span>,<span class="st">&quot;NR&quot;</span>,<span class="st">&quot;PR&quot;</span>),<span class="st">&quot;non_CR&quot;</span>,d28CR)) <span class="sc">%&gt;%</span></span>
<span id="cb89-24"><a href="figure-4.html#cb89-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;D28_status&quot;</span><span class="ot">=</span><span class="st">&quot;d28CR&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-25"><a href="figure-4.html#cb89-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">WBC_type=</span> <span class="fu">ifelse</span>(WBC<span class="sc">&gt;</span><span class="dv">30</span>, <span class="st">&quot;high&quot;</span>,</span>
<span id="cb89-26"><a href="figure-4.html#cb89-26" tabindex="-1"></a>                          <span class="fu">ifelse</span>(WBC<span class="sc">&lt;=</span><span class="dv">30</span>,<span class="st">&quot;low&quot;</span>,<span class="cn">NA</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb89-27"><a href="figure-4.html#cb89-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ifHSCT=</span><span class="fu">as.factor</span>(ifHSCT)) <span class="sc">%&gt;%</span></span>
<span id="cb89-28"><a href="figure-4.html#cb89-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(M_label,<span class="at">by=</span><span class="st">&quot;Pid&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-29"><a href="figure-4.html#cb89-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(tt,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;RNA_id_raw&quot;</span><span class="ot">=</span><span class="st">&quot;RNA_id&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb89-30"><a href="figure-4.html#cb89-30" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">NCCN=</span><span class="fu">ifelse</span>(fusion <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ETV6-RUNX1&quot;</span>,<span class="st">&quot;DUX4-IGH&quot;</span>,<span class="st">&quot;TCF3-PBX1&quot;</span>),<span class="st">&quot;Standard risk&quot;</span>,</span>
<span id="cb89-31"><a href="figure-4.html#cb89-31" tabindex="-1"></a>                     <span class="fu">ifelse</span>(fusion <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;KMT2A-AFF1&quot;</span>,<span class="st">&quot;EP300-ZNF384&quot;</span>,<span class="st">&quot;SMARCA2-ZNF384&quot;</span>),<span class="st">&quot;Poor risk&quot;</span>,</span>
<span id="cb89-32"><a href="figure-4.html#cb89-32" tabindex="-1"></a>                     <span class="fu">ifelse</span>(Prediction_Check<span class="sc">==</span><span class="st">&quot;Ph-like&quot;</span>,<span class="st">&quot;Poor risk&quot;</span>,</span>
<span id="cb89-33"><a href="figure-4.html#cb89-33" tabindex="-1"></a>                     <span class="fu">ifelse</span>(Prediction_Check <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;BCL2/MYC&quot;</span>,<span class="st">&quot;PAX5alt&quot;</span>,<span class="st">&quot;High hyperdoploid&quot;</span>, <span class="st">&quot;Low hypodiploid&quot;</span>,<span class="st">&quot;IDH&quot;</span>,<span class="st">&quot;TWIST2-high&quot;</span>),<span class="st">&quot;Poor risk&quot;</span>,<span class="st">&quot;Standard risk&quot;</span>))))) <span class="sc">%&gt;%</span></span>
<span id="cb89-34"><a href="figure-4.html#cb89-34" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">NCCN=</span><span class="fu">factor</span>(NCCN,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;Standard risk&quot;</span>,<span class="st">&quot;Poor risk&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb89-35"><a href="figure-4.html#cb89-35" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Sex=</span><span class="fu">factor</span>(Sex,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;M&quot;</span>,<span class="st">&quot;F&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb89-36"><a href="figure-4.html#cb89-36" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Age=</span><span class="fu">ifelse</span>(Age<span class="sc">&gt;</span><span class="dv">40</span>,<span class="st">&quot;old&quot;</span>,<span class="st">&quot;young&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb89-37"><a href="figure-4.html#cb89-37" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Age=</span><span class="fu">factor</span>(Age,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;young&quot;</span>,<span class="st">&quot;old&quot;</span>)))</span>
<span id="cb89-38"><a href="figure-4.html#cb89-38" tabindex="-1"></a></span>
<span id="cb89-39"><a href="figure-4.html#cb89-39" tabindex="-1"></a>var.names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Clusters&quot;</span>,<span class="st">&quot;Age&quot;</span>,<span class="st">&quot;WBC_type&quot;</span>,<span class="st">&quot;NCCN&quot;</span>,<span class="st">&quot;D28_status&quot;</span>,<span class="st">&quot;ifHSCT&quot;</span>)</span>
<span id="cb89-40"><a href="figure-4.html#cb89-40" tabindex="-1"></a></span>
<span id="cb89-41"><a href="figure-4.html#cb89-41" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb89-42"><a href="figure-4.html#cb89-42" tabindex="-1"></a><span class="co">#  Step 2: Event-free survival (EFS)</span></span>
<span id="cb89-43"><a href="figure-4.html#cb89-43" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb89-44"><a href="figure-4.html#cb89-44" tabindex="-1"></a>f_efs <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">&#39;Surv(EFS, EFS_stat)~&#39;</span>,<span class="fu">paste</span>(var.names,<span class="at">collapse =</span> <span class="st">&quot;+&quot;</span>)))</span>
<span id="cb89-45"><a href="figure-4.html#cb89-45" tabindex="-1"></a>fit.final <span class="ot">&lt;-</span> <span class="fu">coxph</span>(f_efs,<span class="at">data=</span>clinical_survival)</span>
<span id="cb89-46"><a href="figure-4.html#cb89-46" tabindex="-1"></a>p_efs <span class="ot">&lt;-</span> <span class="fu">ggforest</span>(fit.final,<span class="at">main=</span><span class="st">&quot;EFS Hzard Ratio&quot;</span>,</span>
<span id="cb89-47"><a href="figure-4.html#cb89-47" tabindex="-1"></a>                  <span class="at">cpositions=</span><span class="fu">c</span>(<span class="fl">0.02</span>,<span class="fl">0.22</span>,<span class="fl">0.4</span>),</span>
<span id="cb89-48"><a href="figure-4.html#cb89-48" tabindex="-1"></a>                  <span class="at">fontsize=</span><span class="fl">0.8</span>,<span class="at">refLabel=</span><span class="st">&quot;reference&quot;</span>,</span>
<span id="cb89-49"><a href="figure-4.html#cb89-49" tabindex="-1"></a>                  <span class="at">noDigits=</span><span class="dv">2</span>,<span class="at">data=</span>clinical_survival)</span>
<span id="cb89-50"><a href="figure-4.html#cb89-50" tabindex="-1"></a></span>
<span id="cb89-51"><a href="figure-4.html#cb89-51" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb89-52"><a href="figure-4.html#cb89-52" tabindex="-1"></a><span class="co">#  Step 3: Overall survival(OS)</span></span>
<span id="cb89-53"><a href="figure-4.html#cb89-53" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb89-54"><a href="figure-4.html#cb89-54" tabindex="-1"></a>f_os <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">&#39;Surv(OS, OS_stat)~&#39;</span>,<span class="fu">paste</span>(var.names,<span class="at">collapse =</span> <span class="st">&quot;+&quot;</span>)))</span>
<span id="cb89-55"><a href="figure-4.html#cb89-55" tabindex="-1"></a>fit.os <span class="ot">&lt;-</span> <span class="fu">coxph</span>(f_os,<span class="at">data=</span>clinical_survival)</span>
<span id="cb89-56"><a href="figure-4.html#cb89-56" tabindex="-1"></a>p_os <span class="ot">&lt;-</span> <span class="fu">ggforest</span>(fit.os,<span class="at">main=</span><span class="st">&quot;OS Hzard Ratio&quot;</span>,</span>
<span id="cb89-57"><a href="figure-4.html#cb89-57" tabindex="-1"></a>                 <span class="at">cpositions=</span><span class="fu">c</span>(<span class="fl">0.02</span>,<span class="fl">0.22</span>,<span class="fl">0.4</span>),</span>
<span id="cb89-58"><a href="figure-4.html#cb89-58" tabindex="-1"></a>                 <span class="at">fontsize=</span><span class="fl">0.8</span>,<span class="at">refLabel=</span><span class="st">&quot;reference&quot;</span>,</span>
<span id="cb89-59"><a href="figure-4.html#cb89-59" tabindex="-1"></a>                 <span class="at">noDigits=</span><span class="dv">2</span>,<span class="at">data=</span>clinical_survival)</span>
<span id="cb89-60"><a href="figure-4.html#cb89-60" tabindex="-1"></a><span class="fu">ggsave</span>(p_efs,<span class="at">filename =</span> <span class="st">&quot;result/Figure4/4D_HR_EFS_B_NCCN_1plus2vs3.pdf&quot;</span>,<span class="at">width=</span><span class="dv">9</span>,<span class="at">height=</span><span class="fl">4.5</span>)</span>
<span id="cb89-61"><a href="figure-4.html#cb89-61" tabindex="-1"></a><span class="fu">ggsave</span>(p_os,<span class="at">filename =</span> <span class="st">&quot;result/Figure4/4D_HR_OS_B_NCCN_1plus2vs3.pdf&quot;</span>,<span class="at">width=</span><span class="dv">9</span>,<span class="at">height=</span><span class="fl">4.5</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure4/4D.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="e-subnetwork-between-bc3-and-bc12" class="section level2 hasAnchor" number="19.5">
<h2><span class="header-section-number">19.5</span> (E) Subnetwork between BC3 and BC1/2<a href="figure-4.html#e-subnetwork-between-bc3-and-bc12" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A core metabolism-based subnetwork that best explains the difference between BC3 and BC1/2. Each circle node represents one metabolite (labeled with KEGG ID), and each square node represents one gene. The colors represent the logFC (logarithm of fold change) of genes, with red and green indicating different expression levels, while yellow and blue represent the logFC of metabolites, indicating varying levels. Highlighted labels belong to cholesterol metabolism and nicotinate and nicotinamide metabolism.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="figure-4.html#cb90-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb90-2"><a href="figure-4.html#cb90-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb90-3"><a href="figure-4.html#cb90-3" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb90-4"><a href="figure-4.html#cb90-4" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb90-5"><a href="figure-4.html#cb90-5" tabindex="-1"></a><span class="fu">library</span>(graphics)</span>
<span id="cb90-6"><a href="figure-4.html#cb90-6" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb90-7"><a href="figure-4.html#cb90-7" tabindex="-1"></a></span>
<span id="cb90-8"><a href="figure-4.html#cb90-8" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb90-9"><a href="figure-4.html#cb90-9" tabindex="-1"></a></span>
<span id="cb90-10"><a href="figure-4.html#cb90-10" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb90-11"><a href="figure-4.html#cb90-11" tabindex="-1"></a><span class="co">#  Step 1: Read data and set parameters</span></span>
<span id="cb90-12"><a href="figure-4.html#cb90-12" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb90-13"><a href="figure-4.html#cb90-13" tabindex="-1"></a></span>
<span id="cb90-14"><a href="figure-4.html#cb90-14" tabindex="-1"></a>gene1 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/Chol_Transport_Deg_Ester.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-15"><a href="figure-4.html#cb90-15" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb90-16"><a href="figure-4.html#cb90-16" tabindex="-1"></a></span>
<span id="cb90-17"><a href="figure-4.html#cb90-17" tabindex="-1"></a>name_gene <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4A_1.cox_gene_all_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-18"><a href="figure-4.html#cb90-18" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb90-19"><a href="figure-4.html#cb90-19" tabindex="-1"></a></span>
<span id="cb90-20"><a href="figure-4.html#cb90-20" tabindex="-1"></a>diff_gene <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S5H_gene_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-21"><a href="figure-4.html#cb90-21" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb90-22"><a href="figure-4.html#cb90-22" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">%in%</span> name_gene<span class="sc">$</span>name_raw)</span>
<span id="cb90-23"><a href="figure-4.html#cb90-23" tabindex="-1"></a></span>
<span id="cb90-24"><a href="figure-4.html#cb90-24" tabindex="-1"></a>kid <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">&quot;raw_data/cell_metabolite_info_all_v1109.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-25"><a href="figure-4.html#cb90-25" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb90-26"><a href="figure-4.html#cb90-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(refmet_name,KEGG) <span class="sc">%&gt;%</span></span>
<span id="cb90-27"><a href="figure-4.html#cb90-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">KEGG=</span><span class="fu">ifelse</span>(KEGG<span class="sc">==</span><span class="st">&quot;None&quot;</span>,refmet_name,KEGG))</span>
<span id="cb90-28"><a href="figure-4.html#cb90-28" tabindex="-1"></a></span>
<span id="cb90-29"><a href="figure-4.html#cb90-29" tabindex="-1"></a>diff_meta <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S5H_metabolite_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-30"><a href="figure-4.html#cb90-30" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb90-31"><a href="figure-4.html#cb90-31" tabindex="-1"></a>  <span class="fu">inner_join</span>(kid,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span><span class="ot">=</span><span class="st">&quot;refmet_name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb90-32"><a href="figure-4.html#cb90-32" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span></span>
<span id="cb90-33"><a href="figure-4.html#cb90-33" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;name&quot;</span><span class="ot">=</span><span class="st">&quot;KEGG&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-34"><a href="figure-4.html#cb90-34" tabindex="-1"></a>  <span class="fu">arrange</span>(P.Value) <span class="sc">%&gt;%</span></span>
<span id="cb90-35"><a href="figure-4.html#cb90-35" tabindex="-1"></a>  <span class="fu">distinct</span>(name,<span class="at">.keep_all =</span> T)</span>
<span id="cb90-36"><a href="figure-4.html#cb90-36" tabindex="-1"></a></span>
<span id="cb90-37"><a href="figure-4.html#cb90-37" tabindex="-1"></a><span class="fu">names</span>(diff_meta)[<span class="dv">4</span>]  <span class="ot">&lt;-</span> <span class="st">&quot;p_value&quot;</span></span>
<span id="cb90-38"><a href="figure-4.html#cb90-38" tabindex="-1"></a></span>
<span id="cb90-39"><a href="figure-4.html#cb90-39" tabindex="-1"></a><span class="fu">names</span>(diff_gene)[<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="st">&quot;p_value&quot;</span></span>
<span id="cb90-40"><a href="figure-4.html#cb90-40" tabindex="-1"></a></span>
<span id="cb90-41"><a href="figure-4.html#cb90-41" tabindex="-1"></a>dd <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/subnetwork_important_edge-300_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-42"><a href="figure-4.html#cb90-42" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb90-43"><a href="figure-4.html#cb90-43" tabindex="-1"></a></span>
<span id="cb90-44"><a href="figure-4.html#cb90-44" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb90-45"><a href="figure-4.html#cb90-45" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(dd)</span>
<span id="cb90-46"><a href="figure-4.html#cb90-46" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="fu">layout_with_dh</span>(g,<span class="fu">set.seed</span>(<span class="dv">1</span>))  </span>
<span id="cb90-47"><a href="figure-4.html#cb90-47" tabindex="-1"></a><span class="fu">row.names</span>(layout) <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">V</span>(g))</span>
<span id="cb90-48"><a href="figure-4.html#cb90-48" tabindex="-1"></a><span class="fu">colnames</span>(layout) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;pos.x&quot;</span>,<span class="st">&quot;pos.y&quot;</span>)</span>
<span id="cb90-49"><a href="figure-4.html#cb90-49" tabindex="-1"></a></span>
<span id="cb90-50"><a href="figure-4.html#cb90-50" tabindex="-1"></a>kk <span class="ot">&lt;-</span> PathwayExtendData <span class="sc">%&gt;%</span></span>
<span id="cb90-51"><a href="figure-4.html#cb90-51" tabindex="-1"></a>  <span class="fu">filter</span>(kegg_pathwayname<span class="sc">==</span><span class="st">&quot;Nicotinate and nicotinamide metabolism&quot;</span>)</span>
<span id="cb90-52"><a href="figure-4.html#cb90-52" tabindex="-1"></a></span>
<span id="cb90-53"><a href="figure-4.html#cb90-53" tabindex="-1"></a>node.data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(layout) <span class="sc">%&gt;%</span></span>
<span id="cb90-54"><a href="figure-4.html#cb90-54" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-55"><a href="figure-4.html#cb90-55" tabindex="-1"></a>  <span class="fu">left_join</span>(diff_gene,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;label&quot;</span><span class="ot">=</span><span class="st">&quot;name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb90-56"><a href="figure-4.html#cb90-56" tabindex="-1"></a>  <span class="fu">left_join</span>(diff_meta,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;label&quot;</span><span class="ot">=</span><span class="st">&quot;name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb90-57"><a href="figure-4.html#cb90-57" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(label,pos.x,pos.y,logFC.x,logFC.y) <span class="sc">%&gt;%</span></span>
<span id="cb90-58"><a href="figure-4.html#cb90-58" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logFC=</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(logFC.x),logFC.y,logFC.x)) <span class="sc">%&gt;%</span></span>
<span id="cb90-59"><a href="figure-4.html#cb90-59" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type=</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(logFC.x),<span class="st">&quot;metabolite&quot;</span>,<span class="st">&quot;gene&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb90-60"><a href="figure-4.html#cb90-60" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>logFC.x,<span class="sc">-</span>logFC.y) <span class="sc">%&gt;%</span></span>
<span id="cb90-61"><a href="figure-4.html#cb90-61" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label1=</span><span class="fu">ifelse</span>(label <span class="sc">%in%</span> gene1<span class="sc">$</span><span class="st">`</span><span class="at">Gene Name</span><span class="st">`</span> <span class="sc">|</span>label <span class="sc">%in%</span> kk<span class="sc">$</span>name<span class="sc">|</span> type<span class="sc">==</span><span class="st">&quot;metabolite&quot;</span>,label,<span class="cn">NA</span>))</span>
<span id="cb90-62"><a href="figure-4.html#cb90-62" tabindex="-1"></a></span>
<span id="cb90-63"><a href="figure-4.html#cb90-63" tabindex="-1"></a>ab <span class="ot">&lt;-</span> node.data <span class="sc">%&gt;%</span></span>
<span id="cb90-64"><a href="figure-4.html#cb90-64" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(label1)) <span class="sc">%&gt;%</span></span>
<span id="cb90-65"><a href="figure-4.html#cb90-65" tabindex="-1"></a>  <span class="fu">left_join</span>(gene1,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;label1&quot;</span><span class="ot">=</span><span class="st">&quot;Gene Name&quot;</span>))</span>
<span id="cb90-66"><a href="figure-4.html#cb90-66" tabindex="-1"></a><span class="fu">write.table</span>(ab,<span class="st">&quot;result/Figure4/4E_node-filter-v0925.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names =</span> F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb90-67"><a href="figure-4.html#cb90-67" tabindex="-1"></a></span>
<span id="cb90-68"><a href="figure-4.html#cb90-68" tabindex="-1"></a>edge.data <span class="ot">&lt;-</span> dd <span class="sc">%&gt;%</span></span>
<span id="cb90-69"><a href="figure-4.html#cb90-69" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;fromNode&quot;</span><span class="ot">=</span><span class="st">&quot;X1&quot;</span>,</span>
<span id="cb90-70"><a href="figure-4.html#cb90-70" tabindex="-1"></a>         <span class="st">&quot;toNode&quot;</span><span class="ot">=</span><span class="st">&quot;X2&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-71"><a href="figure-4.html#cb90-71" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(fromNode,toNode) <span class="sc">%&gt;%</span></span>
<span id="cb90-72"><a href="figure-4.html#cb90-72" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(node.data,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;fromNode&quot;</span><span class="ot">=</span><span class="st">&quot;label&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb90-73"><a href="figure-4.html#cb90-73" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;from.x&quot;</span><span class="ot">=</span><span class="st">&quot;pos.x&quot;</span>,<span class="st">&quot;from.y&quot;</span><span class="ot">=</span><span class="st">&quot;pos.y&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-74"><a href="figure-4.html#cb90-74" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(node.data,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;toNode&quot;</span><span class="ot">=</span><span class="st">&quot;label&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb90-75"><a href="figure-4.html#cb90-75" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;to.x&quot;</span><span class="ot">=</span><span class="st">&quot;pos.x&quot;</span>,<span class="st">&quot;to.y&quot;</span><span class="ot">=</span><span class="st">&quot;pos.y&quot;</span>)</span>
<span id="cb90-76"><a href="figure-4.html#cb90-76" tabindex="-1"></a></span>
<span id="cb90-77"><a href="figure-4.html#cb90-77" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb90-78"><a href="figure-4.html#cb90-78" tabindex="-1"></a><span class="co">#  Step 2: Core metabolism-based subnetwork</span></span>
<span id="cb90-79"><a href="figure-4.html#cb90-79" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb90-80"><a href="figure-4.html#cb90-80" tabindex="-1"></a><span class="do">## node.color</span></span>
<span id="cb90-81"><a href="figure-4.html#cb90-81" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;raw_data/node.color.R&quot;</span>)</span>
<span id="cb90-82"><a href="figure-4.html#cb90-82" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;raw_data/col.key.R&quot;</span>)</span>
<span id="cb90-83"><a href="figure-4.html#cb90-83" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;raw_data/colorpanel2.R&quot;</span>)</span>
<span id="cb90-84"><a href="figure-4.html#cb90-84" tabindex="-1"></a></span>
<span id="cb90-85"><a href="figure-4.html#cb90-85" tabindex="-1"></a>node_meta <span class="ot">&lt;-</span> node.data <span class="sc">%&gt;%</span></span>
<span id="cb90-86"><a href="figure-4.html#cb90-86" tabindex="-1"></a>  <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;metabolite&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-87"><a href="figure-4.html#cb90-87" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logFC=</span><span class="fu">round</span>(logFC,<span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb90-88"><a href="figure-4.html#cb90-88" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logFC=</span><span class="fu">ifelse</span>(logFC <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.58</span>, <span class="sc">-</span><span class="fl">0.58</span>, logFC))</span>
<span id="cb90-89"><a href="figure-4.html#cb90-89" tabindex="-1"></a>meta_limits<span class="ot">=</span><span class="fu">as.numeric</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%.1f&quot;</span>, <span class="fu">max</span>(<span class="fu">max</span>(node_meta<span class="sc">$</span>logFC),<span class="fu">abs</span>(<span class="fu">min</span>(node_meta<span class="sc">$</span>logFC)))))<span class="sc">+</span><span class="fl">0.1</span></span>
<span id="cb90-90"><a href="figure-4.html#cb90-90" tabindex="-1"></a>meta_color <span class="ot">&lt;-</span> <span class="fu">node.color</span>(<span class="at">limit=</span>meta_limits,node_meta<span class="sc">$</span>logFC,<span class="at">low=</span><span class="st">&quot;#007DDB&quot;</span>, <span class="at">mid=</span><span class="st">&quot;gray&quot;</span>, <span class="at">high=</span><span class="st">&quot;yellow&quot;</span>)</span>
<span id="cb90-91"><a href="figure-4.html#cb90-91" tabindex="-1"></a>node_meta<span class="sc">$</span>color <span class="ot">&lt;-</span> meta_color</span>
<span id="cb90-92"><a href="figure-4.html#cb90-92" tabindex="-1"></a></span>
<span id="cb90-93"><a href="figure-4.html#cb90-93" tabindex="-1"></a>node_gene <span class="ot">&lt;-</span> node.data <span class="sc">%&gt;%</span></span>
<span id="cb90-94"><a href="figure-4.html#cb90-94" tabindex="-1"></a>  <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;gene&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-95"><a href="figure-4.html#cb90-95" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logFC=</span><span class="fu">round</span>(logFC,<span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb90-96"><a href="figure-4.html#cb90-96" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logFC=</span><span class="fu">ifelse</span>(logFC <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">2</span>, logFC)) <span class="sc">%&gt;%</span></span>
<span id="cb90-97"><a href="figure-4.html#cb90-97" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logFC=</span><span class="fu">ifelse</span>(logFC <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="dv">2</span>, logFC))</span>
<span id="cb90-98"><a href="figure-4.html#cb90-98" tabindex="-1"></a>gene_limits<span class="ot">=</span><span class="fu">as.numeric</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%.1f&quot;</span>, <span class="fu">max</span>(<span class="fu">max</span>(node_gene<span class="sc">$</span>logFC),<span class="fu">abs</span>(<span class="fu">min</span>(node_gene<span class="sc">$</span>logFC)))))<span class="sc">+</span><span class="fl">0.1</span></span>
<span id="cb90-99"><a href="figure-4.html#cb90-99" tabindex="-1"></a>gene_color <span class="ot">&lt;-</span> <span class="fu">node.color</span>(<span class="at">limit=</span>gene_limits,node_gene<span class="sc">$</span>logFC,<span class="at">low=</span><span class="st">&quot;#4FBD81&quot;</span>,<span class="at">mid=</span><span class="st">&quot;gray&quot;</span>,<span class="at">high=</span><span class="st">&quot;#D01910&quot;</span>)</span>
<span id="cb90-100"><a href="figure-4.html#cb90-100" tabindex="-1"></a>node_gene<span class="sc">$</span>color <span class="ot">&lt;-</span> gene_color</span>
<span id="cb90-101"><a href="figure-4.html#cb90-101" tabindex="-1"></a></span>
<span id="cb90-102"><a href="figure-4.html#cb90-102" tabindex="-1"></a>node.data1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(node_meta,node_gene)</span>
<span id="cb90-103"><a href="figure-4.html#cb90-103" tabindex="-1"></a></span>
<span id="cb90-104"><a href="figure-4.html#cb90-104" tabindex="-1"></a>aa<span class="ot">=</span>node.data1<span class="sc">$</span>color</span>
<span id="cb90-105"><a href="figure-4.html#cb90-105" tabindex="-1"></a><span class="fu">names</span>(aa)<span class="ot">=</span>node.data1<span class="sc">$</span>color</span>
<span id="cb90-106"><a href="figure-4.html#cb90-106" tabindex="-1"></a></span>
<span id="cb90-107"><a href="figure-4.html#cb90-107" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()</span>
<span id="cb90-108"><a href="figure-4.html#cb90-108" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> from.x, <span class="at">y =</span> from.y, <span class="at">xend =</span> to.x, <span class="at">yend =</span> to.y),</span>
<span id="cb90-109"><a href="figure-4.html#cb90-109" tabindex="-1"></a>                        <span class="at">color =</span> <span class="st">&quot;#CCCCCC&quot;</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">data =</span> edge.data) </span>
<span id="cb90-110"><a href="figure-4.html#cb90-110" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> pos.x, <span class="at">y =</span> pos.y,<span class="at">color=</span>color,<span class="at">shape=</span>type), </span>
<span id="cb90-111"><a href="figure-4.html#cb90-111" tabindex="-1"></a>                      <span class="at">size =</span> <span class="dv">4</span>, <span class="at">data =</span> node.data1) </span>
<span id="cb90-112"><a href="figure-4.html#cb90-112" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>) <span class="sc">*</span> <span class="dv">2</span>) </span>
<span id="cb90-113"><a href="figure-4.html#cb90-113" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">theme_void</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>)</span>
<span id="cb90-114"><a href="figure-4.html#cb90-114" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb90-115"><a href="figure-4.html#cb90-115" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x =</span> pos.x, <span class="at">y =</span> pos.y,<span class="at">label=</span>label1),<span class="at">data=</span>node.data1)</span>
<span id="cb90-116"><a href="figure-4.html#cb90-116" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> aa)<span class="sc">+</span><span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;gene&quot;</span><span class="ot">=</span><span class="st">&quot;square&quot;</span>,<span class="st">&quot;metabolite&quot;</span><span class="ot">=</span><span class="st">&quot;circle&quot;</span>))</span>
<span id="cb90-117"><a href="figure-4.html#cb90-117" tabindex="-1"></a></span>
<span id="cb90-118"><a href="figure-4.html#cb90-118" tabindex="-1"></a><span class="co">#if (0){</span></span>
<span id="cb90-119"><a href="figure-4.html#cb90-119" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot.new</span>()</span>
<span id="cb90-120"><a href="figure-4.html#cb90-120" tabindex="-1"></a>off.sets<span class="ot">=</span><span class="fu">col.key</span>(<span class="at">limit=</span>gene_limits,<span class="at">bins=</span><span class="dv">10</span>,<span class="at">cex=</span><span class="fl">0.5</span>,<span class="at">graph.size =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">off.sets=</span><span class="fu">c</span>(<span class="at">x=</span><span class="dv">0</span>,<span class="at">y=</span><span class="dv">0</span>),</span>
<span id="cb90-121"><a href="figure-4.html#cb90-121" tabindex="-1"></a>                 <span class="at">low=</span><span class="st">&quot;#4FBD81&quot;</span>,<span class="at">mid=</span><span class="st">&quot;gray&quot;</span>,<span class="at">high=</span><span class="st">&quot;#D01910&quot;</span>)</span>
<span id="cb90-122"><a href="figure-4.html#cb90-122" tabindex="-1"></a>off.sets<span class="ot">=</span><span class="fu">col.key</span>(<span class="at">limit=</span>meta_limits,<span class="at">bins=</span><span class="dv">10</span>,<span class="at">cex=</span><span class="fl">0.5</span>,<span class="at">low=</span><span class="st">&quot;#007DDB&quot;</span>, <span class="at">mid=</span><span class="st">&quot;gray&quot;</span>, <span class="at">high=</span><span class="st">&quot;yellow&quot;</span>,</span>
<span id="cb90-123"><a href="figure-4.html#cb90-123" tabindex="-1"></a>                   <span class="at">off.sets=</span><span class="fu">c</span>(<span class="at">x=</span><span class="dv">0</span>,<span class="at">y=</span><span class="dv">0</span>),<span class="at">graph.size =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.9</span>))</span>
<span id="cb90-124"><a href="figure-4.html#cb90-124" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">recordPlot</span>()</span>
<span id="cb90-125"><a href="figure-4.html#cb90-125" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb90-126"><a href="figure-4.html#cb90-126" tabindex="-1"></a></span>
<span id="cb90-127"><a href="figure-4.html#cb90-127" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>()<span class="sc">+</span></span>
<span id="cb90-128"><a href="figure-4.html#cb90-128" tabindex="-1"></a>  <span class="fu">draw_plot</span>(p,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.55</span>)<span class="sc">+</span></span>
<span id="cb90-129"><a href="figure-4.html#cb90-129" tabindex="-1"></a>  <span class="fu">draw_plot</span>(gg,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb90-130"><a href="figure-4.html#cb90-130" tabindex="-1"></a></span>
<span id="cb90-131"><a href="figure-4.html#cb90-131" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure4/4E_node-300-all-B.pdf&quot;</span>,p1,<span class="at">width=</span><span class="dv">6</span>,<span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb90-132"><a href="figure-4.html#cb90-132" tabindex="-1"></a></span>
<span id="cb90-133"><a href="figure-4.html#cb90-133" tabindex="-1"></a><span class="cf">if</span> (<span class="dv">0</span>) {</span>
<span id="cb90-134"><a href="figure-4.html#cb90-134" tabindex="-1"></a>  <span class="fu">png</span>(<span class="st">&quot;result/Figure4/4E_node-300-aa.png&quot;</span>,<span class="at">width=</span><span class="dv">5</span>,<span class="at">height =</span> <span class="dv">5</span>,<span class="at">units =</span> <span class="st">&#39;in&#39;</span>, <span class="at">res =</span> <span class="dv">200</span>)</span>
<span id="cb90-135"><a href="figure-4.html#cb90-135" tabindex="-1"></a>  grid<span class="sc">::</span><span class="fu">grid.draw</span>(p1)</span>
<span id="cb90-136"><a href="figure-4.html#cb90-136" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb90-137"><a href="figure-4.html#cb90-137" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="Figure-1025/Figure4/4E.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="f-discrimination-of-t-all-clusters" class="section level2 hasAnchor" number="19.6">
<h2><span class="header-section-number">19.6</span> (F) Discrimination of T-ALL Clusters<a href="figure-4.html#f-discrimination-of-t-all-clusters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <strong>discrimination of two T-ALL clusters (TC1 and TC2)</strong> based on SNF method.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="figure-4.html#cb91-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb91-2"><a href="figure-4.html#cb91-2" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb91-3"><a href="figure-4.html#cb91-3" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb91-4"><a href="figure-4.html#cb91-4" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb91-5"><a href="figure-4.html#cb91-5" tabindex="-1"></a></span>
<span id="cb91-6"><a href="figure-4.html#cb91-6" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb91-7"><a href="figure-4.html#cb91-7" tabindex="-1"></a><span class="co">#  Step 1: Load data and set parameters</span></span>
<span id="cb91-8"><a href="figure-4.html#cb91-8" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb91-9"><a href="figure-4.html#cb91-9" tabindex="-1"></a>dat_filter <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure2/1.BMMCvsHC.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-10"><a href="figure-4.html#cb91-10" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb91-11"><a href="figure-4.html#cb91-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(P.Value) <span class="sc">%&gt;%</span></span>
<span id="cb91-12"><a href="figure-4.html#cb91-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.5</span>)</span>
<span id="cb91-13"><a href="figure-4.html#cb91-13" tabindex="-1"></a>dat_filter<span class="sc">$</span>P.Value[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb91-14"><a href="figure-4.html#cb91-14" tabindex="-1"></a></span>
<span id="cb91-15"><a href="figure-4.html#cb91-15" tabindex="-1"></a>dat_cox <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4A_1.cox_metabolite_all_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-16"><a href="figure-4.html#cb91-16" tabindex="-1"></a> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb91-17"><a href="figure-4.html#cb91-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(p.value) <span class="sc">%&gt;%</span></span>
<span id="cb91-18"><a href="figure-4.html#cb91-18" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n=</span><span class="dv">120</span>)</span>
<span id="cb91-19"><a href="figure-4.html#cb91-19" tabindex="-1"></a>dat_cox<span class="sc">$</span>p.value[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb91-20"><a href="figure-4.html#cb91-20" tabindex="-1"></a>dat_filter <span class="ot">&lt;-</span> dat_filter <span class="sc">%&gt;%</span></span>
<span id="cb91-21"><a href="figure-4.html#cb91-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name <span class="sc">%in%</span> dat_cox<span class="sc">$</span>name_raw)</span>
<span id="cb91-22"><a href="figure-4.html#cb91-22" tabindex="-1"></a></span>
<span id="cb91-23"><a href="figure-4.html#cb91-23" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-24"><a href="figure-4.html#cb91-24" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb91-25"><a href="figure-4.html#cb91-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(METc_BM_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb91-26"><a href="figure-4.html#cb91-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(RNA_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb91-27"><a href="figure-4.html#cb91-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Lineage<span class="sc">==</span><span class="st">&quot;T&quot;</span>)</span>
<span id="cb91-28"><a href="figure-4.html#cb91-28" tabindex="-1"></a></span>
<span id="cb91-29"><a href="figure-4.html#cb91-29" tabindex="-1"></a>dat_cell <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-30"><a href="figure-4.html#cb91-30" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb91-31"><a href="figure-4.html#cb91-31" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(label <span class="sc">%in%</span> dat_filter<span class="sc">$</span>name) <span class="sc">%&gt;%</span></span>
<span id="cb91-32"><a href="figure-4.html#cb91-32" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-33"><a href="figure-4.html#cb91-33" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(sample_info<span class="sc">$</span>METc_BM_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb91-34"><a href="figure-4.html#cb91-34" tabindex="-1"></a>  <span class="fu">log1p</span>()</span>
<span id="cb91-35"><a href="figure-4.html#cb91-35" tabindex="-1"></a></span>
<span id="cb91-36"><a href="figure-4.html#cb91-36" tabindex="-1"></a><span class="fu">names</span>(dat_cell) <span class="ot">&lt;-</span> sample_info<span class="sc">$</span>Pid</span>
<span id="cb91-37"><a href="figure-4.html#cb91-37" tabindex="-1"></a></span>
<span id="cb91-38"><a href="figure-4.html#cb91-38" tabindex="-1"></a>cox_gene <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4A_1.cox_gene_all_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-39"><a href="figure-4.html#cb91-39" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb91-40"><a href="figure-4.html#cb91-40" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(p.value) <span class="sc">%&gt;%</span></span>
<span id="cb91-41"><a href="figure-4.html#cb91-41" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n=</span><span class="dv">600</span>)</span>
<span id="cb91-42"><a href="figure-4.html#cb91-42" tabindex="-1"></a></span>
<span id="cb91-43"><a href="figure-4.html#cb91-43" tabindex="-1"></a>dat_gene <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;raw_data/20231113_RNA_ALL_VST_coding.rds&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-44"><a href="figure-4.html#cb91-44" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb91-45"><a href="figure-4.html#cb91-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample_info<span class="sc">$</span>RNA_id_raw) <span class="sc">%&gt;%</span></span>
<span id="cb91-46"><a href="figure-4.html#cb91-46" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-47"><a href="figure-4.html#cb91-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(label <span class="sc">%in%</span> cox_gene<span class="sc">$</span>name_raw) <span class="sc">%&gt;%</span></span>
<span id="cb91-48"><a href="figure-4.html#cb91-48" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>)</span>
<span id="cb91-49"><a href="figure-4.html#cb91-49" tabindex="-1"></a></span>
<span id="cb91-50"><a href="figure-4.html#cb91-50" tabindex="-1"></a><span class="fu">names</span>(dat_gene) <span class="ot">&lt;-</span> sample_info<span class="sc">$</span>Pid</span>
<span id="cb91-51"><a href="figure-4.html#cb91-51" tabindex="-1"></a></span>
<span id="cb91-52"><a href="figure-4.html#cb91-52" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb91-53"><a href="figure-4.html#cb91-53" tabindex="-1"></a><span class="co">#  Step 2: SNF of discrimination T-ALL clusters</span></span>
<span id="cb91-54"><a href="figure-4.html#cb91-54" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb91-55"><a href="figure-4.html#cb91-55" tabindex="-1"></a><span class="fu">library</span>(SNFtool)</span>
<span id="cb91-56"><a href="figure-4.html#cb91-56" tabindex="-1"></a>metabolite_norm <span class="ot">=</span> <span class="fu">standardNormalization</span>(<span class="fu">t</span>(dat_cell))</span>
<span id="cb91-57"><a href="figure-4.html#cb91-57" tabindex="-1"></a>metgene_norm <span class="ot">=</span> <span class="fu">standardNormalization</span>(<span class="fu">t</span>(dat_gene))</span>
<span id="cb91-58"><a href="figure-4.html#cb91-58" tabindex="-1"></a></span>
<span id="cb91-59"><a href="figure-4.html#cb91-59" tabindex="-1"></a><span class="fu">dim</span>(metabolite_norm)</span>
<span id="cb91-60"><a href="figure-4.html#cb91-60" tabindex="-1"></a><span class="fu">dim</span>(metgene_norm)</span>
<span id="cb91-61"><a href="figure-4.html#cb91-61" tabindex="-1"></a></span>
<span id="cb91-62"><a href="figure-4.html#cb91-62" tabindex="-1"></a><span class="fu">write.table</span>(metabolite_norm,<span class="st">&quot;result/Figure4/4F_metabolite_norm_T.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb91-63"><a href="figure-4.html#cb91-63" tabindex="-1"></a><span class="fu">write.table</span>(metgene_norm,<span class="st">&quot;result/Figure4/4F_metgene_norm_T.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb91-64"><a href="figure-4.html#cb91-64" tabindex="-1"></a></span>
<span id="cb91-65"><a href="figure-4.html#cb91-65" tabindex="-1"></a>Dist1 <span class="ot">=</span> (SNFtool<span class="sc">::</span><span class="fu">dist2</span>(<span class="fu">as.matrix</span>(metabolite_norm),<span class="fu">as.matrix</span>(metabolite_norm)))<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb91-66"><a href="figure-4.html#cb91-66" tabindex="-1"></a>Dist2 <span class="ot">=</span> (SNFtool<span class="sc">::</span><span class="fu">dist2</span>(<span class="fu">as.matrix</span>(metgene_norm),<span class="fu">as.matrix</span>(metgene_norm)))<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb91-67"><a href="figure-4.html#cb91-67" tabindex="-1"></a>W1 <span class="ot">=</span> <span class="fu">affinityMatrix</span>(Dist1, <span class="dv">10</span>, <span class="fl">0.5</span>)</span>
<span id="cb91-68"><a href="figure-4.html#cb91-68" tabindex="-1"></a>W2 <span class="ot">=</span> <span class="fu">affinityMatrix</span>(Dist2, <span class="dv">10</span>, <span class="fl">0.5</span>)</span>
<span id="cb91-69"><a href="figure-4.html#cb91-69" tabindex="-1"></a>W <span class="ot">=</span> <span class="fu">SNF</span>(<span class="fu">list</span>(W1,W2), <span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb91-70"><a href="figure-4.html#cb91-70" tabindex="-1"></a>ec <span class="ot">&lt;-</span> <span class="fu">estimateNumberOfClustersGivenGraph</span>(W, <span class="at">NUMC=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb91-71"><a href="figure-4.html#cb91-71" tabindex="-1"></a></span>
<span id="cb91-72"><a href="figure-4.html#cb91-72" tabindex="-1"></a>Clusters <span class="ot">=</span> <span class="fu">spectralClustering</span>(W,<span class="at">K=</span><span class="dv">2</span>)</span>
<span id="cb91-73"><a href="figure-4.html#cb91-73" tabindex="-1"></a>M_label<span class="ot">=</span><span class="fu">cbind</span>(Clusters,sample_info) <span class="sc">%&gt;%</span></span>
<span id="cb91-74"><a href="figure-4.html#cb91-74" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Clusters=</span><span class="fu">ifelse</span>(Clusters<span class="sc">==</span><span class="dv">1</span>,<span class="st">&quot;TC2&quot;</span>,</span>
<span id="cb91-75"><a href="figure-4.html#cb91-75" tabindex="-1"></a>                                <span class="fu">ifelse</span>(Clusters<span class="sc">==</span><span class="dv">2</span>,<span class="st">&quot;TC1&quot;</span>,Clusters)))</span>
<span id="cb91-76"><a href="figure-4.html#cb91-76" tabindex="-1"></a><span class="fu">write.table</span>(M_label,<span class="fu">paste0</span>(<span class="st">&quot;result/Figure4/4F_cluster_T.txt&quot;</span>),<span class="at">quote=</span>F,<span class="at">row.names =</span> F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb91-77"><a href="figure-4.html#cb91-77" tabindex="-1"></a></span>
<span id="cb91-78"><a href="figure-4.html#cb91-78" tabindex="-1"></a>l <span class="ot">&lt;-</span> M_label <span class="sc">%&gt;%</span></span>
<span id="cb91-79"><a href="figure-4.html#cb91-79" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(Clusters)</span>
<span id="cb91-80"><a href="figure-4.html#cb91-80" tabindex="-1"></a></span>
<span id="cb91-81"><a href="figure-4.html#cb91-81" tabindex="-1"></a>W_2 <span class="ot">&lt;-</span> W <span class="sc">%&gt;%</span></span>
<span id="cb91-82"><a href="figure-4.html#cb91-82" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb91-83"><a href="figure-4.html#cb91-83" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(l<span class="sc">$</span>Pid) <span class="sc">%&gt;%</span></span>
<span id="cb91-84"><a href="figure-4.html#cb91-84" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;sample&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-85"><a href="figure-4.html#cb91-85" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">match</span>(sample,l<span class="sc">$</span>Pid)) <span class="sc">%&gt;%</span></span>
<span id="cb91-86"><a href="figure-4.html#cb91-86" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;sample&quot;</span>)</span>
<span id="cb91-87"><a href="figure-4.html#cb91-87" tabindex="-1"></a>W_2[W_2<span class="sc">==</span><span class="fl">0.5</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb91-88"><a href="figure-4.html#cb91-88" tabindex="-1"></a></span>
<span id="cb91-89"><a href="figure-4.html#cb91-89" tabindex="-1"></a>col_fun <span class="ot">=</span> circlize<span class="sc">::</span><span class="fu">colorRamp2</span>(<span class="fu">c</span>( <span class="dv">0</span>, <span class="fl">0.03</span>), <span class="fu">c</span>( <span class="st">&quot;white&quot;</span>,<span class="st">&quot;#F48326&quot;</span>))</span>
<span id="cb91-90"><a href="figure-4.html#cb91-90" tabindex="-1"></a></span>
<span id="cb91-91"><a href="figure-4.html#cb91-91" tabindex="-1"></a><span class="fu">library</span>(ComplexHeatmap)</span>
<span id="cb91-92"><a href="figure-4.html#cb91-92" tabindex="-1"></a>p_metabolite <span class="ot">&lt;-</span> <span class="fu">Heatmap</span>(W_2,<span class="at">height=</span><span class="fu">unit</span>(<span class="dv">10</span>,<span class="st">&quot;cm&quot;</span>),<span class="at">name=</span><span class="st">&quot;Sample Data&quot;</span>,</span>
<span id="cb91-93"><a href="figure-4.html#cb91-93" tabindex="-1"></a>                        <span class="at">cluster_rows =</span> F,<span class="at">cluster_columns =</span> F,</span>
<span id="cb91-94"><a href="figure-4.html#cb91-94" tabindex="-1"></a>                        <span class="at">col =</span> col_fun,</span>
<span id="cb91-95"><a href="figure-4.html#cb91-95" tabindex="-1"></a>                        <span class="co">#top_annotation =top_annotation,</span></span>
<span id="cb91-96"><a href="figure-4.html#cb91-96" tabindex="-1"></a>                        <span class="at">show_column_names =</span> F,<span class="at">show_row_names =</span> F,</span>
<span id="cb91-97"><a href="figure-4.html#cb91-97" tabindex="-1"></a>                        <span class="at">row_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">3</span>),<span class="at">column_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">3</span>))</span>
<span id="cb91-98"><a href="figure-4.html#cb91-98" tabindex="-1"></a></span>
<span id="cb91-99"><a href="figure-4.html#cb91-99" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;result/Figure4/4F_SNF_discrimination_complexheatmap_T.pdf&quot;</span>,<span class="at">width=</span><span class="dv">5</span>,<span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb91-100"><a href="figure-4.html#cb91-100" tabindex="-1"></a>p_metabolite</span>
<span id="cb91-101"><a href="figure-4.html#cb91-101" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p><img src="Figure-1025/Figure4/4F.png" width="292" style="display: block; margin: auto;" /></p>
</div>
<div id="g-os-of-tc12" class="section level2 hasAnchor" number="19.7">
<h2><span class="header-section-number">19.7</span> (G) OS of TC1/2<a href="figure-4.html#g-os-of-tc12" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The association of the two metabolic clusters with <strong>clinical OS outcomes</strong> in 24 T-ALL patients (P-value from log rank test). The result suggests TC1 is of significantly poorer prognosis than TC2.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="figure-4.html#cb92-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb92-2"><a href="figure-4.html#cb92-2" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb92-3"><a href="figure-4.html#cb92-3" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb92-4"><a href="figure-4.html#cb92-4" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb92-5"><a href="figure-4.html#cb92-5" tabindex="-1"></a></span>
<span id="cb92-6"><a href="figure-4.html#cb92-6" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb92-7"><a href="figure-4.html#cb92-7" tabindex="-1"></a><span class="co">#  OS of TC1/2</span></span>
<span id="cb92-8"><a href="figure-4.html#cb92-8" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb92-9"><a href="figure-4.html#cb92-9" tabindex="-1"></a>clinical_survival <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="fu">paste0</span>(<span class="st">&quot;result/Figure4/4F_cluster_T.txt&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb92-10"><a href="figure-4.html#cb92-10" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb92-11"><a href="figure-4.html#cb92-11" tabindex="-1"></a></span>
<span id="cb92-12"><a href="figure-4.html#cb92-12" tabindex="-1"></a>surv_object <span class="ot">&lt;-</span> <span class="fu">Surv</span>(<span class="at">time =</span> clinical_survival<span class="sc">$</span>OS<span class="sc">/</span><span class="dv">30</span>, <span class="at">event =</span> clinical_survival<span class="sc">$</span>OS_stat)</span>
<span id="cb92-13"><a href="figure-4.html#cb92-13" tabindex="-1"></a>fit_cluster <span class="ot">&lt;-</span> <span class="fu">survfit</span>(surv_object <span class="sc">~</span> Clusters, <span class="at">data =</span> clinical_survival)</span>
<span id="cb92-14"><a href="figure-4.html#cb92-14" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> survminer<span class="sc">::</span><span class="fu">ggsurvplot</span>(fit_cluster, <span class="at">data =</span> clinical_survival, </span>
<span id="cb92-15"><a href="figure-4.html#cb92-15" tabindex="-1"></a>                            <span class="at">title=</span><span class="st">&quot;OS&quot;</span>,</span>
<span id="cb92-16"><a href="figure-4.html#cb92-16" tabindex="-1"></a>                            <span class="at">palette=</span><span class="fu">c</span>(<span class="st">&quot;#9BD53F&quot;</span>,<span class="st">&quot;#A6CEE3&quot;</span>),</span>
<span id="cb92-17"><a href="figure-4.html#cb92-17" tabindex="-1"></a>                            <span class="at">tables.theme =</span> <span class="fu">theme_void</span>(),<span class="at">risk.table =</span> <span class="cn">TRUE</span>,</span>
<span id="cb92-18"><a href="figure-4.html#cb92-18" tabindex="-1"></a>                            <span class="at">risk.table.fontsize=</span><span class="dv">6</span>,</span>
<span id="cb92-19"><a href="figure-4.html#cb92-19" tabindex="-1"></a>                            <span class="at">break.time.by =</span> <span class="dv">12</span>,</span>
<span id="cb92-20"><a href="figure-4.html#cb92-20" tabindex="-1"></a>                            <span class="at">risk.table.y.text =</span> <span class="cn">FALSE</span>, </span>
<span id="cb92-21"><a href="figure-4.html#cb92-21" tabindex="-1"></a>                            <span class="at">tables.height =</span> <span class="fl">0.15</span>,<span class="at">risk.table.col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb92-22"><a href="figure-4.html#cb92-22" tabindex="-1"></a>                            <span class="at">pval =</span> <span class="cn">TRUE</span>,</span>
<span id="cb92-23"><a href="figure-4.html#cb92-23" tabindex="-1"></a>                            <span class="at">pval.method =</span> F,<span class="at">pval.coord=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.1</span>),<span class="at">pval.size=</span><span class="dv">6</span>,</span>
<span id="cb92-24"><a href="figure-4.html#cb92-24" tabindex="-1"></a>                            <span class="at">font.tickslab=</span><span class="fu">c</span>(<span class="dv">14</span>,<span class="st">&quot;plain&quot;</span>,<span class="st">&quot;black&quot;</span>),</span>
<span id="cb92-25"><a href="figure-4.html#cb92-25" tabindex="-1"></a>                            <span class="at">xlab=</span><span class="st">&quot;Time (Months) &quot;</span>,<span class="at">ylab=</span><span class="st">&quot;OS Survival&quot;</span>)</span>
<span id="cb92-26"><a href="figure-4.html#cb92-26" tabindex="-1"></a></span>
<span id="cb92-27"><a href="figure-4.html#cb92-27" tabindex="-1"></a><span class="fu">pdf</span>(<span class="fu">paste0</span>(<span class="st">&quot;result/Figure4/4G_OS_T.pdf&quot;</span>),<span class="at">onefile=</span><span class="cn">FALSE</span>)</span>
<span id="cb92-28"><a href="figure-4.html#cb92-28" tabindex="-1"></a>p1</span>
<span id="cb92-29"><a href="figure-4.html#cb92-29" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p><img src="Figure-1025/Figure4/4G.png" width="340" style="display: block; margin: auto;" /></p>
</div>
<div id="h-subnetwork-between-tc2-and-tc1" class="section level2 hasAnchor" number="19.8">
<h2><span class="header-section-number">19.8</span> (H) Subnetwork between TC2 and TC1<a href="figure-4.html#h-subnetwork-between-tc2-and-tc1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A core metabolism-based subnetwork that best explains the difference between TC2 and TC1. Each circle node represents one metabolite (labeled with KEGG ID), and each square node represents one gene. The colors represent the logFC (logarithm of fold change) of genes, with red and green indicating different expression levels, while yellow and blue represent the logFC of metabolites, indicating varying levels. Highlighted labels belong to citrate cycle oxidative phosphorylation.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="figure-4.html#cb93-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb93-2"><a href="figure-4.html#cb93-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb93-3"><a href="figure-4.html#cb93-3" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb93-4"><a href="figure-4.html#cb93-4" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb93-5"><a href="figure-4.html#cb93-5" tabindex="-1"></a><span class="fu">library</span>(graphics)</span>
<span id="cb93-6"><a href="figure-4.html#cb93-6" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb93-7"><a href="figure-4.html#cb93-7" tabindex="-1"></a></span>
<span id="cb93-8"><a href="figure-4.html#cb93-8" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb93-9"><a href="figure-4.html#cb93-9" tabindex="-1"></a><span class="co">#  Step 1: Read data and set parameters</span></span>
<span id="cb93-10"><a href="figure-4.html#cb93-10" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb93-11"><a href="figure-4.html#cb93-11" tabindex="-1"></a></span>
<span id="cb93-12"><a href="figure-4.html#cb93-12" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb93-13"><a href="figure-4.html#cb93-13" tabindex="-1"></a>name_gene <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4A_1.cox_gene_all_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-14"><a href="figure-4.html#cb93-14" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb93-15"><a href="figure-4.html#cb93-15" tabindex="-1"></a></span>
<span id="cb93-16"><a href="figure-4.html#cb93-16" tabindex="-1"></a>diff_gene <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S6J_gene_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-17"><a href="figure-4.html#cb93-17" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb93-18"><a href="figure-4.html#cb93-18" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">%in%</span> name_gene<span class="sc">$</span>name_raw)</span>
<span id="cb93-19"><a href="figure-4.html#cb93-19" tabindex="-1"></a></span>
<span id="cb93-20"><a href="figure-4.html#cb93-20" tabindex="-1"></a>kid <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">&quot;raw_data/cell_metabolite_info_all_v1109.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-21"><a href="figure-4.html#cb93-21" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb93-22"><a href="figure-4.html#cb93-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(refmet_name,KEGG) <span class="sc">%&gt;%</span></span>
<span id="cb93-23"><a href="figure-4.html#cb93-23" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">KEGG=</span><span class="fu">ifelse</span>(KEGG<span class="sc">==</span><span class="st">&quot;None&quot;</span>,refmet_name,KEGG))</span>
<span id="cb93-24"><a href="figure-4.html#cb93-24" tabindex="-1"></a></span>
<span id="cb93-25"><a href="figure-4.html#cb93-25" tabindex="-1"></a>diff_meta <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S6J_metabolite_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-26"><a href="figure-4.html#cb93-26" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb93-27"><a href="figure-4.html#cb93-27" tabindex="-1"></a>  <span class="fu">inner_join</span>(kid,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span><span class="ot">=</span><span class="st">&quot;refmet_name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb93-28"><a href="figure-4.html#cb93-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span></span>
<span id="cb93-29"><a href="figure-4.html#cb93-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;name&quot;</span><span class="ot">=</span><span class="st">&quot;KEGG&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-30"><a href="figure-4.html#cb93-30" tabindex="-1"></a>  <span class="fu">arrange</span>(P.Value) <span class="sc">%&gt;%</span></span>
<span id="cb93-31"><a href="figure-4.html#cb93-31" tabindex="-1"></a>  <span class="fu">distinct</span>(name,<span class="at">.keep_all =</span> T)</span>
<span id="cb93-32"><a href="figure-4.html#cb93-32" tabindex="-1"></a></span>
<span id="cb93-33"><a href="figure-4.html#cb93-33" tabindex="-1"></a><span class="fu">names</span>(diff_meta)[<span class="dv">4</span>]  <span class="ot">&lt;-</span> <span class="st">&quot;p_value&quot;</span></span>
<span id="cb93-34"><a href="figure-4.html#cb93-34" tabindex="-1"></a></span>
<span id="cb93-35"><a href="figure-4.html#cb93-35" tabindex="-1"></a><span class="fu">names</span>(diff_gene)[<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="st">&quot;p_value&quot;</span></span>
<span id="cb93-36"><a href="figure-4.html#cb93-36" tabindex="-1"></a></span>
<span id="cb93-37"><a href="figure-4.html#cb93-37" tabindex="-1"></a>dd <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/subnetwork_important_edge-300_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-38"><a href="figure-4.html#cb93-38" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb93-39"><a href="figure-4.html#cb93-39" tabindex="-1"></a></span>
<span id="cb93-40"><a href="figure-4.html#cb93-40" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb93-41"><a href="figure-4.html#cb93-41" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(dd)</span>
<span id="cb93-42"><a href="figure-4.html#cb93-42" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="fu">layout_with_dh</span>(g,<span class="fu">set.seed</span>(<span class="dv">1</span>))  </span>
<span id="cb93-43"><a href="figure-4.html#cb93-43" tabindex="-1"></a><span class="fu">row.names</span>(layout) <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">V</span>(g))</span>
<span id="cb93-44"><a href="figure-4.html#cb93-44" tabindex="-1"></a><span class="fu">colnames</span>(layout) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;pos.x&quot;</span>,<span class="st">&quot;pos.y&quot;</span>)</span>
<span id="cb93-45"><a href="figure-4.html#cb93-45" tabindex="-1"></a></span>
<span id="cb93-46"><a href="figure-4.html#cb93-46" tabindex="-1"></a>kk <span class="ot">&lt;-</span> PathwayExtendData <span class="sc">%&gt;%</span></span>
<span id="cb93-47"><a href="figure-4.html#cb93-47" tabindex="-1"></a>  <span class="fu">filter</span>(kegg_pathwayname <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Citrate cycle (TCA cycle)&quot;</span>,<span class="st">&quot;Oxidative phosphorylation&quot;</span>))</span>
<span id="cb93-48"><a href="figure-4.html#cb93-48" tabindex="-1"></a></span>
<span id="cb93-49"><a href="figure-4.html#cb93-49" tabindex="-1"></a>node.data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(layout) <span class="sc">%&gt;%</span></span>
<span id="cb93-50"><a href="figure-4.html#cb93-50" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-51"><a href="figure-4.html#cb93-51" tabindex="-1"></a>  <span class="fu">left_join</span>(diff_gene,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;label&quot;</span><span class="ot">=</span><span class="st">&quot;name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb93-52"><a href="figure-4.html#cb93-52" tabindex="-1"></a>  <span class="fu">left_join</span>(diff_meta,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;label&quot;</span><span class="ot">=</span><span class="st">&quot;name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb93-53"><a href="figure-4.html#cb93-53" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(label,pos.x,pos.y,logFC.x,logFC.y) <span class="sc">%&gt;%</span></span>
<span id="cb93-54"><a href="figure-4.html#cb93-54" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logFC=</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(logFC.x),logFC.y,logFC.x)) <span class="sc">%&gt;%</span></span>
<span id="cb93-55"><a href="figure-4.html#cb93-55" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type=</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(logFC.x),<span class="st">&quot;metabolite&quot;</span>,<span class="st">&quot;gene&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb93-56"><a href="figure-4.html#cb93-56" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>logFC.x,<span class="sc">-</span>logFC.y) <span class="sc">%&gt;%</span></span>
<span id="cb93-57"><a href="figure-4.html#cb93-57" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label1=</span><span class="fu">ifelse</span>(label <span class="sc">%in%</span> kk<span class="sc">$</span>name,label,<span class="cn">NA</span>))</span>
<span id="cb93-58"><a href="figure-4.html#cb93-58" tabindex="-1"></a></span>
<span id="cb93-59"><a href="figure-4.html#cb93-59" tabindex="-1"></a>edge.data <span class="ot">&lt;-</span> dd <span class="sc">%&gt;%</span></span>
<span id="cb93-60"><a href="figure-4.html#cb93-60" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;fromNode&quot;</span><span class="ot">=</span><span class="st">&quot;X1&quot;</span>,</span>
<span id="cb93-61"><a href="figure-4.html#cb93-61" tabindex="-1"></a>         <span class="st">&quot;toNode&quot;</span><span class="ot">=</span><span class="st">&quot;X2&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-62"><a href="figure-4.html#cb93-62" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(fromNode,toNode) <span class="sc">%&gt;%</span></span>
<span id="cb93-63"><a href="figure-4.html#cb93-63" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(node.data,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;fromNode&quot;</span><span class="ot">=</span><span class="st">&quot;label&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb93-64"><a href="figure-4.html#cb93-64" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;from.x&quot;</span><span class="ot">=</span><span class="st">&quot;pos.x&quot;</span>,<span class="st">&quot;from.y&quot;</span><span class="ot">=</span><span class="st">&quot;pos.y&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-65"><a href="figure-4.html#cb93-65" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(node.data,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;toNode&quot;</span><span class="ot">=</span><span class="st">&quot;label&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb93-66"><a href="figure-4.html#cb93-66" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;to.x&quot;</span><span class="ot">=</span><span class="st">&quot;pos.x&quot;</span>,<span class="st">&quot;to.y&quot;</span><span class="ot">=</span><span class="st">&quot;pos.y&quot;</span>)</span>
<span id="cb93-67"><a href="figure-4.html#cb93-67" tabindex="-1"></a></span>
<span id="cb93-68"><a href="figure-4.html#cb93-68" tabindex="-1"></a><span class="do">## node.color</span></span>
<span id="cb93-69"><a href="figure-4.html#cb93-69" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;raw_data/node.color.R&quot;</span>)</span>
<span id="cb93-70"><a href="figure-4.html#cb93-70" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;raw_data/col.key.R&quot;</span>)</span>
<span id="cb93-71"><a href="figure-4.html#cb93-71" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;raw_data/colorpanel2.R&quot;</span>)</span>
<span id="cb93-72"><a href="figure-4.html#cb93-72" tabindex="-1"></a></span>
<span id="cb93-73"><a href="figure-4.html#cb93-73" tabindex="-1"></a>node_meta <span class="ot">&lt;-</span> node.data <span class="sc">%&gt;%</span></span>
<span id="cb93-74"><a href="figure-4.html#cb93-74" tabindex="-1"></a>  <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;metabolite&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-75"><a href="figure-4.html#cb93-75" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logFC=</span><span class="fu">round</span>(logFC,<span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb93-76"><a href="figure-4.html#cb93-76" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logFC=</span><span class="fu">ifelse</span>(logFC <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.58</span>, <span class="sc">-</span><span class="fl">0.58</span>, logFC))</span>
<span id="cb93-77"><a href="figure-4.html#cb93-77" tabindex="-1"></a>meta_limits<span class="ot">=</span><span class="fu">as.numeric</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%.1f&quot;</span>, <span class="fu">max</span>(<span class="fu">max</span>(node_meta<span class="sc">$</span>logFC),<span class="fu">abs</span>(<span class="fu">min</span>(node_meta<span class="sc">$</span>logFC)))))<span class="sc">+</span><span class="fl">0.1</span></span>
<span id="cb93-78"><a href="figure-4.html#cb93-78" tabindex="-1"></a>meta_color <span class="ot">&lt;-</span> <span class="fu">node.color</span>(<span class="at">limit=</span>meta_limits,node_meta<span class="sc">$</span>logFC,<span class="at">low=</span><span class="st">&quot;#007DDB&quot;</span>, <span class="at">mid=</span><span class="st">&quot;gray&quot;</span>, <span class="at">high=</span><span class="st">&quot;yellow&quot;</span>)</span>
<span id="cb93-79"><a href="figure-4.html#cb93-79" tabindex="-1"></a>node_meta<span class="sc">$</span>color <span class="ot">&lt;-</span> meta_color</span>
<span id="cb93-80"><a href="figure-4.html#cb93-80" tabindex="-1"></a></span>
<span id="cb93-81"><a href="figure-4.html#cb93-81" tabindex="-1"></a>node_gene <span class="ot">&lt;-</span> node.data <span class="sc">%&gt;%</span></span>
<span id="cb93-82"><a href="figure-4.html#cb93-82" tabindex="-1"></a>  <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;gene&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-83"><a href="figure-4.html#cb93-83" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logFC=</span><span class="fu">round</span>(logFC,<span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb93-84"><a href="figure-4.html#cb93-84" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logFC=</span><span class="fu">ifelse</span>(logFC <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">2</span>, logFC)) <span class="sc">%&gt;%</span></span>
<span id="cb93-85"><a href="figure-4.html#cb93-85" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logFC=</span><span class="fu">ifelse</span>(logFC <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="dv">2</span>, logFC))</span>
<span id="cb93-86"><a href="figure-4.html#cb93-86" tabindex="-1"></a>gene_limits<span class="ot">=</span><span class="fu">as.numeric</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%.1f&quot;</span>, <span class="fu">max</span>(<span class="fu">max</span>(node_gene<span class="sc">$</span>logFC),<span class="fu">abs</span>(<span class="fu">min</span>(node_gene<span class="sc">$</span>logFC)))))<span class="sc">+</span><span class="fl">0.1</span></span>
<span id="cb93-87"><a href="figure-4.html#cb93-87" tabindex="-1"></a>gene_color <span class="ot">&lt;-</span> <span class="fu">node.color</span>(<span class="at">limit=</span>gene_limits,node_gene<span class="sc">$</span>logFC,<span class="at">low=</span><span class="st">&quot;#4FBD81&quot;</span>,<span class="at">mid=</span><span class="st">&quot;gray&quot;</span>,<span class="at">high=</span><span class="st">&quot;#D01910&quot;</span>)</span>
<span id="cb93-88"><a href="figure-4.html#cb93-88" tabindex="-1"></a>node_gene<span class="sc">$</span>color <span class="ot">&lt;-</span> gene_color</span>
<span id="cb93-89"><a href="figure-4.html#cb93-89" tabindex="-1"></a></span>
<span id="cb93-90"><a href="figure-4.html#cb93-90" tabindex="-1"></a>node.data1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(node_meta,node_gene)</span>
<span id="cb93-91"><a href="figure-4.html#cb93-91" tabindex="-1"></a></span>
<span id="cb93-92"><a href="figure-4.html#cb93-92" tabindex="-1"></a>aa<span class="ot">=</span>node.data1<span class="sc">$</span>color</span>
<span id="cb93-93"><a href="figure-4.html#cb93-93" tabindex="-1"></a><span class="fu">names</span>(aa)<span class="ot">=</span>node.data1<span class="sc">$</span>color</span>
<span id="cb93-94"><a href="figure-4.html#cb93-94" tabindex="-1"></a></span>
<span id="cb93-95"><a href="figure-4.html#cb93-95" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()</span>
<span id="cb93-96"><a href="figure-4.html#cb93-96" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> from.x, <span class="at">y =</span> from.y, <span class="at">xend =</span> to.x, <span class="at">yend =</span> to.y),</span>
<span id="cb93-97"><a href="figure-4.html#cb93-97" tabindex="-1"></a>                        <span class="at">color =</span> <span class="st">&quot;#CCCCCC&quot;</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">data =</span> edge.data) </span>
<span id="cb93-98"><a href="figure-4.html#cb93-98" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> pos.x, <span class="at">y =</span> pos.y,<span class="at">color=</span>color,<span class="at">shape=</span>type), </span>
<span id="cb93-99"><a href="figure-4.html#cb93-99" tabindex="-1"></a>                      <span class="at">size =</span> <span class="dv">4</span>, <span class="at">data =</span> node.data1) </span>
<span id="cb93-100"><a href="figure-4.html#cb93-100" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>) <span class="sc">*</span> <span class="dv">2</span>) </span>
<span id="cb93-101"><a href="figure-4.html#cb93-101" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">theme_void</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>)</span>
<span id="cb93-102"><a href="figure-4.html#cb93-102" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb93-103"><a href="figure-4.html#cb93-103" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x =</span> pos.x, <span class="at">y =</span> pos.y,<span class="at">label=</span>label1),<span class="at">data=</span>node.data1)</span>
<span id="cb93-104"><a href="figure-4.html#cb93-104" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> aa)<span class="sc">+</span><span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;gene&quot;</span><span class="ot">=</span><span class="st">&quot;square&quot;</span>,<span class="st">&quot;metabolite&quot;</span><span class="ot">=</span><span class="st">&quot;circle&quot;</span>))</span>
<span id="cb93-105"><a href="figure-4.html#cb93-105" tabindex="-1"></a></span>
<span id="cb93-106"><a href="figure-4.html#cb93-106" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;result/Figure4/4H_node-200-1_T.pdf&quot;</span>)</span>
<span id="cb93-107"><a href="figure-4.html#cb93-107" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot.new</span>()</span>
<span id="cb93-108"><a href="figure-4.html#cb93-108" tabindex="-1"></a>off.sets<span class="ot">=</span><span class="fu">col.key</span>(<span class="at">limit=</span>gene_limits,<span class="at">bins=</span><span class="dv">10</span>,<span class="at">cex=</span><span class="fl">0.5</span>,<span class="at">graph.size =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">off.sets=</span><span class="fu">c</span>(<span class="at">x=</span><span class="dv">0</span>,<span class="at">y=</span><span class="dv">0</span>),</span>
<span id="cb93-109"><a href="figure-4.html#cb93-109" tabindex="-1"></a>                 <span class="at">low=</span><span class="st">&quot;#4FBD81&quot;</span>,<span class="at">mid=</span><span class="st">&quot;gray&quot;</span>,<span class="at">high=</span><span class="st">&quot;#D01910&quot;</span>)</span>
<span id="cb93-110"><a href="figure-4.html#cb93-110" tabindex="-1"></a>off.sets<span class="ot">=</span><span class="fu">col.key</span>(<span class="at">limit=</span>meta_limits,<span class="at">bins=</span><span class="dv">10</span>,<span class="at">cex=</span><span class="fl">0.5</span>,<span class="at">low=</span><span class="st">&quot;#007DDB&quot;</span>, <span class="at">mid=</span><span class="st">&quot;gray&quot;</span>, <span class="at">high=</span><span class="st">&quot;yellow&quot;</span>,</span>
<span id="cb93-111"><a href="figure-4.html#cb93-111" tabindex="-1"></a>                   <span class="at">off.sets=</span><span class="fu">c</span>(<span class="at">x=</span><span class="dv">0</span>,<span class="at">y=</span><span class="dv">0</span>),<span class="at">graph.size =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.9</span>))</span>
<span id="cb93-112"><a href="figure-4.html#cb93-112" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">recordPlot</span>()</span>
<span id="cb93-113"><a href="figure-4.html#cb93-113" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb93-114"><a href="figure-4.html#cb93-114" tabindex="-1"></a></span>
<span id="cb93-115"><a href="figure-4.html#cb93-115" tabindex="-1"></a><span class="cf">if</span> (<span class="dv">0</span>) {</span>
<span id="cb93-116"><a href="figure-4.html#cb93-116" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>()<span class="sc">+</span></span>
<span id="cb93-117"><a href="figure-4.html#cb93-117" tabindex="-1"></a>  <span class="fu">draw_plot</span>(p,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.55</span>)<span class="sc">+</span></span>
<span id="cb93-118"><a href="figure-4.html#cb93-118" tabindex="-1"></a>  <span class="fu">draw_plot</span>(gg,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb93-119"><a href="figure-4.html#cb93-119" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure4/4H_node-300-all.pdf&quot;</span>,p1,<span class="at">width=</span><span class="dv">6</span>,<span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb93-120"><a href="figure-4.html#cb93-120" tabindex="-1"></a>}</span>
<span id="cb93-121"><a href="figure-4.html#cb93-121" tabindex="-1"></a></span>
<span id="cb93-122"><a href="figure-4.html#cb93-122" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure4/4H_node-300-2_T.pdf&quot;</span>,gg,<span class="at">width=</span><span class="dv">6</span>,<span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb93-123"><a href="figure-4.html#cb93-123" tabindex="-1"></a></span>
<span id="cb93-124"><a href="figure-4.html#cb93-124" tabindex="-1"></a></span>
<span id="cb93-125"><a href="figure-4.html#cb93-125" tabindex="-1"></a><span class="cf">if</span> (<span class="dv">0</span>) {</span>
<span id="cb93-126"><a href="figure-4.html#cb93-126" tabindex="-1"></a>  <span class="fu">png</span>(<span class="st">&quot;result/Figure4/4H_node-300-aa.png&quot;</span>,<span class="at">width=</span><span class="dv">5</span>,<span class="at">height =</span> <span class="dv">5</span>,<span class="at">units =</span> <span class="st">&#39;in&#39;</span>, <span class="at">res =</span> <span class="dv">200</span>)</span>
<span id="cb93-127"><a href="figure-4.html#cb93-127" tabindex="-1"></a>  grid<span class="sc">::</span><span class="fu">grid.draw</span>(p1)</span>
<span id="cb93-128"><a href="figure-4.html#cb93-128" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb93-129"><a href="figure-4.html#cb93-129" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="Figure-1025/Figure4/4H.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="s5-a-clusters-of-bcp-all" class="section level2 hasAnchor" number="19.9">
<h2><span class="header-section-number">19.9</span> (S5 A) Clusters of BCP-ALL<a href="figure-4.html#s5-a-clusters-of-bcp-all" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The relative abundance of input metabolites and metabolic genes in the three metabolic clusters in BCP-ALL: <strong>BC1 (N= 20), BC2 (N= 35) and BC3 (N=20)</strong>. Each column represents a sample and each row represents a metabolite or gene included.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="figure-4.html#cb94-1" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb94-2"><a href="figure-4.html#cb94-2" tabindex="-1"></a><span class="co">#  Step 1: Heatmap</span></span>
<span id="cb94-3"><a href="figure-4.html#cb94-3" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb94-4"><a href="figure-4.html#cb94-4" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb94-5"><a href="figure-4.html#cb94-5" tabindex="-1"></a><span class="fu">library</span>(ComplexHeatmap)</span>
<span id="cb94-6"><a href="figure-4.html#cb94-6" tabindex="-1"></a></span>
<span id="cb94-7"><a href="figure-4.html#cb94-7" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4B_cluster_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-8"><a href="figure-4.html#cb94-8" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb94-9"><a href="figure-4.html#cb94-9" tabindex="-1"></a></span>
<span id="cb94-10"><a href="figure-4.html#cb94-10" tabindex="-1"></a>metabolite_norm <span class="ot">=</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4B_metabolite_norm_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-11"><a href="figure-4.html#cb94-11" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb94-12"><a href="figure-4.html#cb94-12" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;V1&quot;</span>)</span>
<span id="cb94-13"><a href="figure-4.html#cb94-13" tabindex="-1"></a></span>
<span id="cb94-14"><a href="figure-4.html#cb94-14" tabindex="-1"></a>metgene_norm <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4B_metgene_norm_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-15"><a href="figure-4.html#cb94-15" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb94-16"><a href="figure-4.html#cb94-16" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;V1&quot;</span>)</span>
<span id="cb94-17"><a href="figure-4.html#cb94-17" tabindex="-1"></a></span>
<span id="cb94-18"><a href="figure-4.html#cb94-18" tabindex="-1"></a>top_annotation <span class="ot">=</span> <span class="fu">HeatmapAnnotation</span>(<span class="at">Subtype=</span>sample_info<span class="sc">$</span>Clusters,</span>
<span id="cb94-19"><a href="figure-4.html#cb94-19" tabindex="-1"></a>  <span class="at">col=</span><span class="fu">list</span>(<span class="at">Subtype=</span><span class="fu">c</span>(<span class="st">&quot;BC1&quot;</span><span class="ot">=</span><span class="st">&quot;#9BD53F&quot;</span>,<span class="st">&quot;BC2&quot;</span><span class="ot">=</span><span class="st">&quot;#A6CEE3&quot;</span>,<span class="st">&quot;BC3&quot;</span><span class="ot">=</span><span class="st">&quot;#EA644C&quot;</span>)),</span>
<span id="cb94-20"><a href="figure-4.html#cb94-20" tabindex="-1"></a>  <span class="at">show_annotation_name =</span> <span class="fu">c</span>(T,T), </span>
<span id="cb94-21"><a href="figure-4.html#cb94-21" tabindex="-1"></a>  <span class="at">border =</span> <span class="fu">c</span>(T,T) ,</span>
<span id="cb94-22"><a href="figure-4.html#cb94-22" tabindex="-1"></a>  <span class="at">simple_anno_size =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">&quot;mm&quot;</span>),<span class="at">gap =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb94-23"><a href="figure-4.html#cb94-23" tabindex="-1"></a></span>
<span id="cb94-24"><a href="figure-4.html#cb94-24" tabindex="-1"></a>col_fun <span class="ot">=</span> circlize<span class="sc">::</span><span class="fu">colorRamp2</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="st">&quot;#00599F&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;#D01910&quot;</span>))</span>
<span id="cb94-25"><a href="figure-4.html#cb94-25" tabindex="-1"></a></span>
<span id="cb94-26"><a href="figure-4.html#cb94-26" tabindex="-1"></a>p_metabolite <span class="ot">&lt;-</span> <span class="fu">Heatmap</span>(<span class="fu">t</span>(metabolite_norm),<span class="at">height=</span><span class="fu">unit</span>(<span class="dv">10</span>,<span class="st">&quot;cm&quot;</span>),<span class="at">name=</span><span class="st">&quot;Metabolite Data&quot;</span>,</span>
<span id="cb94-27"><a href="figure-4.html#cb94-27" tabindex="-1"></a>                        <span class="at">cluster_row_slices =</span> F,<span class="at">clustering_method_rows =</span> <span class="st">&quot;ward.D&quot;</span>,</span>
<span id="cb94-28"><a href="figure-4.html#cb94-28" tabindex="-1"></a>                        <span class="at">clustering_method_columns =</span> <span class="st">&quot;ward.D2&quot;</span>,</span>
<span id="cb94-29"><a href="figure-4.html#cb94-29" tabindex="-1"></a>                        <span class="at">column_split =</span> sample_info<span class="sc">$</span>Clusters,</span>
<span id="cb94-30"><a href="figure-4.html#cb94-30" tabindex="-1"></a>                        <span class="at">col =</span> col_fun,</span>
<span id="cb94-31"><a href="figure-4.html#cb94-31" tabindex="-1"></a>                        <span class="at">top_annotation =</span>top_annotation,</span>
<span id="cb94-32"><a href="figure-4.html#cb94-32" tabindex="-1"></a>                        <span class="at">show_column_names =</span> F,<span class="at">show_row_names =</span> F,</span>
<span id="cb94-33"><a href="figure-4.html#cb94-33" tabindex="-1"></a>                        <span class="at">row_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">3</span>),</span>
<span id="cb94-34"><a href="figure-4.html#cb94-34" tabindex="-1"></a>                        <span class="at">column_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">3</span>))</span>
<span id="cb94-35"><a href="figure-4.html#cb94-35" tabindex="-1"></a></span>
<span id="cb94-36"><a href="figure-4.html#cb94-36" tabindex="-1"></a>col_fun <span class="ot">=</span> circlize<span class="sc">::</span><span class="fu">colorRamp2</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="st">&quot;#00599F&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;#FF7F00&quot;</span>))</span>
<span id="cb94-37"><a href="figure-4.html#cb94-37" tabindex="-1"></a></span>
<span id="cb94-38"><a href="figure-4.html#cb94-38" tabindex="-1"></a>p_gene <span class="ot">&lt;-</span> <span class="fu">Heatmap</span>(<span class="fu">t</span>(metgene_norm),<span class="at">height=</span><span class="fu">unit</span>(<span class="dv">10</span>,<span class="st">&quot;cm&quot;</span>),<span class="at">name=</span><span class="st">&quot;Gene Data&quot;</span>,</span>
<span id="cb94-39"><a href="figure-4.html#cb94-39" tabindex="-1"></a>                  <span class="at">cluster_row_slices =</span> F,<span class="at">clustering_method_rows =</span> <span class="st">&quot;ward.D&quot;</span>,</span>
<span id="cb94-40"><a href="figure-4.html#cb94-40" tabindex="-1"></a>                  <span class="at">clustering_method_columns =</span> <span class="st">&quot;ward.D2&quot;</span>,</span>
<span id="cb94-41"><a href="figure-4.html#cb94-41" tabindex="-1"></a>                  <span class="at">column_split =</span> sample_info<span class="sc">$</span>Clusters,</span>
<span id="cb94-42"><a href="figure-4.html#cb94-42" tabindex="-1"></a>                  <span class="at">col =</span> col_fun,</span>
<span id="cb94-43"><a href="figure-4.html#cb94-43" tabindex="-1"></a>                  <span class="at">show_column_names =</span> F,<span class="at">show_row_names =</span> F,</span>
<span id="cb94-44"><a href="figure-4.html#cb94-44" tabindex="-1"></a>                  <span class="at">row_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">3</span>),</span>
<span id="cb94-45"><a href="figure-4.html#cb94-45" tabindex="-1"></a>                  <span class="at">column_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">3</span>))</span>
<span id="cb94-46"><a href="figure-4.html#cb94-46" tabindex="-1"></a></span>
<span id="cb94-47"><a href="figure-4.html#cb94-47" tabindex="-1"></a><span class="fu">pdf</span>(<span class="fu">paste0</span>(<span class="st">&quot;result/Figure4/S5A_heatmap_B.pdf&quot;</span>),<span class="at">width=</span><span class="dv">8</span>,<span class="at">height =</span> <span class="dv">10</span>)</span>
<span id="cb94-48"><a href="figure-4.html#cb94-48" tabindex="-1"></a>p_metabolite <span class="sc">%v%</span> p_gene</span>
<span id="cb94-49"><a href="figure-4.html#cb94-49" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p><img src="Figure-1025/Figure4/S5A.png" width="337" style="display: block; margin: auto;" /></p>
</div>
<div id="s5-e-waterfall-plot-of-bc123" class="section level2 hasAnchor" number="19.10">
<h2><span class="header-section-number">19.10</span> (S5 E) Waterfall plot of BC1/2/3<a href="figure-4.html#s5-e-waterfall-plot-of-bc123" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>The associations of metabolic clusters with clinical variables and genetic alterations</strong>, including major <strong>mutations and fusions</strong> in BCP-ALL. Note. Among all fusions, only <strong>BCR-ABL1 and TCF3-PBX1</strong> are significantly enriched in BC1/2 and BC3, respectively. P-values were calculated by Pearson’s chi-square test or Fisher’s exact test.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="figure-4.html#cb95-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb95-2"><a href="figure-4.html#cb95-2" tabindex="-1"></a><span class="fu">library</span>(ComplexHeatmap)</span>
<span id="cb95-3"><a href="figure-4.html#cb95-3" tabindex="-1"></a></span>
<span id="cb95-4"><a href="figure-4.html#cb95-4" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb95-5"><a href="figure-4.html#cb95-5" tabindex="-1"></a><span class="co">#  Step 1: Load data and set parameters</span></span>
<span id="cb95-6"><a href="figure-4.html#cb95-6" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb95-7"><a href="figure-4.html#cb95-7" tabindex="-1"></a>dd <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/clinical_all_v231116.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-8"><a href="figure-4.html#cb95-8" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-9"><a href="figure-4.html#cb95-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;Sex&quot;</span><span class="ot">=</span><span class="st">&quot;Gender&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-10"><a href="figure-4.html#cb95-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(group<span class="sc">==</span><span class="st">&quot;A&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-11"><a href="figure-4.html#cb95-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(bianhao,Sex,Age,WBC,d28CR) <span class="sc">%&gt;%</span></span>
<span id="cb95-12"><a href="figure-4.html#cb95-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Age=</span><span class="fu">ifelse</span>(Age <span class="sc">&lt;</span> <span class="dv">40</span>,<span class="st">&quot;&lt; 40&quot;</span>,<span class="st">&quot;&gt;= 40&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb95-13"><a href="figure-4.html#cb95-13" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-14"><a href="figure-4.html#cb95-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">d28CR=</span><span class="fu">ifelse</span>(d28CR <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;early death&quot;</span>,<span class="st">&quot;NR&quot;</span>,<span class="st">&quot;PR&quot;</span>),<span class="st">&quot;non_CR&quot;</span>,d28CR)) <span class="sc">%&gt;%</span></span>
<span id="cb95-15"><a href="figure-4.html#cb95-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;D28_status&quot;</span><span class="ot">=</span><span class="st">&quot;d28CR&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-16"><a href="figure-4.html#cb95-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">WBC_type=</span> <span class="fu">ifelse</span>(WBC<span class="sc">&gt;</span><span class="dv">30</span>, <span class="st">&quot;&gt; 30&quot;</span>,</span>
<span id="cb95-17"><a href="figure-4.html#cb95-17" tabindex="-1"></a>                          <span class="fu">ifelse</span>(WBC<span class="sc">&lt;=</span><span class="dv">30</span>,<span class="st">&quot;&lt;= 30&quot;</span>,<span class="cn">NA</span>)))</span>
<span id="cb95-18"><a href="figure-4.html#cb95-18" tabindex="-1"></a></span>
<span id="cb95-19"><a href="figure-4.html#cb95-19" tabindex="-1"></a>clinical_survival <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">&quot;raw_data/08 队列病人生存资料-240313.xlsx&quot;</span>,<span class="at">sheet=</span><span class="st">&quot;A&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-20"><a href="figure-4.html#cb95-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;bianhao&quot;</span>,<span class="st">&quot;OS_stat&quot;</span>,<span class="st">&quot;ifHSCT&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb95-21"><a href="figure-4.html#cb95-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Outcome=</span><span class="fu">ifelse</span>(OS_stat<span class="sc">==</span><span class="dv">1</span>,<span class="st">&quot;Dead&quot;</span>,</span>
<span id="cb95-22"><a href="figure-4.html#cb95-22" tabindex="-1"></a>                        <span class="fu">ifelse</span>(OS_stat<span class="sc">==</span><span class="dv">0</span>,<span class="st">&quot;Alive&quot;</span>,OS_stat))) <span class="sc">%&gt;%</span></span>
<span id="cb95-23"><a href="figure-4.html#cb95-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(dd,<span class="at">by=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-24"><a href="figure-4.html#cb95-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ifHSCT=</span><span class="fu">ifelse</span>(ifHSCT<span class="sc">==</span><span class="dv">0</span>,<span class="st">&quot;no&quot;</span>,</span>
<span id="cb95-25"><a href="figure-4.html#cb95-25" tabindex="-1"></a>                       <span class="fu">ifelse</span>(ifHSCT<span class="sc">==</span><span class="dv">1</span>,<span class="st">&quot;yes&quot;</span>,ifHSCT))) <span class="sc">%&gt;%</span></span>
<span id="cb95-26"><a href="figure-4.html#cb95-26" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb95-27"><a href="figure-4.html#cb95-27" tabindex="-1"></a></span>
<span id="cb95-28"><a href="figure-4.html#cb95-28" tabindex="-1"></a>sample_info_raw <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/1.cluster_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-29"><a href="figure-4.html#cb95-29" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-30"><a href="figure-4.html#cb95-30" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(bianhao,Clusters)</span>
<span id="cb95-31"><a href="figure-4.html#cb95-31" tabindex="-1"></a></span>
<span id="cb95-32"><a href="figure-4.html#cb95-32" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4B_cluster_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-33"><a href="figure-4.html#cb95-33" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-34"><a href="figure-4.html#cb95-34" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">bianhao=</span><span class="fu">gsub</span>(<span class="st">&quot;RJ-&quot;</span>,<span class="st">&quot;A&quot;</span>,Pid)) <span class="sc">%&gt;%</span></span>
<span id="cb95-35"><a href="figure-4.html#cb95-35" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">match</span>(bianhao,sample_info_raw<span class="sc">$</span>bianhao)) <span class="sc">%&gt;%</span></span>
<span id="cb95-36"><a href="figure-4.html#cb95-36" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(clinical_survival,<span class="at">by=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-37"><a href="figure-4.html#cb95-37" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>RNA_ID) <span class="sc">%&gt;%</span></span>
<span id="cb95-38"><a href="figure-4.html#cb95-38" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;RNA_id&quot;</span><span class="ot">=</span><span class="st">&quot;RNA_id_raw&quot;</span>)</span>
<span id="cb95-39"><a href="figure-4.html#cb95-39" tabindex="-1"></a></span>
<span id="cb95-40"><a href="figure-4.html#cb95-40" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb95-41"><a href="figure-4.html#cb95-41" tabindex="-1"></a><span class="co">#  Step 2: Mutations</span></span>
<span id="cb95-42"><a href="figure-4.html#cb95-42" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb95-43"><a href="figure-4.html#cb95-43" tabindex="-1"></a>q12 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#1F78B4&quot;</span>,<span class="st">&quot;#E31A1C&quot;</span>,<span class="st">&quot;black&quot;</span>)</span>
<span id="cb95-44"><a href="figure-4.html#cb95-44" tabindex="-1"></a><span class="fu">names</span>(q12) <span class="ot">&lt;-</span> <span class="fu">unique</span>(sample_info<span class="sc">$</span>Clusters)</span>
<span id="cb95-45"><a href="figure-4.html#cb95-45" tabindex="-1"></a></span>
<span id="cb95-46"><a href="figure-4.html#cb95-46" tabindex="-1"></a>top_annotation <span class="ot">=</span> <span class="fu">HeatmapAnnotation</span>(</span>
<span id="cb95-47"><a href="figure-4.html#cb95-47" tabindex="-1"></a>  <span class="at">Subtype=</span>sample_info<span class="sc">$</span>Clusters,</span>
<span id="cb95-48"><a href="figure-4.html#cb95-48" tabindex="-1"></a>  <span class="at">Age=</span>sample_info<span class="sc">$</span>Age,</span>
<span id="cb95-49"><a href="figure-4.html#cb95-49" tabindex="-1"></a>  <span class="at">ifHSCT=</span>sample_info<span class="sc">$</span>ifHSCT,</span>
<span id="cb95-50"><a href="figure-4.html#cb95-50" tabindex="-1"></a>  <span class="at">WBC=</span>sample_info<span class="sc">$</span>WBC_type,</span>
<span id="cb95-51"><a href="figure-4.html#cb95-51" tabindex="-1"></a>  <span class="at">Outcome=</span>sample_info<span class="sc">$</span>Outcome,</span>
<span id="cb95-52"><a href="figure-4.html#cb95-52" tabindex="-1"></a>  <span class="at">col=</span><span class="fu">list</span>(<span class="at">Subtype=</span><span class="fu">c</span>(<span class="st">&quot;BC1&quot;</span><span class="ot">=</span><span class="st">&quot;#9BD53F&quot;</span>,<span class="st">&quot;BC2&quot;</span><span class="ot">=</span><span class="st">&quot;#A6CEE3&quot;</span>,<span class="st">&quot;BC3&quot;</span><span class="ot">=</span><span class="st">&quot;#EA644C&quot;</span>),</span>
<span id="cb95-53"><a href="figure-4.html#cb95-53" tabindex="-1"></a>           <span class="at">Age=</span><span class="fu">c</span>(<span class="st">&quot;&lt; 40&quot;</span><span class="ot">=</span><span class="st">&quot;#B2DF8A&quot;</span>,<span class="st">&quot;&gt;= 40&quot;</span><span class="ot">=</span><span class="st">&quot;gray&quot;</span>),</span>
<span id="cb95-54"><a href="figure-4.html#cb95-54" tabindex="-1"></a>           <span class="at">ifHSCT=</span><span class="fu">c</span>(<span class="st">&quot;yes&quot;</span><span class="ot">=</span><span class="st">&quot;#CAB2D6&quot;</span>,<span class="st">&quot;no&quot;</span><span class="ot">=</span><span class="st">&quot;gray&quot;</span>),</span>
<span id="cb95-55"><a href="figure-4.html#cb95-55" tabindex="-1"></a>           <span class="at">WBC=</span><span class="fu">c</span>(<span class="st">&quot;&gt; 30&quot;</span><span class="ot">=</span><span class="st">&quot;#FDBF6F&quot;</span>,<span class="st">&quot;&lt;= 30&quot;</span><span class="ot">=</span><span class="st">&quot;gray&quot;</span>),</span>
<span id="cb95-56"><a href="figure-4.html#cb95-56" tabindex="-1"></a>           <span class="at">Outcome=</span><span class="fu">c</span>(<span class="st">&quot;Dead&quot;</span><span class="ot">=</span><span class="st">&quot;black&quot;</span>,<span class="st">&quot;Alive&quot;</span><span class="ot">=</span><span class="st">&quot;gray&quot;</span>)),</span>
<span id="cb95-57"><a href="figure-4.html#cb95-57" tabindex="-1"></a>  <span class="at">show_annotation_name =</span> <span class="fu">c</span>(T,T), </span>
<span id="cb95-58"><a href="figure-4.html#cb95-58" tabindex="-1"></a>  <span class="at">border =</span> <span class="fu">c</span>(T,T,T,T,T,T) ,</span>
<span id="cb95-59"><a href="figure-4.html#cb95-59" tabindex="-1"></a>  <span class="at">simple_anno_size =</span> <span class="fu">unit</span>(<span class="dv">8</span>, <span class="st">&quot;mm&quot;</span>),<span class="at">gap =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb95-60"><a href="figure-4.html#cb95-60" tabindex="-1"></a></span>
<span id="cb95-61"><a href="figure-4.html#cb95-61" tabindex="-1"></a>mutation_B <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/mutation_B_v1114_all.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-62"><a href="figure-4.html#cb95-62" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-63"><a href="figure-4.html#cb95-63" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(V2,V17,V19) <span class="sc">%&gt;%</span></span>
<span id="cb95-64"><a href="figure-4.html#cb95-64" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;ID&quot;</span><span class="ot">=</span><span class="st">&quot;V2&quot;</span>,<span class="st">&quot;Gene.refGene&quot;</span><span class="ot">=</span><span class="st">&quot;V17&quot;</span>,<span class="st">&quot;ExonicFunc.refGene&quot;</span><span class="ot">=</span><span class="st">&quot;V19&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-65"><a href="figure-4.html#cb95-65" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID,<span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span>,<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-66"><a href="figure-4.html#cb95-66" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span><span class="ot">=</span></span>
<span id="cb95-67"><a href="figure-4.html#cb95-67" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;frameshift deletion&quot;</span>,<span class="st">&quot;frameshift insertion&quot;</span>,<span class="st">&quot;frameshift substitution&quot;</span>),<span class="st">&quot;Frameshift&quot;</span>,</span>
<span id="cb95-68"><a href="figure-4.html#cb95-68" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;nonframeshift deletion&quot;</span>,<span class="st">&quot;nonframeshift insertion&quot;</span>,<span class="st">&quot;nonframeshift substitution&quot;</span>),<span class="st">&quot;Nonframeshift&quot;</span>,</span>
<span id="cb95-69"><a href="figure-4.html#cb95-69" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span> <span class="sc">%in%</span> <span class="st">&quot;.&quot;</span>,<span class="st">&quot;Splice&quot;</span>,</span>
<span id="cb95-70"><a href="figure-4.html#cb95-70" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span> <span class="sc">%in%</span> <span class="st">&quot;nonsynonymous SNV&quot;</span>,<span class="st">&quot;Missense&quot;</span>,</span>
<span id="cb95-71"><a href="figure-4.html#cb95-71" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span><span class="sc">==</span><span class="st">&quot;startloss&quot;</span>,<span class="st">&quot;Startloss&quot;</span>,</span>
<span id="cb95-72"><a href="figure-4.html#cb95-72" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span><span class="sc">==</span><span class="st">&quot;stopgain&quot;</span>,<span class="st">&quot;Stopgain&quot;</span>,</span>
<span id="cb95-73"><a href="figure-4.html#cb95-73" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span><span class="sc">==</span><span class="st">&quot;synonymous SNV&quot;</span>,<span class="st">&quot;Silent&quot;</span>,<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span>)))))))) <span class="sc">%&gt;%</span></span>
<span id="cb95-74"><a href="figure-4.html#cb95-74" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-75"><a href="figure-4.html#cb95-75" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(ID <span class="sc">%in%</span> sample_info<span class="sc">$</span>RNA_id) <span class="sc">%&gt;%</span></span>
<span id="cb95-76"><a href="figure-4.html#cb95-76" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;IDH1&quot;</span>,<span class="st">&quot;IDH2&quot;</span>),<span class="st">&quot;IDH1/2&quot;</span>,<span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span>))</span>
<span id="cb95-77"><a href="figure-4.html#cb95-77" tabindex="-1"></a></span>
<span id="cb95-78"><a href="figure-4.html#cb95-78" tabindex="-1"></a>mutation <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mutation_B)</span>
<span id="cb95-79"><a href="figure-4.html#cb95-79" tabindex="-1"></a></span>
<span id="cb95-80"><a href="figure-4.html#cb95-80" tabindex="-1"></a>hit_num <span class="ot">&lt;-</span> mutation <span class="sc">%&gt;%</span></span>
<span id="cb95-81"><a href="figure-4.html#cb95-81" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(ID,<span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-82"><a href="figure-4.html#cb95-82" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb95-83"><a href="figure-4.html#cb95-83" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(n<span class="sc">&gt;</span><span class="dv">1</span>)</span>
<span id="cb95-84"><a href="figure-4.html#cb95-84" tabindex="-1"></a></span>
<span id="cb95-85"><a href="figure-4.html#cb95-85" tabindex="-1"></a>mutation <span class="ot">&lt;-</span> mutation <span class="sc">%&gt;%</span> </span>
<span id="cb95-86"><a href="figure-4.html#cb95-86" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(hit_num,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>,<span class="st">&quot;Gene.refGene&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb95-87"><a href="figure-4.html#cb95-87" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span><span class="ot">=</span><span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(n),<span class="st">&quot;Multiple&quot;</span>,<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb95-88"><a href="figure-4.html#cb95-88" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb95-89"><a href="figure-4.html#cb95-89" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-90"><a href="figure-4.html#cb95-90" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;RNA_id&quot;</span><span class="ot">=</span><span class="st">&quot;ID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-91"><a href="figure-4.html#cb95-91" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(RNA_id <span class="sc">%in%</span> sample_info<span class="sc">$</span>RNA_id)</span>
<span id="cb95-92"><a href="figure-4.html#cb95-92" tabindex="-1"></a></span>
<span id="cb95-93"><a href="figure-4.html#cb95-93" tabindex="-1"></a>mutation_gene_filter <span class="ot">&lt;-</span> mutation <span class="sc">%&gt;%</span></span>
<span id="cb95-94"><a href="figure-4.html#cb95-94" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(RNA_id,Gene.refGene) <span class="sc">%&gt;%</span></span>
<span id="cb95-95"><a href="figure-4.html#cb95-95" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-96"><a href="figure-4.html#cb95-96" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(<span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-97"><a href="figure-4.html#cb95-97" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb95-98"><a href="figure-4.html#cb95-98" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(n<span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb95-99"><a href="figure-4.html#cb95-99" tabindex="-1"></a>mutation_sort <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">table</span>(mutation <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span> <span class="sc">%in%</span> mutation_gene_filter<span class="sc">$</span>Gene.refGene) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Gene.refGene)))))</span>
<span id="cb95-100"><a href="figure-4.html#cb95-100" tabindex="-1"></a></span>
<span id="cb95-101"><a href="figure-4.html#cb95-101" tabindex="-1"></a>mutation <span class="ot">&lt;-</span> mutation <span class="sc">%&gt;%</span></span>
<span id="cb95-102"><a href="figure-4.html#cb95-102" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span> <span class="sc">%in%</span> mutation_gene_filter<span class="sc">$</span>Gene.refGene) <span class="sc">%&gt;%</span></span>
<span id="cb95-103"><a href="figure-4.html#cb95-103" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-104"><a href="figure-4.html#cb95-104" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(RNA_id,Gene.refGene,<span class="at">.keep_all =</span> T)</span>
<span id="cb95-105"><a href="figure-4.html#cb95-105" tabindex="-1"></a></span>
<span id="cb95-106"><a href="figure-4.html#cb95-106" tabindex="-1"></a>sample_info_filter <span class="ot">&lt;-</span> sample_info <span class="sc">%&gt;%</span></span>
<span id="cb95-107"><a href="figure-4.html#cb95-107" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(bianhao,RNA_id)</span>
<span id="cb95-108"><a href="figure-4.html#cb95-108" tabindex="-1"></a></span>
<span id="cb95-109"><a href="figure-4.html#cb95-109" tabindex="-1"></a>mutation_dcast <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">dcast</span>(mutation,RNA_id <span class="sc">~</span> <span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-110"><a href="figure-4.html#cb95-110" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">right_join</span>(sample_info_filter,<span class="at">by=</span><span class="st">&quot;RNA_id&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-111"><a href="figure-4.html#cb95-111" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>RNA_id) <span class="sc">%&gt;%</span></span>
<span id="cb95-112"><a href="figure-4.html#cb95-112" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-113"><a href="figure-4.html#cb95-113" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(mutation_sort))</span>
<span id="cb95-114"><a href="figure-4.html#cb95-114" tabindex="-1"></a></span>
<span id="cb95-115"><a href="figure-4.html#cb95-115" tabindex="-1"></a>mutation_dcast[<span class="fu">is.na</span>(mutation_dcast)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb95-116"><a href="figure-4.html#cb95-116" tabindex="-1"></a>mutation_dcast[mutation_dcast<span class="sc">==</span><span class="st">&quot;Missense&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb95-117"><a href="figure-4.html#cb95-117" tabindex="-1"></a>mutation_dcast[mutation_dcast<span class="sc">==</span><span class="st">&quot;Frameshift&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb95-118"><a href="figure-4.html#cb95-118" tabindex="-1"></a>mutation_dcast[mutation_dcast<span class="sc">==</span><span class="st">&quot;Nonframeshift&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb95-119"><a href="figure-4.html#cb95-119" tabindex="-1"></a>mutation_dcast[mutation_dcast<span class="sc">==</span><span class="st">&quot;Silent&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb95-120"><a href="figure-4.html#cb95-120" tabindex="-1"></a>mutation_dcast[mutation_dcast<span class="sc">==</span><span class="st">&quot;Splice&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb95-121"><a href="figure-4.html#cb95-121" tabindex="-1"></a>mutation_dcast[mutation_dcast<span class="sc">==</span><span class="st">&quot;Stopgain&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb95-122"><a href="figure-4.html#cb95-122" tabindex="-1"></a>mutation_dcast[mutation_dcast<span class="sc">==</span><span class="st">&quot;Multiple&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb95-123"><a href="figure-4.html#cb95-123" tabindex="-1"></a></span>
<span id="cb95-124"><a href="figure-4.html#cb95-124" tabindex="-1"></a>mutation_dcast1 <span class="ot">&lt;-</span> mutation_dcast <span class="sc">%&gt;%</span></span>
<span id="cb95-125"><a href="figure-4.html#cb95-125" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate_if</span>(is.character,as.numeric) <span class="sc">%&gt;%</span></span>
<span id="cb95-126"><a href="figure-4.html#cb95-126" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-127"><a href="figure-4.html#cb95-127" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Signaling=</span><span class="fu">sum</span>(NRAS,KRAS,FLT3,STAT5B,NF1,MYC)) <span class="sc">%&gt;%</span></span>
<span id="cb95-128"><a href="figure-4.html#cb95-128" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Transcription=</span><span class="fu">sum</span>(PAX5,TP53,RUNX1,IKZF1,ETV6,MGA)) <span class="sc">%&gt;%</span></span>
<span id="cb95-129"><a href="figure-4.html#cb95-129" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Epigenetic=</span><span class="fu">sum</span>(KMT2D,SETD2,NCOR2,EP300,ARID1A,ARID1B,SETD1B,<span class="st">`</span><span class="at">IDH1/2</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb95-130"><a href="figure-4.html#cb95-130" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Others=</span><span class="fu">sum</span>(SACS)) <span class="sc">%&gt;%</span></span>
<span id="cb95-131"><a href="figure-4.html#cb95-131" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Signaling=</span><span class="fu">ifelse</span>(Signaling<span class="sc">==</span><span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb95-132"><a href="figure-4.html#cb95-132" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Transcription=</span><span class="fu">ifelse</span>(Transcription<span class="sc">==</span><span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb95-133"><a href="figure-4.html#cb95-133" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Epigenetic=</span><span class="fu">ifelse</span>(Epigenetic<span class="sc">==</span><span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb95-134"><a href="figure-4.html#cb95-134" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Others=</span><span class="fu">ifelse</span>(Others<span class="sc">==</span><span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb95-135"><a href="figure-4.html#cb95-135" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(NRAS,FLT3,STAT5B,NF1,KRAS,MYC,Signaling,</span>
<span id="cb95-136"><a href="figure-4.html#cb95-136" tabindex="-1"></a>                PAX5,TP53,RUNX1,IKZF1,ETV6,MGA,Transcription,</span>
<span id="cb95-137"><a href="figure-4.html#cb95-137" tabindex="-1"></a>                KMT2D,SETD2,NCOR2,EP300,ARID1A,ARID1B,SETD1B,<span class="st">`</span><span class="at">IDH1/2</span><span class="st">`</span>,Epigenetic,</span>
<span id="cb95-138"><a href="figure-4.html#cb95-138" tabindex="-1"></a>                SACS,Others) <span class="sc">%&gt;%</span></span>
<span id="cb95-139"><a href="figure-4.html#cb95-139" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb95-140"><a href="figure-4.html#cb95-140" tabindex="-1"></a></span>
<span id="cb95-141"><a href="figure-4.html#cb95-141" tabindex="-1"></a><span class="fu">rownames</span>(mutation_dcast1) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(mutation_dcast)</span>
<span id="cb95-142"><a href="figure-4.html#cb95-142" tabindex="-1"></a>mutation_dcast <span class="ot">&lt;-</span> mutation_dcast1</span>
<span id="cb95-143"><a href="figure-4.html#cb95-143" tabindex="-1"></a></span>
<span id="cb95-144"><a href="figure-4.html#cb95-144" tabindex="-1"></a>mutation_dcast_temp <span class="ot">&lt;-</span> mutation_dcast</span>
<span id="cb95-145"><a href="figure-4.html#cb95-145" tabindex="-1"></a>mutation_dcast_temp[mutation_dcast_temp<span class="sc">!=</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb95-146"><a href="figure-4.html#cb95-146" tabindex="-1"></a>num<span class="ot">=</span><span class="fu">colSums</span>(mutation_dcast_temp)</span>
<span id="cb95-147"><a href="figure-4.html#cb95-147" tabindex="-1"></a><span class="fu">names</span>(mutation_dcast) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">names</span>(mutation_dcast),<span class="st">&quot; (n=&quot;</span>,num,<span class="st">&quot;)&quot;</span>)</span>
<span id="cb95-148"><a href="figure-4.html#cb95-148" tabindex="-1"></a></span>
<span id="cb95-149"><a href="figure-4.html#cb95-149" tabindex="-1"></a>d_mutation <span class="ot">&lt;-</span> <span class="fu">t</span>(mutation_dcast) <span class="sc">%&gt;%</span></span>
<span id="cb95-150"><a href="figure-4.html#cb95-150" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-151"><a href="figure-4.html#cb95-151" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample_info<span class="sc">$</span>bianhao)</span>
<span id="cb95-152"><a href="figure-4.html#cb95-152" tabindex="-1"></a></span>
<span id="cb95-153"><a href="figure-4.html#cb95-153" tabindex="-1"></a>mutation_annotation <span class="ot">&lt;-</span> <span class="fu">Heatmap</span>(d_mutation,<span class="at">height=</span><span class="fu">unit</span>(<span class="dv">12</span>,<span class="st">&quot;cm&quot;</span>),<span class="at">rect_gp =</span> <span class="fu">gpar</span>(<span class="at">col =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>),</span>
<span id="cb95-154"><a href="figure-4.html#cb95-154" tabindex="-1"></a>                               <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;#EEEEEE&quot;</span>,<span class="st">&quot;#3987CC&quot;</span>,<span class="st">&quot;#DB3D3D&quot;</span>,<span class="st">&quot;#663FFB&quot;</span>,<span class="st">&quot;#FF7F0E&quot;</span>,<span class="st">&quot;#CC66FF&quot;</span>,<span class="st">&quot;#8B564C&quot;</span>,<span class="st">&quot;#339933&quot;</span>,<span class="st">&quot;blue&quot;</span>),</span>
<span id="cb95-155"><a href="figure-4.html#cb95-155" tabindex="-1"></a>                               <span class="at">cluster_columns =</span> F,<span class="at">cluster_rows =</span> F,<span class="at">border =</span> <span class="cn">TRUE</span>,<span class="at">column_title =</span> <span class="cn">NULL</span>,</span>
<span id="cb95-156"><a href="figure-4.html#cb95-156" tabindex="-1"></a>                               <span class="at">column_split =</span>sample_info<span class="sc">$</span>Clusters,</span>
<span id="cb95-157"><a href="figure-4.html#cb95-157" tabindex="-1"></a>                               <span class="at">show_column_names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb95-158"><a href="figure-4.html#cb95-158" tabindex="-1"></a>                               <span class="at">top_annotation=</span>top_annotation,</span>
<span id="cb95-159"><a href="figure-4.html#cb95-159" tabindex="-1"></a>                               <span class="at">row_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">10</span>),<span class="at">column_names_gp=</span><span class="fu">gpar</span>(<span class="at">fontsize=</span><span class="dv">6</span>))</span>
<span id="cb95-160"><a href="figure-4.html#cb95-160" tabindex="-1"></a></span>
<span id="cb95-161"><a href="figure-4.html#cb95-161" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb95-162"><a href="figure-4.html#cb95-162" tabindex="-1"></a><span class="co">#  Step 3: Fusions</span></span>
<span id="cb95-163"><a href="figure-4.html#cb95-163" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb95-164"><a href="figure-4.html#cb95-164" tabindex="-1"></a>fusion_B <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/fusion_B_v0803.xlsx&quot;</span>,<span class="at">skip=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-165"><a href="figure-4.html#cb95-165" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-166"><a href="figure-4.html#cb95-166" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(RNA_id <span class="sc">%in%</span> sample_info<span class="sc">$</span>RNA_id) <span class="sc">%&gt;%</span></span>
<span id="cb95-167"><a href="figure-4.html#cb95-167" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(RNA_id,fusion_group) <span class="sc">%&gt;%</span></span>
<span id="cb95-168"><a href="figure-4.html#cb95-168" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">fusion_group=</span><span class="fu">ifelse</span>(fusion_group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;PAX5-ETV6&quot;</span>,<span class="st">&quot;PAX5-CPLX1&quot;</span>),<span class="st">&quot;PAX5 fusion&quot;</span>,</span>
<span id="cb95-169"><a href="figure-4.html#cb95-169" tabindex="-1"></a>                                    fusion_group)) <span class="sc">%&gt;%</span></span>
<span id="cb95-170"><a href="figure-4.html#cb95-170" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">fusion_group=</span><span class="fu">ifelse</span>(fusion_group<span class="sc">==</span><span class="st">&quot;BCR-ABL1;IKZF1-IGH&quot;</span>,<span class="st">&quot;BCR-ABL1&quot;</span>,fusion_group)) <span class="sc">%&gt;%</span></span>
<span id="cb95-171"><a href="figure-4.html#cb95-171" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(sample_info,<span class="at">by=</span><span class="st">&quot;RNA_id&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-172"><a href="figure-4.html#cb95-172" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(fusion_group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;BCL2/MYC&quot;</span>,<span class="st">&quot;BCR-ABL1&quot;</span>,<span class="st">&quot;DUX4 rearrangement&quot;</span>,<span class="st">&quot;ETV6-RUNX1&quot;</span>,<span class="st">&quot;KMT2A rearrangement&quot;</span>,<span class="st">&quot;PAX5  fusion&quot;</span>,<span class="st">&quot;TCF3-PBX1&quot;</span>,<span class="st">&quot;ZNF384 fusion&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb95-173"><a href="figure-4.html#cb95-173" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(RNA_id,fusion_group) <span class="sc">%&gt;%</span></span>
<span id="cb95-174"><a href="figure-4.html#cb95-174" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(fusion_group))</span>
<span id="cb95-175"><a href="figure-4.html#cb95-175" tabindex="-1"></a></span>
<span id="cb95-176"><a href="figure-4.html#cb95-176" tabindex="-1"></a>fusion <span class="ot">&lt;-</span> <span class="fu">rbind</span>(fusion_B)</span>
<span id="cb95-177"><a href="figure-4.html#cb95-177" tabindex="-1"></a></span>
<span id="cb95-178"><a href="figure-4.html#cb95-178" tabindex="-1"></a>clinical_fusion_dcast <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">dcast</span>(fusion,RNA_id <span class="sc">~</span> fusion_group) <span class="sc">%&gt;%</span></span>
<span id="cb95-179"><a href="figure-4.html#cb95-179" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">right_join</span>(sample_info_filter,<span class="at">by=</span><span class="st">&quot;RNA_id&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-180"><a href="figure-4.html#cb95-180" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-181"><a href="figure-4.html#cb95-181" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>RNA_id)</span>
<span id="cb95-182"><a href="figure-4.html#cb95-182" tabindex="-1"></a></span>
<span id="cb95-183"><a href="figure-4.html#cb95-183" tabindex="-1"></a>clinical_fusion_dcast[<span class="fu">is.na</span>(clinical_fusion_dcast)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb95-184"><a href="figure-4.html#cb95-184" tabindex="-1"></a>clinical_fusion_dcast[clinical_fusion_dcast <span class="sc">!=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb95-185"><a href="figure-4.html#cb95-185" tabindex="-1"></a></span>
<span id="cb95-186"><a href="figure-4.html#cb95-186" tabindex="-1"></a>d_fusion <span class="ot">&lt;-</span> <span class="fu">t</span>(clinical_fusion_dcast) <span class="sc">%&gt;%</span></span>
<span id="cb95-187"><a href="figure-4.html#cb95-187" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-188"><a href="figure-4.html#cb95-188" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample_info<span class="sc">$</span>bianhao) <span class="sc">%&gt;%</span></span>
<span id="cb95-189"><a href="figure-4.html#cb95-189" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;fusion&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-190"><a href="figure-4.html#cb95-190" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">match</span>(fusion,<span class="fu">c</span>(<span class="st">&quot;DUX4 rearrangement&quot;</span>,<span class="st">&quot;ZNF384 fusion&quot;</span>,<span class="st">&quot;TCF3-PBX1&quot;</span>,<span class="st">&quot;KMT2A rearrangement&quot;</span>,<span class="st">&quot;ETV6-RUNX1&quot;</span>,<span class="st">&quot;PAX5-ETV6&quot;</span>,<span class="st">&quot;PAX5 fusion&quot;</span>,<span class="st">&quot;BCL2/MYC&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb95-191"><a href="figure-4.html#cb95-191" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;fusion&quot;</span>)</span>
<span id="cb95-192"><a href="figure-4.html#cb95-192" tabindex="-1"></a></span>
<span id="cb95-193"><a href="figure-4.html#cb95-193" tabindex="-1"></a>fusion_annotation <span class="ot">&lt;-</span> <span class="fu">Heatmap</span>(d_fusion,<span class="at">rect_gp =</span> <span class="fu">gpar</span>(<span class="at">col =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>),</span>
<span id="cb95-194"><a href="figure-4.html#cb95-194" tabindex="-1"></a>                             <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;#EEEEEE&quot;</span>,<span class="st">&quot;#444444&quot;</span>),</span>
<span id="cb95-195"><a href="figure-4.html#cb95-195" tabindex="-1"></a>                             <span class="at">height=</span><span class="fu">unit</span>(<span class="dv">4</span>,<span class="st">&quot;cm&quot;</span>),<span class="at">border =</span> <span class="cn">TRUE</span>,</span>
<span id="cb95-196"><a href="figure-4.html#cb95-196" tabindex="-1"></a>                             <span class="at">column_split =</span>sample_info<span class="sc">$</span>Clusters,</span>
<span id="cb95-197"><a href="figure-4.html#cb95-197" tabindex="-1"></a>                             <span class="at">cluster_columns =</span> F,<span class="at">cluster_rows =</span> F,</span>
<span id="cb95-198"><a href="figure-4.html#cb95-198" tabindex="-1"></a>                             <span class="at">column_title =</span> <span class="cn">NULL</span>,</span>
<span id="cb95-199"><a href="figure-4.html#cb95-199" tabindex="-1"></a>                             <span class="at">row_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">10</span>),</span>
<span id="cb95-200"><a href="figure-4.html#cb95-200" tabindex="-1"></a>                             <span class="at">column_names_gp=</span><span class="fu">gpar</span>(<span class="at">fontsize=</span><span class="dv">6</span>))</span>
<span id="cb95-201"><a href="figure-4.html#cb95-201" tabindex="-1"></a></span>
<span id="cb95-202"><a href="figure-4.html#cb95-202" tabindex="-1"></a><span class="fu">pdf</span>(<span class="fu">paste0</span>(<span class="st">&quot;result/Figure4/S5E_oncoplot_B.pdf&quot;</span>),<span class="at">width=</span><span class="dv">10</span>,<span class="at">height =</span> <span class="dv">10</span>)</span>
<span id="cb95-203"><a href="figure-4.html#cb95-203" tabindex="-1"></a>mutation_annotation <span class="sc">%v%</span> fusion_annotation</span>
<span id="cb95-204"><a href="figure-4.html#cb95-204" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb95-205"><a href="figure-4.html#cb95-205" tabindex="-1"></a></span>
<span id="cb95-206"><a href="figure-4.html#cb95-206" tabindex="-1"></a><span class="cf">if</span> (<span class="cn">FALSE</span>){</span>
<span id="cb95-207"><a href="figure-4.html#cb95-207" tabindex="-1"></a>  a1<span class="ot">=</span><span class="dv">10</span></span>
<span id="cb95-208"><a href="figure-4.html#cb95-208" tabindex="-1"></a>  a2<span class="ot">=</span><span class="dv">9</span></span>
<span id="cb95-209"><a href="figure-4.html#cb95-209" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(a1,<span class="dv">54</span><span class="sc">-</span>a1,a2,<span class="dv">21</span><span class="sc">-</span>a2),<span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb95-210"><a href="figure-4.html#cb95-210" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">fisher.test</span>(dat)</span>
<span id="cb95-211"><a href="figure-4.html#cb95-211" tabindex="-1"></a>  result</span>
<span id="cb95-212"><a href="figure-4.html#cb95-212" tabindex="-1"></a>  </span>
<span id="cb95-213"><a href="figure-4.html#cb95-213" tabindex="-1"></a>  a1<span class="ot">=</span><span class="dv">4</span></span>
<span id="cb95-214"><a href="figure-4.html#cb95-214" tabindex="-1"></a>  a2<span class="ot">=</span><span class="dv">6</span></span>
<span id="cb95-215"><a href="figure-4.html#cb95-215" tabindex="-1"></a>  a3<span class="ot">=</span><span class="dv">7</span></span>
<span id="cb95-216"><a href="figure-4.html#cb95-216" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(a1,<span class="dv">21</span><span class="sc">-</span>a1,a2,<span class="dv">33</span><span class="sc">-</span>a2,a3,<span class="dv">21</span><span class="sc">-</span>a3),<span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb95-217"><a href="figure-4.html#cb95-217" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">fisher.test</span>(dat,<span class="at">alternative =</span><span class="st">&quot;greater&quot;</span>)</span>
<span id="cb95-218"><a href="figure-4.html#cb95-218" tabindex="-1"></a>  result</span>
<span id="cb95-219"><a href="figure-4.html#cb95-219" tabindex="-1"></a>  </span>
<span id="cb95-220"><a href="figure-4.html#cb95-220" tabindex="-1"></a>  </span>
<span id="cb95-221"><a href="figure-4.html#cb95-221" tabindex="-1"></a>  a1<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb95-222"><a href="figure-4.html#cb95-222" tabindex="-1"></a>  a2<span class="ot">=</span><span class="dv">4</span></span>
<span id="cb95-223"><a href="figure-4.html#cb95-223" tabindex="-1"></a>  a3<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb95-224"><a href="figure-4.html#cb95-224" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(a1,<span class="dv">21</span><span class="sc">-</span>a1,a2,<span class="dv">33</span><span class="sc">-</span>a2,a3,<span class="dv">21</span><span class="sc">-</span>a3),<span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb95-225"><a href="figure-4.html#cb95-225" tabindex="-1"></a>  <span class="fu">fisher.test</span>(dat)</span>
<span id="cb95-226"><a href="figure-4.html#cb95-226" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="Figure-1025/Figure4/S5G.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="s5-h-da-score-of-bc3-cluster" class="section level2 hasAnchor" number="19.11">
<h2><span class="header-section-number">19.11</span> (S5 H) DA-score of BC3 cluster<a href="figure-4.html#s5-h-da-score-of-bc3-cluster" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <strong>DA-score</strong> reveals that most of the disturbed metabolism pathways are significantly enriched in the <strong>BC3</strong> cluster.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="figure-4.html#cb96-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb96-2"><a href="figure-4.html#cb96-2" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb96-3"><a href="figure-4.html#cb96-3" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb96-4"><a href="figure-4.html#cb96-4" tabindex="-1"></a></span>
<span id="cb96-5"><a href="figure-4.html#cb96-5" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb96-6"><a href="figure-4.html#cb96-6" tabindex="-1"></a><span class="co">#  Stpe 1: mlimma of BCP-ALL clusters</span></span>
<span id="cb96-7"><a href="figure-4.html#cb96-7" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb96-8"><a href="figure-4.html#cb96-8" tabindex="-1"></a>cluster <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4B_cluster_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-9"><a href="figure-4.html#cb96-9" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() </span>
<span id="cb96-10"><a href="figure-4.html#cb96-10" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-11"><a href="figure-4.html#cb96-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(label,<span class="fu">all_of</span>(cluster<span class="sc">$</span>METc_BM_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb96-12"><a href="figure-4.html#cb96-12" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>)</span>
<span id="cb96-13"><a href="figure-4.html#cb96-13" tabindex="-1"></a>group <span class="ot">&lt;-</span> cluster<span class="sc">$</span>Clusters</span>
<span id="cb96-14"><a href="figure-4.html#cb96-14" tabindex="-1"></a></span>
<span id="cb96-15"><a href="figure-4.html#cb96-15" tabindex="-1"></a>group[<span class="fu">which</span>(group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;BC3&quot;</span>))] <span class="ot">&lt;-</span> <span class="st">&quot;tumor&quot;</span></span>
<span id="cb96-16"><a href="figure-4.html#cb96-16" tabindex="-1"></a>group[<span class="fu">which</span>(group <span class="sc">%in%</span>  <span class="fu">c</span>(<span class="st">&quot;BC1&quot;</span>,<span class="st">&quot;BC2&quot;</span>))] <span class="ot">&lt;-</span> <span class="st">&quot;normal&quot;</span></span>
<span id="cb96-17"><a href="figure-4.html#cb96-17" tabindex="-1"></a><span class="fu">table</span>(group)</span>
<span id="cb96-18"><a href="figure-4.html#cb96-18" tabindex="-1"></a>metabolite_all <span class="ot">&lt;-</span> <span class="fu">mlimma</span>(<span class="fu">log1p</span>(dat),group)</span>
<span id="cb96-19"><a href="figure-4.html#cb96-19" tabindex="-1"></a><span class="fu">write.table</span>(metabolite_all,<span class="st">&quot;result/Figure4/S5H_metabolite_B.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb96-20"><a href="figure-4.html#cb96-20" tabindex="-1"></a></span>
<span id="cb96-21"><a href="figure-4.html#cb96-21" tabindex="-1"></a>cluster <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4B_cluster_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-22"><a href="figure-4.html#cb96-22" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb96-23"><a href="figure-4.html#cb96-23" tabindex="-1"></a></span>
<span id="cb96-24"><a href="figure-4.html#cb96-24" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;raw_data/20231113_RNA_ALL_VST_coding.rds&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-25"><a href="figure-4.html#cb96-25" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb96-26"><a href="figure-4.html#cb96-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(cluster<span class="sc">$</span>RNA_id_raw))</span>
<span id="cb96-27"><a href="figure-4.html#cb96-27" tabindex="-1"></a>group <span class="ot">&lt;-</span> cluster<span class="sc">$</span>Clusters</span>
<span id="cb96-28"><a href="figure-4.html#cb96-28" tabindex="-1"></a></span>
<span id="cb96-29"><a href="figure-4.html#cb96-29" tabindex="-1"></a>group[<span class="fu">which</span>(group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;BC3&quot;</span>))] <span class="ot">&lt;-</span> <span class="st">&quot;tumor&quot;</span></span>
<span id="cb96-30"><a href="figure-4.html#cb96-30" tabindex="-1"></a>group[<span class="fu">which</span>(group <span class="sc">%in%</span>  <span class="fu">c</span>(<span class="st">&quot;BC1&quot;</span>,<span class="st">&quot;BC2&quot;</span>))] <span class="ot">&lt;-</span> <span class="st">&quot;normal&quot;</span></span>
<span id="cb96-31"><a href="figure-4.html#cb96-31" tabindex="-1"></a><span class="fu">table</span>(group)</span>
<span id="cb96-32"><a href="figure-4.html#cb96-32" tabindex="-1"></a></span>
<span id="cb96-33"><a href="figure-4.html#cb96-33" tabindex="-1"></a>gene_all <span class="ot">&lt;-</span> <span class="fu">mlimma</span>(dat,group)</span>
<span id="cb96-34"><a href="figure-4.html#cb96-34" tabindex="-1"></a> </span>
<span id="cb96-35"><a href="figure-4.html#cb96-35" tabindex="-1"></a><span class="fu">write.table</span>(gene_all,<span class="st">&quot;result/Figure4/S5H_gene_B.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb96-36"><a href="figure-4.html#cb96-36" tabindex="-1"></a></span>
<span id="cb96-37"><a href="figure-4.html#cb96-37" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb96-38"><a href="figure-4.html#cb96-38" tabindex="-1"></a><span class="co">#  Step 2: DA-score of metabolites</span></span>
<span id="cb96-39"><a href="figure-4.html#cb96-39" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb96-40"><a href="figure-4.html#cb96-40" tabindex="-1"></a>kegg_id <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/cell_metabolite_info_all_v1109.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-41"><a href="figure-4.html#cb96-41" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb96-42"><a href="figure-4.html#cb96-42" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(refmet_name,KEGG) <span class="sc">%&gt;%</span></span>
<span id="cb96-43"><a href="figure-4.html#cb96-43" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate_rows</span>(KEGG,<span class="at">sep=</span><span class="st">&quot;;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-44"><a href="figure-4.html#cb96-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(KEGG<span class="sc">!=</span><span class="st">&quot;NA&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-45"><a href="figure-4.html#cb96-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(KEGG <span class="sc">!=</span> <span class="st">&quot;None&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-46"><a href="figure-4.html#cb96-46" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb96-47"><a href="figure-4.html#cb96-47" tabindex="-1"></a></span>
<span id="cb96-48"><a href="figure-4.html#cb96-48" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S5H_metabolite_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-49"><a href="figure-4.html#cb96-49" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(logFC)) <span class="sc">%&gt;%</span></span>
<span id="cb96-50"><a href="figure-4.html#cb96-50" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(kegg_id,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span><span class="ot">=</span><span class="st">&quot;refmet_name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb96-51"><a href="figure-4.html#cb96-51" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(KEGG,<span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb96-52"><a href="figure-4.html#cb96-52" tabindex="-1"></a></span>
<span id="cb96-53"><a href="figure-4.html#cb96-53" tabindex="-1"></a>dat_increase <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb96-54"><a href="figure-4.html#cb96-54" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(logFC <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-55"><a href="figure-4.html#cb96-55" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb96-56"><a href="figure-4.html#cb96-56" tabindex="-1"></a>dat_decrease <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb96-57"><a href="figure-4.html#cb96-57" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(logFC <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-58"><a href="figure-4.html#cb96-58" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb96-59"><a href="figure-4.html#cb96-59" tabindex="-1"></a></span>
<span id="cb96-60"><a href="figure-4.html#cb96-60" tabindex="-1"></a>DA_result <span class="ot">&lt;-</span> <span class="fu">ePDAlyser</span>(dat_increase<span class="sc">$</span>KEGG,dat_decrease<span class="sc">$</span>KEGG,dat<span class="sc">$</span>KEGG,<span class="at">min_measured_num =</span> <span class="dv">3</span>,<span class="at">out=</span><span class="st">&quot;metabolite&quot;</span>)</span>
<span id="cb96-61"><a href="figure-4.html#cb96-61" tabindex="-1"></a><span class="fu">write.table</span>(DA_result<span class="sc">$</span>result,<span class="st">&quot;result/Figure4/S5H_DAscore_metabolite_B.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb96-62"><a href="figure-4.html#cb96-62" tabindex="-1"></a></span>
<span id="cb96-63"><a href="figure-4.html#cb96-63" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb96-64"><a href="figure-4.html#cb96-64" tabindex="-1"></a><span class="co">#  Step 3: DA-score of genes</span></span>
<span id="cb96-65"><a href="figure-4.html#cb96-65" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb96-66"><a href="figure-4.html#cb96-66" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S5H_gene_B.txt&quot;</span>)</span>
<span id="cb96-67"><a href="figure-4.html#cb96-67" tabindex="-1"></a></span>
<span id="cb96-68"><a href="figure-4.html#cb96-68" tabindex="-1"></a>dat_increase <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb96-69"><a href="figure-4.html#cb96-69" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(logFC <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-70"><a href="figure-4.html#cb96-70" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb96-71"><a href="figure-4.html#cb96-71" tabindex="-1"></a>dat_decrease <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb96-72"><a href="figure-4.html#cb96-72" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(logFC <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-73"><a href="figure-4.html#cb96-73" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb96-74"><a href="figure-4.html#cb96-74" tabindex="-1"></a></span>
<span id="cb96-75"><a href="figure-4.html#cb96-75" tabindex="-1"></a>DA_result <span class="ot">&lt;-</span> <span class="fu">ePDAlyser</span>(dat_increase<span class="sc">$</span>name,dat_decrease<span class="sc">$</span>name,dat<span class="sc">$</span>name,<span class="at">min_measured_num =</span> <span class="dv">10</span>,<span class="at">out=</span><span class="st">&quot;gene&quot;</span>)</span>
<span id="cb96-76"><a href="figure-4.html#cb96-76" tabindex="-1"></a><span class="fu">write.table</span>(DA_result<span class="sc">$</span>result,<span class="st">&quot;result/Figure4/S5H_DAscore_gene_B.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb96-77"><a href="figure-4.html#cb96-77" tabindex="-1"></a></span>
<span id="cb96-78"><a href="figure-4.html#cb96-78" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb96-79"><a href="figure-4.html#cb96-79" tabindex="-1"></a><span class="co">#  Step 4: DA-score of metabolites+genes</span></span>
<span id="cb96-80"><a href="figure-4.html#cb96-80" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb96-81"><a href="figure-4.html#cb96-81" tabindex="-1"></a>gene <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S5H_DAscore_gene_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-82"><a href="figure-4.html#cb96-82" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb96-83"><a href="figure-4.html#cb96-83" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Measured_members_num <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-84"><a href="figure-4.html#cb96-84" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(DA_score) <span class="sc">&gt;</span> <span class="fl">0.05</span>)</span>
<span id="cb96-85"><a href="figure-4.html#cb96-85" tabindex="-1"></a></span>
<span id="cb96-86"><a href="figure-4.html#cb96-86" tabindex="-1"></a>metabolite <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S5H_DAscore_metabolite_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-87"><a href="figure-4.html#cb96-87" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb96-88"><a href="figure-4.html#cb96-88" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Measured_members_num <span class="sc">&gt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-89"><a href="figure-4.html#cb96-89" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(DA_score <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb96-90"><a href="figure-4.html#cb96-90" tabindex="-1"></a></span>
<span id="cb96-91"><a href="figure-4.html#cb96-91" tabindex="-1"></a>all_1 <span class="ot">&lt;-</span> gene <span class="sc">%&gt;%</span></span>
<span id="cb96-92"><a href="figure-4.html#cb96-92" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(metabolite,<span class="at">by=</span><span class="st">&quot;Pathway&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-93"><a href="figure-4.html#cb96-93" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(DA_score.x <span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> DA_score.y <span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb96-94"><a href="figure-4.html#cb96-94" tabindex="-1"></a></span>
<span id="cb96-95"><a href="figure-4.html#cb96-95" tabindex="-1"></a>all_2 <span class="ot">&lt;-</span> gene <span class="sc">%&gt;%</span></span>
<span id="cb96-96"><a href="figure-4.html#cb96-96" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(metabolite,<span class="at">by=</span><span class="st">&quot;Pathway&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-97"><a href="figure-4.html#cb96-97" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(DA_score.x <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> DA_score.y <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb96-98"><a href="figure-4.html#cb96-98" tabindex="-1"></a></span>
<span id="cb96-99"><a href="figure-4.html#cb96-99" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">c</span>(all_1<span class="sc">$</span>Pathway,all_2<span class="sc">$</span>Pathway,<span class="st">&quot;Nicotinate and nicotinamide metabolism&quot;</span>)</span>
<span id="cb96-100"><a href="figure-4.html#cb96-100" tabindex="-1"></a></span>
<span id="cb96-101"><a href="figure-4.html#cb96-101" tabindex="-1"></a>metabolite_filter <span class="ot">&lt;-</span> metabolite <span class="sc">%&gt;%</span></span>
<span id="cb96-102"><a href="figure-4.html#cb96-102" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Pathway <span class="sc">%in%</span> path) <span class="sc">%&gt;%</span></span>
<span id="cb96-103"><a href="figure-4.html#cb96-103" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Measured_members_num <span class="sc">&gt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-104"><a href="figure-4.html#cb96-104" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(DA_score) <span class="sc">&gt;</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-105"><a href="figure-4.html#cb96-105" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-106"><a href="figure-4.html#cb96-106" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Pathway=</span><span class="fu">factor</span>(Pathway,<span class="at">levels =</span> Pathway))</span>
<span id="cb96-107"><a href="figure-4.html#cb96-107" tabindex="-1"></a></span>
<span id="cb96-108"><a href="figure-4.html#cb96-108" tabindex="-1"></a>colp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Amino acid metabolism&quot;</span> <span class="ot">=</span><span class="st">&quot;#1B9E77&quot;</span>,</span>
<span id="cb96-109"><a href="figure-4.html#cb96-109" tabindex="-1"></a>          <span class="st">&quot;Carbohydrate metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#D95F02&quot;</span>,</span>
<span id="cb96-110"><a href="figure-4.html#cb96-110" tabindex="-1"></a>          <span class="st">&quot;Glycan biosynthesis and metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#1F78B4&quot;</span>, </span>
<span id="cb96-111"><a href="figure-4.html#cb96-111" tabindex="-1"></a>          <span class="st">&quot;Metabolism of cofactors and vitamins&quot;</span><span class="ot">=</span><span class="st">&quot;#7570B3&quot;</span>,</span>
<span id="cb96-112"><a href="figure-4.html#cb96-112" tabindex="-1"></a>          <span class="st">&quot;Metabolism of terpenoids and polyketides&quot;</span><span class="ot">=</span><span class="st">&quot;#BC80BD&quot;</span>,</span>
<span id="cb96-113"><a href="figure-4.html#cb96-113" tabindex="-1"></a>          <span class="st">&quot;Metabolism of other amino acids&quot;</span><span class="ot">=</span><span class="st">&quot;#8DD3C7&quot;</span>,</span>
<span id="cb96-114"><a href="figure-4.html#cb96-114" tabindex="-1"></a>          <span class="st">&quot;Energy metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#E7298A&quot;</span>,</span>
<span id="cb96-115"><a href="figure-4.html#cb96-115" tabindex="-1"></a>          <span class="st">&quot;Lipid metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#66A61E&quot;</span>,</span>
<span id="cb96-116"><a href="figure-4.html#cb96-116" tabindex="-1"></a>          <span class="st">&quot;Nucleotide metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#E6AB02&quot;</span>,</span>
<span id="cb96-117"><a href="figure-4.html#cb96-117" tabindex="-1"></a>          <span class="st">&quot;Biosynthesis of other secondary metabolites&quot;</span><span class="ot">=</span><span class="st">&quot;#A6761D&quot;</span>,</span>
<span id="cb96-118"><a href="figure-4.html#cb96-118" tabindex="-1"></a>          <span class="st">&quot;Xenobiotics biodegradation and metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#666666&quot;</span>)</span>
<span id="cb96-119"><a href="figure-4.html#cb96-119" tabindex="-1"></a></span>
<span id="cb96-120"><a href="figure-4.html#cb96-120" tabindex="-1"></a>p <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(metabolite_filter)<span class="sc">+</span></span>
<span id="cb96-121"><a href="figure-4.html#cb96-121" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Pathway,<span class="at">y=</span>DA_score,<span class="at">size=</span><span class="fu">log2</span>(Measured_members_num),<span class="at">color=</span><span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb96-122"><a href="figure-4.html#cb96-122" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_pointrange</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Pathway,<span class="at">y=</span>DA_score,<span class="at">ymin=</span><span class="dv">0</span>,<span class="at">ymax=</span>DA_score,<span class="at">color=</span><span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb96-123"><a href="figure-4.html#cb96-123" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>colp)<span class="sc">+</span></span>
<span id="cb96-124"><a href="figure-4.html#cb96-124" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb96-125"><a href="figure-4.html#cb96-125" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">xlab</span>(<span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb96-126"><a href="figure-4.html#cb96-126" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span>
<span id="cb96-127"><a href="figure-4.html#cb96-127" tabindex="-1"></a></span>
<span id="cb96-128"><a href="figure-4.html#cb96-128" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure4/S5H_DAscore_metabolite_B_filter.pdf&quot;</span>,p,<span class="at">width=</span><span class="dv">8</span>,<span class="at">height =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure4/S5H.png" width="406" style="display: block; margin: auto;" /></p>
</div>
<div id="s5-i-j-msea-of-bc123" class="section level2 hasAnchor" number="19.12">
<h2><span class="header-section-number">19.12</span> (S5 I-J) MSEA of BC1/2/3<a href="figure-4.html#s5-i-j-msea-of-bc123" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I. GSEA unveils pathways significantly enriched in BC3, mirroring the findings of the metabolome analyses.<br />
J. GSEA unveils that cholesterol biosynthesis was significantly enriched in BC3.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="figure-4.html#cb97-1" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb97-2"><a href="figure-4.html#cb97-2" tabindex="-1"></a><span class="co">#  Step 1: KEGG citrate TCA cycle</span></span>
<span id="cb97-3"><a href="figure-4.html#cb97-3" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb97-4"><a href="figure-4.html#cb97-4" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb97-5"><a href="figure-4.html#cb97-5" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb97-6"><a href="figure-4.html#cb97-6" tabindex="-1"></a></span>
<span id="cb97-7"><a href="figure-4.html#cb97-7" tabindex="-1"></a><span class="do">## Load data and set parameters</span></span>
<span id="cb97-8"><a href="figure-4.html#cb97-8" tabindex="-1"></a>gene_all <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S5H_gene_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-9"><a href="figure-4.html#cb97-9" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb97-10"><a href="figure-4.html#cb97-10" tabindex="-1"></a></span>
<span id="cb97-11"><a href="figure-4.html#cb97-11" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">&quot;raw_data/tca.txt&quot;</span>)</span>
<span id="cb97-12"><a href="figure-4.html#cb97-12" tabindex="-1"></a>gmt <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(a, <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb97-13"><a href="figure-4.html#cb97-13" tabindex="-1"></a><span class="fu">names</span>(gmt) <span class="ot">&lt;-</span> <span class="fu">vapply</span>(gmt, <span class="cf">function</span>(y) y[<span class="dv">1</span>], <span class="fu">character</span>(<span class="dv">1</span>))</span>
<span id="cb97-14"><a href="figure-4.html#cb97-14" tabindex="-1"></a>gmt1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(gmt, <span class="st">&quot;[&quot;</span>, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span>
<span id="cb97-15"><a href="figure-4.html#cb97-15" tabindex="-1"></a></span>
<span id="cb97-16"><a href="figure-4.html#cb97-16" tabindex="-1"></a>a_temp <span class="ot">&lt;-</span> gene_all<span class="sc">$</span>logFC</span>
<span id="cb97-17"><a href="figure-4.html#cb97-17" tabindex="-1"></a><span class="fu">names</span>(a_temp) <span class="ot">&lt;-</span> gene_all<span class="sc">$</span>name</span>
<span id="cb97-18"><a href="figure-4.html#cb97-18" tabindex="-1"></a>  </span>
<span id="cb97-19"><a href="figure-4.html#cb97-19" tabindex="-1"></a>Ranks_all <span class="ot">&lt;-</span> <span class="fu">sort</span>(a_temp,<span class="at">decreasing =</span><span class="cn">TRUE</span>)</span>
<span id="cb97-20"><a href="figure-4.html#cb97-20" tabindex="-1"></a>  gseaParam <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb97-21"><a href="figure-4.html#cb97-21" tabindex="-1"></a>  minSize<span class="ot">=</span><span class="dv">5</span></span>
<span id="cb97-22"><a href="figure-4.html#cb97-22" tabindex="-1"></a>  ticksSize <span class="ot">=</span> <span class="fl">0.2</span></span>
<span id="cb97-23"><a href="figure-4.html#cb97-23" tabindex="-1"></a>  Ranks_all <span class="ot">=</span> <span class="fu">sort</span>(a_temp,<span class="at">decreasing =</span><span class="cn">TRUE</span>)</span>
<span id="cb97-24"><a href="figure-4.html#cb97-24" tabindex="-1"></a>  fgseaRes_all <span class="ot">&lt;-</span> fgsea<span class="sc">::</span><span class="fu">fgsea</span>(gmt1, <span class="fu">sort</span>(a_temp,<span class="at">decreasing =</span><span class="cn">TRUE</span>),<span class="at">minSize =</span> minSize,<span class="at">nPermSimple=</span><span class="dv">20000</span>,<span class="at">gseaParam=</span><span class="fl">0.5</span>)</span>
<span id="cb97-25"><a href="figure-4.html#cb97-25" tabindex="-1"></a>  </span>
<span id="cb97-26"><a href="figure-4.html#cb97-26" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> fgseaRes_all <span class="sc">%&gt;%</span> </span>
<span id="cb97-27"><a href="figure-4.html#cb97-27" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(pval) <span class="sc">%&gt;%</span></span>
<span id="cb97-28"><a href="figure-4.html#cb97-28" tabindex="-1"></a>    <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb97-29"><a href="figure-4.html#cb97-29" tabindex="-1"></a>  nes <span class="ot">&lt;-</span> fgseaRes_all <span class="sc">%&gt;%</span> </span>
<span id="cb97-30"><a href="figure-4.html#cb97-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(NES) <span class="sc">%&gt;%</span></span>
<span id="cb97-31"><a href="figure-4.html#cb97-31" tabindex="-1"></a>    <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb97-32"><a href="figure-4.html#cb97-32" tabindex="-1"></a>  </span>
<span id="cb97-33"><a href="figure-4.html#cb97-33" tabindex="-1"></a>  pathway <span class="ot">&lt;-</span> gmt1[[<span class="dv">1</span>]]</span>
<span id="cb97-34"><a href="figure-4.html#cb97-34" tabindex="-1"></a>  </span>
<span id="cb97-35"><a href="figure-4.html#cb97-35" tabindex="-1"></a>  stats <span class="ot">&lt;-</span> Ranks_all</span>
<span id="cb97-36"><a href="figure-4.html#cb97-36" tabindex="-1"></a>  rnk <span class="ot">&lt;-</span> <span class="fu">rank</span>(<span class="sc">-</span>stats)</span>
<span id="cb97-37"><a href="figure-4.html#cb97-37" tabindex="-1"></a>  ord <span class="ot">&lt;-</span> <span class="fu">order</span>(rnk)</span>
<span id="cb97-38"><a href="figure-4.html#cb97-38" tabindex="-1"></a>  statsAdj <span class="ot">&lt;-</span> stats[ord]</span>
<span id="cb97-39"><a href="figure-4.html#cb97-39" tabindex="-1"></a>  statsAdj <span class="ot">&lt;-</span> <span class="fu">sign</span>(statsAdj) <span class="sc">*</span> (<span class="fu">abs</span>(statsAdj)<span class="sc">^</span>gseaParam)</span>
<span id="cb97-40"><a href="figure-4.html#cb97-40" tabindex="-1"></a>  statsAdj <span class="ot">&lt;-</span> statsAdj<span class="sc">/</span><span class="fu">max</span>(<span class="fu">abs</span>(statsAdj))</span>
<span id="cb97-41"><a href="figure-4.html#cb97-41" tabindex="-1"></a>  pathway <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">as.vector</span>(<span class="fu">na.omit</span>(<span class="fu">match</span>(pathway, <span class="fu">names</span>(statsAdj)))))</span>
<span id="cb97-42"><a href="figure-4.html#cb97-42" tabindex="-1"></a>  pathway <span class="ot">&lt;-</span> <span class="fu">sort</span>(pathway)</span>
<span id="cb97-43"><a href="figure-4.html#cb97-43" tabindex="-1"></a>  gseaRes <span class="ot">&lt;-</span> fgsea<span class="sc">::</span><span class="fu">calcGseaStat</span>(statsAdj, <span class="at">selectedStats =</span> pathway, </span>
<span id="cb97-44"><a href="figure-4.html#cb97-44" tabindex="-1"></a>                                 <span class="at">returnAllExtremes =</span> <span class="cn">TRUE</span>)</span>
<span id="cb97-45"><a href="figure-4.html#cb97-45" tabindex="-1"></a>  bottoms <span class="ot">&lt;-</span> gseaRes<span class="sc">$</span>bottoms</span>
<span id="cb97-46"><a href="figure-4.html#cb97-46" tabindex="-1"></a>  tops <span class="ot">&lt;-</span> gseaRes<span class="sc">$</span>tops</span>
<span id="cb97-47"><a href="figure-4.html#cb97-47" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(statsAdj)</span>
<span id="cb97-48"><a href="figure-4.html#cb97-48" tabindex="-1"></a>  xs <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">rbind</span>(pathway <span class="sc">-</span> <span class="dv">1</span>, pathway))</span>
<span id="cb97-49"><a href="figure-4.html#cb97-49" tabindex="-1"></a>  ys <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">rbind</span>(bottoms, tops))</span>
<span id="cb97-50"><a href="figure-4.html#cb97-50" tabindex="-1"></a>  toPlot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, xs, n <span class="sc">+</span> <span class="dv">1</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, ys, <span class="dv">0</span>))</span>
<span id="cb97-51"><a href="figure-4.html#cb97-51" tabindex="-1"></a>  diff <span class="ot">&lt;-</span> (<span class="fu">max</span>(tops) <span class="sc">-</span> <span class="fu">min</span>(bottoms))<span class="sc">/</span><span class="dv">8</span></span>
<span id="cb97-52"><a href="figure-4.html#cb97-52" tabindex="-1"></a>  x <span class="ot">=</span> y <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb97-53"><a href="figure-4.html#cb97-53" tabindex="-1"></a>  <span class="do">## Visualization</span></span>
<span id="cb97-54"><a href="figure-4.html#cb97-54" tabindex="-1"></a>  g1 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(toPlot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb97-55"><a href="figure-4.html#cb97-55" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;green&quot;</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span>  </span>
<span id="cb97-56"><a href="figure-4.html#cb97-56" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span> </span>
<span id="cb97-57"><a href="figure-4.html#cb97-57" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb97-58"><a href="figure-4.html#cb97-58" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span> </span>
<span id="cb97-59"><a href="figure-4.html#cb97-59" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb97-60"><a href="figure-4.html#cb97-60" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb97-61"><a href="figure-4.html#cb97-61" tabindex="-1"></a>                   <span class="at">axis.text.x=</span>ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),<span class="at">axis.ticks.x=</span>ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb97-62"><a href="figure-4.html#cb97-62" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;enrichment score&quot;</span>,<span class="at">title=</span>)<span class="sc">+</span></span>
<span id="cb97-63"><a href="figure-4.html#cb97-63" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">length</span>(statsAdj)<span class="sc">+</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb97-64"><a href="figure-4.html#cb97-64" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">5</span>), <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb97-65"><a href="figure-4.html#cb97-65" tabindex="-1"></a>  </span>
<span id="cb97-66"><a href="figure-4.html#cb97-66" tabindex="-1"></a>  g2 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(toPlot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))<span class="sc">+</span></span>
<span id="cb97-67"><a href="figure-4.html#cb97-67" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_segment</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> pathway), </span>
<span id="cb97-68"><a href="figure-4.html#cb97-68" tabindex="-1"></a>                          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, </span>
<span id="cb97-69"><a href="figure-4.html#cb97-69" tabindex="-1"></a>                                        <span class="at">y =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> <span class="dv">1</span>),</span>
<span id="cb97-70"><a href="figure-4.html#cb97-70" tabindex="-1"></a>                          <span class="at">size =</span> ticksSize,<span class="at">color=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb97-71"><a href="figure-4.html#cb97-71" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb97-72"><a href="figure-4.html#cb97-72" tabindex="-1"></a>                                <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">length</span>(statsAdj)<span class="sc">+</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb97-73"><a href="figure-4.html#cb97-73" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb97-74"><a href="figure-4.html#cb97-74" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb97-75"><a href="figure-4.html#cb97-75" tabindex="-1"></a>                   <span class="at">axis.text.x=</span><span class="fu">element_blank</span>(),<span class="at">axis.ticks.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb97-76"><a href="figure-4.html#cb97-76" tabindex="-1"></a>                   <span class="at">axis.text.y=</span><span class="fu">element_blank</span>(),<span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb97-77"><a href="figure-4.html#cb97-77" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>,<span class="at">y=</span><span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb97-78"><a href="figure-4.html#cb97-78" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">5</span>), <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb97-79"><a href="figure-4.html#cb97-79" tabindex="-1"></a>  </span>
<span id="cb97-80"><a href="figure-4.html#cb97-80" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(statsAdj),<span class="at">value=</span>statsAdj)</span>
<span id="cb97-81"><a href="figure-4.html#cb97-81" tabindex="-1"></a>  </span>
<span id="cb97-82"><a href="figure-4.html#cb97-82" tabindex="-1"></a>  g3 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(dat,<span class="fu">aes</span>(name,value))<span class="sc">+</span></span>
<span id="cb97-83"><a href="figure-4.html#cb97-83" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,<span class="at">fill=</span><span class="st">&quot;gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb97-84"><a href="figure-4.html#cb97-84" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb97-85"><a href="figure-4.html#cb97-85" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb97-86"><a href="figure-4.html#cb97-86" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb97-87"><a href="figure-4.html#cb97-87" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">length</span>(statsAdj)<span class="sc">+</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb97-88"><a href="figure-4.html#cb97-88" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>), <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb97-89"><a href="figure-4.html#cb97-89" tabindex="-1"></a>  </span>
<span id="cb97-90"><a href="figure-4.html#cb97-90" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(g1,g2,g3),<span class="at">nrow=</span><span class="dv">3</span>,</span>
<span id="cb97-91"><a href="figure-4.html#cb97-91" tabindex="-1"></a>                           <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.2</span>,<span class="fl">0.5</span>),<span class="at">scale=</span><span class="dv">1</span>,</span>
<span id="cb97-92"><a href="figure-4.html#cb97-92" tabindex="-1"></a>                           <span class="at">align =</span><span class="st">&quot;v&quot;</span>,<span class="at">labels=</span><span class="fu">paste0</span>(<span class="st">&quot;TCA Cycle&quot;</span>,<span class="st">&quot; pval=&quot;</span>,pval,<span class="st">&quot;;NES=&quot;</span>,nes),<span class="at">label_size =</span> <span class="dv">8</span>)</span>
<span id="cb97-93"><a href="figure-4.html#cb97-93" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="st">&quot;result/Figure4/S5I_GSEA_B_TCA.pdf&quot;</span>,p1,<span class="at">width=</span><span class="dv">4</span>,<span class="at">height =</span> <span class="dv">4</span>)</span>
<span id="cb97-94"><a href="figure-4.html#cb97-94" tabindex="-1"></a>  </span>
<span id="cb97-95"><a href="figure-4.html#cb97-95" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb97-96"><a href="figure-4.html#cb97-96" tabindex="-1"></a><span class="co">#  Step 2: Mitochondrial gene expression</span></span>
<span id="cb97-97"><a href="figure-4.html#cb97-97" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb97-98"><a href="figure-4.html#cb97-98" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb97-99"><a href="figure-4.html#cb97-99" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb97-100"><a href="figure-4.html#cb97-100" tabindex="-1"></a></span>
<span id="cb97-101"><a href="figure-4.html#cb97-101" tabindex="-1"></a><span class="do">## Load data and set parameters</span></span>
<span id="cb97-102"><a href="figure-4.html#cb97-102" tabindex="-1"></a>gene_all <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S5H_gene_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-103"><a href="figure-4.html#cb97-103" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb97-104"><a href="figure-4.html#cb97-104" tabindex="-1"></a></span>
<span id="cb97-105"><a href="figure-4.html#cb97-105" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">&quot;raw_data/MITOCHONDRIAL.txt&quot;</span>)</span>
<span id="cb97-106"><a href="figure-4.html#cb97-106" tabindex="-1"></a>gmt <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(a, <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb97-107"><a href="figure-4.html#cb97-107" tabindex="-1"></a><span class="fu">names</span>(gmt) <span class="ot">&lt;-</span> <span class="fu">vapply</span>(gmt, <span class="cf">function</span>(y) y[<span class="dv">1</span>], <span class="fu">character</span>(<span class="dv">1</span>))</span>
<span id="cb97-108"><a href="figure-4.html#cb97-108" tabindex="-1"></a>gmt1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(gmt, <span class="st">&quot;[&quot;</span>, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span>
<span id="cb97-109"><a href="figure-4.html#cb97-109" tabindex="-1"></a></span>
<span id="cb97-110"><a href="figure-4.html#cb97-110" tabindex="-1"></a>a_temp <span class="ot">&lt;-</span> gene_all<span class="sc">$</span>logFC</span>
<span id="cb97-111"><a href="figure-4.html#cb97-111" tabindex="-1"></a><span class="fu">names</span>(a_temp) <span class="ot">&lt;-</span> gene_all<span class="sc">$</span>name</span>
<span id="cb97-112"><a href="figure-4.html#cb97-112" tabindex="-1"></a>  </span>
<span id="cb97-113"><a href="figure-4.html#cb97-113" tabindex="-1"></a>  Ranks_all <span class="ot">&lt;-</span> <span class="fu">sort</span>(a_temp,<span class="at">decreasing =</span><span class="cn">TRUE</span>)</span>
<span id="cb97-114"><a href="figure-4.html#cb97-114" tabindex="-1"></a>  gseaParam <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb97-115"><a href="figure-4.html#cb97-115" tabindex="-1"></a>  minSize<span class="ot">=</span><span class="dv">5</span></span>
<span id="cb97-116"><a href="figure-4.html#cb97-116" tabindex="-1"></a>  ticksSize <span class="ot">=</span> <span class="fl">0.2</span></span>
<span id="cb97-117"><a href="figure-4.html#cb97-117" tabindex="-1"></a>  Ranks_all <span class="ot">=</span> <span class="fu">sort</span>(a_temp,<span class="at">decreasing =</span><span class="cn">TRUE</span>)</span>
<span id="cb97-118"><a href="figure-4.html#cb97-118" tabindex="-1"></a>  fgseaRes_all <span class="ot">&lt;-</span> fgsea<span class="sc">::</span><span class="fu">fgsea</span>(gmt1, <span class="fu">sort</span>(a_temp,<span class="at">decreasing =</span><span class="cn">TRUE</span>),<span class="at">minSize =</span> minSize,<span class="at">nPermSimple=</span><span class="dv">20000</span>,<span class="at">gseaParam=</span><span class="fl">0.5</span>)</span>
<span id="cb97-119"><a href="figure-4.html#cb97-119" tabindex="-1"></a>  </span>
<span id="cb97-120"><a href="figure-4.html#cb97-120" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> fgseaRes_all <span class="sc">%&gt;%</span> </span>
<span id="cb97-121"><a href="figure-4.html#cb97-121" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(pval) <span class="sc">%&gt;%</span></span>
<span id="cb97-122"><a href="figure-4.html#cb97-122" tabindex="-1"></a>    <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb97-123"><a href="figure-4.html#cb97-123" tabindex="-1"></a>  nes <span class="ot">&lt;-</span> fgseaRes_all <span class="sc">%&gt;%</span> </span>
<span id="cb97-124"><a href="figure-4.html#cb97-124" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(NES) <span class="sc">%&gt;%</span></span>
<span id="cb97-125"><a href="figure-4.html#cb97-125" tabindex="-1"></a>    <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb97-126"><a href="figure-4.html#cb97-126" tabindex="-1"></a>  </span>
<span id="cb97-127"><a href="figure-4.html#cb97-127" tabindex="-1"></a>  pathway <span class="ot">&lt;-</span> gmt1[[<span class="dv">1</span>]]</span>
<span id="cb97-128"><a href="figure-4.html#cb97-128" tabindex="-1"></a>  </span>
<span id="cb97-129"><a href="figure-4.html#cb97-129" tabindex="-1"></a>  stats <span class="ot">&lt;-</span> Ranks_all</span>
<span id="cb97-130"><a href="figure-4.html#cb97-130" tabindex="-1"></a>  rnk <span class="ot">&lt;-</span> <span class="fu">rank</span>(<span class="sc">-</span>stats)</span>
<span id="cb97-131"><a href="figure-4.html#cb97-131" tabindex="-1"></a>  ord <span class="ot">&lt;-</span> <span class="fu">order</span>(rnk)</span>
<span id="cb97-132"><a href="figure-4.html#cb97-132" tabindex="-1"></a>  statsAdj <span class="ot">&lt;-</span> stats[ord]</span>
<span id="cb97-133"><a href="figure-4.html#cb97-133" tabindex="-1"></a>  statsAdj <span class="ot">&lt;-</span> <span class="fu">sign</span>(statsAdj) <span class="sc">*</span> (<span class="fu">abs</span>(statsAdj)<span class="sc">^</span>gseaParam)</span>
<span id="cb97-134"><a href="figure-4.html#cb97-134" tabindex="-1"></a>  statsAdj <span class="ot">&lt;-</span> statsAdj<span class="sc">/</span><span class="fu">max</span>(<span class="fu">abs</span>(statsAdj))</span>
<span id="cb97-135"><a href="figure-4.html#cb97-135" tabindex="-1"></a>  pathway <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">as.vector</span>(<span class="fu">na.omit</span>(<span class="fu">match</span>(pathway, <span class="fu">names</span>(statsAdj)))))</span>
<span id="cb97-136"><a href="figure-4.html#cb97-136" tabindex="-1"></a>  pathway <span class="ot">&lt;-</span> <span class="fu">sort</span>(pathway)</span>
<span id="cb97-137"><a href="figure-4.html#cb97-137" tabindex="-1"></a>  gseaRes <span class="ot">&lt;-</span> fgsea<span class="sc">::</span><span class="fu">calcGseaStat</span>(statsAdj, <span class="at">selectedStats =</span> pathway, </span>
<span id="cb97-138"><a href="figure-4.html#cb97-138" tabindex="-1"></a>                                 <span class="at">returnAllExtremes =</span> <span class="cn">TRUE</span>)</span>
<span id="cb97-139"><a href="figure-4.html#cb97-139" tabindex="-1"></a>  bottoms <span class="ot">&lt;-</span> gseaRes<span class="sc">$</span>bottoms</span>
<span id="cb97-140"><a href="figure-4.html#cb97-140" tabindex="-1"></a>  tops <span class="ot">&lt;-</span> gseaRes<span class="sc">$</span>tops</span>
<span id="cb97-141"><a href="figure-4.html#cb97-141" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(statsAdj)</span>
<span id="cb97-142"><a href="figure-4.html#cb97-142" tabindex="-1"></a>  xs <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">rbind</span>(pathway <span class="sc">-</span> <span class="dv">1</span>, pathway))</span>
<span id="cb97-143"><a href="figure-4.html#cb97-143" tabindex="-1"></a>  ys <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">rbind</span>(bottoms, tops))</span>
<span id="cb97-144"><a href="figure-4.html#cb97-144" tabindex="-1"></a>  toPlot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, xs, n <span class="sc">+</span> <span class="dv">1</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, ys, <span class="dv">0</span>))</span>
<span id="cb97-145"><a href="figure-4.html#cb97-145" tabindex="-1"></a>  diff <span class="ot">&lt;-</span> (<span class="fu">max</span>(tops) <span class="sc">-</span> <span class="fu">min</span>(bottoms))<span class="sc">/</span><span class="dv">8</span></span>
<span id="cb97-146"><a href="figure-4.html#cb97-146" tabindex="-1"></a>  x <span class="ot">=</span> y <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb97-147"><a href="figure-4.html#cb97-147" tabindex="-1"></a>  <span class="do">## Visualization</span></span>
<span id="cb97-148"><a href="figure-4.html#cb97-148" tabindex="-1"></a>  g1 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(toPlot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb97-149"><a href="figure-4.html#cb97-149" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;green&quot;</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span>  </span>
<span id="cb97-150"><a href="figure-4.html#cb97-150" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, </span>
<span id="cb97-151"><a href="figure-4.html#cb97-151" tabindex="-1"></a>                        <span class="at">colour =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb97-152"><a href="figure-4.html#cb97-152" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb97-153"><a href="figure-4.html#cb97-153" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb97-154"><a href="figure-4.html#cb97-154" tabindex="-1"></a>                   <span class="at">axis.text.x=</span>ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),<span class="at">axis.ticks.x=</span>ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb97-155"><a href="figure-4.html#cb97-155" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;enrichment score&quot;</span>,<span class="at">title=</span>)<span class="sc">+</span></span>
<span id="cb97-156"><a href="figure-4.html#cb97-156" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">length</span>(statsAdj)<span class="sc">+</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb97-157"><a href="figure-4.html#cb97-157" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">5</span>), <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb97-158"><a href="figure-4.html#cb97-158" tabindex="-1"></a>  </span>
<span id="cb97-159"><a href="figure-4.html#cb97-159" tabindex="-1"></a>  g2 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(toPlot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))<span class="sc">+</span></span>
<span id="cb97-160"><a href="figure-4.html#cb97-160" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_segment</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> pathway), </span>
<span id="cb97-161"><a href="figure-4.html#cb97-161" tabindex="-1"></a>                          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, </span>
<span id="cb97-162"><a href="figure-4.html#cb97-162" tabindex="-1"></a>                                        <span class="at">y =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> <span class="dv">1</span>),</span>
<span id="cb97-163"><a href="figure-4.html#cb97-163" tabindex="-1"></a>                          <span class="at">size =</span> ticksSize,<span class="at">color=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb97-164"><a href="figure-4.html#cb97-164" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">length</span>(statsAdj)<span class="sc">+</span><span class="dv">1</span>))<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb97-165"><a href="figure-4.html#cb97-165" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb97-166"><a href="figure-4.html#cb97-166" tabindex="-1"></a>                   <span class="at">axis.text.x=</span><span class="fu">element_blank</span>(),<span class="at">axis.ticks.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb97-167"><a href="figure-4.html#cb97-167" tabindex="-1"></a>                   <span class="at">axis.text.y=</span><span class="fu">element_blank</span>(),<span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb97-168"><a href="figure-4.html#cb97-168" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>,<span class="at">y=</span><span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb97-169"><a href="figure-4.html#cb97-169" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">5</span>), <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb97-170"><a href="figure-4.html#cb97-170" tabindex="-1"></a>  </span>
<span id="cb97-171"><a href="figure-4.html#cb97-171" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(statsAdj),<span class="at">value=</span>statsAdj)</span>
<span id="cb97-172"><a href="figure-4.html#cb97-172" tabindex="-1"></a>  </span>
<span id="cb97-173"><a href="figure-4.html#cb97-173" tabindex="-1"></a>  g3 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(dat,<span class="fu">aes</span>(name,value))<span class="sc">+</span></span>
<span id="cb97-174"><a href="figure-4.html#cb97-174" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,<span class="at">fill=</span><span class="st">&quot;gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb97-175"><a href="figure-4.html#cb97-175" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb97-176"><a href="figure-4.html#cb97-176" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb97-177"><a href="figure-4.html#cb97-177" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb97-178"><a href="figure-4.html#cb97-178" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">length</span>(statsAdj)<span class="sc">+</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb97-179"><a href="figure-4.html#cb97-179" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>), <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb97-180"><a href="figure-4.html#cb97-180" tabindex="-1"></a>  </span>
<span id="cb97-181"><a href="figure-4.html#cb97-181" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(g1,g2,g3),<span class="at">nrow=</span><span class="dv">3</span>,</span>
<span id="cb97-182"><a href="figure-4.html#cb97-182" tabindex="-1"></a>                           <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.2</span>,<span class="fl">0.5</span>),<span class="at">scale=</span><span class="dv">1</span>,</span>
<span id="cb97-183"><a href="figure-4.html#cb97-183" tabindex="-1"></a>                           <span class="at">align =</span><span class="st">&quot;v&quot;</span>,<span class="at">labels=</span><span class="fu">paste0</span>(<span class="st">&quot;MITOCHONDRIAL&quot;</span>,<span class="st">&quot; pval=&quot;</span>,pval,<span class="st">&quot;;NES=&quot;</span>,nes),<span class="at">label_size =</span> <span class="dv">8</span>)</span>
<span id="cb97-184"><a href="figure-4.html#cb97-184" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="st">&quot;result/Figure4/S5I_GSEA_B_MITOCHONDRIAL.pdf&quot;</span>,p1,<span class="at">width=</span><span class="dv">4</span>,<span class="at">height =</span> <span class="dv">4</span>)</span>
<span id="cb97-185"><a href="figure-4.html#cb97-185" tabindex="-1"></a></span>
<span id="cb97-186"><a href="figure-4.html#cb97-186" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb97-187"><a href="figure-4.html#cb97-187" tabindex="-1"></a><span class="co"># Step 3: Cholesterol biosynthesis pathway</span></span>
<span id="cb97-188"><a href="figure-4.html#cb97-188" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb97-189"><a href="figure-4.html#cb97-189" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb97-190"><a href="figure-4.html#cb97-190" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb97-191"><a href="figure-4.html#cb97-191" tabindex="-1"></a></span>
<span id="cb97-192"><a href="figure-4.html#cb97-192" tabindex="-1"></a><span class="do">## Load data and set parameters</span></span>
<span id="cb97-193"><a href="figure-4.html#cb97-193" tabindex="-1"></a>gene_all <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S5H_gene_B.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-194"><a href="figure-4.html#cb97-194" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb97-195"><a href="figure-4.html#cb97-195" tabindex="-1"></a></span>
<span id="cb97-196"><a href="figure-4.html#cb97-196" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">&quot;raw_data/Cholesterol.txt&quot;</span>)</span>
<span id="cb97-197"><a href="figure-4.html#cb97-197" tabindex="-1"></a>gmt <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(a, <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb97-198"><a href="figure-4.html#cb97-198" tabindex="-1"></a><span class="fu">names</span>(gmt) <span class="ot">&lt;-</span> <span class="fu">vapply</span>(gmt, <span class="cf">function</span>(y) y[<span class="dv">1</span>], <span class="fu">character</span>(<span class="dv">1</span>))</span>
<span id="cb97-199"><a href="figure-4.html#cb97-199" tabindex="-1"></a>gmt1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(gmt, <span class="st">&quot;[&quot;</span>, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span>
<span id="cb97-200"><a href="figure-4.html#cb97-200" tabindex="-1"></a></span>
<span id="cb97-201"><a href="figure-4.html#cb97-201" tabindex="-1"></a>a_temp <span class="ot">&lt;-</span> gene_all<span class="sc">$</span>logFC</span>
<span id="cb97-202"><a href="figure-4.html#cb97-202" tabindex="-1"></a><span class="fu">names</span>(a_temp) <span class="ot">&lt;-</span> gene_all<span class="sc">$</span>name</span>
<span id="cb97-203"><a href="figure-4.html#cb97-203" tabindex="-1"></a></span>
<span id="cb97-204"><a href="figure-4.html#cb97-204" tabindex="-1"></a>  Ranks_all <span class="ot">&lt;-</span> <span class="fu">sort</span>(a_temp,<span class="at">decreasing =</span><span class="cn">TRUE</span>)</span>
<span id="cb97-205"><a href="figure-4.html#cb97-205" tabindex="-1"></a>  gseaParam <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb97-206"><a href="figure-4.html#cb97-206" tabindex="-1"></a>  minSize<span class="ot">=</span><span class="dv">5</span></span>
<span id="cb97-207"><a href="figure-4.html#cb97-207" tabindex="-1"></a>  ticksSize <span class="ot">=</span> <span class="fl">0.2</span></span>
<span id="cb97-208"><a href="figure-4.html#cb97-208" tabindex="-1"></a>  Ranks_all <span class="ot">=</span> <span class="fu">sort</span>(a_temp,<span class="at">decreasing =</span><span class="cn">TRUE</span>)</span>
<span id="cb97-209"><a href="figure-4.html#cb97-209" tabindex="-1"></a>  fgseaRes_all <span class="ot">&lt;-</span> fgsea<span class="sc">::</span><span class="fu">fgsea</span>(gmt1, <span class="fu">sort</span>(a_temp,<span class="at">decreasing =</span><span class="cn">TRUE</span>),<span class="at">minSize =</span> minSize,<span class="at">nPermSimple=</span><span class="dv">20000</span>,<span class="at">gseaParam=</span><span class="fl">0.5</span>)</span>
<span id="cb97-210"><a href="figure-4.html#cb97-210" tabindex="-1"></a>  </span>
<span id="cb97-211"><a href="figure-4.html#cb97-211" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> fgseaRes_all <span class="sc">%&gt;%</span> </span>
<span id="cb97-212"><a href="figure-4.html#cb97-212" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(pval) <span class="sc">%&gt;%</span></span>
<span id="cb97-213"><a href="figure-4.html#cb97-213" tabindex="-1"></a>    <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb97-214"><a href="figure-4.html#cb97-214" tabindex="-1"></a>  nes <span class="ot">&lt;-</span> fgseaRes_all <span class="sc">%&gt;%</span> </span>
<span id="cb97-215"><a href="figure-4.html#cb97-215" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(NES) <span class="sc">%&gt;%</span></span>
<span id="cb97-216"><a href="figure-4.html#cb97-216" tabindex="-1"></a>    <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb97-217"><a href="figure-4.html#cb97-217" tabindex="-1"></a>  </span>
<span id="cb97-218"><a href="figure-4.html#cb97-218" tabindex="-1"></a>  pathway <span class="ot">&lt;-</span> gmt1[[<span class="dv">1</span>]]</span>
<span id="cb97-219"><a href="figure-4.html#cb97-219" tabindex="-1"></a>  </span>
<span id="cb97-220"><a href="figure-4.html#cb97-220" tabindex="-1"></a>  stats <span class="ot">&lt;-</span> Ranks_all</span>
<span id="cb97-221"><a href="figure-4.html#cb97-221" tabindex="-1"></a>  rnk <span class="ot">&lt;-</span> <span class="fu">rank</span>(<span class="sc">-</span>stats)</span>
<span id="cb97-222"><a href="figure-4.html#cb97-222" tabindex="-1"></a>  ord <span class="ot">&lt;-</span> <span class="fu">order</span>(rnk)</span>
<span id="cb97-223"><a href="figure-4.html#cb97-223" tabindex="-1"></a>  statsAdj <span class="ot">&lt;-</span> stats[ord]</span>
<span id="cb97-224"><a href="figure-4.html#cb97-224" tabindex="-1"></a>  statsAdj <span class="ot">&lt;-</span> <span class="fu">sign</span>(statsAdj) <span class="sc">*</span> (<span class="fu">abs</span>(statsAdj)<span class="sc">^</span>gseaParam)</span>
<span id="cb97-225"><a href="figure-4.html#cb97-225" tabindex="-1"></a>  statsAdj <span class="ot">&lt;-</span> statsAdj<span class="sc">/</span><span class="fu">max</span>(<span class="fu">abs</span>(statsAdj))</span>
<span id="cb97-226"><a href="figure-4.html#cb97-226" tabindex="-1"></a>  pathway <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">as.vector</span>(<span class="fu">na.omit</span>(<span class="fu">match</span>(pathway, <span class="fu">names</span>(statsAdj)))))</span>
<span id="cb97-227"><a href="figure-4.html#cb97-227" tabindex="-1"></a>  pathway <span class="ot">&lt;-</span> <span class="fu">sort</span>(pathway)</span>
<span id="cb97-228"><a href="figure-4.html#cb97-228" tabindex="-1"></a>  gseaRes <span class="ot">&lt;-</span> fgsea<span class="sc">::</span><span class="fu">calcGseaStat</span>(statsAdj, <span class="at">selectedStats =</span> pathway, </span>
<span id="cb97-229"><a href="figure-4.html#cb97-229" tabindex="-1"></a>                                 <span class="at">returnAllExtremes =</span> <span class="cn">TRUE</span>)</span>
<span id="cb97-230"><a href="figure-4.html#cb97-230" tabindex="-1"></a>  bottoms <span class="ot">&lt;-</span> gseaRes<span class="sc">$</span>bottoms</span>
<span id="cb97-231"><a href="figure-4.html#cb97-231" tabindex="-1"></a>  tops <span class="ot">&lt;-</span> gseaRes<span class="sc">$</span>tops</span>
<span id="cb97-232"><a href="figure-4.html#cb97-232" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(statsAdj)</span>
<span id="cb97-233"><a href="figure-4.html#cb97-233" tabindex="-1"></a>  xs <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">rbind</span>(pathway <span class="sc">-</span> <span class="dv">1</span>, pathway))</span>
<span id="cb97-234"><a href="figure-4.html#cb97-234" tabindex="-1"></a>  ys <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">rbind</span>(bottoms, tops))</span>
<span id="cb97-235"><a href="figure-4.html#cb97-235" tabindex="-1"></a>  toPlot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, xs, n <span class="sc">+</span> <span class="dv">1</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, ys, <span class="dv">0</span>))</span>
<span id="cb97-236"><a href="figure-4.html#cb97-236" tabindex="-1"></a>  diff <span class="ot">&lt;-</span> (<span class="fu">max</span>(tops) <span class="sc">-</span> <span class="fu">min</span>(bottoms))<span class="sc">/</span><span class="dv">8</span></span>
<span id="cb97-237"><a href="figure-4.html#cb97-237" tabindex="-1"></a>  x <span class="ot">=</span> y <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb97-238"><a href="figure-4.html#cb97-238" tabindex="-1"></a>  <span class="do">## Visualization</span></span>
<span id="cb97-239"><a href="figure-4.html#cb97-239" tabindex="-1"></a>  g1 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(toPlot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb97-240"><a href="figure-4.html#cb97-240" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;green&quot;</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span>  </span>
<span id="cb97-241"><a href="figure-4.html#cb97-241" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, </span>
<span id="cb97-242"><a href="figure-4.html#cb97-242" tabindex="-1"></a>                        <span class="at">colour =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb97-243"><a href="figure-4.html#cb97-243" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb97-244"><a href="figure-4.html#cb97-244" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb97-245"><a href="figure-4.html#cb97-245" tabindex="-1"></a>                   <span class="at">axis.text.x=</span>ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),<span class="at">axis.ticks.x=</span>ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb97-246"><a href="figure-4.html#cb97-246" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;enrichment score&quot;</span>,<span class="at">title=</span>)<span class="sc">+</span></span>
<span id="cb97-247"><a href="figure-4.html#cb97-247" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">length</span>(statsAdj)<span class="sc">+</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb97-248"><a href="figure-4.html#cb97-248" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">5</span>), <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb97-249"><a href="figure-4.html#cb97-249" tabindex="-1"></a>  </span>
<span id="cb97-250"><a href="figure-4.html#cb97-250" tabindex="-1"></a>  g2 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(toPlot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))<span class="sc">+</span></span>
<span id="cb97-251"><a href="figure-4.html#cb97-251" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_segment</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> pathway), </span>
<span id="cb97-252"><a href="figure-4.html#cb97-252" tabindex="-1"></a>                          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, </span>
<span id="cb97-253"><a href="figure-4.html#cb97-253" tabindex="-1"></a>                                        <span class="at">y =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> <span class="dv">1</span>),</span>
<span id="cb97-254"><a href="figure-4.html#cb97-254" tabindex="-1"></a>                          <span class="at">size =</span> ticksSize,<span class="at">color=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb97-255"><a href="figure-4.html#cb97-255" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">length</span>(statsAdj)<span class="sc">+</span><span class="dv">1</span>))<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb97-256"><a href="figure-4.html#cb97-256" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb97-257"><a href="figure-4.html#cb97-257" tabindex="-1"></a>                   <span class="at">axis.text.x=</span><span class="fu">element_blank</span>(),<span class="at">axis.ticks.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb97-258"><a href="figure-4.html#cb97-258" tabindex="-1"></a>                   <span class="at">axis.text.y=</span><span class="fu">element_blank</span>(),<span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb97-259"><a href="figure-4.html#cb97-259" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>,<span class="at">y=</span><span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb97-260"><a href="figure-4.html#cb97-260" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">5</span>), <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb97-261"><a href="figure-4.html#cb97-261" tabindex="-1"></a>  </span>
<span id="cb97-262"><a href="figure-4.html#cb97-262" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(statsAdj),<span class="at">value=</span>statsAdj)</span>
<span id="cb97-263"><a href="figure-4.html#cb97-263" tabindex="-1"></a>  </span>
<span id="cb97-264"><a href="figure-4.html#cb97-264" tabindex="-1"></a>  g3 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(dat,<span class="fu">aes</span>(name,value))<span class="sc">+</span></span>
<span id="cb97-265"><a href="figure-4.html#cb97-265" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,<span class="at">fill=</span><span class="st">&quot;gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb97-266"><a href="figure-4.html#cb97-266" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb97-267"><a href="figure-4.html#cb97-267" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb97-268"><a href="figure-4.html#cb97-268" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb97-269"><a href="figure-4.html#cb97-269" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">length</span>(statsAdj)<span class="sc">+</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb97-270"><a href="figure-4.html#cb97-270" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>), <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb97-271"><a href="figure-4.html#cb97-271" tabindex="-1"></a>  </span>
<span id="cb97-272"><a href="figure-4.html#cb97-272" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(g1,g2,g3),<span class="at">nrow=</span><span class="dv">3</span>,</span>
<span id="cb97-273"><a href="figure-4.html#cb97-273" tabindex="-1"></a>                           <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.2</span>,<span class="fl">0.5</span>),<span class="at">scale=</span><span class="dv">1</span>,</span>
<span id="cb97-274"><a href="figure-4.html#cb97-274" tabindex="-1"></a>                           <span class="at">align =</span><span class="st">&quot;v&quot;</span>,<span class="at">labels=</span><span class="fu">paste0</span>(<span class="st">&quot;Cholesterol Biosynthesis&quot;</span>,<span class="st">&quot; pval=&quot;</span>,pval,<span class="st">&quot;;NES=&quot;</span>,nes),<span class="at">label_size =</span> <span class="dv">8</span>)</span>
<span id="cb97-275"><a href="figure-4.html#cb97-275" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="st">&quot;result/Figure4/S5J_GSEA_B_Cholesterol.pdf&quot;</span>,p1,<span class="at">width=</span><span class="dv">4</span>,<span class="at">height =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure4/S5I-J.png" width="1104" style="display: block; margin: auto;" /></p>
</div>
<div id="s6-a-clusters-of-t-all" class="section level2 hasAnchor" number="19.13">
<h2><span class="header-section-number">19.13</span> (S6 A) Clusters of T-ALL<a href="figure-4.html#s6-a-clusters-of-t-all" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The relative abundance of input metabolites and expression of metabolic genes in the two metabolic clusters: <strong>TC1 (N=10) and TC2 (N=14)</strong>. Each column represents a sample and each row represents a metabolite (upper panel) or gene included (lower panel).</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="figure-4.html#cb98-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb98-2"><a href="figure-4.html#cb98-2" tabindex="-1"></a></span>
<span id="cb98-3"><a href="figure-4.html#cb98-3" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4F_cluster_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-4"><a href="figure-4.html#cb98-4" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb98-5"><a href="figure-4.html#cb98-5" tabindex="-1"></a></span>
<span id="cb98-6"><a href="figure-4.html#cb98-6" tabindex="-1"></a>metabolite_norm <span class="ot">=</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4F_metabolite_norm_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-7"><a href="figure-4.html#cb98-7" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb98-8"><a href="figure-4.html#cb98-8" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;V1&quot;</span>)</span>
<span id="cb98-9"><a href="figure-4.html#cb98-9" tabindex="-1"></a></span>
<span id="cb98-10"><a href="figure-4.html#cb98-10" tabindex="-1"></a>metgene_norm <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4F_metgene_norm_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-11"><a href="figure-4.html#cb98-11" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb98-12"><a href="figure-4.html#cb98-12" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;V1&quot;</span>) </span>
<span id="cb98-13"><a href="figure-4.html#cb98-13" tabindex="-1"></a></span>
<span id="cb98-14"><a href="figure-4.html#cb98-14" tabindex="-1"></a>top_annotation <span class="ot">=</span> <span class="fu">HeatmapAnnotation</span>(</span>
<span id="cb98-15"><a href="figure-4.html#cb98-15" tabindex="-1"></a>  <span class="at">Subtype=</span>sample_info<span class="sc">$</span>Clusters,</span>
<span id="cb98-16"><a href="figure-4.html#cb98-16" tabindex="-1"></a>  <span class="at">col=</span><span class="fu">list</span>(<span class="at">Subtype=</span><span class="fu">c</span>(<span class="st">&quot;TC1&quot;</span><span class="ot">=</span><span class="st">&quot;#9BD53F&quot;</span>,<span class="st">&quot;TC2&quot;</span><span class="ot">=</span><span class="st">&quot;#A6CEE3&quot;</span>)),</span>
<span id="cb98-17"><a href="figure-4.html#cb98-17" tabindex="-1"></a>  <span class="at">show_annotation_name =</span> <span class="fu">c</span>(T,T), </span>
<span id="cb98-18"><a href="figure-4.html#cb98-18" tabindex="-1"></a>  <span class="at">border =</span> <span class="fu">c</span>(T,T) ,</span>
<span id="cb98-19"><a href="figure-4.html#cb98-19" tabindex="-1"></a>  <span class="at">simple_anno_size =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">&quot;mm&quot;</span>),<span class="at">gap =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb98-20"><a href="figure-4.html#cb98-20" tabindex="-1"></a></span>
<span id="cb98-21"><a href="figure-4.html#cb98-21" tabindex="-1"></a>col_fun <span class="ot">=</span> circlize<span class="sc">::</span><span class="fu">colorRamp2</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="st">&quot;#00599F&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;#D01910&quot;</span>))</span>
<span id="cb98-22"><a href="figure-4.html#cb98-22" tabindex="-1"></a></span>
<span id="cb98-23"><a href="figure-4.html#cb98-23" tabindex="-1"></a>p_metabolite <span class="ot">&lt;-</span> <span class="fu">Heatmap</span>(<span class="fu">t</span>(metabolite_norm),<span class="at">height=</span><span class="fu">unit</span>(<span class="dv">10</span>,<span class="st">&quot;cm&quot;</span>),</span>
<span id="cb98-24"><a href="figure-4.html#cb98-24" tabindex="-1"></a>                        <span class="at">name=</span><span class="st">&quot;Metabolite Data&quot;</span>,</span>
<span id="cb98-25"><a href="figure-4.html#cb98-25" tabindex="-1"></a>                        <span class="at">cluster_row_slices =</span> F,<span class="at">clustering_method_rows =</span> <span class="st">&quot;ward.D&quot;</span>,</span>
<span id="cb98-26"><a href="figure-4.html#cb98-26" tabindex="-1"></a>                        <span class="at">clustering_method_columns =</span> <span class="st">&quot;ward.D2&quot;</span>,</span>
<span id="cb98-27"><a href="figure-4.html#cb98-27" tabindex="-1"></a>                        <span class="at">column_split =</span> sample_info<span class="sc">$</span>Clusters,</span>
<span id="cb98-28"><a href="figure-4.html#cb98-28" tabindex="-1"></a>                        <span class="at">col =</span> col_fun,</span>
<span id="cb98-29"><a href="figure-4.html#cb98-29" tabindex="-1"></a>                        <span class="at">top_annotation =</span>top_annotation,</span>
<span id="cb98-30"><a href="figure-4.html#cb98-30" tabindex="-1"></a>                        <span class="at">show_column_names =</span> F,<span class="at">show_row_names =</span> F,</span>
<span id="cb98-31"><a href="figure-4.html#cb98-31" tabindex="-1"></a>                        <span class="at">row_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">3</span>),</span>
<span id="cb98-32"><a href="figure-4.html#cb98-32" tabindex="-1"></a>                        <span class="at">column_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">3</span>))</span>
<span id="cb98-33"><a href="figure-4.html#cb98-33" tabindex="-1"></a></span>
<span id="cb98-34"><a href="figure-4.html#cb98-34" tabindex="-1"></a>col_fun <span class="ot">=</span> circlize<span class="sc">::</span><span class="fu">colorRamp2</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="st">&quot;#00599F&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;#FF7F00&quot;</span>))</span>
<span id="cb98-35"><a href="figure-4.html#cb98-35" tabindex="-1"></a></span>
<span id="cb98-36"><a href="figure-4.html#cb98-36" tabindex="-1"></a>p_gene <span class="ot">&lt;-</span> <span class="fu">Heatmap</span>(<span class="fu">t</span>(metgene_norm),<span class="at">height=</span><span class="fu">unit</span>(<span class="dv">10</span>,<span class="st">&quot;cm&quot;</span>),<span class="at">name=</span><span class="st">&quot;Gene Data&quot;</span>,</span>
<span id="cb98-37"><a href="figure-4.html#cb98-37" tabindex="-1"></a>                  <span class="at">cluster_row_slices =</span> F,<span class="at">clustering_method_rows =</span> <span class="st">&quot;ward.D&quot;</span>,</span>
<span id="cb98-38"><a href="figure-4.html#cb98-38" tabindex="-1"></a>                  <span class="at">clustering_method_columns =</span> <span class="st">&quot;ward.D2&quot;</span>,</span>
<span id="cb98-39"><a href="figure-4.html#cb98-39" tabindex="-1"></a>                  <span class="at">column_split =</span> sample_info<span class="sc">$</span>Clusters,</span>
<span id="cb98-40"><a href="figure-4.html#cb98-40" tabindex="-1"></a>                  <span class="at">col =</span> col_fun,</span>
<span id="cb98-41"><a href="figure-4.html#cb98-41" tabindex="-1"></a>                  <span class="at">show_column_names =</span> F,<span class="at">show_row_names =</span> F,</span>
<span id="cb98-42"><a href="figure-4.html#cb98-42" tabindex="-1"></a>                  <span class="at">row_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">3</span>),</span>
<span id="cb98-43"><a href="figure-4.html#cb98-43" tabindex="-1"></a>                  <span class="at">column_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">3</span>))</span>
<span id="cb98-44"><a href="figure-4.html#cb98-44" tabindex="-1"></a></span>
<span id="cb98-45"><a href="figure-4.html#cb98-45" tabindex="-1"></a><span class="fu">pdf</span>(<span class="fu">paste0</span>(<span class="st">&quot;result/Figure4/S6A_heatmap_T.pdf&quot;</span>),<span class="at">width=</span><span class="dv">8</span>,<span class="at">height =</span> <span class="dv">10</span>)</span>
<span id="cb98-46"><a href="figure-4.html#cb98-46" tabindex="-1"></a>p_metabolite <span class="sc">%v%</span> p_gene</span>
<span id="cb98-47"><a href="figure-4.html#cb98-47" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p><img src="Figure-1025/Figure4/S6A.png" width="360" style="display: block; margin: auto;" /></p>
</div>
<div id="s6-e-f-rfs-and-efs-of-tc12" class="section level2 hasAnchor" number="19.14">
<h2><span class="header-section-number">19.14</span> (S6 E-F) RFS and EFS of TC1/2<a href="figure-4.html#s6-e-f-rfs-and-efs-of-tc12" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The associations of the two metabolic clusters with <strong>clinical RFS (E) and EFS (F) outcomes in T-ALL patients</strong> (P-value from log rank test). The results suggest TC1 may be of significantly poorer prognosis than TC2.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="figure-4.html#cb99-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb99-2"><a href="figure-4.html#cb99-2" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb99-3"><a href="figure-4.html#cb99-3" tabindex="-1"></a></span>
<span id="cb99-4"><a href="figure-4.html#cb99-4" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb99-5"><a href="figure-4.html#cb99-5" tabindex="-1"></a><span class="co">#  Step 1: RFS of TC1/2</span></span>
<span id="cb99-6"><a href="figure-4.html#cb99-6" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb99-7"><a href="figure-4.html#cb99-7" tabindex="-1"></a>clinical_survival <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="fu">paste0</span>(<span class="st">&quot;result/Figure4/4F_cluster_T.txt&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb99-8"><a href="figure-4.html#cb99-8" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb99-9"><a href="figure-4.html#cb99-9" tabindex="-1"></a></span>
<span id="cb99-10"><a href="figure-4.html#cb99-10" tabindex="-1"></a>surv_object <span class="ot">&lt;-</span> <span class="fu">Surv</span>(<span class="at">time =</span> clinical_survival<span class="sc">$</span>RFS<span class="sc">/</span><span class="dv">30</span>, <span class="at">event =</span> clinical_survival<span class="sc">$</span>RFS_stat)</span>
<span id="cb99-11"><a href="figure-4.html#cb99-11" tabindex="-1"></a>fit_cluster <span class="ot">&lt;-</span> <span class="fu">survfit</span>(surv_object <span class="sc">~</span> Clusters, <span class="at">data =</span> clinical_survival)</span>
<span id="cb99-12"><a href="figure-4.html#cb99-12" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> survminer<span class="sc">::</span><span class="fu">ggsurvplot</span>(fit_cluster, <span class="at">data =</span> clinical_survival, </span>
<span id="cb99-13"><a href="figure-4.html#cb99-13" tabindex="-1"></a>                            <span class="at">title=</span><span class="st">&quot;RFS&quot;</span>,</span>
<span id="cb99-14"><a href="figure-4.html#cb99-14" tabindex="-1"></a>                <span class="at">palette=</span><span class="fu">c</span>(<span class="st">&quot;#9BD53F&quot;</span>,<span class="st">&quot;#A6CEE3&quot;</span>,<span class="st">&quot;#EA644C&quot;</span>),</span>
<span id="cb99-15"><a href="figure-4.html#cb99-15" tabindex="-1"></a>                            <span class="at">tables.theme =</span> <span class="fu">theme_void</span>(),<span class="at">risk.table =</span> <span class="cn">TRUE</span>,</span>
<span id="cb99-16"><a href="figure-4.html#cb99-16" tabindex="-1"></a>                            <span class="at">risk.table.fontsize=</span><span class="dv">6</span>,</span>
<span id="cb99-17"><a href="figure-4.html#cb99-17" tabindex="-1"></a>                            <span class="at">break.time.by =</span> <span class="dv">12</span>,</span>
<span id="cb99-18"><a href="figure-4.html#cb99-18" tabindex="-1"></a>                            <span class="at">risk.table.y.text =</span> <span class="cn">FALSE</span>, <span class="at">tables.height =</span> <span class="fl">0.15</span>,<span class="at">risk.table.col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb99-19"><a href="figure-4.html#cb99-19" tabindex="-1"></a>                            <span class="at">pval =</span> <span class="cn">TRUE</span>,<span class="at">pval.method =</span> F,<span class="at">pval.coord=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.1</span>),<span class="at">pval.size=</span><span class="dv">6</span>,</span>
<span id="cb99-20"><a href="figure-4.html#cb99-20" tabindex="-1"></a>                            <span class="at">font.tickslab=</span><span class="fu">c</span>(<span class="dv">14</span>,<span class="st">&quot;plain&quot;</span>,<span class="st">&quot;black&quot;</span>),</span>
<span id="cb99-21"><a href="figure-4.html#cb99-21" tabindex="-1"></a>                            <span class="at">xlab=</span><span class="st">&quot;Time (Months) &quot;</span>,<span class="at">ylab=</span><span class="st">&quot;RFS Survival&quot;</span>)</span>
<span id="cb99-22"><a href="figure-4.html#cb99-22" tabindex="-1"></a></span>
<span id="cb99-23"><a href="figure-4.html#cb99-23" tabindex="-1"></a><span class="fu">pdf</span>(<span class="fu">paste0</span>(<span class="st">&quot;result/Figure4/S6E_RFS_T.pdf&quot;</span>),<span class="at">onefile=</span><span class="cn">FALSE</span>)</span>
<span id="cb99-24"><a href="figure-4.html#cb99-24" tabindex="-1"></a>p1</span>
<span id="cb99-25"><a href="figure-4.html#cb99-25" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb99-26"><a href="figure-4.html#cb99-26" tabindex="-1"></a></span>
<span id="cb99-27"><a href="figure-4.html#cb99-27" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb99-28"><a href="figure-4.html#cb99-28" tabindex="-1"></a><span class="co">#  Step 2: EFS</span></span>
<span id="cb99-29"><a href="figure-4.html#cb99-29" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb99-30"><a href="figure-4.html#cb99-30" tabindex="-1"></a>clinical_survival <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="fu">paste0</span>(<span class="st">&quot;result/Figure4/4F_cluster_T.txt&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb99-31"><a href="figure-4.html#cb99-31" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb99-32"><a href="figure-4.html#cb99-32" tabindex="-1"></a></span>
<span id="cb99-33"><a href="figure-4.html#cb99-33" tabindex="-1"></a>surv_object <span class="ot">&lt;-</span> <span class="fu">Surv</span>(<span class="at">time =</span> clinical_survival<span class="sc">$</span>EFS<span class="sc">/</span><span class="dv">30</span>, <span class="at">event =</span> clinical_survival<span class="sc">$</span>EFS_stat)</span>
<span id="cb99-34"><a href="figure-4.html#cb99-34" tabindex="-1"></a>fit_cluster <span class="ot">&lt;-</span> <span class="fu">survfit</span>(surv_object <span class="sc">~</span> Clusters, <span class="at">data =</span> clinical_survival)</span>
<span id="cb99-35"><a href="figure-4.html#cb99-35" tabindex="-1"></a></span>
<span id="cb99-36"><a href="figure-4.html#cb99-36" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> survminer<span class="sc">::</span><span class="fu">ggsurvplot</span>(fit_cluster, <span class="at">data =</span> clinical_survival, </span>
<span id="cb99-37"><a href="figure-4.html#cb99-37" tabindex="-1"></a>                            <span class="at">title=</span><span class="st">&quot;EFS&quot;</span>,</span>
<span id="cb99-38"><a href="figure-4.html#cb99-38" tabindex="-1"></a>                <span class="at">palette=</span><span class="fu">c</span>(<span class="st">&quot;#9BD53F&quot;</span>,<span class="st">&quot;#A6CEE3&quot;</span>,<span class="st">&quot;#EA644C&quot;</span>),</span>
<span id="cb99-39"><a href="figure-4.html#cb99-39" tabindex="-1"></a>                            <span class="at">tables.theme =</span> <span class="fu">theme_void</span>(),<span class="at">risk.table =</span> <span class="cn">TRUE</span>,</span>
<span id="cb99-40"><a href="figure-4.html#cb99-40" tabindex="-1"></a>                            <span class="at">risk.table.fontsize=</span><span class="dv">6</span>,</span>
<span id="cb99-41"><a href="figure-4.html#cb99-41" tabindex="-1"></a>                            <span class="at">break.time.by =</span> <span class="dv">12</span>,</span>
<span id="cb99-42"><a href="figure-4.html#cb99-42" tabindex="-1"></a>                            <span class="at">risk.table.y.text =</span> <span class="cn">FALSE</span>, <span class="at">tables.height =</span> <span class="fl">0.15</span>,<span class="at">risk.table.col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb99-43"><a href="figure-4.html#cb99-43" tabindex="-1"></a>                            <span class="at">pval =</span> <span class="cn">TRUE</span>,<span class="at">pval.method =</span> F,<span class="at">pval.coord=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.1</span>),<span class="at">pval.size=</span><span class="dv">6</span>,</span>
<span id="cb99-44"><a href="figure-4.html#cb99-44" tabindex="-1"></a>                            <span class="at">font.tickslab=</span><span class="fu">c</span>(<span class="dv">14</span>,<span class="st">&quot;plain&quot;</span>,<span class="st">&quot;black&quot;</span>),</span>
<span id="cb99-45"><a href="figure-4.html#cb99-45" tabindex="-1"></a>                            <span class="at">xlab=</span><span class="st">&quot;Time (Months) &quot;</span>,<span class="at">ylab=</span><span class="st">&quot;EFS Survival&quot;</span>)</span>
<span id="cb99-46"><a href="figure-4.html#cb99-46" tabindex="-1"></a></span>
<span id="cb99-47"><a href="figure-4.html#cb99-47" tabindex="-1"></a><span class="fu">pdf</span>(<span class="fu">paste0</span>(<span class="st">&quot;result/Figure4/S6F_EFS_T.pdf&quot;</span>),<span class="at">onefile=</span><span class="cn">FALSE</span>)</span>
<span id="cb99-48"><a href="figure-4.html#cb99-48" tabindex="-1"></a>p1</span>
<span id="cb99-49"><a href="figure-4.html#cb99-49" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p><img src="Figure-1025/Figure4/S6E-F.png" width="746" style="display: block; margin: auto;" /></p>
</div>
<div id="s6-h-multivariate-cox-analysis-of-tc12" class="section level2 hasAnchor" number="19.15">
<h2><span class="header-section-number">19.15</span> (S6 H) Multivariate Cox Analysis of TC1/2<a href="figure-4.html#s6-h-multivariate-cox-analysis-of-tc12" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <strong>multivariate cox analysis</strong> suggests that TC1 may represent an unfavorable group independent of HSCT status. The WBC is stratified by 100*109/L, genetic risk has been evaluated according to the NCCN guideline (Version 2.2023) that is RAS signaling, PTEN and NOTCH1/FBXW7. RAS/PTEN mutation and/or NOTCH1/FBXW7 wildtype are considered as high risk, otherwise low.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="figure-4.html#cb100-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb100-2"><a href="figure-4.html#cb100-2" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb100-3"><a href="figure-4.html#cb100-3" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb100-4"><a href="figure-4.html#cb100-4" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb100-5"><a href="figure-4.html#cb100-5" tabindex="-1"></a></span>
<span id="cb100-6"><a href="figure-4.html#cb100-6" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb100-7"><a href="figure-4.html#cb100-7" tabindex="-1"></a><span class="co">#  Step 1: Load data and set parameters</span></span>
<span id="cb100-8"><a href="figure-4.html#cb100-8" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb100-9"><a href="figure-4.html#cb100-9" tabindex="-1"></a>M_label <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4F_cluster_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-10"><a href="figure-4.html#cb100-10" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb100-11"><a href="figure-4.html#cb100-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Clusters=</span><span class="fu">as.factor</span>(Clusters)) <span class="sc">%&gt;%</span></span>
<span id="cb100-12"><a href="figure-4.html#cb100-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Clusters,Pid)</span>
<span id="cb100-13"><a href="figure-4.html#cb100-13" tabindex="-1"></a></span>
<span id="cb100-14"><a href="figure-4.html#cb100-14" tabindex="-1"></a></span>
<span id="cb100-15"><a href="figure-4.html#cb100-15" tabindex="-1"></a>ras <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/RAS.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-16"><a href="figure-4.html#cb100-16" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb100-17"><a href="figure-4.html#cb100-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name=</span>stringr<span class="sc">::</span><span class="fu">str_to_upper</span>(name))</span>
<span id="cb100-18"><a href="figure-4.html#cb100-18" tabindex="-1"></a></span>
<span id="cb100-19"><a href="figure-4.html#cb100-19" tabindex="-1"></a>mut <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/Sample_RNA_190_fusion_mutation_v1130.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-20"><a href="figure-4.html#cb100-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(mutation,RNA_id,bianhao) <span class="sc">%&gt;%</span></span>
<span id="cb100-21"><a href="figure-4.html#cb100-21" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate_rows</span>(mutation,<span class="at">sep=</span><span class="st">&quot;;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-22"><a href="figure-4.html#cb100-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mutation=</span>stringr<span class="sc">::</span><span class="fu">str_to_upper</span>(mutation)) <span class="sc">%&gt;%</span></span>
<span id="cb100-23"><a href="figure-4.html#cb100-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ras=</span><span class="fu">ifelse</span>(mutation <span class="sc">%in%</span> ras<span class="sc">$</span>name,<span class="st">&quot;yes&quot;</span>,<span class="st">&quot;no&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb100-24"><a href="figure-4.html#cb100-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(RNA_id,bianhao) <span class="sc">%&gt;%</span></span>
<span id="cb100-25"><a href="figure-4.html#cb100-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">Ras1=</span><span class="fu">paste</span>(ras,<span class="at">collapse =</span> <span class="st">&quot;;&quot;</span>),<span class="at">mutation1=</span><span class="fu">paste</span>(mutation,<span class="at">collapse =</span> <span class="st">&quot;;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb100-26"><a href="figure-4.html#cb100-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ras_new=</span><span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;yes&quot;</span>,Ras1),<span class="st">&quot;yes&quot;</span>,<span class="st">&quot;no&quot;</span>))</span>
<span id="cb100-27"><a href="figure-4.html#cb100-27" tabindex="-1"></a></span>
<span id="cb100-28"><a href="figure-4.html#cb100-28" tabindex="-1"></a>genetic <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">&quot;raw_data/Sample_RNA_190_fusion_mutation_v1130.xlsx&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-29"><a href="figure-4.html#cb100-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(bianhao,fusion,mutation) <span class="sc">%&gt;%</span> </span>
<span id="cb100-30"><a href="figure-4.html#cb100-30" tabindex="-1"></a>  <span class="fu">inner_join</span>(mut,<span class="at">by=</span><span class="st">&quot;bianhao&quot;</span>)</span>
<span id="cb100-31"><a href="figure-4.html#cb100-31" tabindex="-1"></a></span>
<span id="cb100-32"><a href="figure-4.html#cb100-32" tabindex="-1"></a><span class="fu">names</span>(genetic)</span>
<span id="cb100-33"><a href="figure-4.html#cb100-33" tabindex="-1"></a></span>
<span id="cb100-34"><a href="figure-4.html#cb100-34" tabindex="-1"></a>T_gene <span class="ot">&lt;-</span> genetic <span class="sc">%&gt;%</span> </span>
<span id="cb100-35"><a href="figure-4.html#cb100-35" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(mutation,bianhao,ras_new) <span class="sc">%&gt;%</span> </span>
<span id="cb100-36"><a href="figure-4.html#cb100-36" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">RAS_PTEN=</span><span class="fu">ifelse</span>(ras_new<span class="sc">==</span><span class="st">&quot;yes&quot;</span>,<span class="st">&quot;MUT&quot;</span>,</span>
<span id="cb100-37"><a href="figure-4.html#cb100-37" tabindex="-1"></a>                         <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;PTEN&quot;</span>,mutation),<span class="st">&quot;MUT&quot;</span>,<span class="st">&quot;WT&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb100-38"><a href="figure-4.html#cb100-38" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">NOTCH1_FBXW7=</span><span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;NOTCH1&quot;</span>,mutation),<span class="st">&quot;MUT&quot;</span>,</span>
<span id="cb100-39"><a href="figure-4.html#cb100-39" tabindex="-1"></a>                             <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;FBXW7&quot;</span>,mutation),<span class="st">&quot;MUT&quot;</span>, <span class="st">&quot;WT&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb100-40"><a href="figure-4.html#cb100-40" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">risk=</span><span class="fu">ifelse</span>(RAS_PTEN<span class="sc">==</span><span class="st">&quot;WT&quot;</span><span class="sc">&amp;</span> NOTCH1_FBXW7<span class="sc">==</span><span class="st">&quot;MUT&quot;</span>,<span class="st">&quot;Low&quot;</span>,<span class="st">&quot;High&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb100-41"><a href="figure-4.html#cb100-41" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(bianhao,risk) <span class="sc">%&gt;%</span></span>
<span id="cb100-42"><a href="figure-4.html#cb100-42" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Pid=</span><span class="fu">gsub</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;RJ-&quot;</span>,bianhao))</span>
<span id="cb100-43"><a href="figure-4.html#cb100-43" tabindex="-1"></a></span>
<span id="cb100-44"><a href="figure-4.html#cb100-44" tabindex="-1"></a>clinical_survival <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-45"><a href="figure-4.html#cb100-45" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb100-46"><a href="figure-4.html#cb100-46" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;Sex&quot;</span><span class="ot">=</span><span class="st">&quot;Gender&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-47"><a href="figure-4.html#cb100-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Pid,RNA_id_raw,Age,Sex,WBC,d28CR,ifHSCT,OS,OS_stat,EFS,EFS_stat,RFS,RFS_stat) <span class="sc">%&gt;%</span></span>
<span id="cb100-48"><a href="figure-4.html#cb100-48" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">d28CR=</span><span class="fu">ifelse</span>(d28CR <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;early death&quot;</span>,<span class="st">&quot;NR&quot;</span>,<span class="st">&quot;PR&quot;</span>),<span class="st">&quot;non_CR&quot;</span>,d28CR)) <span class="sc">%&gt;%</span></span>
<span id="cb100-49"><a href="figure-4.html#cb100-49" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;D28_status&quot;</span><span class="ot">=</span><span class="st">&quot;d28CR&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-50"><a href="figure-4.html#cb100-50" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(M_label,<span class="at">by=</span><span class="st">&quot;Pid&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-51"><a href="figure-4.html#cb100-51" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">WBC_type=</span> <span class="fu">ifelse</span>(WBC <span class="sc">&gt;</span> <span class="dv">100</span>, <span class="st">&quot;High&quot;</span>,</span>
<span id="cb100-52"><a href="figure-4.html#cb100-52" tabindex="-1"></a>                          <span class="fu">ifelse</span>(WBC <span class="sc">&lt;=</span> <span class="dv">100</span>,<span class="st">&quot;Low&quot;</span>,WBC))) <span class="sc">%&gt;%</span></span>
<span id="cb100-53"><a href="figure-4.html#cb100-53" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ifHSCT=</span><span class="fu">as.factor</span>(ifHSCT)) <span class="sc">%&gt;%</span></span>
<span id="cb100-54"><a href="figure-4.html#cb100-54" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Age=</span><span class="fu">ifelse</span>(Age<span class="sc">&gt;</span><span class="dv">40</span>,<span class="st">&quot;old&quot;</span>,<span class="st">&quot;young&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb100-55"><a href="figure-4.html#cb100-55" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Age=</span><span class="fu">factor</span>(Age,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;young&quot;</span>,<span class="st">&quot;old&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb100-56"><a href="figure-4.html#cb100-56" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Clusters=</span><span class="fu">factor</span>(Clusters)) <span class="sc">%&gt;%</span></span>
<span id="cb100-57"><a href="figure-4.html#cb100-57" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb100-58"><a href="figure-4.html#cb100-58" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(T_gene,<span class="at">by=</span><span class="st">&quot;Pid&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-59"><a href="figure-4.html#cb100-59" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Clusters=</span><span class="fu">factor</span>(Clusters,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;TC2&quot;</span>,<span class="st">&quot;TC1&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb100-60"><a href="figure-4.html#cb100-60" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">WBC_type=</span><span class="fu">factor</span>(WBC_type,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;Low&quot;</span>,<span class="st">&quot;High&quot;</span>)))</span>
<span id="cb100-61"><a href="figure-4.html#cb100-61" tabindex="-1"></a>  </span>
<span id="cb100-62"><a href="figure-4.html#cb100-62" tabindex="-1"></a>var.names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Clusters&quot;</span>,<span class="st">&quot;WBC_type&quot;</span>,<span class="st">&quot;risk&quot;</span>,<span class="st">&quot;D28_status&quot;</span>,<span class="st">&quot;ifHSCT&quot;</span>)</span>
<span id="cb100-63"><a href="figure-4.html#cb100-63" tabindex="-1"></a></span>
<span id="cb100-64"><a href="figure-4.html#cb100-64" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb100-65"><a href="figure-4.html#cb100-65" tabindex="-1"></a><span class="co">#  Step 2: EFS of T-ALL</span></span>
<span id="cb100-66"><a href="figure-4.html#cb100-66" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb100-67"><a href="figure-4.html#cb100-67" tabindex="-1"></a>f_efs <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">&#39;Surv(EFS, EFS_stat)~&#39;</span>,<span class="fu">paste</span>(var.names,<span class="at">collapse =</span> <span class="st">&quot;+&quot;</span>)))</span>
<span id="cb100-68"><a href="figure-4.html#cb100-68" tabindex="-1"></a>fit.final <span class="ot">&lt;-</span> <span class="fu">coxph</span>(f_efs,<span class="at">data=</span>clinical_survival)</span>
<span id="cb100-69"><a href="figure-4.html#cb100-69" tabindex="-1"></a>p_efs <span class="ot">&lt;-</span> <span class="fu">ggforest</span>(fit.final,<span class="at">main=</span><span class="st">&quot;EFS Hzard Ratio&quot;</span>,<span class="at">cpositions=</span><span class="fu">c</span>(<span class="fl">0.02</span>,<span class="fl">0.22</span>,<span class="fl">0.4</span>),<span class="at">fontsize=</span><span class="fl">0.8</span>,</span>
<span id="cb100-70"><a href="figure-4.html#cb100-70" tabindex="-1"></a>                  <span class="at">refLabel=</span><span class="st">&quot;reference&quot;</span>,<span class="at">noDigits=</span><span class="dv">2</span>,<span class="at">data=</span>clinical_survival)</span>
<span id="cb100-71"><a href="figure-4.html#cb100-71" tabindex="-1"></a></span>
<span id="cb100-72"><a href="figure-4.html#cb100-72" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb100-73"><a href="figure-4.html#cb100-73" tabindex="-1"></a><span class="co">#  Step 3: OS of T-ALL</span></span>
<span id="cb100-74"><a href="figure-4.html#cb100-74" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb100-75"><a href="figure-4.html#cb100-75" tabindex="-1"></a>f_os <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">&#39;Surv(OS, OS_stat)~&#39;</span>,<span class="fu">paste</span>(var.names,<span class="at">collapse =</span> <span class="st">&quot;+&quot;</span>)))</span>
<span id="cb100-76"><a href="figure-4.html#cb100-76" tabindex="-1"></a>fit.os <span class="ot">&lt;-</span> <span class="fu">coxph</span>(f_os,<span class="at">data=</span>clinical_survival)</span>
<span id="cb100-77"><a href="figure-4.html#cb100-77" tabindex="-1"></a>p_os <span class="ot">&lt;-</span> <span class="fu">ggforest</span>(fit.os,<span class="at">main=</span><span class="st">&quot;OS Hzard Ratio&quot;</span>,<span class="at">cpositions=</span><span class="fu">c</span>(<span class="fl">0.02</span>,<span class="fl">0.22</span>,<span class="fl">0.4</span>),<span class="at">fontsize=</span><span class="fl">0.8</span>,</span>
<span id="cb100-78"><a href="figure-4.html#cb100-78" tabindex="-1"></a>                 <span class="at">refLabel=</span><span class="st">&quot;reference&quot;</span>,<span class="at">noDigits=</span><span class="dv">2</span>,<span class="at">data=</span>clinical_survival)</span>
<span id="cb100-79"><a href="figure-4.html#cb100-79" tabindex="-1"></a><span class="fu">ggsave</span>(p_efs,<span class="at">filename =</span> <span class="st">&quot;result/Figure4/S6H_HR_EFS_T.pdf&quot;</span>,<span class="at">width=</span><span class="dv">8</span>,<span class="at">height=</span><span class="dv">4</span>)</span>
<span id="cb100-80"><a href="figure-4.html#cb100-80" tabindex="-1"></a><span class="fu">ggsave</span>(p_os,<span class="at">filename =</span> <span class="st">&quot;result/Figure4/S6H_HR_OS_T.pdf&quot;</span>,<span class="at">width=</span><span class="dv">8</span>,<span class="at">height=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure4/S6H.png" width="530" style="display: block; margin: auto;" /></p>
</div>
<div id="s6-i-heatmap-of-tc12" class="section level2 hasAnchor" number="19.16">
<h2><span class="header-section-number">19.16</span> (S6 I) Heatmap of TC1/2<a href="figure-4.html#s6-i-heatmap-of-tc12" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <strong>associations of metabolic clusters with clinical variables and genetic alterations</strong>, including major mutations and fusions in <strong>T-ALL</strong>.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="figure-4.html#cb101-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb101-2"><a href="figure-4.html#cb101-2" tabindex="-1"></a><span class="fu">library</span>(ComplexHeatmap)</span>
<span id="cb101-3"><a href="figure-4.html#cb101-3" tabindex="-1"></a></span>
<span id="cb101-4"><a href="figure-4.html#cb101-4" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb101-5"><a href="figure-4.html#cb101-5" tabindex="-1"></a><span class="co">#  Step 1: Load data and set parameters</span></span>
<span id="cb101-6"><a href="figure-4.html#cb101-6" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb101-7"><a href="figure-4.html#cb101-7" tabindex="-1"></a>dd <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/clinical_all_v231116.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-8"><a href="figure-4.html#cb101-8" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-9"><a href="figure-4.html#cb101-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;Sex&quot;</span><span class="ot">=</span><span class="st">&quot;Gender&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-10"><a href="figure-4.html#cb101-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(group<span class="sc">==</span><span class="st">&quot;A&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-11"><a href="figure-4.html#cb101-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(bianhao,Sex,Age,WBC,d28CR) <span class="sc">%&gt;%</span></span>
<span id="cb101-12"><a href="figure-4.html#cb101-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Age=</span><span class="fu">ifelse</span>(Age <span class="sc">&lt;</span> <span class="dv">40</span>,<span class="st">&quot;&lt; 40&quot;</span>,<span class="st">&quot;&gt;= 40&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-13"><a href="figure-4.html#cb101-13" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-14"><a href="figure-4.html#cb101-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">d28CR=</span><span class="fu">ifelse</span>(d28CR <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;early death&quot;</span>,<span class="st">&quot;NR&quot;</span>,<span class="st">&quot;PR&quot;</span>),<span class="st">&quot;non_CR&quot;</span>,d28CR)) <span class="sc">%&gt;%</span></span>
<span id="cb101-15"><a href="figure-4.html#cb101-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;D28_status&quot;</span><span class="ot">=</span><span class="st">&quot;d28CR&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-16"><a href="figure-4.html#cb101-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">WBC_type=</span> <span class="fu">ifelse</span>(WBC <span class="sc">&gt;</span> <span class="dv">100</span>, <span class="st">&quot;&gt; 100&quot;</span>,</span>
<span id="cb101-17"><a href="figure-4.html#cb101-17" tabindex="-1"></a>                                 <span class="fu">ifelse</span>(WBC <span class="sc">&lt;=</span> <span class="dv">100</span>,<span class="st">&quot;&lt;= 100&quot;</span>,<span class="cn">NA</span>)))</span>
<span id="cb101-18"><a href="figure-4.html#cb101-18" tabindex="-1"></a></span>
<span id="cb101-19"><a href="figure-4.html#cb101-19" tabindex="-1"></a>clinical_survival <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">&quot;raw_data/08 队列病人生存资料-240313.xlsx&quot;</span>,<span class="at">sheet=</span><span class="st">&quot;A&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-20"><a href="figure-4.html#cb101-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;bianhao&quot;</span>,<span class="st">&quot;OS_stat&quot;</span>,<span class="st">&quot;ifHSCT&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-21"><a href="figure-4.html#cb101-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Outcome=</span><span class="fu">ifelse</span>(OS_stat<span class="sc">==</span><span class="dv">1</span>,<span class="st">&quot;Dead&quot;</span>,</span>
<span id="cb101-22"><a href="figure-4.html#cb101-22" tabindex="-1"></a>                               <span class="fu">ifelse</span>(OS_stat<span class="sc">==</span><span class="dv">0</span>,<span class="st">&quot;Alive&quot;</span>,OS_stat))) <span class="sc">%&gt;%</span></span>
<span id="cb101-23"><a href="figure-4.html#cb101-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(dd,<span class="at">by=</span><span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-24"><a href="figure-4.html#cb101-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ifHSCT=</span><span class="fu">ifelse</span>(ifHSCT<span class="sc">==</span><span class="dv">0</span>,<span class="st">&quot;no&quot;</span>,</span>
<span id="cb101-25"><a href="figure-4.html#cb101-25" tabindex="-1"></a>                              <span class="fu">ifelse</span>(ifHSCT<span class="sc">==</span><span class="dv">1</span>,<span class="st">&quot;yes&quot;</span>,ifHSCT))) <span class="sc">%&gt;%</span></span>
<span id="cb101-26"><a href="figure-4.html#cb101-26" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb101-27"><a href="figure-4.html#cb101-27" tabindex="-1"></a></span>
<span id="cb101-28"><a href="figure-4.html#cb101-28" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4F_cluster_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-29"><a href="figure-4.html#cb101-29" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-30"><a href="figure-4.html#cb101-30" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">bianhao=</span><span class="fu">gsub</span>(<span class="st">&quot;RJ-&quot;</span>,<span class="st">&quot;A&quot;</span>,Pid)) <span class="sc">%&gt;%</span></span>
<span id="cb101-31"><a href="figure-4.html#cb101-31" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(clinical_survival,<span class="at">by=</span><span class="st">&quot;bianhao&quot;</span>)</span>
<span id="cb101-32"><a href="figure-4.html#cb101-32" tabindex="-1"></a></span>
<span id="cb101-33"><a href="figure-4.html#cb101-33" tabindex="-1"></a>q12 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#1F78B4&quot;</span>,<span class="st">&quot;#E31A1C&quot;</span>,<span class="st">&quot;black&quot;</span>)</span>
<span id="cb101-34"><a href="figure-4.html#cb101-34" tabindex="-1"></a><span class="fu">names</span>(q12) <span class="ot">&lt;-</span> <span class="fu">unique</span>(sample_info<span class="sc">$</span>Clusters)</span>
<span id="cb101-35"><a href="figure-4.html#cb101-35" tabindex="-1"></a></span>
<span id="cb101-36"><a href="figure-4.html#cb101-36" tabindex="-1"></a>top_annotation <span class="ot">=</span> <span class="fu">HeatmapAnnotation</span>(</span>
<span id="cb101-37"><a href="figure-4.html#cb101-37" tabindex="-1"></a>  <span class="at">Subtype=</span>sample_info<span class="sc">$</span>Clusters,</span>
<span id="cb101-38"><a href="figure-4.html#cb101-38" tabindex="-1"></a>  <span class="at">Lineage=</span>sample_info<span class="sc">$</span>Subtype,</span>
<span id="cb101-39"><a href="figure-4.html#cb101-39" tabindex="-1"></a>  <span class="at">ifHSCT=</span>sample_info<span class="sc">$</span>ifHSCT.y,</span>
<span id="cb101-40"><a href="figure-4.html#cb101-40" tabindex="-1"></a>  <span class="at">WBC=</span>sample_info<span class="sc">$</span>WBC_type,</span>
<span id="cb101-41"><a href="figure-4.html#cb101-41" tabindex="-1"></a>  <span class="at">Outcome=</span>sample_info<span class="sc">$</span>Outcome,</span>
<span id="cb101-42"><a href="figure-4.html#cb101-42" tabindex="-1"></a>  <span class="at">col=</span><span class="fu">list</span>(<span class="at">Subtype=</span><span class="fu">c</span>(<span class="st">&quot;TC1&quot;</span><span class="ot">=</span><span class="st">&quot;#9BD53F&quot;</span>,<span class="st">&quot;TC2&quot;</span><span class="ot">=</span><span class="st">&quot;#A6CEE3&quot;</span>),</span>
<span id="cb101-43"><a href="figure-4.html#cb101-43" tabindex="-1"></a>           <span class="at">Lineage=</span><span class="fu">c</span>(<span class="st">&quot;ETP&quot;</span><span class="ot">=</span><span class="st">&quot;#F9EE35&quot;</span>,<span class="st">&quot;non_ETP&quot;</span><span class="ot">=</span><span class="st">&quot;#E7317C&quot;</span>),</span>
<span id="cb101-44"><a href="figure-4.html#cb101-44" tabindex="-1"></a>           <span class="at">ifHSCT=</span><span class="fu">c</span>(<span class="st">&quot;yes&quot;</span><span class="ot">=</span><span class="st">&quot;#CAB2D6&quot;</span>,<span class="st">&quot;no&quot;</span><span class="ot">=</span><span class="st">&quot;gray&quot;</span>),</span>
<span id="cb101-45"><a href="figure-4.html#cb101-45" tabindex="-1"></a>           <span class="at">WBC=</span><span class="fu">c</span>(<span class="st">&quot;&gt; 100&quot;</span><span class="ot">=</span><span class="st">&quot;#FDBF6F&quot;</span>,<span class="st">&quot;&lt;= 100&quot;</span><span class="ot">=</span><span class="st">&quot;gray&quot;</span>),</span>
<span id="cb101-46"><a href="figure-4.html#cb101-46" tabindex="-1"></a>           <span class="at">Outcome=</span><span class="fu">c</span>(<span class="st">&quot;Dead&quot;</span><span class="ot">=</span><span class="st">&quot;black&quot;</span>,<span class="st">&quot;Alive&quot;</span><span class="ot">=</span><span class="st">&quot;gray&quot;</span>)</span>
<span id="cb101-47"><a href="figure-4.html#cb101-47" tabindex="-1"></a>  ),</span>
<span id="cb101-48"><a href="figure-4.html#cb101-48" tabindex="-1"></a>  <span class="at">show_annotation_name =</span> <span class="fu">c</span>(T,T), </span>
<span id="cb101-49"><a href="figure-4.html#cb101-49" tabindex="-1"></a>  <span class="at">border =</span> <span class="fu">c</span>(T,T,T,T,T,T) ,</span>
<span id="cb101-50"><a href="figure-4.html#cb101-50" tabindex="-1"></a>  <span class="at">simple_anno_size =</span> <span class="fu">unit</span>(<span class="dv">8</span>, <span class="st">&quot;mm&quot;</span>),<span class="at">gap =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">&quot;mm&quot;</span>)</span>
<span id="cb101-51"><a href="figure-4.html#cb101-51" tabindex="-1"></a>)</span>
<span id="cb101-52"><a href="figure-4.html#cb101-52" tabindex="-1"></a></span>
<span id="cb101-53"><a href="figure-4.html#cb101-53" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb101-54"><a href="figure-4.html#cb101-54" tabindex="-1"></a><span class="co">#  Step 2: Mutations of T-ALL</span></span>
<span id="cb101-55"><a href="figure-4.html#cb101-55" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb101-56"><a href="figure-4.html#cb101-56" tabindex="-1"></a>mutation_T <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/mutation_T_v1114_all.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-57"><a href="figure-4.html#cb101-57" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-58"><a href="figure-4.html#cb101-58" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(V2,V17,V19) <span class="sc">%&gt;%</span></span>
<span id="cb101-59"><a href="figure-4.html#cb101-59" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;ID&quot;</span><span class="ot">=</span><span class="st">&quot;V2&quot;</span>,<span class="st">&quot;Gene.refGene&quot;</span><span class="ot">=</span><span class="st">&quot;V17&quot;</span>,<span class="st">&quot;ExonicFunc.refGene&quot;</span><span class="ot">=</span><span class="st">&quot;V19&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-60"><a href="figure-4.html#cb101-60" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID,<span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span>,<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-61"><a href="figure-4.html#cb101-61" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span><span class="ot">=</span></span>
<span id="cb101-62"><a href="figure-4.html#cb101-62" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;frameshift deletion&quot;</span>,<span class="st">&quot;frameshift insertion&quot;</span>,<span class="st">&quot;frameshift substitution&quot;</span>),<span class="st">&quot;Frameshift&quot;</span>,</span>
<span id="cb101-63"><a href="figure-4.html#cb101-63" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;nonframeshift deletion&quot;</span>,<span class="st">&quot;nonframeshift insertion&quot;</span>,<span class="st">&quot;nonframeshift substitution&quot;</span>),<span class="st">&quot;Nonframeshift&quot;</span>,</span>
<span id="cb101-64"><a href="figure-4.html#cb101-64" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span> <span class="sc">%in%</span> <span class="st">&quot;.&quot;</span>,<span class="st">&quot;Splice&quot;</span>,</span>
<span id="cb101-65"><a href="figure-4.html#cb101-65" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span> <span class="sc">%in%</span> <span class="st">&quot;nonsynonymous SNV&quot;</span>,<span class="st">&quot;Missense&quot;</span>,</span>
<span id="cb101-66"><a href="figure-4.html#cb101-66" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span><span class="sc">==</span><span class="st">&quot;startloss&quot;</span>,<span class="st">&quot;Startloss&quot;</span>,</span>
<span id="cb101-67"><a href="figure-4.html#cb101-67" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span><span class="sc">==</span><span class="st">&quot;stopgain&quot;</span>,<span class="st">&quot;Stopgain&quot;</span>,</span>
<span id="cb101-68"><a href="figure-4.html#cb101-68" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span><span class="sc">==</span><span class="st">&quot;synonymous SNV&quot;</span>,<span class="st">&quot;Silent&quot;</span>,<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span>)))))))) <span class="sc">%&gt;%</span></span>
<span id="cb101-69"><a href="figure-4.html#cb101-69" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-70"><a href="figure-4.html#cb101-70" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(ID <span class="sc">%in%</span> sample_info<span class="sc">$</span>RNA_id_raw) <span class="sc">%&gt;%</span></span>
<span id="cb101-71"><a href="figure-4.html#cb101-71" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;IDH1&quot;</span>,<span class="st">&quot;IDH2&quot;</span>),<span class="st">&quot;IDH1/2&quot;</span>,<span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span>))</span>
<span id="cb101-72"><a href="figure-4.html#cb101-72" tabindex="-1"></a></span>
<span id="cb101-73"><a href="figure-4.html#cb101-73" tabindex="-1"></a>mutation <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mutation_T)</span>
<span id="cb101-74"><a href="figure-4.html#cb101-74" tabindex="-1"></a></span>
<span id="cb101-75"><a href="figure-4.html#cb101-75" tabindex="-1"></a>hit_num <span class="ot">&lt;-</span> mutation <span class="sc">%&gt;%</span></span>
<span id="cb101-76"><a href="figure-4.html#cb101-76" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(ID,<span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-77"><a href="figure-4.html#cb101-77" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb101-78"><a href="figure-4.html#cb101-78" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(n<span class="sc">&gt;</span><span class="dv">1</span>)</span>
<span id="cb101-79"><a href="figure-4.html#cb101-79" tabindex="-1"></a></span>
<span id="cb101-80"><a href="figure-4.html#cb101-80" tabindex="-1"></a>mutation <span class="ot">&lt;-</span> mutation <span class="sc">%&gt;%</span> </span>
<span id="cb101-81"><a href="figure-4.html#cb101-81" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(hit_num,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>,<span class="st">&quot;Gene.refGene&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-82"><a href="figure-4.html#cb101-82" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span><span class="ot">=</span><span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(n),<span class="st">&quot;Multiple&quot;</span>,<span class="st">`</span><span class="at">ExonicFunc.refGene</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-83"><a href="figure-4.html#cb101-83" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb101-84"><a href="figure-4.html#cb101-84" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-85"><a href="figure-4.html#cb101-85" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;RNA_id&quot;</span><span class="ot">=</span><span class="st">&quot;ID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-86"><a href="figure-4.html#cb101-86" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(RNA_id <span class="sc">%in%</span> sample_info<span class="sc">$</span>RNA_id_raw)</span>
<span id="cb101-87"><a href="figure-4.html#cb101-87" tabindex="-1"></a></span>
<span id="cb101-88"><a href="figure-4.html#cb101-88" tabindex="-1"></a>mutation_gene_filter <span class="ot">&lt;-</span> mutation <span class="sc">%&gt;%</span></span>
<span id="cb101-89"><a href="figure-4.html#cb101-89" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(RNA_id,Gene.refGene) <span class="sc">%&gt;%</span></span>
<span id="cb101-90"><a href="figure-4.html#cb101-90" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-91"><a href="figure-4.html#cb101-91" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(<span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-92"><a href="figure-4.html#cb101-92" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb101-93"><a href="figure-4.html#cb101-93" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(n<span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb101-94"><a href="figure-4.html#cb101-94" tabindex="-1"></a>mutation_sort <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">table</span>(mutation <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span> <span class="sc">%in%</span> mutation_gene_filter<span class="sc">$</span>Gene.refGene) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Gene.refGene)))))</span>
<span id="cb101-95"><a href="figure-4.html#cb101-95" tabindex="-1"></a></span>
<span id="cb101-96"><a href="figure-4.html#cb101-96" tabindex="-1"></a>mutation <span class="ot">&lt;-</span> mutation <span class="sc">%&gt;%</span></span>
<span id="cb101-97"><a href="figure-4.html#cb101-97" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span> <span class="sc">%in%</span> mutation_gene_filter<span class="sc">$</span>Gene.refGene) <span class="sc">%&gt;%</span></span>
<span id="cb101-98"><a href="figure-4.html#cb101-98" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-99"><a href="figure-4.html#cb101-99" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(RNA_id,Gene.refGene,<span class="at">.keep_all =</span> T)</span>
<span id="cb101-100"><a href="figure-4.html#cb101-100" tabindex="-1"></a></span>
<span id="cb101-101"><a href="figure-4.html#cb101-101" tabindex="-1"></a>sample_info_filter <span class="ot">&lt;-</span> sample_info <span class="sc">%&gt;%</span></span>
<span id="cb101-102"><a href="figure-4.html#cb101-102" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(bianhao,RNA_id_raw)</span>
<span id="cb101-103"><a href="figure-4.html#cb101-103" tabindex="-1"></a></span>
<span id="cb101-104"><a href="figure-4.html#cb101-104" tabindex="-1"></a>mutation_dcast <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">dcast</span>(mutation,RNA_id <span class="sc">~</span> <span class="st">`</span><span class="at">Gene.refGene</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-105"><a href="figure-4.html#cb101-105" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">right_join</span>(sample_info_filter,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;RNA_id&quot;</span><span class="ot">=</span><span class="st">&quot;RNA_id_raw&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-106"><a href="figure-4.html#cb101-106" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>RNA_id) <span class="sc">%&gt;%</span></span>
<span id="cb101-107"><a href="figure-4.html#cb101-107" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-108"><a href="figure-4.html#cb101-108" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(mutation_sort))</span>
<span id="cb101-109"><a href="figure-4.html#cb101-109" tabindex="-1"></a></span>
<span id="cb101-110"><a href="figure-4.html#cb101-110" tabindex="-1"></a>mutation_dcast[<span class="fu">is.na</span>(mutation_dcast)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb101-111"><a href="figure-4.html#cb101-111" tabindex="-1"></a>mutation_dcast[mutation_dcast<span class="sc">==</span><span class="st">&quot;Missense&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb101-112"><a href="figure-4.html#cb101-112" tabindex="-1"></a>mutation_dcast[mutation_dcast<span class="sc">==</span><span class="st">&quot;Frameshift&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb101-113"><a href="figure-4.html#cb101-113" tabindex="-1"></a>mutation_dcast[mutation_dcast<span class="sc">==</span><span class="st">&quot;Nonframeshift&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb101-114"><a href="figure-4.html#cb101-114" tabindex="-1"></a>mutation_dcast[mutation_dcast<span class="sc">==</span><span class="st">&quot;Silent&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb101-115"><a href="figure-4.html#cb101-115" tabindex="-1"></a>mutation_dcast[mutation_dcast<span class="sc">==</span><span class="st">&quot;Splice&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb101-116"><a href="figure-4.html#cb101-116" tabindex="-1"></a>mutation_dcast[mutation_dcast<span class="sc">==</span><span class="st">&quot;Stopgain&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb101-117"><a href="figure-4.html#cb101-117" tabindex="-1"></a>mutation_dcast[mutation_dcast<span class="sc">==</span><span class="st">&quot;Multiple&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb101-118"><a href="figure-4.html#cb101-118" tabindex="-1"></a></span>
<span id="cb101-119"><a href="figure-4.html#cb101-119" tabindex="-1"></a>mutation_dcast1 <span class="ot">&lt;-</span> mutation_dcast <span class="sc">%&gt;%</span></span>
<span id="cb101-120"><a href="figure-4.html#cb101-120" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate_if</span>(is.character,as.numeric) <span class="sc">%&gt;%</span></span>
<span id="cb101-121"><a href="figure-4.html#cb101-121" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-122"><a href="figure-4.html#cb101-122" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">NOTCH=</span><span class="fu">sum</span>(NOTCH1)) <span class="sc">%&gt;%</span></span>
<span id="cb101-123"><a href="figure-4.html#cb101-123" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">PHF=</span><span class="fu">sum</span>(PTEN,PHF6)) <span class="sc">%&gt;%</span></span>
<span id="cb101-124"><a href="figure-4.html#cb101-124" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">RAS=</span><span class="fu">sum</span>(JAK3,JAK1,STAT5A,MTOR,NRAS,KRAS,TCF7,TCF7)) <span class="sc">%&gt;%</span></span>
<span id="cb101-125"><a href="figure-4.html#cb101-125" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Transcript=</span><span class="fu">sum</span>(MED12,RUNX1,ETV6,CNOT3,MED12,GATA3,BCOR)) <span class="sc">%&gt;%</span></span>
<span id="cb101-126"><a href="figure-4.html#cb101-126" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Epigenetic=</span><span class="fu">sum</span>(<span class="st">`</span><span class="at">IDH1/2</span><span class="st">`</span>,DNMT3A,KMT2E,SUZ12,SETD1B,SETD2,NCOR2,</span>
<span id="cb101-127"><a href="figure-4.html#cb101-127" tabindex="-1"></a>                               EP300,KDM6A)) <span class="sc">%&gt;%</span></span>
<span id="cb101-128"><a href="figure-4.html#cb101-128" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Others=</span><span class="fu">sum</span>(CCND3,CTCF,BOD1L1,CCND3,SATB1,OBSCN,DNM2,CIC)) <span class="sc">%&gt;%</span></span>
<span id="cb101-129"><a href="figure-4.html#cb101-129" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">NOTCH=</span><span class="fu">ifelse</span>(NOTCH<span class="sc">==</span><span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-130"><a href="figure-4.html#cb101-130" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">PHF=</span><span class="fu">ifelse</span>(PHF<span class="sc">==</span><span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-131"><a href="figure-4.html#cb101-131" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">RAS=</span><span class="fu">ifelse</span>(RAS<span class="sc">==</span><span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-132"><a href="figure-4.html#cb101-132" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Transcript=</span><span class="fu">ifelse</span>(Transcript<span class="sc">==</span><span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-133"><a href="figure-4.html#cb101-133" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Epigenetic=</span><span class="fu">ifelse</span>(Epigenetic<span class="sc">==</span><span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-134"><a href="figure-4.html#cb101-134" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Others=</span><span class="fu">ifelse</span>(Others<span class="sc">==</span><span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-135"><a href="figure-4.html#cb101-135" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(NOTCH1,NOTCH,</span>
<span id="cb101-136"><a href="figure-4.html#cb101-136" tabindex="-1"></a>                PHF6,PTEN,PHF,</span>
<span id="cb101-137"><a href="figure-4.html#cb101-137" tabindex="-1"></a>                JAK3,JAK1,MTOR,NRAS,KRAS,TCF7,TCF7,STAT5A,RAS,</span>
<span id="cb101-138"><a href="figure-4.html#cb101-138" tabindex="-1"></a>                ETV6,RUNX1,MED12,CNOT3,MED12,GATA3,BCOR,Transcript,</span>
<span id="cb101-139"><a href="figure-4.html#cb101-139" tabindex="-1"></a>                DNMT3A,SUZ12,SETD1B,<span class="st">`</span><span class="at">IDH1/2</span><span class="st">`</span>,KMT2E,NCOR2,EP300,KDM6A,</span>
<span id="cb101-140"><a href="figure-4.html#cb101-140" tabindex="-1"></a>                Epigenetic,</span>
<span id="cb101-141"><a href="figure-4.html#cb101-141" tabindex="-1"></a>                CTCF,CCND3,CCND3,SATB1,OBSCN,DNM2,CIC,BOD1L1,Others) <span class="sc">%&gt;%</span></span>
<span id="cb101-142"><a href="figure-4.html#cb101-142" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb101-143"><a href="figure-4.html#cb101-143" tabindex="-1"></a></span>
<span id="cb101-144"><a href="figure-4.html#cb101-144" tabindex="-1"></a></span>
<span id="cb101-145"><a href="figure-4.html#cb101-145" tabindex="-1"></a><span class="fu">rownames</span>(mutation_dcast1) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(mutation_dcast)</span>
<span id="cb101-146"><a href="figure-4.html#cb101-146" tabindex="-1"></a>mutation_dcast <span class="ot">&lt;-</span> mutation_dcast1</span>
<span id="cb101-147"><a href="figure-4.html#cb101-147" tabindex="-1"></a></span>
<span id="cb101-148"><a href="figure-4.html#cb101-148" tabindex="-1"></a>mutation_dcast_temp <span class="ot">&lt;-</span> mutation_dcast</span>
<span id="cb101-149"><a href="figure-4.html#cb101-149" tabindex="-1"></a>mutation_dcast_temp[mutation_dcast_temp<span class="sc">!=</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb101-150"><a href="figure-4.html#cb101-150" tabindex="-1"></a>num<span class="ot">=</span><span class="fu">colSums</span>(mutation_dcast_temp)</span>
<span id="cb101-151"><a href="figure-4.html#cb101-151" tabindex="-1"></a><span class="fu">names</span>(mutation_dcast) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">names</span>(mutation_dcast),<span class="st">&quot; (n=&quot;</span>,num,<span class="st">&quot;)&quot;</span>)</span>
<span id="cb101-152"><a href="figure-4.html#cb101-152" tabindex="-1"></a></span>
<span id="cb101-153"><a href="figure-4.html#cb101-153" tabindex="-1"></a>d_mutation <span class="ot">&lt;-</span> <span class="fu">t</span>(mutation_dcast) <span class="sc">%&gt;%</span></span>
<span id="cb101-154"><a href="figure-4.html#cb101-154" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-155"><a href="figure-4.html#cb101-155" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample_info<span class="sc">$</span>bianhao)</span>
<span id="cb101-156"><a href="figure-4.html#cb101-156" tabindex="-1"></a></span>
<span id="cb101-157"><a href="figure-4.html#cb101-157" tabindex="-1"></a>mutation_annotation <span class="ot">&lt;-</span> <span class="fu">Heatmap</span>(d_mutation,<span class="at">height=</span><span class="fu">unit</span>(<span class="dv">15</span>,<span class="st">&quot;cm&quot;</span>),<span class="at">rect_gp =</span> <span class="fu">gpar</span>(<span class="at">col =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>),</span>
<span id="cb101-158"><a href="figure-4.html#cb101-158" tabindex="-1"></a>                               <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;#EEEEEE&quot;</span>,<span class="st">&quot;#3987CC&quot;</span>,<span class="st">&quot;#DB3D3D&quot;</span>,<span class="st">&quot;#663FFB&quot;</span>,<span class="st">&quot;#FF7F0E&quot;</span>,<span class="st">&quot;#CC66FF&quot;</span>,<span class="st">&quot;#8B564C&quot;</span>,<span class="st">&quot;#339933&quot;</span>,<span class="st">&quot;blue&quot;</span>),</span>
<span id="cb101-159"><a href="figure-4.html#cb101-159" tabindex="-1"></a>                               <span class="at">cluster_columns =</span> F,<span class="at">cluster_rows =</span> F,<span class="at">border =</span> <span class="cn">TRUE</span>,<span class="at">column_title =</span> <span class="cn">NULL</span>,</span>
<span id="cb101-160"><a href="figure-4.html#cb101-160" tabindex="-1"></a>                               <span class="at">column_split =</span>sample_info<span class="sc">$</span>Clusters,</span>
<span id="cb101-161"><a href="figure-4.html#cb101-161" tabindex="-1"></a>                               <span class="at">show_column_names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb101-162"><a href="figure-4.html#cb101-162" tabindex="-1"></a>                               <span class="at">top_annotation=</span>top_annotation,</span>
<span id="cb101-163"><a href="figure-4.html#cb101-163" tabindex="-1"></a>                               <span class="at">row_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">8</span>),<span class="at">column_names_gp=</span><span class="fu">gpar</span>(<span class="at">fontsize=</span><span class="dv">6</span>))</span>
<span id="cb101-164"><a href="figure-4.html#cb101-164" tabindex="-1"></a></span>
<span id="cb101-165"><a href="figure-4.html#cb101-165" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb101-166"><a href="figure-4.html#cb101-166" tabindex="-1"></a><span class="co">#  Step 3: Fusions of T-ALL</span></span>
<span id="cb101-167"><a href="figure-4.html#cb101-167" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb101-168"><a href="figure-4.html#cb101-168" tabindex="-1"></a>fusion_T <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/fusion_T_v0803.xlsx&quot;</span>,<span class="at">skip=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-169"><a href="figure-4.html#cb101-169" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-170"><a href="figure-4.html#cb101-170" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(RNA_id <span class="sc">%in%</span> sample_info<span class="sc">$</span>RNA_id_raw) <span class="sc">%&gt;%</span></span>
<span id="cb101-171"><a href="figure-4.html#cb101-171" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(RNA_id,final_check) <span class="sc">%&gt;%</span></span>
<span id="cb101-172"><a href="figure-4.html#cb101-172" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(sample_info,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;RNA_id&quot;</span><span class="ot">=</span><span class="st">&quot;RNA_id_raw&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-173"><a href="figure-4.html#cb101-173" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(RNA_id,final_check) <span class="sc">%&gt;%</span></span>
<span id="cb101-174"><a href="figure-4.html#cb101-174" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(final_check))</span>
<span id="cb101-175"><a href="figure-4.html#cb101-175" tabindex="-1"></a></span>
<span id="cb101-176"><a href="figure-4.html#cb101-176" tabindex="-1"></a>fusion <span class="ot">&lt;-</span> <span class="fu">rbind</span>(fusion_T)</span>
<span id="cb101-177"><a href="figure-4.html#cb101-177" tabindex="-1"></a></span>
<span id="cb101-178"><a href="figure-4.html#cb101-178" tabindex="-1"></a>clinical_fusion_dcast <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">dcast</span>(fusion,RNA_id <span class="sc">~</span> final_check) <span class="sc">%&gt;%</span></span>
<span id="cb101-179"><a href="figure-4.html#cb101-179" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">right_join</span>(sample_info_filter,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;RNA_id&quot;</span><span class="ot">=</span><span class="st">&quot;RNA_id_raw&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-180"><a href="figure-4.html#cb101-180" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;bianhao&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-181"><a href="figure-4.html#cb101-181" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>RNA_id)</span>
<span id="cb101-182"><a href="figure-4.html#cb101-182" tabindex="-1"></a></span>
<span id="cb101-183"><a href="figure-4.html#cb101-183" tabindex="-1"></a>clinical_fusion_dcast[<span class="fu">is.na</span>(clinical_fusion_dcast)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb101-184"><a href="figure-4.html#cb101-184" tabindex="-1"></a>clinical_fusion_dcast[clinical_fusion_dcast <span class="sc">!=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb101-185"><a href="figure-4.html#cb101-185" tabindex="-1"></a></span>
<span id="cb101-186"><a href="figure-4.html#cb101-186" tabindex="-1"></a>d_fusion <span class="ot">&lt;-</span> <span class="fu">t</span>(clinical_fusion_dcast) <span class="sc">%&gt;%</span></span>
<span id="cb101-187"><a href="figure-4.html#cb101-187" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-188"><a href="figure-4.html#cb101-188" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample_info<span class="sc">$</span>bianhao) <span class="sc">%&gt;%</span></span>
<span id="cb101-189"><a href="figure-4.html#cb101-189" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">&quot;fusion&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-190"><a href="figure-4.html#cb101-190" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">match</span>(fusion,<span class="fu">c</span>(<span class="st">&quot;SET-NUP214&quot;</span>,<span class="st">&quot;MLLT10 rearrangement&quot;</span>,<span class="st">&quot;NUP98&quot;</span>,<span class="st">&quot;STIL-TAL1&quot;</span>,</span>
<span id="cb101-191"><a href="figure-4.html#cb101-191" tabindex="-1"></a>                                <span class="st">&quot;KMT2A rearrangement&quot;</span>,<span class="st">&quot;other&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb101-192"><a href="figure-4.html#cb101-192" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;fusion&quot;</span>)</span>
<span id="cb101-193"><a href="figure-4.html#cb101-193" tabindex="-1"></a></span>
<span id="cb101-194"><a href="figure-4.html#cb101-194" tabindex="-1"></a>fusion_annotation <span class="ot">&lt;-</span> <span class="fu">Heatmap</span>(d_fusion,<span class="at">rect_gp =</span> <span class="fu">gpar</span>(<span class="at">col =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>),</span>
<span id="cb101-195"><a href="figure-4.html#cb101-195" tabindex="-1"></a>                             <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;#EEEEEE&quot;</span>,<span class="st">&quot;#444444&quot;</span>),</span>
<span id="cb101-196"><a href="figure-4.html#cb101-196" tabindex="-1"></a>                             <span class="at">height=</span><span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">&quot;cm&quot;</span>),<span class="at">border =</span> <span class="cn">TRUE</span>,</span>
<span id="cb101-197"><a href="figure-4.html#cb101-197" tabindex="-1"></a>                             <span class="at">column_split =</span>sample_info<span class="sc">$</span>Clusters,</span>
<span id="cb101-198"><a href="figure-4.html#cb101-198" tabindex="-1"></a>                             <span class="at">cluster_columns =</span> F,<span class="at">cluster_rows =</span> F,<span class="at">column_title =</span> <span class="cn">NULL</span>,</span>
<span id="cb101-199"><a href="figure-4.html#cb101-199" tabindex="-1"></a>                             <span class="at">row_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">8</span>),<span class="at">column_names_gp=</span><span class="fu">gpar</span>(<span class="at">fontsize=</span><span class="dv">6</span>))</span>
<span id="cb101-200"><a href="figure-4.html#cb101-200" tabindex="-1"></a></span>
<span id="cb101-201"><a href="figure-4.html#cb101-201" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb101-202"><a href="figure-4.html#cb101-202" tabindex="-1"></a><span class="co">#  Step 4: Visualization</span></span>
<span id="cb101-203"><a href="figure-4.html#cb101-203" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb101-204"><a href="figure-4.html#cb101-204" tabindex="-1"></a><span class="fu">pdf</span>(<span class="fu">paste0</span>(<span class="st">&quot;result/Figure4/S6I_oncoplot_T.pdf&quot;</span>),<span class="at">width=</span><span class="dv">7</span>,<span class="at">height =</span> <span class="dv">10</span>)</span>
<span id="cb101-205"><a href="figure-4.html#cb101-205" tabindex="-1"></a>mutation_annotation <span class="sc">%v%</span> fusion_annotation</span>
<span id="cb101-206"><a href="figure-4.html#cb101-206" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb101-207"><a href="figure-4.html#cb101-207" tabindex="-1"></a></span>
<span id="cb101-208"><a href="figure-4.html#cb101-208" tabindex="-1"></a><span class="cf">if</span> (<span class="cn">FALSE</span>){</span>
<span id="cb101-209"><a href="figure-4.html#cb101-209" tabindex="-1"></a>  a1<span class="ot">=</span><span class="dv">10</span></span>
<span id="cb101-210"><a href="figure-4.html#cb101-210" tabindex="-1"></a>  a2<span class="ot">=</span><span class="dv">2</span></span>
<span id="cb101-211"><a href="figure-4.html#cb101-211" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(a1,<span class="dv">23</span><span class="sc">-</span>a1,a2,<span class="dv">16</span><span class="sc">-</span>a2),<span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb101-212"><a href="figure-4.html#cb101-212" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">fisher.test</span>(dat,<span class="at">alternative =</span><span class="st">&quot;greater&quot;</span>)</span>
<span id="cb101-213"><a href="figure-4.html#cb101-213" tabindex="-1"></a>  result</span>
<span id="cb101-214"><a href="figure-4.html#cb101-214" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="Figure-1025/Figure4/S6I.png" width="582" style="display: block; margin: auto;" /></p>
</div>
<div id="s6-j-da-score-of-tc12" class="section level2 hasAnchor" number="19.17">
<h2><span class="header-section-number">19.17</span> (S6 J) DA score of TC1/2<a href="figure-4.html#s6-j-da-score-of-tc12" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>DA-score demonstrates that most of the metabolic pathways are upregulated in the relatively favorable TC2 cluster.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="figure-4.html#cb102-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb102-2"><a href="figure-4.html#cb102-2" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb102-3"><a href="figure-4.html#cb102-3" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb102-4"><a href="figure-4.html#cb102-4" tabindex="-1"></a></span>
<span id="cb102-5"><a href="figure-4.html#cb102-5" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb102-6"><a href="figure-4.html#cb102-6" tabindex="-1"></a><span class="co">#  Step 1: DA-score of gene_T</span></span>
<span id="cb102-7"><a href="figure-4.html#cb102-7" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb102-8"><a href="figure-4.html#cb102-8" tabindex="-1"></a>cluster <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4F_cluster_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-9"><a href="figure-4.html#cb102-9" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() </span>
<span id="cb102-10"><a href="figure-4.html#cb102-10" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-11"><a href="figure-4.html#cb102-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(label,<span class="fu">all_of</span>(cluster<span class="sc">$</span>METc_BM_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb102-12"><a href="figure-4.html#cb102-12" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>)</span>
<span id="cb102-13"><a href="figure-4.html#cb102-13" tabindex="-1"></a>group <span class="ot">&lt;-</span> cluster<span class="sc">$</span>Clusters</span>
<span id="cb102-14"><a href="figure-4.html#cb102-14" tabindex="-1"></a><span class="fu">table</span>(group)</span>
<span id="cb102-15"><a href="figure-4.html#cb102-15" tabindex="-1"></a>group[<span class="fu">which</span>(group<span class="sc">==</span> <span class="st">&quot;TC1&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;tumor&quot;</span></span>
<span id="cb102-16"><a href="figure-4.html#cb102-16" tabindex="-1"></a>group[<span class="fu">which</span>(group<span class="sc">==</span> <span class="st">&quot;TC2&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;normal&quot;</span></span>
<span id="cb102-17"><a href="figure-4.html#cb102-17" tabindex="-1"></a>metabolite_all <span class="ot">&lt;-</span> <span class="fu">mlimma</span>(<span class="fu">log1p</span>(dat),group)</span>
<span id="cb102-18"><a href="figure-4.html#cb102-18" tabindex="-1"></a><span class="fu">write.table</span>(metabolite_all,<span class="st">&quot;result/Figure4/S6J_metabolite_T.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb102-19"><a href="figure-4.html#cb102-19" tabindex="-1"></a></span>
<span id="cb102-20"><a href="figure-4.html#cb102-20" tabindex="-1"></a>dd <span class="ot">&lt;-</span> metabolite_all <span class="sc">%&gt;%</span></span>
<span id="cb102-21"><a href="figure-4.html#cb102-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Condition=</span><span class="fu">ifelse</span>(logFC<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>,<span class="st">&quot;Up&quot;</span>,</span>
<span id="cb102-22"><a href="figure-4.html#cb102-22" tabindex="-1"></a>                          <span class="fu">ifelse</span>(logFC <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">0</span> <span class="sc">&amp;</span> P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>,<span class="st">&quot;Down&quot;</span>,<span class="st">&quot;normal&quot;</span>)))</span>
<span id="cb102-23"><a href="figure-4.html#cb102-23" tabindex="-1"></a></span>
<span id="cb102-24"><a href="figure-4.html#cb102-24" tabindex="-1"></a>cluster <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/4F_cluster_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-25"><a href="figure-4.html#cb102-25" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb102-26"><a href="figure-4.html#cb102-26" tabindex="-1"></a></span>
<span id="cb102-27"><a href="figure-4.html#cb102-27" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;raw_data/20231113_RNA_ALL_VST_coding.rds&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-28"><a href="figure-4.html#cb102-28" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb102-29"><a href="figure-4.html#cb102-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(cluster<span class="sc">$</span>RNA_id_raw))</span>
<span id="cb102-30"><a href="figure-4.html#cb102-30" tabindex="-1"></a>group <span class="ot">&lt;-</span> cluster<span class="sc">$</span>Clusters</span>
<span id="cb102-31"><a href="figure-4.html#cb102-31" tabindex="-1"></a></span>
<span id="cb102-32"><a href="figure-4.html#cb102-32" tabindex="-1"></a>group[<span class="fu">which</span>(group<span class="sc">==</span> <span class="st">&quot;TC1&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;tumor&quot;</span></span>
<span id="cb102-33"><a href="figure-4.html#cb102-33" tabindex="-1"></a>group[<span class="fu">which</span>(group<span class="sc">==</span> <span class="st">&quot;TC2&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;normal&quot;</span></span>
<span id="cb102-34"><a href="figure-4.html#cb102-34" tabindex="-1"></a></span>
<span id="cb102-35"><a href="figure-4.html#cb102-35" tabindex="-1"></a>gene_all <span class="ot">&lt;-</span> <span class="fu">mlimma</span>(dat,group)</span>
<span id="cb102-36"><a href="figure-4.html#cb102-36" tabindex="-1"></a> </span>
<span id="cb102-37"><a href="figure-4.html#cb102-37" tabindex="-1"></a><span class="fu">write.table</span>(gene_all,<span class="st">&quot;result/Figure4/S6J_gene_T.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb102-38"><a href="figure-4.html#cb102-38" tabindex="-1"></a></span>
<span id="cb102-39"><a href="figure-4.html#cb102-39" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S6J_gene_T.txt&quot;</span>)</span>
<span id="cb102-40"><a href="figure-4.html#cb102-40" tabindex="-1"></a></span>
<span id="cb102-41"><a href="figure-4.html#cb102-41" tabindex="-1"></a>dat_increase <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb102-42"><a href="figure-4.html#cb102-42" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(logFC <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-43"><a href="figure-4.html#cb102-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb102-44"><a href="figure-4.html#cb102-44" tabindex="-1"></a>dat_decrease <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb102-45"><a href="figure-4.html#cb102-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(logFC <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-46"><a href="figure-4.html#cb102-46" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb102-47"><a href="figure-4.html#cb102-47" tabindex="-1"></a></span>
<span id="cb102-48"><a href="figure-4.html#cb102-48" tabindex="-1"></a>DA_result <span class="ot">&lt;-</span> <span class="fu">ePDAlyser</span>(dat_increase<span class="sc">$</span>name,dat_decrease<span class="sc">$</span>name,dat<span class="sc">$</span>name,<span class="at">min_measured_num =</span> <span class="dv">10</span>,<span class="at">out=</span><span class="st">&quot;gene&quot;</span>)</span>
<span id="cb102-49"><a href="figure-4.html#cb102-49" tabindex="-1"></a><span class="fu">write.table</span>(DA_result<span class="sc">$</span>result,<span class="st">&quot;result/Figure4/S6J_DAscore_gene_T.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb102-50"><a href="figure-4.html#cb102-50" tabindex="-1"></a></span>
<span id="cb102-51"><a href="figure-4.html#cb102-51" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb102-52"><a href="figure-4.html#cb102-52" tabindex="-1"></a><span class="co">#  Step 2: DA-score of metabolite_T</span></span>
<span id="cb102-53"><a href="figure-4.html#cb102-53" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb102-54"><a href="figure-4.html#cb102-54" tabindex="-1"></a>kegg_id <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/cell_metabolite_info_all_v1109.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-55"><a href="figure-4.html#cb102-55" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb102-56"><a href="figure-4.html#cb102-56" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(refmet_name,KEGG) <span class="sc">%&gt;%</span></span>
<span id="cb102-57"><a href="figure-4.html#cb102-57" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate_rows</span>(KEGG,<span class="at">sep=</span><span class="st">&quot;;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-58"><a href="figure-4.html#cb102-58" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(KEGG<span class="sc">!=</span><span class="st">&quot;NA&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-59"><a href="figure-4.html#cb102-59" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(KEGG <span class="sc">!=</span> <span class="st">&quot;None&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-60"><a href="figure-4.html#cb102-60" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb102-61"><a href="figure-4.html#cb102-61" tabindex="-1"></a></span>
<span id="cb102-62"><a href="figure-4.html#cb102-62" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S6J_metabolite_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-63"><a href="figure-4.html#cb102-63" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(logFC)) <span class="sc">%&gt;%</span></span>
<span id="cb102-64"><a href="figure-4.html#cb102-64" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(kegg_id,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span><span class="ot">=</span><span class="st">&quot;refmet_name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-65"><a href="figure-4.html#cb102-65" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(KEGG,<span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-66"><a href="figure-4.html#cb102-66" tabindex="-1"></a></span>
<span id="cb102-67"><a href="figure-4.html#cb102-67" tabindex="-1"></a>dat_increase <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb102-68"><a href="figure-4.html#cb102-68" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(logFC <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-69"><a href="figure-4.html#cb102-69" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb102-70"><a href="figure-4.html#cb102-70" tabindex="-1"></a>dat_decrease <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb102-71"><a href="figure-4.html#cb102-71" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(logFC <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-72"><a href="figure-4.html#cb102-72" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb102-73"><a href="figure-4.html#cb102-73" tabindex="-1"></a></span>
<span id="cb102-74"><a href="figure-4.html#cb102-74" tabindex="-1"></a>DA_result <span class="ot">&lt;-</span> <span class="fu">ePDAlyser</span>(dat_increase<span class="sc">$</span>KEGG,dat_decrease<span class="sc">$</span>KEGG,dat<span class="sc">$</span>KEGG,<span class="at">min_measured_num =</span> <span class="dv">3</span>,<span class="at">out=</span><span class="st">&quot;metabolite&quot;</span>)</span>
<span id="cb102-75"><a href="figure-4.html#cb102-75" tabindex="-1"></a><span class="fu">write.table</span>(DA_result<span class="sc">$</span>result,<span class="st">&quot;result/Figure4/S6J_DAscore_metabolite_T.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb102-76"><a href="figure-4.html#cb102-76" tabindex="-1"></a></span>
<span id="cb102-77"><a href="figure-4.html#cb102-77" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb102-78"><a href="figure-4.html#cb102-78" tabindex="-1"></a><span class="co">#  Step 3: DA-score of gene+metabolite_T</span></span>
<span id="cb102-79"><a href="figure-4.html#cb102-79" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb102-80"><a href="figure-4.html#cb102-80" tabindex="-1"></a>gene <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S6J_DAscore_gene_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-81"><a href="figure-4.html#cb102-81" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb102-82"><a href="figure-4.html#cb102-82" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Measured_members_num <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-83"><a href="figure-4.html#cb102-83" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(DA_score) <span class="sc">&gt;</span> <span class="fl">0.05</span>)</span>
<span id="cb102-84"><a href="figure-4.html#cb102-84" tabindex="-1"></a></span>
<span id="cb102-85"><a href="figure-4.html#cb102-85" tabindex="-1"></a>metabolite <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S6J_DAscore_metabolite_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-86"><a href="figure-4.html#cb102-86" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb102-87"><a href="figure-4.html#cb102-87" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Measured_members_num <span class="sc">&gt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-88"><a href="figure-4.html#cb102-88" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(DA_score <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb102-89"><a href="figure-4.html#cb102-89" tabindex="-1"></a></span>
<span id="cb102-90"><a href="figure-4.html#cb102-90" tabindex="-1"></a>all_1 <span class="ot">&lt;-</span> gene <span class="sc">%&gt;%</span></span>
<span id="cb102-91"><a href="figure-4.html#cb102-91" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(metabolite,<span class="at">by=</span><span class="st">&quot;Pathway&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-92"><a href="figure-4.html#cb102-92" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(DA_score.x <span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> DA_score.y <span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb102-93"><a href="figure-4.html#cb102-93" tabindex="-1"></a>  </span>
<span id="cb102-94"><a href="figure-4.html#cb102-94" tabindex="-1"></a>all_2 <span class="ot">&lt;-</span> gene <span class="sc">%&gt;%</span></span>
<span id="cb102-95"><a href="figure-4.html#cb102-95" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(metabolite,<span class="at">by=</span><span class="st">&quot;Pathway&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-96"><a href="figure-4.html#cb102-96" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(DA_score.x <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> DA_score.y <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb102-97"><a href="figure-4.html#cb102-97" tabindex="-1"></a></span>
<span id="cb102-98"><a href="figure-4.html#cb102-98" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">c</span>(all_1<span class="sc">$</span>Pathway,all_2<span class="sc">$</span>Pathway)</span>
<span id="cb102-99"><a href="figure-4.html#cb102-99" tabindex="-1"></a></span>
<span id="cb102-100"><a href="figure-4.html#cb102-100" tabindex="-1"></a>gene_filter <span class="ot">&lt;-</span> gene <span class="sc">%&gt;%</span></span>
<span id="cb102-101"><a href="figure-4.html#cb102-101" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Pathway <span class="sc">%in%</span> path) <span class="sc">%&gt;%</span></span>
<span id="cb102-102"><a href="figure-4.html#cb102-102" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Measured_members_num <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-103"><a href="figure-4.html#cb102-103" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(DA_score) <span class="sc">&gt;</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-104"><a href="figure-4.html#cb102-104" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-105"><a href="figure-4.html#cb102-105" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Pathway=</span><span class="fu">factor</span>(Pathway,<span class="at">levels =</span> Pathway))</span>
<span id="cb102-106"><a href="figure-4.html#cb102-106" tabindex="-1"></a></span>
<span id="cb102-107"><a href="figure-4.html#cb102-107" tabindex="-1"></a>colp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Amino acid metabolism&quot;</span> <span class="ot">=</span><span class="st">&quot;#1B9E77&quot;</span>,</span>
<span id="cb102-108"><a href="figure-4.html#cb102-108" tabindex="-1"></a>          <span class="st">&quot;Carbohydrate metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#D95F02&quot;</span>,</span>
<span id="cb102-109"><a href="figure-4.html#cb102-109" tabindex="-1"></a>          <span class="st">&quot;Glycan biosynthesis and metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#1F78B4&quot;</span>, </span>
<span id="cb102-110"><a href="figure-4.html#cb102-110" tabindex="-1"></a>          <span class="st">&quot;Metabolism of cofactors and vitamins&quot;</span><span class="ot">=</span><span class="st">&quot;#7570B3&quot;</span>,</span>
<span id="cb102-111"><a href="figure-4.html#cb102-111" tabindex="-1"></a>          <span class="st">&quot;Metabolism of terpenoids and polyketides&quot;</span><span class="ot">=</span><span class="st">&quot;#BC80BD&quot;</span>,</span>
<span id="cb102-112"><a href="figure-4.html#cb102-112" tabindex="-1"></a>          <span class="st">&quot;Metabolism of other amino acids&quot;</span><span class="ot">=</span><span class="st">&quot;#8DD3C7&quot;</span>,</span>
<span id="cb102-113"><a href="figure-4.html#cb102-113" tabindex="-1"></a>          <span class="st">&quot;Energy metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#E7298A&quot;</span>,</span>
<span id="cb102-114"><a href="figure-4.html#cb102-114" tabindex="-1"></a>          <span class="st">&quot;Lipid metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#66A61E&quot;</span>,</span>
<span id="cb102-115"><a href="figure-4.html#cb102-115" tabindex="-1"></a>          <span class="st">&quot;Nucleotide metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#E6AB02&quot;</span>,</span>
<span id="cb102-116"><a href="figure-4.html#cb102-116" tabindex="-1"></a>          <span class="st">&quot;Biosynthesis of other secondary metabolites&quot;</span><span class="ot">=</span><span class="st">&quot;#A6761D&quot;</span>,</span>
<span id="cb102-117"><a href="figure-4.html#cb102-117" tabindex="-1"></a>          <span class="st">&quot;Xenobiotics biodegradation and metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#666666&quot;</span>)</span>
<span id="cb102-118"><a href="figure-4.html#cb102-118" tabindex="-1"></a></span>
<span id="cb102-119"><a href="figure-4.html#cb102-119" tabindex="-1"></a>p <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(gene_filter)<span class="sc">+</span></span>
<span id="cb102-120"><a href="figure-4.html#cb102-120" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Pathway,<span class="at">y=</span>DA_score,<span class="at">size=</span><span class="fu">log2</span>(Measured_members_num),<span class="at">color=</span><span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb102-121"><a href="figure-4.html#cb102-121" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_pointrange</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Pathway,<span class="at">y=</span>DA_score,<span class="at">ymin=</span><span class="dv">0</span>,<span class="at">ymax=</span>DA_score,<span class="at">color=</span><span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb102-122"><a href="figure-4.html#cb102-122" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>colp)<span class="sc">+</span></span>
<span id="cb102-123"><a href="figure-4.html#cb102-123" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb102-124"><a href="figure-4.html#cb102-124" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">xlab</span>(<span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb102-125"><a href="figure-4.html#cb102-125" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span>
<span id="cb102-126"><a href="figure-4.html#cb102-126" tabindex="-1"></a></span>
<span id="cb102-127"><a href="figure-4.html#cb102-127" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure4/S6J_DAscore_gene_T_filter.pdf&quot;</span>,p,<span class="at">width=</span><span class="dv">8</span>,<span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb102-128"><a href="figure-4.html#cb102-128" tabindex="-1"></a></span>
<span id="cb102-129"><a href="figure-4.html#cb102-129" tabindex="-1"></a>metabolite_filter <span class="ot">&lt;-</span> metabolite <span class="sc">%&gt;%</span></span>
<span id="cb102-130"><a href="figure-4.html#cb102-130" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Pathway <span class="sc">%in%</span> path) <span class="sc">%&gt;%</span></span>
<span id="cb102-131"><a href="figure-4.html#cb102-131" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Measured_members_num <span class="sc">&gt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-132"><a href="figure-4.html#cb102-132" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(DA_score) <span class="sc">&gt;</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-133"><a href="figure-4.html#cb102-133" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-134"><a href="figure-4.html#cb102-134" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Pathway=</span><span class="fu">factor</span>(Pathway,<span class="at">levels =</span> Pathway))</span>
<span id="cb102-135"><a href="figure-4.html#cb102-135" tabindex="-1"></a></span>
<span id="cb102-136"><a href="figure-4.html#cb102-136" tabindex="-1"></a>colp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Amino acid metabolism&quot;</span> <span class="ot">=</span><span class="st">&quot;#1B9E77&quot;</span>,</span>
<span id="cb102-137"><a href="figure-4.html#cb102-137" tabindex="-1"></a>          <span class="st">&quot;Carbohydrate metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#D95F02&quot;</span>,</span>
<span id="cb102-138"><a href="figure-4.html#cb102-138" tabindex="-1"></a>          <span class="st">&quot;Glycan biosynthesis and metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#1F78B4&quot;</span>, </span>
<span id="cb102-139"><a href="figure-4.html#cb102-139" tabindex="-1"></a>          <span class="st">&quot;Metabolism of cofactors and vitamins&quot;</span><span class="ot">=</span><span class="st">&quot;#7570B3&quot;</span>,</span>
<span id="cb102-140"><a href="figure-4.html#cb102-140" tabindex="-1"></a>          <span class="st">&quot;Metabolism of terpenoids and polyketides&quot;</span><span class="ot">=</span><span class="st">&quot;#BC80BD&quot;</span>,</span>
<span id="cb102-141"><a href="figure-4.html#cb102-141" tabindex="-1"></a>          <span class="st">&quot;Metabolism of other amino acids&quot;</span><span class="ot">=</span><span class="st">&quot;#8DD3C7&quot;</span>,</span>
<span id="cb102-142"><a href="figure-4.html#cb102-142" tabindex="-1"></a>          <span class="st">&quot;Energy metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#E7298A&quot;</span>,</span>
<span id="cb102-143"><a href="figure-4.html#cb102-143" tabindex="-1"></a>          <span class="st">&quot;Lipid metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#66A61E&quot;</span>,</span>
<span id="cb102-144"><a href="figure-4.html#cb102-144" tabindex="-1"></a>          <span class="st">&quot;Nucleotide metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#E6AB02&quot;</span>,</span>
<span id="cb102-145"><a href="figure-4.html#cb102-145" tabindex="-1"></a>          <span class="st">&quot;Biosynthesis of other secondary metabolites&quot;</span><span class="ot">=</span><span class="st">&quot;#A6761D&quot;</span>,</span>
<span id="cb102-146"><a href="figure-4.html#cb102-146" tabindex="-1"></a>          <span class="st">&quot;Xenobiotics biodegradation and metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#666666&quot;</span>)</span>
<span id="cb102-147"><a href="figure-4.html#cb102-147" tabindex="-1"></a></span>
<span id="cb102-148"><a href="figure-4.html#cb102-148" tabindex="-1"></a>p <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(metabolite_filter)<span class="sc">+</span></span>
<span id="cb102-149"><a href="figure-4.html#cb102-149" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Pathway,<span class="at">y=</span>DA_score,<span class="at">size=</span><span class="fu">log2</span>(Measured_members_num),<span class="at">color=</span><span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb102-150"><a href="figure-4.html#cb102-150" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_pointrange</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Pathway,<span class="at">y=</span>DA_score,<span class="at">ymin=</span><span class="dv">0</span>,<span class="at">ymax=</span>DA_score,<span class="at">color=</span><span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb102-151"><a href="figure-4.html#cb102-151" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>colp)<span class="sc">+</span></span>
<span id="cb102-152"><a href="figure-4.html#cb102-152" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb102-153"><a href="figure-4.html#cb102-153" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">xlab</span>(<span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb102-154"><a href="figure-4.html#cb102-154" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span>
<span id="cb102-155"><a href="figure-4.html#cb102-155" tabindex="-1"></a></span>
<span id="cb102-156"><a href="figure-4.html#cb102-156" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure4/S6J_DAscore_metabolite_T_filter.pdf&quot;</span>,p,<span class="at">width=</span><span class="dv">8</span>,<span class="at">height =</span> <span class="fl">3.5</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure4/S6J.png" width="450" style="display: block; margin: auto;" /></p>
</div>
<div id="s6-k-l-msea-of-tc12" class="section level2 hasAnchor" number="19.18">
<h2><span class="header-section-number">19.18</span> (S6 K-L) MSEA of TC1/2<a href="figure-4.html#s6-k-l-msea-of-tc12" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The GSEA reveals that the TC1 cluster, associated with poorer prognosis, exhibits suppression in OXPHOS and enrichment in histone modifications.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="figure-4.html#cb103-1" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb103-2"><a href="figure-4.html#cb103-2" tabindex="-1"></a><span class="co">#  Step 1: Oxidative phosphorylation</span></span>
<span id="cb103-3"><a href="figure-4.html#cb103-3" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb103-4"><a href="figure-4.html#cb103-4" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb103-5"><a href="figure-4.html#cb103-5" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb103-6"><a href="figure-4.html#cb103-6" tabindex="-1"></a></span>
<span id="cb103-7"><a href="figure-4.html#cb103-7" tabindex="-1"></a><span class="do">## Load data</span></span>
<span id="cb103-8"><a href="figure-4.html#cb103-8" tabindex="-1"></a>gene_all <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S6J_gene_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb103-9"><a href="figure-4.html#cb103-9" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb103-10"><a href="figure-4.html#cb103-10" tabindex="-1"></a></span>
<span id="cb103-11"><a href="figure-4.html#cb103-11" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">&quot;raw_data/OXIDATIVE.txt&quot;</span>)</span>
<span id="cb103-12"><a href="figure-4.html#cb103-12" tabindex="-1"></a>gmt <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(a, <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb103-13"><a href="figure-4.html#cb103-13" tabindex="-1"></a><span class="fu">names</span>(gmt) <span class="ot">&lt;-</span> <span class="fu">vapply</span>(gmt, <span class="cf">function</span>(y) y[<span class="dv">1</span>], <span class="fu">character</span>(<span class="dv">1</span>))</span>
<span id="cb103-14"><a href="figure-4.html#cb103-14" tabindex="-1"></a>gmt1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(gmt, <span class="st">&quot;[&quot;</span>, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span>
<span id="cb103-15"><a href="figure-4.html#cb103-15" tabindex="-1"></a></span>
<span id="cb103-16"><a href="figure-4.html#cb103-16" tabindex="-1"></a>a_temp <span class="ot">&lt;-</span> gene_all<span class="sc">$</span>logFC</span>
<span id="cb103-17"><a href="figure-4.html#cb103-17" tabindex="-1"></a><span class="fu">names</span>(a_temp) <span class="ot">&lt;-</span> gene_all<span class="sc">$</span>name</span>
<span id="cb103-18"><a href="figure-4.html#cb103-18" tabindex="-1"></a>  <span class="do">##GSEA</span></span>
<span id="cb103-19"><a href="figure-4.html#cb103-19" tabindex="-1"></a>  Ranks_all <span class="ot">&lt;-</span> <span class="fu">sort</span>(a_temp,<span class="at">decreasing =</span><span class="cn">TRUE</span>)</span>
<span id="cb103-20"><a href="figure-4.html#cb103-20" tabindex="-1"></a>  gseaParam <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb103-21"><a href="figure-4.html#cb103-21" tabindex="-1"></a>  minSize<span class="ot">=</span><span class="dv">5</span></span>
<span id="cb103-22"><a href="figure-4.html#cb103-22" tabindex="-1"></a>  ticksSize <span class="ot">=</span> <span class="fl">0.2</span></span>
<span id="cb103-23"><a href="figure-4.html#cb103-23" tabindex="-1"></a>  Ranks_all <span class="ot">=</span> <span class="fu">sort</span>(a_temp,<span class="at">decreasing =</span><span class="cn">TRUE</span>)</span>
<span id="cb103-24"><a href="figure-4.html#cb103-24" tabindex="-1"></a>  fgseaRes_all <span class="ot">&lt;-</span> fgsea<span class="sc">::</span><span class="fu">fgsea</span>(gmt1, <span class="fu">sort</span>(a_temp,<span class="at">decreasing =</span><span class="cn">TRUE</span>),<span class="at">minSize =</span> minSize,<span class="at">nPermSimple=</span><span class="dv">20000</span>,<span class="at">gseaParam=</span><span class="dv">1</span>)</span>
<span id="cb103-25"><a href="figure-4.html#cb103-25" tabindex="-1"></a>  </span>
<span id="cb103-26"><a href="figure-4.html#cb103-26" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> fgseaRes_all <span class="sc">%&gt;%</span> </span>
<span id="cb103-27"><a href="figure-4.html#cb103-27" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(pval) <span class="sc">%&gt;%</span></span>
<span id="cb103-28"><a href="figure-4.html#cb103-28" tabindex="-1"></a>    <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb103-29"><a href="figure-4.html#cb103-29" tabindex="-1"></a>  nes <span class="ot">&lt;-</span> fgseaRes_all <span class="sc">%&gt;%</span> </span>
<span id="cb103-30"><a href="figure-4.html#cb103-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(NES) <span class="sc">%&gt;%</span></span>
<span id="cb103-31"><a href="figure-4.html#cb103-31" tabindex="-1"></a>    <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb103-32"><a href="figure-4.html#cb103-32" tabindex="-1"></a>  </span>
<span id="cb103-33"><a href="figure-4.html#cb103-33" tabindex="-1"></a>  pathway <span class="ot">&lt;-</span> gmt1[[<span class="dv">1</span>]]</span>
<span id="cb103-34"><a href="figure-4.html#cb103-34" tabindex="-1"></a>  </span>
<span id="cb103-35"><a href="figure-4.html#cb103-35" tabindex="-1"></a>  stats <span class="ot">&lt;-</span> Ranks_all</span>
<span id="cb103-36"><a href="figure-4.html#cb103-36" tabindex="-1"></a>  rnk <span class="ot">&lt;-</span> <span class="fu">rank</span>(<span class="sc">-</span>stats)</span>
<span id="cb103-37"><a href="figure-4.html#cb103-37" tabindex="-1"></a>  ord <span class="ot">&lt;-</span> <span class="fu">order</span>(rnk)</span>
<span id="cb103-38"><a href="figure-4.html#cb103-38" tabindex="-1"></a>  statsAdj <span class="ot">&lt;-</span> stats[ord]</span>
<span id="cb103-39"><a href="figure-4.html#cb103-39" tabindex="-1"></a>  statsAdj <span class="ot">&lt;-</span> <span class="fu">sign</span>(statsAdj) <span class="sc">*</span> (<span class="fu">abs</span>(statsAdj)<span class="sc">^</span>gseaParam)</span>
<span id="cb103-40"><a href="figure-4.html#cb103-40" tabindex="-1"></a>  statsAdj <span class="ot">&lt;-</span> statsAdj<span class="sc">/</span><span class="fu">max</span>(<span class="fu">abs</span>(statsAdj))</span>
<span id="cb103-41"><a href="figure-4.html#cb103-41" tabindex="-1"></a>  pathway <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">as.vector</span>(<span class="fu">na.omit</span>(<span class="fu">match</span>(pathway, <span class="fu">names</span>(statsAdj)))))</span>
<span id="cb103-42"><a href="figure-4.html#cb103-42" tabindex="-1"></a>  pathway <span class="ot">&lt;-</span> <span class="fu">sort</span>(pathway)</span>
<span id="cb103-43"><a href="figure-4.html#cb103-43" tabindex="-1"></a>  gseaRes <span class="ot">&lt;-</span> fgsea<span class="sc">::</span><span class="fu">calcGseaStat</span>(statsAdj, <span class="at">selectedStats =</span> pathway, </span>
<span id="cb103-44"><a href="figure-4.html#cb103-44" tabindex="-1"></a>                                 <span class="at">returnAllExtremes =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-45"><a href="figure-4.html#cb103-45" tabindex="-1"></a>  bottoms <span class="ot">&lt;-</span> gseaRes<span class="sc">$</span>bottoms</span>
<span id="cb103-46"><a href="figure-4.html#cb103-46" tabindex="-1"></a>  tops <span class="ot">&lt;-</span> gseaRes<span class="sc">$</span>tops</span>
<span id="cb103-47"><a href="figure-4.html#cb103-47" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(statsAdj)</span>
<span id="cb103-48"><a href="figure-4.html#cb103-48" tabindex="-1"></a>  xs <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">rbind</span>(pathway <span class="sc">-</span> <span class="dv">1</span>, pathway))</span>
<span id="cb103-49"><a href="figure-4.html#cb103-49" tabindex="-1"></a>  ys <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">rbind</span>(bottoms, tops))</span>
<span id="cb103-50"><a href="figure-4.html#cb103-50" tabindex="-1"></a>  toPlot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, xs, n <span class="sc">+</span> <span class="dv">1</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, ys, <span class="dv">0</span>))</span>
<span id="cb103-51"><a href="figure-4.html#cb103-51" tabindex="-1"></a>  diff <span class="ot">&lt;-</span> (<span class="fu">max</span>(tops) <span class="sc">-</span> <span class="fu">min</span>(bottoms))<span class="sc">/</span><span class="dv">8</span></span>
<span id="cb103-52"><a href="figure-4.html#cb103-52" tabindex="-1"></a>  x <span class="ot">=</span> y <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb103-53"><a href="figure-4.html#cb103-53" tabindex="-1"></a>  g1 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(toPlot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb103-54"><a href="figure-4.html#cb103-54" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;green&quot;</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span>  </span>
<span id="cb103-55"><a href="figure-4.html#cb103-55" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, </span>
<span id="cb103-56"><a href="figure-4.html#cb103-56" tabindex="-1"></a>                        <span class="at">colour =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-57"><a href="figure-4.html#cb103-57" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb103-58"><a href="figure-4.html#cb103-58" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb103-59"><a href="figure-4.html#cb103-59" tabindex="-1"></a>                   <span class="at">axis.text.x=</span>ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),<span class="at">axis.ticks.x=</span>ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb103-60"><a href="figure-4.html#cb103-60" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;enrichment score&quot;</span>,<span class="at">title=</span>)<span class="sc">+</span></span>
<span id="cb103-61"><a href="figure-4.html#cb103-61" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">length</span>(statsAdj)<span class="sc">+</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb103-62"><a href="figure-4.html#cb103-62" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">5</span>), <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb103-63"><a href="figure-4.html#cb103-63" tabindex="-1"></a>  </span>
<span id="cb103-64"><a href="figure-4.html#cb103-64" tabindex="-1"></a>  g2 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(toPlot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))<span class="sc">+</span></span>
<span id="cb103-65"><a href="figure-4.html#cb103-65" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_segment</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> pathway), </span>
<span id="cb103-66"><a href="figure-4.html#cb103-66" tabindex="-1"></a>                          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, </span>
<span id="cb103-67"><a href="figure-4.html#cb103-67" tabindex="-1"></a>                                        <span class="at">y =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> <span class="dv">1</span>),</span>
<span id="cb103-68"><a href="figure-4.html#cb103-68" tabindex="-1"></a>                          <span class="at">size =</span> ticksSize,<span class="at">color=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-69"><a href="figure-4.html#cb103-69" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">length</span>(statsAdj)<span class="sc">+</span><span class="dv">1</span>))<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb103-70"><a href="figure-4.html#cb103-70" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb103-71"><a href="figure-4.html#cb103-71" tabindex="-1"></a>                   <span class="at">axis.text.x=</span><span class="fu">element_blank</span>(),<span class="at">axis.ticks.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb103-72"><a href="figure-4.html#cb103-72" tabindex="-1"></a>                   <span class="at">axis.text.y=</span><span class="fu">element_blank</span>(),<span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb103-73"><a href="figure-4.html#cb103-73" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>,<span class="at">y=</span><span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb103-74"><a href="figure-4.html#cb103-74" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">5</span>), <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb103-75"><a href="figure-4.html#cb103-75" tabindex="-1"></a>  </span>
<span id="cb103-76"><a href="figure-4.html#cb103-76" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(statsAdj),<span class="at">value=</span>statsAdj)</span>
<span id="cb103-77"><a href="figure-4.html#cb103-77" tabindex="-1"></a>  </span>
<span id="cb103-78"><a href="figure-4.html#cb103-78" tabindex="-1"></a>  g3 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(dat,<span class="fu">aes</span>(name,value))<span class="sc">+</span></span>
<span id="cb103-79"><a href="figure-4.html#cb103-79" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,<span class="at">fill=</span><span class="st">&quot;gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb103-80"><a href="figure-4.html#cb103-80" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb103-81"><a href="figure-4.html#cb103-81" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb103-82"><a href="figure-4.html#cb103-82" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb103-83"><a href="figure-4.html#cb103-83" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">length</span>(statsAdj)<span class="sc">+</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb103-84"><a href="figure-4.html#cb103-84" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>), <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb103-85"><a href="figure-4.html#cb103-85" tabindex="-1"></a>  </span>
<span id="cb103-86"><a href="figure-4.html#cb103-86" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(g1,g2,g3),<span class="at">nrow=</span><span class="dv">3</span>,</span>
<span id="cb103-87"><a href="figure-4.html#cb103-87" tabindex="-1"></a>                           <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.2</span>,<span class="fl">0.5</span>),<span class="at">scale=</span><span class="dv">1</span>,</span>
<span id="cb103-88"><a href="figure-4.html#cb103-88" tabindex="-1"></a>                           <span class="at">align =</span><span class="st">&quot;v&quot;</span>,<span class="at">labels=</span><span class="fu">paste0</span>(<span class="st">&quot;OXIDATIVE_PHOSPHORYLATION&quot;</span>,<span class="st">&quot; pval=&quot;</span>,pval,<span class="st">&quot;;NES=&quot;</span>,nes),<span class="at">label_size =</span> <span class="dv">8</span>)</span>
<span id="cb103-89"><a href="figure-4.html#cb103-89" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="st">&quot;result/Figure4/S6K_GSEA_T_OXIDATIVE.pdf&quot;</span>,p1,<span class="at">width=</span><span class="dv">5</span>,<span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb103-90"><a href="figure-4.html#cb103-90" tabindex="-1"></a></span>
<span id="cb103-91"><a href="figure-4.html#cb103-91" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb103-92"><a href="figure-4.html#cb103-92" tabindex="-1"></a><span class="co">#  Step 2: Histone modifications</span></span>
<span id="cb103-93"><a href="figure-4.html#cb103-93" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb103-94"><a href="figure-4.html#cb103-94" tabindex="-1"></a><span class="do">## Load data</span></span>
<span id="cb103-95"><a href="figure-4.html#cb103-95" tabindex="-1"></a>gene_all <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure4/S6J_gene_T.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb103-96"><a href="figure-4.html#cb103-96" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb103-97"><a href="figure-4.html#cb103-97" tabindex="-1"></a></span>
<span id="cb103-98"><a href="figure-4.html#cb103-98" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">&quot;raw_data/histone.txt&quot;</span>)</span>
<span id="cb103-99"><a href="figure-4.html#cb103-99" tabindex="-1"></a>gmt <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(a, <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb103-100"><a href="figure-4.html#cb103-100" tabindex="-1"></a><span class="fu">names</span>(gmt) <span class="ot">&lt;-</span> <span class="fu">vapply</span>(gmt, <span class="cf">function</span>(y) y[<span class="dv">1</span>], <span class="fu">character</span>(<span class="dv">1</span>))</span>
<span id="cb103-101"><a href="figure-4.html#cb103-101" tabindex="-1"></a>gmt1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(gmt, <span class="st">&quot;[&quot;</span>, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span>
<span id="cb103-102"><a href="figure-4.html#cb103-102" tabindex="-1"></a></span>
<span id="cb103-103"><a href="figure-4.html#cb103-103" tabindex="-1"></a>a_temp <span class="ot">&lt;-</span> gene_all<span class="sc">$</span>logFC</span>
<span id="cb103-104"><a href="figure-4.html#cb103-104" tabindex="-1"></a><span class="fu">names</span>(a_temp) <span class="ot">&lt;-</span> gene_all<span class="sc">$</span>name</span>
<span id="cb103-105"><a href="figure-4.html#cb103-105" tabindex="-1"></a></span>
<span id="cb103-106"><a href="figure-4.html#cb103-106" tabindex="-1"></a><span class="do">##GSEA</span></span>
<span id="cb103-107"><a href="figure-4.html#cb103-107" tabindex="-1"></a>  Ranks_all <span class="ot">&lt;-</span> <span class="fu">sort</span>(a_temp,<span class="at">decreasing =</span><span class="cn">TRUE</span>)</span>
<span id="cb103-108"><a href="figure-4.html#cb103-108" tabindex="-1"></a>  gseaParam <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb103-109"><a href="figure-4.html#cb103-109" tabindex="-1"></a>  minSize<span class="ot">=</span><span class="dv">5</span></span>
<span id="cb103-110"><a href="figure-4.html#cb103-110" tabindex="-1"></a>  ticksSize <span class="ot">=</span> <span class="fl">0.2</span></span>
<span id="cb103-111"><a href="figure-4.html#cb103-111" tabindex="-1"></a>  Ranks_all <span class="ot">=</span> <span class="fu">sort</span>(a_temp,<span class="at">decreasing =</span><span class="cn">TRUE</span>)</span>
<span id="cb103-112"><a href="figure-4.html#cb103-112" tabindex="-1"></a>  fgseaRes_all <span class="ot">&lt;-</span> fgsea<span class="sc">::</span><span class="fu">fgsea</span>(gmt1, <span class="fu">sort</span>(a_temp,<span class="at">decreasing =</span><span class="cn">TRUE</span>),<span class="at">minSize =</span> minSize,<span class="at">nPermSimple=</span><span class="dv">20000</span>,<span class="at">gseaParam=</span><span class="fl">0.5</span>)</span>
<span id="cb103-113"><a href="figure-4.html#cb103-113" tabindex="-1"></a>  </span>
<span id="cb103-114"><a href="figure-4.html#cb103-114" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> fgseaRes_all <span class="sc">%&gt;%</span> </span>
<span id="cb103-115"><a href="figure-4.html#cb103-115" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(pval) <span class="sc">%&gt;%</span></span>
<span id="cb103-116"><a href="figure-4.html#cb103-116" tabindex="-1"></a>    <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb103-117"><a href="figure-4.html#cb103-117" tabindex="-1"></a>  nes <span class="ot">&lt;-</span> fgseaRes_all <span class="sc">%&gt;%</span> </span>
<span id="cb103-118"><a href="figure-4.html#cb103-118" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(NES) <span class="sc">%&gt;%</span></span>
<span id="cb103-119"><a href="figure-4.html#cb103-119" tabindex="-1"></a>    <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb103-120"><a href="figure-4.html#cb103-120" tabindex="-1"></a>  </span>
<span id="cb103-121"><a href="figure-4.html#cb103-121" tabindex="-1"></a>  pathway <span class="ot">&lt;-</span> gmt1[[<span class="dv">1</span>]]</span>
<span id="cb103-122"><a href="figure-4.html#cb103-122" tabindex="-1"></a>  </span>
<span id="cb103-123"><a href="figure-4.html#cb103-123" tabindex="-1"></a>  stats <span class="ot">&lt;-</span> Ranks_all</span>
<span id="cb103-124"><a href="figure-4.html#cb103-124" tabindex="-1"></a>  rnk <span class="ot">&lt;-</span> <span class="fu">rank</span>(<span class="sc">-</span>stats)</span>
<span id="cb103-125"><a href="figure-4.html#cb103-125" tabindex="-1"></a>  ord <span class="ot">&lt;-</span> <span class="fu">order</span>(rnk)</span>
<span id="cb103-126"><a href="figure-4.html#cb103-126" tabindex="-1"></a>  statsAdj <span class="ot">&lt;-</span> stats[ord]</span>
<span id="cb103-127"><a href="figure-4.html#cb103-127" tabindex="-1"></a>  statsAdj <span class="ot">&lt;-</span> <span class="fu">sign</span>(statsAdj) <span class="sc">*</span> (<span class="fu">abs</span>(statsAdj)<span class="sc">^</span>gseaParam)</span>
<span id="cb103-128"><a href="figure-4.html#cb103-128" tabindex="-1"></a>  statsAdj <span class="ot">&lt;-</span> statsAdj<span class="sc">/</span><span class="fu">max</span>(<span class="fu">abs</span>(statsAdj))</span>
<span id="cb103-129"><a href="figure-4.html#cb103-129" tabindex="-1"></a>  pathway <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">as.vector</span>(<span class="fu">na.omit</span>(<span class="fu">match</span>(pathway, <span class="fu">names</span>(statsAdj)))))</span>
<span id="cb103-130"><a href="figure-4.html#cb103-130" tabindex="-1"></a>  pathway <span class="ot">&lt;-</span> <span class="fu">sort</span>(pathway)</span>
<span id="cb103-131"><a href="figure-4.html#cb103-131" tabindex="-1"></a>  gseaRes <span class="ot">&lt;-</span> fgsea<span class="sc">::</span><span class="fu">calcGseaStat</span>(statsAdj, <span class="at">selectedStats =</span> pathway, </span>
<span id="cb103-132"><a href="figure-4.html#cb103-132" tabindex="-1"></a>                                 <span class="at">returnAllExtremes =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-133"><a href="figure-4.html#cb103-133" tabindex="-1"></a>  bottoms <span class="ot">&lt;-</span> gseaRes<span class="sc">$</span>bottoms</span>
<span id="cb103-134"><a href="figure-4.html#cb103-134" tabindex="-1"></a>  tops <span class="ot">&lt;-</span> gseaRes<span class="sc">$</span>tops</span>
<span id="cb103-135"><a href="figure-4.html#cb103-135" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(statsAdj)</span>
<span id="cb103-136"><a href="figure-4.html#cb103-136" tabindex="-1"></a>  xs <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">rbind</span>(pathway <span class="sc">-</span> <span class="dv">1</span>, pathway))</span>
<span id="cb103-137"><a href="figure-4.html#cb103-137" tabindex="-1"></a>  ys <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">rbind</span>(bottoms, tops))</span>
<span id="cb103-138"><a href="figure-4.html#cb103-138" tabindex="-1"></a>  toPlot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, xs, n <span class="sc">+</span> <span class="dv">1</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, ys, <span class="dv">0</span>))</span>
<span id="cb103-139"><a href="figure-4.html#cb103-139" tabindex="-1"></a>  diff <span class="ot">&lt;-</span> (<span class="fu">max</span>(tops) <span class="sc">-</span> <span class="fu">min</span>(bottoms))<span class="sc">/</span><span class="dv">8</span></span>
<span id="cb103-140"><a href="figure-4.html#cb103-140" tabindex="-1"></a>  x <span class="ot">=</span> y <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb103-141"><a href="figure-4.html#cb103-141" tabindex="-1"></a>  g1 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(toPlot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb103-142"><a href="figure-4.html#cb103-142" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;green&quot;</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span>  </span>
<span id="cb103-143"><a href="figure-4.html#cb103-143" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, </span>
<span id="cb103-144"><a href="figure-4.html#cb103-144" tabindex="-1"></a>                        <span class="at">colour =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-145"><a href="figure-4.html#cb103-145" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb103-146"><a href="figure-4.html#cb103-146" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb103-147"><a href="figure-4.html#cb103-147" tabindex="-1"></a>                   <span class="at">axis.text.x=</span>ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),<span class="at">axis.ticks.x=</span>ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb103-148"><a href="figure-4.html#cb103-148" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;enrichment score&quot;</span>,<span class="at">title=</span>)<span class="sc">+</span></span>
<span id="cb103-149"><a href="figure-4.html#cb103-149" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">length</span>(statsAdj)<span class="sc">+</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb103-150"><a href="figure-4.html#cb103-150" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">5</span>), <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb103-151"><a href="figure-4.html#cb103-151" tabindex="-1"></a>  </span>
<span id="cb103-152"><a href="figure-4.html#cb103-152" tabindex="-1"></a>  g2 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(toPlot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))<span class="sc">+</span></span>
<span id="cb103-153"><a href="figure-4.html#cb103-153" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_segment</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> pathway), </span>
<span id="cb103-154"><a href="figure-4.html#cb103-154" tabindex="-1"></a>                          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, </span>
<span id="cb103-155"><a href="figure-4.html#cb103-155" tabindex="-1"></a>                                        <span class="at">y =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> <span class="dv">1</span>),</span>
<span id="cb103-156"><a href="figure-4.html#cb103-156" tabindex="-1"></a>                          <span class="at">size =</span> ticksSize,<span class="at">color=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-157"><a href="figure-4.html#cb103-157" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">length</span>(statsAdj)<span class="sc">+</span><span class="dv">1</span>))<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb103-158"><a href="figure-4.html#cb103-158" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb103-159"><a href="figure-4.html#cb103-159" tabindex="-1"></a>                   <span class="at">axis.text.x=</span><span class="fu">element_blank</span>(),<span class="at">axis.ticks.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb103-160"><a href="figure-4.html#cb103-160" tabindex="-1"></a>                   <span class="at">axis.text.y=</span><span class="fu">element_blank</span>(),<span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb103-161"><a href="figure-4.html#cb103-161" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>,<span class="at">y=</span><span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb103-162"><a href="figure-4.html#cb103-162" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">5</span>), <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb103-163"><a href="figure-4.html#cb103-163" tabindex="-1"></a>  </span>
<span id="cb103-164"><a href="figure-4.html#cb103-164" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(statsAdj),<span class="at">value=</span>statsAdj)</span>
<span id="cb103-165"><a href="figure-4.html#cb103-165" tabindex="-1"></a>  </span>
<span id="cb103-166"><a href="figure-4.html#cb103-166" tabindex="-1"></a>  g3 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(dat,<span class="fu">aes</span>(name,value))<span class="sc">+</span></span>
<span id="cb103-167"><a href="figure-4.html#cb103-167" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,<span class="at">fill=</span><span class="st">&quot;gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb103-168"><a href="figure-4.html#cb103-168" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb103-169"><a href="figure-4.html#cb103-169" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb103-170"><a href="figure-4.html#cb103-170" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb103-171"><a href="figure-4.html#cb103-171" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">length</span>(statsAdj)<span class="sc">+</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb103-172"><a href="figure-4.html#cb103-172" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>), <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb103-173"><a href="figure-4.html#cb103-173" tabindex="-1"></a>  </span>
<span id="cb103-174"><a href="figure-4.html#cb103-174" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(g1,g2,g3),<span class="at">nrow=</span><span class="dv">3</span>,</span>
<span id="cb103-175"><a href="figure-4.html#cb103-175" tabindex="-1"></a>                           <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.2</span>,<span class="fl">0.5</span>),<span class="at">scale=</span><span class="dv">1</span>,</span>
<span id="cb103-176"><a href="figure-4.html#cb103-176" tabindex="-1"></a>                           <span class="at">align =</span><span class="st">&quot;v&quot;</span>,<span class="at">labels=</span><span class="fu">paste0</span>(<span class="st">&quot;histone&quot;</span>,<span class="st">&quot; pval=&quot;</span>,pval,<span class="st">&quot;;NES=&quot;</span>,nes),<span class="at">label_size =</span> <span class="dv">8</span>)</span>
<span id="cb103-177"><a href="figure-4.html#cb103-177" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="st">&quot;result/Figure4/S6L_GSEA_T_histone.pdf&quot;</span>,p1,<span class="at">width=</span><span class="dv">4</span>,<span class="at">height =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure4/S6K-L.png" width="666" style="display: block; margin: auto;" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="figure-3.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/18-Figure4.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
