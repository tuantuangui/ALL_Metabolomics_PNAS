<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 17 Figure 2 | ALL metabolism analysis</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 17 Figure 2 | ALL metabolism analysis" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 17 Figure 2 | ALL metabolism analysis" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Tuantuan Gui" />


<meta name="date" content="2024-12-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="figure-1.html"/>
<link rel="next" href="figure-3.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ALL Metabolimics PNAS</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> the ALL metabolism analysis</a></li>
<li class="chapter" data-level="2" data-path="serum-2020-data-preprocess.html"><a href="serum-2020-data-preprocess.html"><i class="fa fa-check"></i><b>2</b> serum: 2020 data preprocess</a>
<ul>
<li class="chapter" data-level="2.1" data-path="serum-2020-data-preprocess.html"><a href="serum-2020-data-preprocess.html#positive"><i class="fa fa-check"></i><b>2.1</b> positive</a></li>
<li class="chapter" data-level="2.2" data-path="serum-2020-data-preprocess.html"><a href="serum-2020-data-preprocess.html#negative"><i class="fa fa-check"></i><b>2.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="serum-2021-data-preprocess.html"><a href="serum-2021-data-preprocess.html"><i class="fa fa-check"></i><b>3</b> serum: 2021 data preprocess</a>
<ul>
<li class="chapter" data-level="3.1" data-path="serum-2021-data-preprocess.html"><a href="serum-2021-data-preprocess.html#positive-1"><i class="fa fa-check"></i><b>3.1</b> positive</a></li>
<li class="chapter" data-level="3.2" data-path="serum-2021-data-preprocess.html"><a href="serum-2021-data-preprocess.html#negative-1"><i class="fa fa-check"></i><b>3.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="serum-metid-data-anatation.html"><a href="serum-metid-data-anatation.html"><i class="fa fa-check"></i><b>4</b> serum: metID data anatation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="serum-metid-data-anatation.html"><a href="serum-metid-data-anatation.html#serum-2020"><i class="fa fa-check"></i><b>4.1</b> serum 2020</a></li>
<li class="chapter" data-level="4.2" data-path="serum-metid-data-anatation.html"><a href="serum-metid-data-anatation.html#serum-2021"><i class="fa fa-check"></i><b>4.2</b> serum 2021</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="serum-combine-data-from-ab-metid-and-metdna-of-serum-2020-and-serum-2021.html"><a href="serum-combine-data-from-ab-metid-and-metdna-of-serum-2020-and-serum-2021.html"><i class="fa fa-check"></i><b>5</b> serum: combine data from AB, metID and metDNA of serum 2020 and serum 2021</a></li>
<li class="chapter" data-level="6" data-path="serum-combine-data-from-positive-and-negative.html"><a href="serum-combine-data-from-positive-and-negative.html"><i class="fa fa-check"></i><b>6</b> serum: combine data from positive and negative</a></li>
<li class="chapter" data-level="7" data-path="serum-batch-effection-of-data-from-serum-2020-and-serum-2021-using-sva.html"><a href="serum-batch-effection-of-data-from-serum-2020-and-serum-2021-using-sva.html"><i class="fa fa-check"></i><b>7</b> serum: batch effection of data from serum 2020 and serum 2021 using sva</a></li>
<li class="chapter" data-level="8" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html"><i class="fa fa-check"></i><b>8</b> Cell: AB data process</a>
<ul>
<li class="chapter" data-level="8.1" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#filter-the-metabolites-too-much-na-and-impute-the-na"><i class="fa fa-check"></i><b>8.1</b> filter the metabolites (too much NA) and impute the NA</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#positive-2"><i class="fa fa-check"></i><b>8.1.1</b> positive</a></li>
<li class="chapter" data-level="8.1.2" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#negative-2"><i class="fa fa-check"></i><b>8.1.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#transform-the-metabolite-name-to-refmet-name"><i class="fa fa-check"></i><b>8.2</b> transform the metabolite name to refmet name</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#positive-3"><i class="fa fa-check"></i><b>8.2.1</b> positive</a></li>
<li class="chapter" data-level="8.2.2" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#negative-3"><i class="fa fa-check"></i><b>8.2.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#filter-the-metabolite-based-on-the-library-hit"><i class="fa fa-check"></i><b>8.3</b> filter the metabolite based on the library hit</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#positive-4"><i class="fa fa-check"></i><b>8.3.1</b> positive</a></li>
<li class="chapter" data-level="8.3.2" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#negative-4"><i class="fa fa-check"></i><b>8.3.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="cell-ab-data-process.html"><a href="cell-ab-data-process.html#filter-metabolite-by-manual-check"><i class="fa fa-check"></i><b>8.4</b> filter metabolite by manual check</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cell-annotation.html"><a href="cell-annotation.html"><i class="fa fa-check"></i><b>9</b> Cell: annotation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="cell-annotation.html"><a href="cell-annotation.html#metid"><i class="fa fa-check"></i><b>9.1</b> metID</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="cell-annotation.html"><a href="cell-annotation.html#positive-5"><i class="fa fa-check"></i><b>9.1.1</b> positive</a></li>
<li class="chapter" data-level="9.1.2" data-path="cell-annotation.html"><a href="cell-annotation.html#negative-5"><i class="fa fa-check"></i><b>9.1.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="cell-annotation.html"><a href="cell-annotation.html#metdna"><i class="fa fa-check"></i><b>9.2</b> metDNA</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="cell-annotation.html"><a href="cell-annotation.html#positive-6"><i class="fa fa-check"></i><b>9.2.1</b> positive</a></li>
<li class="chapter" data-level="9.2.2" data-path="cell-annotation.html"><a href="cell-annotation.html#negative-6"><i class="fa fa-check"></i><b>9.2.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="cell-annotation.html"><a href="cell-annotation.html#combine-the-data-from-metid-and-metdna"><i class="fa fa-check"></i><b>9.3</b> combine the data from metID and metDNA</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="cell-annotation.html"><a href="cell-annotation.html#positive-7"><i class="fa fa-check"></i><b>9.3.1</b> positive</a></li>
<li class="chapter" data-level="9.3.2" data-path="cell-annotation.html"><a href="cell-annotation.html#negative-7"><i class="fa fa-check"></i><b>9.3.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="cell-annotation.html"><a href="cell-annotation.html#transform-metabolite-name-to-refmet-name"><i class="fa fa-check"></i><b>9.4</b> transform metabolite name to refmet name</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="cell-annotation.html"><a href="cell-annotation.html#positive-8"><i class="fa fa-check"></i><b>9.4.1</b> positive</a></li>
<li class="chapter" data-level="9.4.2" data-path="cell-annotation.html"><a href="cell-annotation.html#negative-8"><i class="fa fa-check"></i><b>9.4.2</b> negative</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="cell-combine-the-data-from-ab-and-xcms.html"><a href="cell-combine-the-data-from-ab-and-xcms.html"><i class="fa fa-check"></i><b>10</b> Cell: combine the data from AB and xcms</a>
<ul>
<li class="chapter" data-level="10.1" data-path="cell-combine-the-data-from-ab-and-xcms.html"><a href="cell-combine-the-data-from-ab-and-xcms.html#combine-the-data-from-ab-and-xcms"><i class="fa fa-check"></i><b>10.1</b> combine the data from AB and xcms</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="cell-combine-the-data-from-ab-and-xcms.html"><a href="cell-combine-the-data-from-ab-and-xcms.html#positive-9"><i class="fa fa-check"></i><b>10.1.1</b> positive</a></li>
<li class="chapter" data-level="10.1.2" data-path="cell-combine-the-data-from-ab-and-xcms.html"><a href="cell-combine-the-data-from-ab-and-xcms.html#negative-9"><i class="fa fa-check"></i><b>10.1.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="cell-combine-the-data-from-ab-and-xcms.html"><a href="cell-combine-the-data-from-ab-and-xcms.html#transform-the-format-to-serrf"><i class="fa fa-check"></i><b>10.2</b> transform the format to serrf</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="cell-combine-the-data-from-ab-and-xcms.html"><a href="cell-combine-the-data-from-ab-and-xcms.html#positive-10"><i class="fa fa-check"></i><b>10.2.1</b> positive</a></li>
<li class="chapter" data-level="10.2.2" data-path="cell-combine-the-data-from-ab-and-xcms.html"><a href="cell-combine-the-data-from-ab-and-xcms.html#negative-10"><i class="fa fa-check"></i><b>10.2.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="cell-combine-the-data-from-ab-and-xcms.html"><a href="cell-combine-the-data-from-ab-and-xcms.html#rsd"><i class="fa fa-check"></i><b>10.3</b> RSD</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="cell-combine-positive.html"><a href="cell-combine-positive.html"><i class="fa fa-check"></i><b>11</b> Cell: combine positive</a></li>
<li class="chapter" data-level="12" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html"><i class="fa fa-check"></i><b>12</b> Cell: metabolite info</a>
<ul>
<li class="chapter" data-level="12.1" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#ab"><i class="fa fa-check"></i><b>12.1</b> AB</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#positive-11"><i class="fa fa-check"></i><b>12.1.1</b> positive</a></li>
<li class="chapter" data-level="12.1.2" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#negative-11"><i class="fa fa-check"></i><b>12.1.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#metid-1"><i class="fa fa-check"></i><b>12.2</b> metID</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#positive-12"><i class="fa fa-check"></i><b>12.2.1</b> positive</a></li>
<li class="chapter" data-level="12.2.2" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#negative-12"><i class="fa fa-check"></i><b>12.2.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#metdna-1"><i class="fa fa-check"></i><b>12.3</b> metDNA</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#positive-13"><i class="fa fa-check"></i><b>12.3.1</b> positive</a></li>
<li class="chapter" data-level="12.3.2" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#negative-13"><i class="fa fa-check"></i><b>12.3.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#combine-the-data-from-abmetid-and-metdna"><i class="fa fa-check"></i><b>12.4</b> combine the data from AB,metID and metDNA</a></li>
<li class="chapter" data-level="12.5" data-path="cell-metabolite-info.html"><a href="cell-metabolite-info.html#compare-with-the-local-cas-id"><i class="fa fa-check"></i><b>12.5</b> compare with the local CAS ID</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="cell-qc.html"><a href="cell-qc.html"><i class="fa fa-check"></i><b>13</b> Cell: QC</a>
<ul>
<li class="chapter" data-level="13.1" data-path="cell-qc.html"><a href="cell-qc.html#pca"><i class="fa fa-check"></i><b>13.1</b> PCA</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="cell-qc.html"><a href="cell-qc.html#positive-14"><i class="fa fa-check"></i><b>13.1.1</b> positive</a></li>
<li class="chapter" data-level="13.1.2" data-path="cell-qc.html"><a href="cell-qc.html#negative-14"><i class="fa fa-check"></i><b>13.1.2</b> negative</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="cell-qc.html"><a href="cell-qc.html#the-distribution-of-every-metabolite"><i class="fa fa-check"></i><b>13.2</b> the distribution of every metabolite</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="cell-qc.html"><a href="cell-qc.html#positive-15"><i class="fa fa-check"></i><b>13.2.1</b> positive</a></li>
<li class="chapter" data-level="13.2.2" data-path="cell-qc.html"><a href="cell-qc.html#negative-15"><i class="fa fa-check"></i><b>13.2.2</b> negative</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="cell-filter-metabolites-and-samples.html"><a href="cell-filter-metabolites-and-samples.html"><i class="fa fa-check"></i><b>14</b> Cell: filter metabolites and samples</a>
<ul>
<li class="chapter" data-level="14.1" data-path="cell-filter-metabolites-and-samples.html"><a href="cell-filter-metabolites-and-samples.html#filter-out-c053"><i class="fa fa-check"></i><b>14.1</b> filter out C053</a></li>
<li class="chapter" data-level="14.2" data-path="cell-filter-metabolites-and-samples.html"><a href="cell-filter-metabolites-and-samples.html#filter-compound"><i class="fa fa-check"></i><b>14.2</b> filter compound</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="cell-filter-metabolites-and-samples.html"><a href="cell-filter-metabolites-and-samples.html#filter-compound-in-2023.11.08"><i class="fa fa-check"></i><b>14.2.1</b> filter compound in 2023.11.08</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="cell-rsd.html"><a href="cell-rsd.html"><i class="fa fa-check"></i><b>15</b> Cell: RSD</a>
<ul>
<li class="chapter" data-level="15.1" data-path="cell-rsd.html"><a href="cell-rsd.html#after"><i class="fa fa-check"></i><b>15.1</b> after</a></li>
<li class="chapter" data-level="15.2" data-path="cell-rsd.html"><a href="cell-rsd.html#rsd-1"><i class="fa fa-check"></i><b>15.2</b> RSD</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="figure-1.html"><a href="figure-1.html"><i class="fa fa-check"></i><b>16</b> Figure 1</a>
<ul>
<li class="chapter" data-level="16.1" data-path="figure-1.html"><a href="figure-1.html#b-annotated-metabolites"><i class="fa fa-check"></i><b>16.1</b> (B) Annotated metabolites</a></li>
<li class="chapter" data-level="16.2" data-path="figure-1.html"><a href="figure-1.html#c-comprehensive-metabolome-overview"><i class="fa fa-check"></i><b>16.2</b> (C) Comprehensive metabolome overview</a></li>
<li class="chapter" data-level="16.3" data-path="figure-1.html"><a href="figure-1.html#s1-a-clinical-characteristics"><i class="fa fa-check"></i><b>16.3</b> (S1 A) Clinical characteristics</a></li>
<li class="chapter" data-level="16.4" data-path="figure-1.html"><a href="figure-1.html#s1-b-venn-plot"><i class="fa fa-check"></i><b>16.4</b> (S1 B) Venn plot</a></li>
<li class="chapter" data-level="16.5" data-path="figure-1.html"><a href="figure-1.html#s1-c-waterfall-plot"><i class="fa fa-check"></i><b>16.5</b> (S1 C) Waterfall plot</a></li>
<li class="chapter" data-level="16.6" data-path="figure-1.html"><a href="figure-1.html#s1-d-scatter-plot"><i class="fa fa-check"></i><b>16.6</b> (S1 D) Scatter plot</a></li>
<li class="chapter" data-level="16.7" data-path="figure-1.html"><a href="figure-1.html#s2-a-pca"><i class="fa fa-check"></i><b>16.7</b> (S2 A) PCA</a></li>
<li class="chapter" data-level="16.8" data-path="figure-1.html"><a href="figure-1.html#s2-b-volcano-plot"><i class="fa fa-check"></i><b>16.8</b> (S2 B) Volcano Plot</a></li>
<li class="chapter" data-level="16.9" data-path="figure-1.html"><a href="figure-1.html#s2-c-msea"><i class="fa fa-check"></i><b>16.9</b> (S2 C) MSEA</a></li>
<li class="chapter" data-level="16.10" data-path="figure-1.html"><a href="figure-1.html#s2-d-ageing-related-metabolites"><i class="fa fa-check"></i><b>16.10</b> (S2 D) Ageing-related metabolites</a></li>
<li class="chapter" data-level="16.11" data-path="figure-1.html"><a href="figure-1.html#s2-e-box-plot"><i class="fa fa-check"></i><b>16.11</b> (S2 E) Box plot</a></li>
<li class="chapter" data-level="16.12" data-path="figure-1.html"><a href="figure-1.html#s2-f-overall-survival-analysis"><i class="fa fa-check"></i><b>16.12</b> (S2 F) Overall Survival analysis</a></li>
<li class="chapter" data-level="16.13" data-path="figure-1.html"><a href="figure-1.html#s2-g-box-plot"><i class="fa fa-check"></i><b>16.13</b> (S2 G) Box plot</a></li>
<li class="chapter" data-level="16.14" data-path="figure-1.html"><a href="figure-1.html#s2-h-metabolism-set-enrichment-analysis"><i class="fa fa-check"></i><b>16.14</b> (S2 H) Metabolism Set Enrichment Analysis</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="figure-2.html"><a href="figure-2.html"><i class="fa fa-check"></i><b>17</b> Figure 2</a>
<ul>
<li class="chapter" data-level="17.1" data-path="figure-2.html"><a href="figure-2.html#a-3d-pca"><i class="fa fa-check"></i><b>17.1</b> (A) 3D PCA</a></li>
<li class="chapter" data-level="17.2" data-path="figure-2.html"><a href="figure-2.html#b-all-vs-hc"><i class="fa fa-check"></i><b>17.2</b> (B) ALL vs HC</a></li>
<li class="chapter" data-level="17.3" data-path="figure-2.html"><a href="figure-2.html#c-intracellular-metabolome-landscape"><i class="fa fa-check"></i><b>17.3</b> (C) Intracellular Metabolome Landscape</a></li>
<li class="chapter" data-level="17.4" data-path="figure-2.html"><a href="figure-2.html#e-bcp-all-vs-t-all"><i class="fa fa-check"></i><b>17.4</b> (E) BCP-ALL vs T-ALL</a></li>
<li class="chapter" data-level="17.5" data-path="figure-2.html"><a href="figure-2.html#s3-a-correlation-within-bmmc-samples"><i class="fa fa-check"></i><b>17.5</b> (S3 A) Correlation Within BMMC Samples</a></li>
<li class="chapter" data-level="17.6" data-path="figure-2.html"><a href="figure-2.html#s3-b-correlation-between-hc-pmmc-and-all-bmmc-mrd-"><i class="fa fa-check"></i><b>17.6</b> (S3 B) Correlation Between HC PMMC And ALL BMMC MRD-</a></li>
<li class="chapter" data-level="17.7" data-path="figure-2.html"><a href="figure-2.html#s3-c-correlation-between-bmmc-and-pbmc"><i class="fa fa-check"></i><b>17.7</b> (S3 C) Correlation Between BMMC And PBMC</a></li>
<li class="chapter" data-level="17.8" data-path="figure-2.html"><a href="figure-2.html#s3-d-differential-analyses"><i class="fa fa-check"></i><b>17.8</b> (S3 D) Differential Analyses</a></li>
<li class="chapter" data-level="17.9" data-path="figure-2.html"><a href="figure-2.html#s3-e-volcano-plot-of-bmmc-d0-vs.-mrd-"><i class="fa fa-check"></i><b>17.9</b> (S3 E) Volcano Plot of BMMC-D0 vs. MRD-</a></li>
<li class="chapter" data-level="17.10" data-path="figure-2.html"><a href="figure-2.html#s3-f-abundance-boxplot"><i class="fa fa-check"></i><b>17.10</b> (S3 F) Abundance Boxplot</a></li>
<li class="chapter" data-level="17.11" data-path="figure-2.html"><a href="figure-2.html#s3-g-wgcna"><i class="fa fa-check"></i><b>17.11</b> (S3 G) WGCNA</a></li>
<li class="chapter" data-level="17.12" data-path="figure-2.html"><a href="figure-2.html#s3-h-bar-plot"><i class="fa fa-check"></i><b>17.12</b> (S3 H) bar plot</a></li>
<li class="chapter" data-level="17.13" data-path="figure-2.html"><a href="figure-2.html#s3-i-venn-diagram"><i class="fa fa-check"></i><b>17.13</b> (S3 I) Venn Diagram</a></li>
<li class="chapter" data-level="17.14" data-path="figure-2.html"><a href="figure-2.html#s3-j-boxplot"><i class="fa fa-check"></i><b>17.14</b> (S3 J) Boxplot</a></li>
<li class="chapter" data-level="17.15" data-path="figure-2.html"><a href="figure-2.html#s3-k-pathway-based-analysis"><i class="fa fa-check"></i><b>17.15</b> (S3 K) Pathway-based Analysis</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="figure-3.html"><a href="figure-3.html"><i class="fa fa-check"></i><b>18</b> Figure 3</a>
<ul>
<li class="chapter" data-level="18.1" data-path="figure-3.html"><a href="figure-3.html#a-gsva-scores-for-metabolic-pathways"><i class="fa fa-check"></i><b>18.1</b> (A) GSVA Scores for Metabolic Pathways</a></li>
<li class="chapter" data-level="18.2" data-path="figure-3.html"><a href="figure-3.html#b-mutations-and-metabolites"><i class="fa fa-check"></i><b>18.2</b> (B) Mutations and Metabolites</a></li>
<li class="chapter" data-level="18.3" data-path="figure-3.html"><a href="figure-3.html#c-idh12-and-etv6-mutations"><i class="fa fa-check"></i><b>18.3</b> (C) IDH1/2 and ETV6 Mutations</a></li>
<li class="chapter" data-level="18.4" data-path="figure-3.html"><a href="figure-3.html#d-fusions-and-metabolites"><i class="fa fa-check"></i><b>18.4</b> (D) Fusions and Metabolites</a></li>
<li class="chapter" data-level="18.5" data-path="figure-3.html"><a href="figure-3.html#e-bcr-abl1-fusion"><i class="fa fa-check"></i><b>18.5</b> (E) BCR-ABL1 Fusion</a></li>
<li class="chapter" data-level="18.6" data-path="figure-3.html"><a href="figure-3.html#s4-a-metabolic-gene-heatmap"><i class="fa fa-check"></i><b>18.6</b> (S4 A) Metabolic Gene Heatmap</a></li>
<li class="chapter" data-level="18.7" data-path="figure-3.html"><a href="figure-3.html#s4-b-correlation-within-bmmc-samples"><i class="fa fa-check"></i><b>18.7</b> (S4 B) Correlation Within BMMC Samples</a></li>
<li class="chapter" data-level="18.8" data-path="figure-3.html"><a href="figure-3.html#s4-c-correlation-of-mrna-expression-of-metabolic-genes"><i class="fa fa-check"></i><b>18.8</b> (S4 C) Correlation of mRNA Expression of Metabolic Genes</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="figure-4.html"><a href="figure-4.html"><i class="fa fa-check"></i><b>19</b> Figure 4</a>
<ul>
<li class="chapter" data-level="19.1" data-path="figure-4.html"><a href="figure-4.html#a-schematic-workflow"><i class="fa fa-check"></i><b>19.1</b> (A) Schematic Workflow</a></li>
<li class="chapter" data-level="19.2" data-path="figure-4.html"><a href="figure-4.html#b-discrimination-of-bcp-all-clusters"><i class="fa fa-check"></i><b>19.2</b> (B) Discrimination of BCP-ALL Clusters</a></li>
<li class="chapter" data-level="19.3" data-path="figure-4.html"><a href="figure-4.html#c-os-in-75-bcp-all-patients"><i class="fa fa-check"></i><b>19.3</b> (C) OS in 75 BCP-ALL patients</a></li>
<li class="chapter" data-level="19.4" data-path="figure-4.html"><a href="figure-4.html#d-multivariate-cox-analysis"><i class="fa fa-check"></i><b>19.4</b> (D) Multivariate Cox Analysis</a></li>
<li class="chapter" data-level="19.5" data-path="figure-4.html"><a href="figure-4.html#e-subnetwork-between-bc3-and-bc12"><i class="fa fa-check"></i><b>19.5</b> (E) Subnetwork between BC3 and BC1/2</a></li>
<li class="chapter" data-level="19.6" data-path="figure-4.html"><a href="figure-4.html#f-discrimination-of-t-all-clusters"><i class="fa fa-check"></i><b>19.6</b> (F) Discrimination of T-ALL Clusters</a></li>
<li class="chapter" data-level="19.7" data-path="figure-4.html"><a href="figure-4.html#g-os-of-tc12"><i class="fa fa-check"></i><b>19.7</b> (G) OS of TC1/2</a></li>
<li class="chapter" data-level="19.8" data-path="figure-4.html"><a href="figure-4.html#h-subnetwork-between-tc2-and-tc1"><i class="fa fa-check"></i><b>19.8</b> (H) Subnetwork between TC2 and TC1</a></li>
<li class="chapter" data-level="19.9" data-path="figure-4.html"><a href="figure-4.html#s5-a-clusters-of-bcp-all"><i class="fa fa-check"></i><b>19.9</b> (S5 A) Clusters of BCP-ALL</a></li>
<li class="chapter" data-level="19.10" data-path="figure-4.html"><a href="figure-4.html#s5-e-waterfall-plot-of-bc123"><i class="fa fa-check"></i><b>19.10</b> (S5 E) Waterfall plot of BC1/2/3</a></li>
<li class="chapter" data-level="19.11" data-path="figure-4.html"><a href="figure-4.html#s5-h-da-score-of-bc3-cluster"><i class="fa fa-check"></i><b>19.11</b> (S5 H) DA-score of BC3 cluster</a></li>
<li class="chapter" data-level="19.12" data-path="figure-4.html"><a href="figure-4.html#s5-i-j-msea-of-bc123"><i class="fa fa-check"></i><b>19.12</b> (S5 I-J) MSEA of BC1/2/3</a></li>
<li class="chapter" data-level="19.13" data-path="figure-4.html"><a href="figure-4.html#s6-a-clusters-of-t-all"><i class="fa fa-check"></i><b>19.13</b> (S6 A) Clusters of T-ALL</a></li>
<li class="chapter" data-level="19.14" data-path="figure-4.html"><a href="figure-4.html#s6-e-f-rfs-and-efs-of-tc12"><i class="fa fa-check"></i><b>19.14</b> (S6 E-F) RFS and EFS of TC1/2</a></li>
<li class="chapter" data-level="19.15" data-path="figure-4.html"><a href="figure-4.html#s6-h-multivariate-cox-analysis-of-tc12"><i class="fa fa-check"></i><b>19.15</b> (S6 H) Multivariate Cox Analysis of TC1/2</a></li>
<li class="chapter" data-level="19.16" data-path="figure-4.html"><a href="figure-4.html#s6-i-heatmap-of-tc12"><i class="fa fa-check"></i><b>19.16</b> (S6 I) Heatmap of TC1/2</a></li>
<li class="chapter" data-level="19.17" data-path="figure-4.html"><a href="figure-4.html#s6-j-da-score-of-tc12"><i class="fa fa-check"></i><b>19.17</b> (S6 J) DA score of TC1/2</a></li>
<li class="chapter" data-level="19.18" data-path="figure-4.html"><a href="figure-4.html#s6-k-l-msea-of-tc12"><i class="fa fa-check"></i><b>19.18</b> (S6 K-L) MSEA of TC1/2</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank"></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">ALL metabolism analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="figure-2" class="section level1 hasAnchor" number="17">
<h1><span class="header-section-number">Chapter 17</span> Figure 2<a href="figure-2.html#figure-2" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><img src="Figure-1025/2_Figure2.png" width="1159" style="display: block; margin: auto;" /></p>
<p><strong>Figure 2: Intracellular metabolome reveals aberrant metabolic profiles underlying the pathogenesis of ALL.</strong></p>
<p>A. PCA of intracellular samples from all groups (n=127) reveals a plane (depicted schematically in gray) that distinguishes most cases of the ALL groups from the control (HC PBMC and ALL BMMC MRD-) group.</p>
<p>B. The DA score reveals the enrichment of metabolism pathways (each row) linked to ALL-associated metabolites, and captures the average gross changes for all metabolites in a pathway. A score 1 or −1 indicates that all measured metabolites in the pathway are increased or decreased in the ALL compared to HC samples. Here pathways containing no less than three measured metabolites with fold change of 1.2 and filtered by P &lt; 0.05 were used for DA score calculation. Activity levels of pathway are color coded: pink for upregulated, green for downregulated, otherwise colored in brown.</p>
<p>C. The intracellular metabolome landscape reveals that most disturbed metabolites were upregulated in ALL, consistent with the data in Extended Data Fig. 3d-e; and the profile within the two groups is consistent with panel (a). The columns represent samples, and rows represent metabolites, with highlighted metabolites in Extended Data Fig. 3f. FMN: Flavin Mononucleotide; DHAP: Dihydroxyacetone Phosphate; NMN: Nicotinamide Mononucleotide; F-1,6-BP: Fructose 1,6−bisphosphate; G-1-P: Glucose 1−Phosphate; sn−Gly−3-P: sn−Glycero−3−phosphat.</p>
<p>D. A simplified schematic plot illustrates the globally upregulated metabolism pathways in ALL blasts.</p>
<p>E. A specific comparison between BCP-ALL and T-ALL cases elucidates the pathways enriched with significantly differential metabolites. The colors represent metabolic pathway categories and the size of each circle reflects the quantity of measured metabolites in indicated pathway.</p>
<div id="a-3d-pca" class="section level2 hasAnchor" number="17.1">
<h2><span class="header-section-number">17.1</span> (A) 3D PCA<a href="figure-2.html#a-3d-pca" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>PCA of intracellular samples from all groups (n=127) reveals a plane (depicted schematically in gray) that distinguishes most cases of the ALL groups from the control (HC PBMC and ALL BMMC MRD-) group.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="figure-2.html#cb63-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb63-2"><a href="figure-2.html#cb63-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb63-3"><a href="figure-2.html#cb63-3" tabindex="-1"></a><span class="fu">library</span>(scatterplot3d)</span>
<span id="cb63-4"><a href="figure-2.html#cb63-4" tabindex="-1"></a></span>
<span id="cb63-5"><a href="figure-2.html#cb63-5" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb63-6"><a href="figure-2.html#cb63-6" tabindex="-1"></a><span class="co">#  Step 1: Load data and set parameters</span></span>
<span id="cb63-7"><a href="figure-2.html#cb63-7" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb63-8"><a href="figure-2.html#cb63-8" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-9"><a href="figure-2.html#cb63-9" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-10"><a href="figure-2.html#cb63-10" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-11"><a href="figure-2.html#cb63-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">RJ-19058_METc_BM_MRD-</span><span class="st">`</span>))</span>
<span id="cb63-12"><a href="figure-2.html#cb63-12" tabindex="-1"></a></span>
<span id="cb63-13"><a href="figure-2.html#cb63-13" tabindex="-1"></a>sample_lineage <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-14"><a href="figure-2.html#cb63-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Pid,Lineage) <span class="sc">%&gt;%</span></span>
<span id="cb63-15"><a href="figure-2.html#cb63-15" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb63-16"><a href="figure-2.html#cb63-16" tabindex="-1"></a></span>
<span id="cb63-17"><a href="figure-2.html#cb63-17" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sample=</span><span class="fu">names</span>(dat)) <span class="sc">%&gt;%</span></span>
<span id="cb63-18"><a href="figure-2.html#cb63-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">type=</span><span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;METc_BM_D0&quot;</span>,sample),<span class="st">&quot;BM_D0&quot;</span>,</span>
<span id="cb63-19"><a href="figure-2.html#cb63-19" tabindex="-1"></a>                     <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;METc_PB_D0&quot;</span>,sample),<span class="st">&quot;ALL PBMC&quot;</span>,</span>
<span id="cb63-20"><a href="figure-2.html#cb63-20" tabindex="-1"></a>                     <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;H&quot;</span>,sample),<span class="st">&quot;HC PBMC&quot;</span>,</span>
<span id="cb63-21"><a href="figure-2.html#cb63-21" tabindex="-1"></a>                     <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;METc_BM_MRD&quot;</span>,sample),<span class="st">&quot;MRD-&quot;</span>,sample))))) <span class="sc">%&gt;%</span></span>
<span id="cb63-22"><a href="figure-2.html#cb63-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Pid=</span>sample) <span class="sc">%&gt;%</span></span>
<span id="cb63-23"><a href="figure-2.html#cb63-23" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate</span>(Pid,<span class="at">sep=</span><span class="st">&quot;_&quot;</span>,<span class="st">&quot;Pid&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-24"><a href="figure-2.html#cb63-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(sample_lineage,<span class="at">by=</span><span class="st">&quot;Pid&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-25"><a href="figure-2.html#cb63-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">type=</span><span class="fu">ifelse</span>(type<span class="sc">==</span><span class="st">&quot;BM_D0&quot;</span>,Lineage,type))</span>
<span id="cb63-26"><a href="figure-2.html#cb63-26" tabindex="-1"></a></span>
<span id="cb63-27"><a href="figure-2.html#cb63-27" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb63-28"><a href="figure-2.html#cb63-28" tabindex="-1"></a><span class="co">#  Step 2: 3D PCA</span></span>
<span id="cb63-29"><a href="figure-2.html#cb63-29" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb63-30"><a href="figure-2.html#cb63-30" tabindex="-1"></a>dd_pca <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb63-31"><a href="figure-2.html#cb63-31" tabindex="-1"></a>  <span class="fu">log1p</span>()</span>
<span id="cb63-32"><a href="figure-2.html#cb63-32" tabindex="-1"></a></span>
<span id="cb63-33"><a href="figure-2.html#cb63-33" tabindex="-1"></a>pca <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">prcomp</span>(<span class="fu">t</span>(dd_pca), <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-34"><a href="figure-2.html#cb63-34" tabindex="-1"></a>variance <span class="ot">=</span> pca<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fu">sum</span>(pca<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb63-35"><a href="figure-2.html#cb63-35" tabindex="-1"></a>pca.data <span class="ot">=</span> <span class="fu">data.frame</span>(pca<span class="sc">$</span>x,<span class="at">group=</span>sample_info<span class="sc">$</span>type,<span class="at">label=</span><span class="fu">rownames</span>(pca<span class="sc">$</span>x))</span>
<span id="cb63-36"><a href="figure-2.html#cb63-36" tabindex="-1"></a></span>
<span id="cb63-37"><a href="figure-2.html#cb63-37" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pca.data,<span class="fu">aes</span>(PC1,PC2,<span class="at">color=</span>group))<span class="sc">+</span></span>
<span id="cb63-38"><a href="figure-2.html#cb63-38" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb63-39"><a href="figure-2.html#cb63-39" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb63-40"><a href="figure-2.html#cb63-40" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>( <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="fl">0.5</span>,<span class="at">level=</span><span class="fl">0.9</span>)<span class="sc">+</span></span>
<span id="cb63-41"><a href="figure-2.html#cb63-41" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb63-42"><a href="figure-2.html#cb63-42" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="fu">paste0</span>(<span class="st">&quot;PC1 (&quot;</span>,<span class="fu">signif</span>(variance[<span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>,<span class="dv">3</span>),<span class="st">&quot;%)&quot;</span>),</span>
<span id="cb63-43"><a href="figure-2.html#cb63-43" tabindex="-1"></a>                <span class="at">y=</span><span class="fu">paste0</span>(<span class="st">&quot;PC2 (&quot;</span>,<span class="fu">signif</span>(variance[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">100</span>,<span class="dv">3</span>),<span class="st">&quot;%)&quot;</span>))</span>
<span id="cb63-44"><a href="figure-2.html#cb63-44" tabindex="-1"></a></span>
<span id="cb63-45"><a href="figure-2.html#cb63-45" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;result/Figure2/2A_3Dpca.pdf&quot;</span>,<span class="at">width=</span><span class="dv">13</span>,<span class="at">height =</span> <span class="dv">13</span>)</span>
<span id="cb63-46"><a href="figure-2.html#cb63-46" tabindex="-1"></a>col1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#BE1E2D&quot;</span>,<span class="st">&quot;#E5E059&quot;</span>,<span class="st">&quot;#006838&quot;</span>,<span class="st">&quot;#007DDB&quot;</span>,<span class="st">&quot;#4B0082&quot;</span>) <span class="co"># B T</span></span>
<span id="cb63-47"><a href="figure-2.html#cb63-47" tabindex="-1"></a>sample_info<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(sample_info<span class="sc">$</span>type)</span>
<span id="cb63-48"><a href="figure-2.html#cb63-48" tabindex="-1"></a>colors <span class="ot">&lt;-</span> col1[<span class="fu">as.numeric</span>(sample_info<span class="sc">$</span>type)]</span>
<span id="cb63-49"><a href="figure-2.html#cb63-49" tabindex="-1"></a></span>
<span id="cb63-50"><a href="figure-2.html#cb63-50" tabindex="-1"></a><span class="fu">scatterplot3d</span>(pca.data[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>)],<span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex.symbols =</span> <span class="dv">2</span>, </span>
<span id="cb63-51"><a href="figure-2.html#cb63-51" tabindex="-1"></a>              <span class="at">scale.y =</span> <span class="fl">0.7</span>, <span class="at">angle =</span> <span class="dv">45</span>,</span>
<span id="cb63-52"><a href="figure-2.html#cb63-52" tabindex="-1"></a>              <span class="at">col.axis =</span> <span class="st">&quot;#444444&quot;</span>, <span class="at">col.grid =</span> <span class="st">&quot;#CCCCCC&quot;</span>, <span class="at">color=</span>colors)</span>
<span id="cb63-53"><a href="figure-2.html#cb63-53" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">legend =</span> <span class="fu">levels</span>(sample_info<span class="sc">$</span>type),</span>
<span id="cb63-54"><a href="figure-2.html#cb63-54" tabindex="-1"></a>       <span class="at">col =</span>  <span class="fu">c</span>(<span class="st">&quot;#BE1E2D&quot;</span>,<span class="st">&quot;#E5E059&quot;</span>,<span class="st">&quot;#006838&quot;</span>,<span class="st">&quot;#007DDB&quot;</span>,<span class="st">&quot;#4B0082&quot;</span>),</span>
<span id="cb63-55"><a href="figure-2.html#cb63-55" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">xpd =</span> <span class="cn">TRUE</span>,<span class="at">horiz =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-56"><a href="figure-2.html#cb63-56" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p><img src="Figure-1025/Figure2/2A.png" width="532" style="display: block; margin: auto;" /></p>
</div>
<div id="b-all-vs-hc" class="section level2 hasAnchor" number="17.2">
<h2><span class="header-section-number">17.2</span> (B) ALL vs HC<a href="figure-2.html#b-all-vs-hc" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <strong>DA score</strong> reveals the enrichment of metabolism pathways (each row) linked to ALL-associated metabolites, and captures the average gross changes for all metabolites in a pathway. A score 1 or −1 indicates that all measured metabolites in the pathway are increased or decreased in the ALL compared to HC samples. Here pathways containing no less than three measured metabolites with fold change of 1.2 and filtered by P &lt; 0.05 were used for DA score calculation. Activity levels of pathway are color coded: pink for upregulated and green for downregulated. For detailed information of the metabolites, please refer to Supplementary Table 12.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="figure-2.html#cb64-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb64-2"><a href="figure-2.html#cb64-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb64-3"><a href="figure-2.html#cb64-3" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb64-4"><a href="figure-2.html#cb64-4" tabindex="-1"></a><span class="fu">library</span>(ComplexHeatmap)</span>
<span id="cb64-5"><a href="figure-2.html#cb64-5" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb64-6"><a href="figure-2.html#cb64-6" tabindex="-1"></a></span>
<span id="cb64-7"><a href="figure-2.html#cb64-7" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb64-8"><a href="figure-2.html#cb64-8" tabindex="-1"></a><span class="co">#  Step 1: Load data and set parameters</span></span>
<span id="cb64-9"><a href="figure-2.html#cb64-9" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb64-10"><a href="figure-2.html#cb64-10" tabindex="-1"></a>sample_info_temp <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-11"><a href="figure-2.html#cb64-11" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb64-12"><a href="figure-2.html#cb64-12" tabindex="-1"></a>sample_info_1 <span class="ot">&lt;-</span> sample_info_temp <span class="sc">%&gt;%</span></span>
<span id="cb64-13"><a href="figure-2.html#cb64-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(METc_BM_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb64-14"><a href="figure-2.html#cb64-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(METc_BM_D0_ID) <span class="sc">%&gt;%</span></span>
<span id="cb64-15"><a href="figure-2.html#cb64-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;id&quot;</span><span class="ot">=</span><span class="st">&quot;METc_BM_D0_ID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-16"><a href="figure-2.html#cb64-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id)</span>
<span id="cb64-17"><a href="figure-2.html#cb64-17" tabindex="-1"></a>sample_info_2 <span class="ot">&lt;-</span> sample_info_temp <span class="sc">%&gt;%</span></span>
<span id="cb64-18"><a href="figure-2.html#cb64-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(METc_PB_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb64-19"><a href="figure-2.html#cb64-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;id&quot;</span><span class="ot">=</span><span class="st">&quot;METc_PB_D0_ID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-20"><a href="figure-2.html#cb64-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id)</span>
<span id="cb64-21"><a href="figure-2.html#cb64-21" tabindex="-1"></a></span>
<span id="cb64-22"><a href="figure-2.html#cb64-22" tabindex="-1"></a>sample_info_1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(sample_info_1,sample_info_2)</span>
<span id="cb64-23"><a href="figure-2.html#cb64-23" tabindex="-1"></a></span>
<span id="cb64-24"><a href="figure-2.html#cb64-24" tabindex="-1"></a>dat_filter <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-25"><a href="figure-2.html#cb64-25" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-26"><a href="figure-2.html#cb64-26" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-27"><a href="figure-2.html#cb64-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample_info_1<span class="sc">$</span>id,<span class="fu">starts_with</span>(<span class="st">&quot;H&quot;</span>))</span>
<span id="cb64-28"><a href="figure-2.html#cb64-28" tabindex="-1"></a></span>
<span id="cb64-29"><a href="figure-2.html#cb64-29" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb64-30"><a href="figure-2.html#cb64-30" tabindex="-1"></a><span class="co">#  Step 2: mlimma</span></span>
<span id="cb64-31"><a href="figure-2.html#cb64-31" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb64-32"><a href="figure-2.html#cb64-32" tabindex="-1"></a>dat_filter <span class="ot">&lt;-</span> <span class="fu">log2</span>(dat_filter<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb64-33"><a href="figure-2.html#cb64-33" tabindex="-1"></a></span>
<span id="cb64-34"><a href="figure-2.html#cb64-34" tabindex="-1"></a><span class="fu">dim</span>(dat_filter)</span>
<span id="cb64-35"><a href="figure-2.html#cb64-35" tabindex="-1"></a>group <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;tumor&quot;</span>,<span class="dv">106</span>),<span class="fu">rep</span>(<span class="st">&quot;normal&quot;</span>,<span class="dv">12</span>))</span>
<span id="cb64-36"><a href="figure-2.html#cb64-36" tabindex="-1"></a><span class="fu">table</span>(group)</span>
<span id="cb64-37"><a href="figure-2.html#cb64-37" tabindex="-1"></a></span>
<span id="cb64-38"><a href="figure-2.html#cb64-38" tabindex="-1"></a>metabolite_all <span class="ot">&lt;-</span> <span class="fu">mlimma</span>(dat_filter,group)</span>
<span id="cb64-39"><a href="figure-2.html#cb64-39" tabindex="-1"></a></span>
<span id="cb64-40"><a href="figure-2.html#cb64-40" tabindex="-1"></a><span class="fu">write.table</span>(metabolite_all,<span class="st">&quot;result/Figure2/1.BMMCvsHC.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb64-41"><a href="figure-2.html#cb64-41" tabindex="-1"></a></span>
<span id="cb64-42"><a href="figure-2.html#cb64-42" tabindex="-1"></a>metabolite_diff <span class="ot">&lt;-</span> metabolite_all <span class="sc">%&gt;%</span></span>
<span id="cb64-43"><a href="figure-2.html#cb64-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(logFC) <span class="sc">&gt;</span> <span class="fl">0.26</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-44"><a href="figure-2.html#cb64-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb64-45"><a href="figure-2.html#cb64-45" tabindex="-1"></a><span class="fu">write.table</span>(metabolite_diff,<span class="st">&quot;result/Figure2/1.BMMCvsHC_filter.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb64-46"><a href="figure-2.html#cb64-46" tabindex="-1"></a></span>
<span id="cb64-47"><a href="figure-2.html#cb64-47" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb64-48"><a href="figure-2.html#cb64-48" tabindex="-1"></a><span class="co">#  Step 3: DA-score</span></span>
<span id="cb64-49"><a href="figure-2.html#cb64-49" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------------</span></span>
<span id="cb64-50"><a href="figure-2.html#cb64-50" tabindex="-1"></a>diff_MC <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure2/1.BMMCvsHC.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-51"><a href="figure-2.html#cb64-51" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb64-52"><a href="figure-2.html#cb64-52" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name=</span>stringr<span class="sc">::</span><span class="fu">str_to_title</span>(name))</span>
<span id="cb64-53"><a href="figure-2.html#cb64-53" tabindex="-1"></a></span>
<span id="cb64-54"><a href="figure-2.html#cb64-54" tabindex="-1"></a>kid <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">&quot;raw_data/cell_metabolite_info_all_v1109.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-55"><a href="figure-2.html#cb64-55" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-56"><a href="figure-2.html#cb64-56" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">refmet_name=</span>stringr<span class="sc">::</span><span class="fu">str_to_title</span>(refmet_name))</span>
<span id="cb64-57"><a href="figure-2.html#cb64-57" tabindex="-1"></a></span>
<span id="cb64-58"><a href="figure-2.html#cb64-58" tabindex="-1"></a>data_all <span class="ot">&lt;-</span> diff_MC <span class="sc">%&gt;%</span> </span>
<span id="cb64-59"><a href="figure-2.html#cb64-59" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(kid,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span><span class="ot">=</span><span class="st">&quot;refmet_name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-60"><a href="figure-2.html#cb64-60" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(KEGG<span class="sc">!=</span><span class="st">&quot;None&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-61"><a href="figure-2.html#cb64-61" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(logFC))</span>
<span id="cb64-62"><a href="figure-2.html#cb64-62" tabindex="-1"></a></span>
<span id="cb64-63"><a href="figure-2.html#cb64-63" tabindex="-1"></a>data <span class="ot">&lt;-</span> data_all <span class="sc">%&gt;%</span></span>
<span id="cb64-64"><a href="figure-2.html#cb64-64" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-65"><a href="figure-2.html#cb64-65" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">change=</span><span class="fu">ifelse</span>(logFC <span class="sc">&gt;</span> <span class="fl">0.26</span>,<span class="st">&quot;increase&quot;</span>,</span>
<span id="cb64-66"><a href="figure-2.html#cb64-66" tabindex="-1"></a>                       <span class="fu">ifelse</span>(logFC <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.26</span>,<span class="st">&quot;decrease&quot;</span>,<span class="st">&quot;no sig&quot;</span>)))</span>
<span id="cb64-67"><a href="figure-2.html#cb64-67" tabindex="-1"></a>data_increase <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb64-68"><a href="figure-2.html#cb64-68" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(change<span class="sc">==</span><span class="st">&quot;increase&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-69"><a href="figure-2.html#cb64-69" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(KEGG)</span>
<span id="cb64-70"><a href="figure-2.html#cb64-70" tabindex="-1"></a>data_decrease <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb64-71"><a href="figure-2.html#cb64-71" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(change<span class="sc">==</span><span class="st">&quot;decrease&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-72"><a href="figure-2.html#cb64-72" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(KEGG)</span>
<span id="cb64-73"><a href="figure-2.html#cb64-73" tabindex="-1"></a></span>
<span id="cb64-74"><a href="figure-2.html#cb64-74" tabindex="-1"></a>da_result <span class="ot">&lt;-</span> <span class="fu">ePDAlyser</span>(data_increase,data_decrease,data_all<span class="sc">$</span>KEGG,</span>
<span id="cb64-75"><a href="figure-2.html#cb64-75" tabindex="-1"></a>                     <span class="at">sort_plot =</span><span class="st">&quot;category&quot;</span>,<span class="at">min_measured_num =</span> <span class="dv">3</span>,</span>
<span id="cb64-76"><a href="figure-2.html#cb64-76" tabindex="-1"></a>                     <span class="at">out =</span> <span class="st">&quot;metabolite&quot;</span>)</span>
<span id="cb64-77"><a href="figure-2.html#cb64-77" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">ePEAlyser</span>(<span class="fu">unique</span>(<span class="fu">c</span>(data_increase,data_decrease)),</span>
<span id="cb64-78"><a href="figure-2.html#cb64-78" tabindex="-1"></a>                     <span class="at">out=</span><span class="st">&quot;metabolite&quot;</span>,<span class="at">p_cutoff =</span> <span class="fl">0.05</span>,<span class="at">test=</span><span class="st">&quot;hypergeo&quot;</span>)</span>
<span id="cb64-79"><a href="figure-2.html#cb64-79" tabindex="-1"></a>Pa <span class="ot">&lt;-</span> a<span class="sc">$</span>output</span>
<span id="cb64-80"><a href="figure-2.html#cb64-80" tabindex="-1"></a></span>
<span id="cb64-81"><a href="figure-2.html#cb64-81" tabindex="-1"></a>da_result_filter <span class="ot">&lt;-</span> da_result<span class="sc">$</span>result <span class="sc">%&gt;%</span></span>
<span id="cb64-82"><a href="figure-2.html#cb64-82" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Pathway <span class="sc">%in%</span> Pa<span class="sc">$</span>name) <span class="sc">%&gt;%</span></span>
<span id="cb64-83"><a href="figure-2.html#cb64-83" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Measured_members_num <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-84"><a href="figure-2.html#cb64-84" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-85"><a href="figure-2.html#cb64-85" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Pathway=</span><span class="fu">factor</span>(Pathway,<span class="at">levels=</span>Pathway)) <span class="sc">%&gt;%</span></span>
<span id="cb64-86"><a href="figure-2.html#cb64-86" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">da_type=</span><span class="fu">ifelse</span>(DA_score<span class="sc">&gt;</span><span class="dv">0</span>,<span class="st">&quot;big&quot;</span>,</span>
<span id="cb64-87"><a href="figure-2.html#cb64-87" tabindex="-1"></a>                        <span class="fu">ifelse</span>(DA_score<span class="sc">&lt;</span><span class="dv">0</span>,<span class="st">&quot;little&quot;</span>,<span class="st">&quot;zero&quot;</span>)))</span>
<span id="cb64-88"><a href="figure-2.html#cb64-88" tabindex="-1"></a></span>
<span id="cb64-89"><a href="figure-2.html#cb64-89" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(da_result_filter)<span class="sc">+</span></span>
<span id="cb64-90"><a href="figure-2.html#cb64-90" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Pathway,<span class="at">y=</span>DA_score,<span class="at">size=</span><span class="fu">log2</span>(Measured_members_num),</span>
<span id="cb64-91"><a href="figure-2.html#cb64-91" tabindex="-1"></a>                                     <span class="at">color=</span><span class="st">`</span><span class="at">da_type</span><span class="st">`</span>,<span class="at">shape=</span><span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>,</span>
<span id="cb64-92"><a href="figure-2.html#cb64-92" tabindex="-1"></a>                                     <span class="at">fill=</span><span class="st">`</span><span class="at">da_type</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb64-93"><a href="figure-2.html#cb64-93" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x=</span>Pathway,<span class="at">y=</span>DA_score,<span class="at">ymin=</span><span class="dv">0</span>,<span class="at">ymax=</span>DA_score,<span class="at">color=</span><span class="st">`</span><span class="at">da_type</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb64-94"><a href="figure-2.html#cb64-94" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb64-95"><a href="figure-2.html#cb64-95" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb64-96"><a href="figure-2.html#cb64-96" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>))<span class="sc">+</span></span>
<span id="cb64-97"><a href="figure-2.html#cb64-97" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Metabolism pathways&quot;</span>,<span class="at">x=</span><span class="st">&quot;DA score&quot;</span>)<span class="sc">+</span></span>
<span id="cb64-98"><a href="figure-2.html#cb64-98" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;big&quot;</span><span class="ot">=</span><span class="st">&quot;#FD6AB0&quot;</span>,<span class="st">&quot;little&quot;</span><span class="ot">=</span><span class="st">&quot;#00AE4C&quot;</span>,<span class="st">&quot;zero&quot;</span><span class="ot">=</span><span class="st">&quot;gray&quot;</span>))<span class="sc">+</span></span>
<span id="cb64-99"><a href="figure-2.html#cb64-99" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;big&quot;</span><span class="ot">=</span><span class="st">&quot;#FD6AB0&quot;</span>,<span class="st">&quot;little&quot;</span><span class="ot">=</span><span class="st">&quot;#00AE4C&quot;</span>,<span class="st">&quot;zero&quot;</span><span class="ot">=</span><span class="st">&quot;gray&quot;</span>))<span class="sc">+</span></span>
<span id="cb64-100"><a href="figure-2.html#cb64-100" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Amino acid metabolism&quot;</span><span class="ot">=</span><span class="dv">21</span>,</span>
<span id="cb64-101"><a href="figure-2.html#cb64-101" tabindex="-1"></a>                              <span class="st">&quot;Carbohydrate metabolism&quot;</span><span class="ot">=</span><span class="dv">22</span>,</span>
<span id="cb64-102"><a href="figure-2.html#cb64-102" tabindex="-1"></a>                              <span class="st">&quot;Energy metabolism&quot;</span><span class="ot">=</span><span class="dv">23</span>,<span class="st">&quot;Lipid metabolism&quot;</span><span class="ot">=</span><span class="dv">24</span>,</span>
<span id="cb64-103"><a href="figure-2.html#cb64-103" tabindex="-1"></a>                              <span class="st">&quot;Metabolism of cofactors and vitamins&quot;</span><span class="ot">=</span><span class="dv">25</span>,</span>
<span id="cb64-104"><a href="figure-2.html#cb64-104" tabindex="-1"></a>                              <span class="st">&quot;Metabolism of other amino acids&quot;</span><span class="ot">=</span><span class="dv">3</span>,</span>
<span id="cb64-105"><a href="figure-2.html#cb64-105" tabindex="-1"></a>                              <span class="st">&quot;Nucleotide metabolism&quot;</span><span class="ot">=</span><span class="dv">4</span>))<span class="sc">+</span></span>
<span id="cb64-106"><a href="figure-2.html#cb64-106" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb64-107"><a href="figure-2.html#cb64-107" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb64-108"><a href="figure-2.html#cb64-108" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure2/2B_DAscore_BMMC_ALL.pdf&quot;</span>,p,<span class="at">width=</span><span class="dv">22</span>,<span class="at">height=</span><span class="dv">15</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb64-109"><a href="figure-2.html#cb64-109" tabindex="-1"></a></span>
<span id="cb64-110"><a href="figure-2.html#cb64-110" tabindex="-1"></a>openxlsx<span class="sc">::</span><span class="fu">write.xlsx</span>(da_result<span class="sc">$</span>result,<span class="at">file=</span><span class="st">&quot;result/Figure2/2B_DAscore_BMMC_ALL.xlsx&quot;</span>,<span class="at">rowNames =</span> <span class="cn">FALSE</span>)</span>
<span id="cb64-111"><a href="figure-2.html#cb64-111" tabindex="-1"></a>openxlsx<span class="sc">::</span><span class="fu">write.xlsx</span>(da_result_filter,<span class="at">file=</span><span class="st">&quot;result/Figure2/2B_DAscore_BMMC_ALL_filter.xlsx&quot;</span>,<span class="at">rowNames =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure2/2B.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="c-intracellular-metabolome-landscape" class="section level2 hasAnchor" number="17.3">
<h2><span class="header-section-number">17.3</span> (C) Intracellular Metabolome Landscape<a href="figure-2.html#c-intracellular-metabolome-landscape" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <strong>intracellular metabolome landscape</strong> reveals that <strong>most disturbed metabolites were upregulated in ALL</strong>, consistent with the data in Extended Data Fig. 3d-e; and the profile within the two groups is consistent with panel (a). The columns represent samples, and rows represent metabolites, with highlighted metabolites in Extended Data Fig. 3f. FMN: Flavin Mononucleotide; DHAP: Dihydroxyacetone Phosphate; NMN: Nicotinamide Mononucleotide; F-1,6-BP: Fructose 1,6−bisphosphate; G-1-P: Glucose 1−Phosphate; sn−Gly−3-P: sn−Glycero−3−phosphate.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="figure-2.html#cb65-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb65-2"><a href="figure-2.html#cb65-2" tabindex="-1"></a><span class="fu">library</span>(ComplexHeatmap)</span>
<span id="cb65-3"><a href="figure-2.html#cb65-3" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb65-4"><a href="figure-2.html#cb65-4" tabindex="-1"></a></span>
<span id="cb65-5"><a href="figure-2.html#cb65-5" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb65-6"><a href="figure-2.html#cb65-6" tabindex="-1"></a><span class="co">#  Step 1: Load metabolomics data and set parameters</span></span>
<span id="cb65-7"><a href="figure-2.html#cb65-7" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb65-8"><a href="figure-2.html#cb65-8" tabindex="-1"></a>sample_lineage <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-9"><a href="figure-2.html#cb65-9" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-10"><a href="figure-2.html#cb65-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Pid,Lineage,Subtype)</span>
<span id="cb65-11"><a href="figure-2.html#cb65-11" tabindex="-1"></a></span>
<span id="cb65-12"><a href="figure-2.html#cb65-12" tabindex="-1"></a>diff <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure2/1.BMMCvsHC.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-13"><a href="figure-2.html#cb65-13" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-14"><a href="figure-2.html#cb65-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(logFC)<span class="sc">&gt;</span><span class="fl">0.26</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-15"><a href="figure-2.html#cb65-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-16"><a href="figure-2.html#cb65-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(logFC) <span class="sc">%&gt;%</span></span>
<span id="cb65-17"><a href="figure-2.html#cb65-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">type=</span><span class="fu">ifelse</span>(logFC<span class="sc">&gt;</span><span class="dv">0</span>,<span class="st">&quot;Up&quot;</span>,<span class="st">&quot;Down&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-18"><a href="figure-2.html#cb65-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name=</span>stringr<span class="sc">::</span><span class="fu">str_to_title</span>(name))</span>
<span id="cb65-19"><a href="figure-2.html#cb65-19" tabindex="-1"></a>  </span>
<span id="cb65-20"><a href="figure-2.html#cb65-20" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-21"><a href="figure-2.html#cb65-21" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-22"><a href="figure-2.html#cb65-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">label=</span>stringr<span class="sc">::</span><span class="fu">str_to_title</span>(label)) <span class="sc">%&gt;%</span></span>
<span id="cb65-23"><a href="figure-2.html#cb65-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(label <span class="sc">%in%</span> diff<span class="sc">$</span>name) <span class="sc">%&gt;%</span></span>
<span id="cb65-24"><a href="figure-2.html#cb65-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">match</span>(label,diff<span class="sc">$</span>name)) <span class="sc">%&gt;%</span></span>
<span id="cb65-25"><a href="figure-2.html#cb65-25" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-26"><a href="figure-2.html#cb65-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">MRD_mean=</span><span class="fu">mean</span>(<span class="fu">c</span>(<span class="st">`</span><span class="at">RJ-19058_METc_BM_MRD-</span><span class="st">`</span>,<span class="st">`</span><span class="at">RJ-19081_METc_BM_MRD-</span><span class="st">`</span>,<span class="st">`</span><span class="at">RJ-19102_METc_BM_MRD-</span><span class="st">`</span>,<span class="st">`</span><span class="at">RJ-19137_METc_BM_MRD-</span><span class="st">`</span>,<span class="st">`</span><span class="at">RJ-19112_METc_BM_MRD-</span><span class="st">`</span>,<span class="st">`</span><span class="at">RJ-19004_METc_BM_MRD-</span><span class="st">`</span>,<span class="st">`</span><span class="at">RJ-19215_METc_BM_MRD-</span><span class="st">`</span>,<span class="st">`</span><span class="at">RJ-19115_METc_BM_MRD-</span><span class="st">`</span>,<span class="st">`</span><span class="at">RJ-19124_METc_BM_MRD-</span><span class="st">`</span>),<span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span></span>
<span id="cb65-27"><a href="figure-2.html#cb65-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">HC_PBMC_mean=</span><span class="fu">mean</span>(<span class="fu">c</span>(H047_PB,H053_PB,H054_PB,H055_PB,H058_PB,H065_PB,H069_PB,H080_PB,H085_PB,H088_PB,H091_PB,H093_PB),<span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span></span>
<span id="cb65-28"><a href="figure-2.html#cb65-28" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-29"><a href="figure-2.html#cb65-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">MRD_mean=</span><span class="fu">ifelse</span>(label<span class="sc">==</span><span class="st">&quot;Citric Acid&quot;</span>,<span class="cn">NA</span>,MRD_mean)) <span class="sc">%&gt;%</span></span>
<span id="cb65-30"><a href="figure-2.html#cb65-30" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-31"><a href="figure-2.html#cb65-31" tabindex="-1"></a>  <span class="fu">log1p</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-32"><a href="figure-2.html#cb65-32" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">&quot;H0&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-33"><a href="figure-2.html#cb65-33" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">&quot;MRD-&quot;</span>))</span>
<span id="cb65-34"><a href="figure-2.html#cb65-34" tabindex="-1"></a></span>
<span id="cb65-35"><a href="figure-2.html#cb65-35" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sample=</span><span class="fu">names</span>(dat)) <span class="sc">%&gt;%</span></span>
<span id="cb65-36"><a href="figure-2.html#cb65-36" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">type=</span><span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;METc_BM_D0&quot;</span>,sample),<span class="st">&quot;BM_D0&quot;</span>,</span>
<span id="cb65-37"><a href="figure-2.html#cb65-37" tabindex="-1"></a>                     <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;METc_PB_D0&quot;</span>,sample),<span class="st">&quot;ALL PBMC&quot;</span>,sample))) <span class="sc">%&gt;%</span></span>
<span id="cb65-38"><a href="figure-2.html#cb65-38" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Pid=</span>sample) <span class="sc">%&gt;%</span></span>
<span id="cb65-39"><a href="figure-2.html#cb65-39" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate</span>(Pid,<span class="at">sep=</span><span class="st">&quot;_&quot;</span>,<span class="st">&quot;Pid&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-40"><a href="figure-2.html#cb65-40" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(sample_lineage,<span class="at">by=</span><span class="st">&quot;Pid&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-41"><a href="figure-2.html#cb65-41" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Lineage=</span><span class="fu">ifelse</span>(type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;BM_D0&quot;</span>,<span class="st">&quot;ALL PBMC&quot;</span>),Lineage,type)) <span class="sc">%&gt;%</span></span>
<span id="cb65-42"><a href="figure-2.html#cb65-42" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Subtype=</span><span class="fu">ifelse</span>(type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;BM_D0&quot;</span>,<span class="st">&quot;ALL PBMC&quot;</span>),Subtype,<span class="cn">NA</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-43"><a href="figure-2.html#cb65-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Lineage=</span><span class="fu">ifelse</span>(Lineage<span class="sc">==</span><span class="st">&quot;B&quot;</span>,<span class="st">&quot;BCP-ALL&quot;</span>,</span>
<span id="cb65-44"><a href="figure-2.html#cb65-44" tabindex="-1"></a>                        <span class="fu">ifelse</span>(Lineage<span class="sc">==</span><span class="st">&quot;T&quot;</span>,<span class="st">&quot;T-ALL&quot;</span>,</span>
<span id="cb65-45"><a href="figure-2.html#cb65-45" tabindex="-1"></a>                        <span class="fu">ifelse</span>(Lineage<span class="sc">==</span><span class="st">&quot;MRD_mean&quot;</span>,<span class="st">&quot;MRD- BMMC mean&quot;</span>,</span>
<span id="cb65-46"><a href="figure-2.html#cb65-46" tabindex="-1"></a>                        <span class="fu">ifelse</span>(Lineage<span class="sc">==</span><span class="st">&quot;HC_PBMC_mean&quot;</span>,<span class="st">&quot;HC PBMC mean&quot;</span>,Lineage))))) <span class="sc">%&gt;%</span></span>
<span id="cb65-47"><a href="figure-2.html#cb65-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Cell_type=</span><span class="fu">ifelse</span>(type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;BM_D0&quot;</span>,<span class="st">&quot;MRD_mean&quot;</span>),<span class="st">&quot;BMMC&quot;</span>,</span>
<span id="cb65-48"><a href="figure-2.html#cb65-48" tabindex="-1"></a>                          <span class="fu">ifelse</span>(type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ALL PBMC&quot;</span>,<span class="st">&quot;HC_PBMC_mean&quot;</span>),<span class="st">&quot;PBMC&quot;</span>,<span class="cn">NA</span>)))</span>
<span id="cb65-49"><a href="figure-2.html#cb65-49" tabindex="-1"></a></span>
<span id="cb65-50"><a href="figure-2.html#cb65-50" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb65-51"><a href="figure-2.html#cb65-51" tabindex="-1"></a><span class="co">#  Step 2: Intracellular metabolome landscape heatmap</span></span>
<span id="cb65-52"><a href="figure-2.html#cb65-52" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb65-53"><a href="figure-2.html#cb65-53" tabindex="-1"></a>dat_scale <span class="ot">&lt;-</span> <span class="fu">myscale</span>(dat,<span class="at">method=</span><span class="st">&quot;raw_zscore&quot;</span>)</span>
<span id="cb65-54"><a href="figure-2.html#cb65-54" tabindex="-1"></a></span>
<span id="cb65-55"><a href="figure-2.html#cb65-55" tabindex="-1"></a>mark_gene <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(<span class="st">&quot;Malonic Acid&quot;</span>,<span class="st">&quot;Cdp&quot;</span>,<span class="st">&quot;Dtmp&quot;</span>,<span class="st">&quot;Cytosine&quot;</span>,<span class="st">&quot;Damp&quot;</span>,<span class="st">&quot;Adp&quot;</span>, <span class="st">&quot;Glucose 1-Phosphate&quot;</span>,<span class="st">&quot;Dihydroxyacetone Phosphate&quot;</span>,<span class="st">&quot;Gdp&quot;</span>,<span class="st">&quot;Deoxyadenosine&quot;</span>, <span class="st">&quot;Udp&quot;</span>,<span class="st">&quot;Citric Acid&quot;</span>,<span class="st">&quot;Udp-Glucose&quot;</span>,<span class="st">&quot;Fgar&quot;</span>,<span class="st">&quot;Xmp&quot;</span>,<span class="st">&quot;Ribulose 5-Phosphate&quot;</span>,<span class="st">&quot;Xylulose 5-Phosphate&quot;</span>,<span class="st">&quot;Fmn&quot;</span>,<span class="st">&quot;Adp&quot;</span>,<span class="st">&quot;Nicotinamide Ribotide&quot;</span>,<span class="st">&quot;Fructose 1,6-Bisphosphate&quot;</span>,<span class="st">&quot;Sn-Glycero-3-Phosphate&quot;</span>,<span class="st">&quot;Ribulose 5-Phosphate&quot;</span>,<span class="st">&quot;Xylulose 5-Phosphate&quot;</span>))</span>
<span id="cb65-56"><a href="figure-2.html#cb65-56" tabindex="-1"></a><span class="fu">length</span>(mark_gene)</span>
<span id="cb65-57"><a href="figure-2.html#cb65-57" tabindex="-1"></a></span>
<span id="cb65-58"><a href="figure-2.html#cb65-58" tabindex="-1"></a><span class="fu">setdiff</span>(mark_gene,<span class="fu">rownames</span>(dat_scale))</span>
<span id="cb65-59"><a href="figure-2.html#cb65-59" tabindex="-1"></a>gene_pos <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>()</span>
<span id="cb65-60"><a href="figure-2.html#cb65-60" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mark_gene)) {</span>
<span id="cb65-61"><a href="figure-2.html#cb65-61" tabindex="-1"></a>  gene_pos_temp <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">rownames</span>(dat_scale)<span class="sc">==</span>mark_gene[i])</span>
<span id="cb65-62"><a href="figure-2.html#cb65-62" tabindex="-1"></a>  gene_pos <span class="ot">&lt;-</span> <span class="fu">c</span>(gene_pos,gene_pos_temp)</span>
<span id="cb65-63"><a href="figure-2.html#cb65-63" tabindex="-1"></a>}</span>
<span id="cb65-64"><a href="figure-2.html#cb65-64" tabindex="-1"></a><span class="fu">length</span>(gene_pos)</span>
<span id="cb65-65"><a href="figure-2.html#cb65-65" tabindex="-1"></a>right_anno <span class="ot">&lt;-</span>  <span class="fu">rowAnnotation</span>(<span class="at">mark_gene =</span> <span class="fu">anno_mark</span>(<span class="at">at =</span> gene_pos, <span class="at">labels =</span> mark_gene))</span>
<span id="cb65-66"><a href="figure-2.html#cb65-66" tabindex="-1"></a></span>
<span id="cb65-67"><a href="figure-2.html#cb65-67" tabindex="-1"></a>annotation_file <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/cell_metabolite_info_all_v1109.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-68"><a href="figure-2.html#cb65-68" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-69"><a href="figure-2.html#cb65-69" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(refmet_name,class) <span class="sc">%&gt;%</span></span>
<span id="cb65-70"><a href="figure-2.html#cb65-70" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;label&quot;</span><span class="ot">=</span><span class="st">&quot;refmet_name&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-71"><a href="figure-2.html#cb65-71" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">label=</span>stringr<span class="sc">::</span><span class="fu">str_to_title</span>(label))</span>
<span id="cb65-72"><a href="figure-2.html#cb65-72" tabindex="-1"></a></span>
<span id="cb65-73"><a href="figure-2.html#cb65-73" tabindex="-1"></a>left_a <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">label=</span><span class="fu">rownames</span>(dat_scale)) <span class="sc">%&gt;%</span></span>
<span id="cb65-74"><a href="figure-2.html#cb65-74" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(annotation_file,<span class="at">by=</span><span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-75"><a href="figure-2.html#cb65-75" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(diff,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;label&quot;</span><span class="ot">=</span><span class="st">&quot;name&quot;</span>))</span>
<span id="cb65-76"><a href="figure-2.html#cb65-76" tabindex="-1"></a>q8 <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="dv">8</span>, <span class="at">name =</span> <span class="st">&quot;Paired&quot;</span>)</span>
<span id="cb65-77"><a href="figure-2.html#cb65-77" tabindex="-1"></a><span class="fu">names</span>(q8) <span class="ot">&lt;-</span> <span class="fu">unique</span>(annotation_file<span class="sc">$</span>class)</span>
<span id="cb65-78"><a href="figure-2.html#cb65-78" tabindex="-1"></a></span>
<span id="cb65-79"><a href="figure-2.html#cb65-79" tabindex="-1"></a>col_fc <span class="ot">=</span> circlize<span class="sc">::</span><span class="fu">colorRamp2</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="st">&quot;#00AE4C&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;#FD6AB0&quot;</span>))</span>
<span id="cb65-80"><a href="figure-2.html#cb65-80" tabindex="-1"></a></span>
<span id="cb65-81"><a href="figure-2.html#cb65-81" tabindex="-1"></a>left_annotation <span class="ot">=</span> <span class="fu">rowAnnotation</span>(<span class="at">Class =</span> left_a<span class="sc">$</span>class,</span>
<span id="cb65-82"><a href="figure-2.html#cb65-82" tabindex="-1"></a>                                <span class="at">FC=</span>left_a<span class="sc">$</span>logFC,</span>
<span id="cb65-83"><a href="figure-2.html#cb65-83" tabindex="-1"></a>                                <span class="at">col=</span><span class="fu">list</span>(<span class="at">Class=</span>q8,</span>
<span id="cb65-84"><a href="figure-2.html#cb65-84" tabindex="-1"></a>                                         <span class="at">FC=</span>col_fc),</span>
<span id="cb65-85"><a href="figure-2.html#cb65-85" tabindex="-1"></a>                                <span class="at">show_annotation_name =</span> <span class="fu">c</span>(T,T), </span>
<span id="cb65-86"><a href="figure-2.html#cb65-86" tabindex="-1"></a>                                <span class="at">border =</span> <span class="fu">c</span>(T,T) ,</span>
<span id="cb65-87"><a href="figure-2.html#cb65-87" tabindex="-1"></a>                                <span class="at">simple_anno_size =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">&quot;mm&quot;</span>),</span>
<span id="cb65-88"><a href="figure-2.html#cb65-88" tabindex="-1"></a>                                <span class="at">gap =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb65-89"><a href="figure-2.html#cb65-89" tabindex="-1"></a>top_annotation <span class="ot">=</span> <span class="fu">HeatmapAnnotation</span>( </span>
<span id="cb65-90"><a href="figure-2.html#cb65-90" tabindex="-1"></a>  <span class="at">Lineage =</span> sample_info<span class="sc">$</span>Lineage,</span>
<span id="cb65-91"><a href="figure-2.html#cb65-91" tabindex="-1"></a>  <span class="at">Subtype=</span>sample_info<span class="sc">$</span>Subtype,</span>
<span id="cb65-92"><a href="figure-2.html#cb65-92" tabindex="-1"></a>  <span class="at">Cell_type=</span>sample_info<span class="sc">$</span>Cell_type,</span>
<span id="cb65-93"><a href="figure-2.html#cb65-93" tabindex="-1"></a>  <span class="at">col=</span><span class="fu">list</span>(<span class="at">Lineage=</span><span class="fu">c</span>(<span class="st">&quot;BCP-ALL&quot;</span><span class="ot">=</span><span class="st">&quot;#E5E059&quot;</span>,<span class="st">&quot;T-ALL&quot;</span><span class="ot">=</span><span class="st">&quot;#4B0082&quot;</span>,</span>
<span id="cb65-94"><a href="figure-2.html#cb65-94" tabindex="-1"></a>                     <span class="st">&quot;HC PBMC mean&quot;</span><span class="ot">=</span><span class="st">&quot;#746E15&quot;</span>,<span class="st">&quot;MRD- BMMC mean&quot;</span><span class="ot">=</span><span class="st">&quot;#1E90FF&quot;</span>),</span>
<span id="cb65-95"><a href="figure-2.html#cb65-95" tabindex="-1"></a>           <span class="at">Subtype=</span><span class="fu">c</span>(<span class="st">&quot;Ph&quot;</span><span class="ot">=</span><span class="st">&quot;#D01910&quot;</span>,<span class="st">&quot;non_Ph&quot;</span><span class="ot">=</span><span class="st">&quot;#FE7F2D&quot;</span>,<span class="st">&quot;ETP&quot;</span><span class="ot">=</span><span class="st">&quot;#4C6CB0&quot;</span>,<span class="st">&quot;non_ETP&quot;</span><span class="ot">=</span><span class="st">&quot;#8DC8ED&quot;</span>),</span>
<span id="cb65-96"><a href="figure-2.html#cb65-96" tabindex="-1"></a>           <span class="at">Cell_type=</span><span class="fu">c</span>(<span class="st">&quot;PBMC&quot;</span><span class="ot">=</span><span class="st">&quot;#8B4720&quot;</span>,<span class="st">&quot;BMMC&quot;</span><span class="ot">=</span><span class="st">&quot;#CB8A93&quot;</span>)),</span>
<span id="cb65-97"><a href="figure-2.html#cb65-97" tabindex="-1"></a>  <span class="at">show_annotation_name =</span> <span class="fu">c</span>(T,T), </span>
<span id="cb65-98"><a href="figure-2.html#cb65-98" tabindex="-1"></a>  <span class="at">border =</span> <span class="fu">c</span>(T,T) ,</span>
<span id="cb65-99"><a href="figure-2.html#cb65-99" tabindex="-1"></a>  <span class="at">simple_anno_size =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">&quot;mm&quot;</span>),<span class="at">gap =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb65-100"><a href="figure-2.html#cb65-100" tabindex="-1"></a></span>
<span id="cb65-101"><a href="figure-2.html#cb65-101" tabindex="-1"></a>col_fun <span class="ot">=</span> circlize<span class="sc">::</span><span class="fu">colorRamp2</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">0</span>, <span class="fl">1.5</span>), <span class="fu">c</span>(<span class="st">&quot;#00599F&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;#D01910&quot;</span>))</span>
<span id="cb65-102"><a href="figure-2.html#cb65-102" tabindex="-1"></a></span>
<span id="cb65-103"><a href="figure-2.html#cb65-103" tabindex="-1"></a>p_metabolite <span class="ot">&lt;-</span> <span class="fu">Heatmap</span>(dat_scale,<span class="at">height=</span><span class="fu">unit</span>(<span class="dv">15</span>,<span class="st">&quot;cm&quot;</span>),<span class="at">name=</span><span class="st">&quot;Metabolite Data&quot;</span>,</span>
<span id="cb65-104"><a href="figure-2.html#cb65-104" tabindex="-1"></a>                        <span class="at">top_annotation =</span>top_annotation,</span>
<span id="cb65-105"><a href="figure-2.html#cb65-105" tabindex="-1"></a>                        <span class="at">left_annotation =</span> left_annotation,</span>
<span id="cb65-106"><a href="figure-2.html#cb65-106" tabindex="-1"></a>                        <span class="at">right_annotation =</span> right_anno,</span>
<span id="cb65-107"><a href="figure-2.html#cb65-107" tabindex="-1"></a>                        <span class="at">row_split =</span> <span class="fu">factor</span>(diff<span class="sc">$</span>type,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;Down&quot;</span>,<span class="st">&quot;Up&quot;</span>)),</span>
<span id="cb65-108"><a href="figure-2.html#cb65-108" tabindex="-1"></a>                        <span class="at">cluster_row_slices =</span> F,</span>
<span id="cb65-109"><a href="figure-2.html#cb65-109" tabindex="-1"></a>                        <span class="at">column_split =</span> <span class="fu">factor</span>(sample_info<span class="sc">$</span>Lineage,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;BCP-ALL&quot;</span>,<span class="st">&quot;T-ALL&quot;</span>,<span class="st">&quot;MRD- BMMC mean&quot;</span>,<span class="st">&quot;HC PBMC mean&quot;</span>)),</span>
<span id="cb65-110"><a href="figure-2.html#cb65-110" tabindex="-1"></a>                        <span class="at">cluster_column_slices =</span> F,</span>
<span id="cb65-111"><a href="figure-2.html#cb65-111" tabindex="-1"></a>                        <span class="at">show_row_dend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb65-112"><a href="figure-2.html#cb65-112" tabindex="-1"></a>                        <span class="at">show_column_dend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb65-113"><a href="figure-2.html#cb65-113" tabindex="-1"></a>                        <span class="at">col =</span> col_fun,</span>
<span id="cb65-114"><a href="figure-2.html#cb65-114" tabindex="-1"></a>                        <span class="at">show_column_names =</span> F,</span>
<span id="cb65-115"><a href="figure-2.html#cb65-115" tabindex="-1"></a>                        <span class="at">show_row_names =</span> F,</span>
<span id="cb65-116"><a href="figure-2.html#cb65-116" tabindex="-1"></a>                        <span class="at">row_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">2</span>),<span class="at">column_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">5</span>))</span>
<span id="cb65-117"><a href="figure-2.html#cb65-117" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;result/Figure2/2C_heatmap.pdf&quot;</span>,<span class="at">width=</span><span class="dv">15</span>,<span class="at">height =</span> <span class="dv">8</span>)</span>
<span id="cb65-118"><a href="figure-2.html#cb65-118" tabindex="-1"></a>p_metabolite</span>
<span id="cb65-119"><a href="figure-2.html#cb65-119" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p><img src="Figure-1025/Figure2/2C.png" width="552" style="display: block; margin: auto;" /></p>
</div>
<div id="e-bcp-all-vs-t-all" class="section level2 hasAnchor" number="17.4">
<h2><span class="header-section-number">17.4</span> (E) BCP-ALL vs T-ALL<a href="figure-2.html#e-bcp-all-vs-t-all" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>A specific comparison between BCP-ALL and T-ALL cases</strong> elucidates the pathways enriched with significantly differential metabolites. The colors represent metabolic pathway categories and the size of each circle reflects the quantity of measured metabolites in indicated pathway.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="figure-2.html#cb66-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb66-2"><a href="figure-2.html#cb66-2" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb66-3"><a href="figure-2.html#cb66-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb66-4"><a href="figure-2.html#cb66-4" tabindex="-1"></a><span class="fu">library</span>(tidymass)</span>
<span id="cb66-5"><a href="figure-2.html#cb66-5" tabindex="-1"></a></span>
<span id="cb66-6"><a href="figure-2.html#cb66-6" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb66-7"><a href="figure-2.html#cb66-7" tabindex="-1"></a><span class="co">#  Step 1: Load data and conduct variance analysis</span></span>
<span id="cb66-8"><a href="figure-2.html#cb66-8" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb66-9"><a href="figure-2.html#cb66-9" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-10"><a href="figure-2.html#cb66-10" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-11"><a href="figure-2.html#cb66-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(METc_BM_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb66-12"><a href="figure-2.html#cb66-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(METc_BM_D0_ID,Lineage) <span class="sc">%&gt;%</span></span>
<span id="cb66-13"><a href="figure-2.html#cb66-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Lineage=</span><span class="fu">ifelse</span>(Lineage<span class="sc">==</span><span class="st">&quot;B&quot;</span>,<span class="st">&quot;BCP-ALL&quot;</span>,</span>
<span id="cb66-14"><a href="figure-2.html#cb66-14" tabindex="-1"></a>                               <span class="fu">ifelse</span>(Lineage<span class="sc">==</span><span class="st">&quot;T&quot;</span>,<span class="st">&quot;T-ALL&quot;</span>,Lineage))) <span class="sc">%&gt;%</span></span>
<span id="cb66-15"><a href="figure-2.html#cb66-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Lineage <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;BCP-ALL&quot;</span>,<span class="st">&quot;T-ALL&quot;</span>))</span>
<span id="cb66-16"><a href="figure-2.html#cb66-16" tabindex="-1"></a></span>
<span id="cb66-17"><a href="figure-2.html#cb66-17" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-18"><a href="figure-2.html#cb66-18" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-19"><a href="figure-2.html#cb66-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(label,<span class="fu">all_of</span>(sample_info<span class="sc">$</span>METc_BM_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb66-20"><a href="figure-2.html#cb66-20" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>)</span>
<span id="cb66-21"><a href="figure-2.html#cb66-21" tabindex="-1"></a></span>
<span id="cb66-22"><a href="figure-2.html#cb66-22" tabindex="-1"></a>group <span class="ot">&lt;-</span> sample_info<span class="sc">$</span>Lineage</span>
<span id="cb66-23"><a href="figure-2.html#cb66-23" tabindex="-1"></a></span>
<span id="cb66-24"><a href="figure-2.html#cb66-24" tabindex="-1"></a>group[<span class="fu">which</span>(group<span class="sc">==</span><span class="st">&quot;BCP-ALL&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;tumor&quot;</span></span>
<span id="cb66-25"><a href="figure-2.html#cb66-25" tabindex="-1"></a>group[<span class="fu">which</span>(group<span class="sc">==</span><span class="st">&quot;T-ALL&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;normal&quot;</span></span>
<span id="cb66-26"><a href="figure-2.html#cb66-26" tabindex="-1"></a>metabolite_all <span class="ot">&lt;-</span> <span class="fu">mlimma</span>(<span class="fu">log2</span>(dat<span class="sc">+</span><span class="dv">1</span>),group)</span>
<span id="cb66-27"><a href="figure-2.html#cb66-27" tabindex="-1"></a>metabolite_diff <span class="ot">&lt;-</span> metabolite_all <span class="sc">%&gt;%</span></span>
<span id="cb66-28"><a href="figure-2.html#cb66-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(logFC) <span class="sc">&gt;</span> <span class="fl">0.26</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-29"><a href="figure-2.html#cb66-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb66-30"><a href="figure-2.html#cb66-30" tabindex="-1"></a></span>
<span id="cb66-31"><a href="figure-2.html#cb66-31" tabindex="-1"></a><span class="fu">write.table</span>(metabolite_all,<span class="st">&quot;result/Figure2/2E_BvsT_all.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb66-32"><a href="figure-2.html#cb66-32" tabindex="-1"></a><span class="fu">write.table</span>(metabolite_diff,<span class="st">&quot;result/Figure2/2E_BvsT_diff.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb66-33"><a href="figure-2.html#cb66-33" tabindex="-1"></a></span>
<span id="cb66-34"><a href="figure-2.html#cb66-34" tabindex="-1"></a>kid <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/cell_metabolite_info_all_v1109.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-35"><a href="figure-2.html#cb66-35" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-36"><a href="figure-2.html#cb66-36" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(refmet_name,KEGG)</span>
<span id="cb66-37"><a href="figure-2.html#cb66-37" tabindex="-1"></a></span>
<span id="cb66-38"><a href="figure-2.html#cb66-38" tabindex="-1"></a>data_all <span class="ot">&lt;-</span> metabolite_all <span class="sc">%&gt;%</span> </span>
<span id="cb66-39"><a href="figure-2.html#cb66-39" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(kid,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span><span class="ot">=</span><span class="st">&quot;refmet_name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-40"><a href="figure-2.html#cb66-40" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(KEGG<span class="sc">!=</span><span class="st">&quot;None&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-41"><a href="figure-2.html#cb66-41" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(KEGG)</span>
<span id="cb66-42"><a href="figure-2.html#cb66-42" tabindex="-1"></a></span>
<span id="cb66-43"><a href="figure-2.html#cb66-43" tabindex="-1"></a>dat <span class="ot">&lt;-</span> metabolite_all <span class="sc">%&gt;%</span> </span>
<span id="cb66-44"><a href="figure-2.html#cb66-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(kid,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span><span class="ot">=</span><span class="st">&quot;refmet_name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-45"><a href="figure-2.html#cb66-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(KEGG<span class="sc">!=</span><span class="st">&quot;None&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-46"><a href="figure-2.html#cb66-46" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb66-47"><a href="figure-2.html#cb66-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">change=</span><span class="fu">ifelse</span>(logFC <span class="sc">&gt;</span> <span class="fl">0.26</span>,<span class="st">&quot;increase&quot;</span>,</span>
<span id="cb66-48"><a href="figure-2.html#cb66-48" tabindex="-1"></a>                              <span class="fu">ifelse</span>(logFC <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.26</span>,<span class="st">&quot;decrease&quot;</span>,<span class="st">&quot;no sig&quot;</span>)))</span>
<span id="cb66-49"><a href="figure-2.html#cb66-49" tabindex="-1"></a>data_increase <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb66-50"><a href="figure-2.html#cb66-50" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(change<span class="sc">==</span><span class="st">&quot;increase&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-51"><a href="figure-2.html#cb66-51" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(KEGG)</span>
<span id="cb66-52"><a href="figure-2.html#cb66-52" tabindex="-1"></a>data_decrease <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb66-53"><a href="figure-2.html#cb66-53" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(change<span class="sc">==</span><span class="st">&quot;decrease&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-54"><a href="figure-2.html#cb66-54" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(KEGG)</span>
<span id="cb66-55"><a href="figure-2.html#cb66-55" tabindex="-1"></a></span>
<span id="cb66-56"><a href="figure-2.html#cb66-56" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb66-57"><a href="figure-2.html#cb66-57" tabindex="-1"></a><span class="co">#  Step 2: DA score</span></span>
<span id="cb66-58"><a href="figure-2.html#cb66-58" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb66-59"><a href="figure-2.html#cb66-59" tabindex="-1"></a>da_result <span class="ot">&lt;-</span> <span class="fu">ePDAlyser</span>(data_increase,data_decrease,data_all,<span class="at">sort_plot=</span><span class="st">&quot;category&quot;</span>,</span>
<span id="cb66-60"><a href="figure-2.html#cb66-60" tabindex="-1"></a>                     <span class="at">min_measured_num =</span> <span class="dv">2</span>,<span class="at">out=</span><span class="st">&quot;metabolite&quot;</span>)</span>
<span id="cb66-61"><a href="figure-2.html#cb66-61" tabindex="-1"></a><span class="fu">ggsave</span>(da_result<span class="sc">$</span>p,<span class="at">filename =</span> <span class="st">&quot;result/Figure2/2E_DA_score_all.pdf&quot;</span>,<span class="at">width=</span><span class="dv">13</span>,<span class="at">height=</span><span class="dv">9</span>)</span>
<span id="cb66-62"><a href="figure-2.html#cb66-62" tabindex="-1"></a>openxlsx<span class="sc">::</span><span class="fu">write.xlsx</span>(da_result<span class="sc">$</span>result,<span class="at">file=</span><span class="st">&quot;result/Figure2/2E_DA_score_all.xlsx&quot;</span>,<span class="at">rowNames =</span> <span class="cn">FALSE</span>)</span>
<span id="cb66-63"><a href="figure-2.html#cb66-63" tabindex="-1"></a></span>
<span id="cb66-64"><a href="figure-2.html#cb66-64" tabindex="-1"></a>diff.kid <span class="ot">&lt;-</span> metabolite_all <span class="sc">%&gt;%</span> </span>
<span id="cb66-65"><a href="figure-2.html#cb66-65" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span><span class="fl">0.05</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb66-66"><a href="figure-2.html#cb66-66" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(logFC <span class="sc">&gt;</span> <span class="fl">0.26</span> <span class="sc">|</span> logFC <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.26</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-67"><a href="figure-2.html#cb66-67" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(kid,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span><span class="ot">=</span><span class="st">&quot;refmet_name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-68"><a href="figure-2.html#cb66-68" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(KEGG<span class="sc">!=</span><span class="st">&quot;None&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb66-69"><a href="figure-2.html#cb66-69" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(KEGG) <span class="sc">%&gt;%</span> </span>
<span id="cb66-70"><a href="figure-2.html#cb66-70" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb66-71"><a href="figure-2.html#cb66-71" tabindex="-1"></a></span>
<span id="cb66-72"><a href="figure-2.html#cb66-72" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;kegg_hsa_pathway&quot;</span>, <span class="at">package =</span> <span class="st">&quot;metpath&quot;</span>)</span>
<span id="cb66-73"><a href="figure-2.html#cb66-73" tabindex="-1"></a>pathway_class <span class="ot">=</span> metpath<span class="sc">::</span><span class="fu">pathway_class</span>(kegg_hsa_pathway)</span>
<span id="cb66-74"><a href="figure-2.html#cb66-74" tabindex="-1"></a>remain_idx <span class="ot">=</span> pathway_class <span class="sc">%&gt;%</span></span>
<span id="cb66-75"><a href="figure-2.html#cb66-75" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-76"><a href="figure-2.html#cb66-76" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_detect</span>(<span class="st">&quot;Disease&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-77"><a href="figure-2.html#cb66-77" tabindex="-1"></a>  <span class="st">`</span><span class="at">!</span><span class="st">`</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-78"><a href="figure-2.html#cb66-78" tabindex="-1"></a>  <span class="fu">which</span>()</span>
<span id="cb66-79"><a href="figure-2.html#cb66-79" tabindex="-1"></a>pathway_database <span class="ot">=</span> kegg_hsa_pathway[remain_idx]</span>
<span id="cb66-80"><a href="figure-2.html#cb66-80" tabindex="-1"></a></span>
<span id="cb66-81"><a href="figure-2.html#cb66-81" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">enrich_kegg</span>(<span class="at">query_id =</span> diff.kid, </span>
<span id="cb66-82"><a href="figure-2.html#cb66-82" tabindex="-1"></a>                      <span class="at">query_type =</span> <span class="st">&quot;compound&quot;</span>, </span>
<span id="cb66-83"><a href="figure-2.html#cb66-83" tabindex="-1"></a>                      <span class="at">id_type =</span> <span class="st">&quot;KEGG&quot;</span>,<span class="at">method =</span> <span class="st">&quot;hypergeometric&quot;</span>,</span>
<span id="cb66-84"><a href="figure-2.html#cb66-84" tabindex="-1"></a>                      <span class="at">pathway_database =</span> pathway_database, </span>
<span id="cb66-85"><a href="figure-2.html#cb66-85" tabindex="-1"></a>                      <span class="at">p_cutoff =</span> <span class="fl">0.05</span>, </span>
<span id="cb66-86"><a href="figure-2.html#cb66-86" tabindex="-1"></a>                      <span class="at">p_adjust_method =</span> <span class="st">&quot;BH&quot;</span>, </span>
<span id="cb66-87"><a href="figure-2.html#cb66-87" tabindex="-1"></a>                      <span class="at">threads =</span> <span class="dv">5</span>)</span>
<span id="cb66-88"><a href="figure-2.html#cb66-88" tabindex="-1"></a>msea_table <span class="ot">&lt;-</span> result<span class="sc">@</span>result <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(p_value) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb66-89"><a href="figure-2.html#cb66-89" tabindex="-1"></a>tablefilter <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(msea_table,p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb66-90"><a href="figure-2.html#cb66-90" tabindex="-1"></a><span class="fu">write.csv</span>(msea_table,<span class="st">&quot;result/Figure2/2E.MSEA_all.csv&quot;</span>)</span>
<span id="cb66-91"><a href="figure-2.html#cb66-91" tabindex="-1"></a></span>
<span id="cb66-92"><a href="figure-2.html#cb66-92" tabindex="-1"></a>da_filter <span class="ot">&lt;-</span> da_result<span class="sc">$</span>result <span class="sc">%&gt;%</span></span>
<span id="cb66-93"><a href="figure-2.html#cb66-93" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(KEGG_pathwayid <span class="sc">%in%</span> tablefilter<span class="sc">$</span>pathway_id) <span class="sc">%&gt;%</span></span>
<span id="cb66-94"><a href="figure-2.html#cb66-94" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-95"><a href="figure-2.html#cb66-95" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Pathway=</span><span class="fu">factor</span>(Pathway,<span class="at">levels =</span> Pathway))</span>
<span id="cb66-96"><a href="figure-2.html#cb66-96" tabindex="-1"></a></span>
<span id="cb66-97"><a href="figure-2.html#cb66-97" tabindex="-1"></a>pathway_data <span class="ot">&lt;-</span> PathwayExtendData <span class="sc">%&gt;%</span></span>
<span id="cb66-98"><a href="figure-2.html#cb66-98" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;metabolite&quot;</span>)</span>
<span id="cb66-99"><a href="figure-2.html#cb66-99" tabindex="-1"></a></span>
<span id="cb66-100"><a href="figure-2.html#cb66-100" tabindex="-1"></a>colp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Amino acid metabolism&quot;</span> <span class="ot">=</span><span class="st">&quot;#1B9E77&quot;</span>,</span>
<span id="cb66-101"><a href="figure-2.html#cb66-101" tabindex="-1"></a>          <span class="st">&quot;Carbohydrate metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#D95F02&quot;</span>,</span>
<span id="cb66-102"><a href="figure-2.html#cb66-102" tabindex="-1"></a>          <span class="st">&quot;Glycan biosynthesis and metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#1F78B4&quot;</span>, </span>
<span id="cb66-103"><a href="figure-2.html#cb66-103" tabindex="-1"></a>          <span class="st">&quot;Metabolism of cofactors and vitamins&quot;</span><span class="ot">=</span><span class="st">&quot;#7570B3&quot;</span>,</span>
<span id="cb66-104"><a href="figure-2.html#cb66-104" tabindex="-1"></a>          <span class="st">&quot;Metabolism of terpenoids and polyketides&quot;</span><span class="ot">=</span><span class="st">&quot;#BC80BD&quot;</span>,</span>
<span id="cb66-105"><a href="figure-2.html#cb66-105" tabindex="-1"></a>          <span class="st">&quot;Metabolism of other amino acids&quot;</span><span class="ot">=</span><span class="st">&quot;#8DD3C7&quot;</span>,</span>
<span id="cb66-106"><a href="figure-2.html#cb66-106" tabindex="-1"></a>          <span class="st">&quot;Energy metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#E7298A&quot;</span>,<span class="st">&quot;Lipid metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#66A61E&quot;</span>,</span>
<span id="cb66-107"><a href="figure-2.html#cb66-107" tabindex="-1"></a>          <span class="st">&quot;Nucleotide metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#E6AB02&quot;</span>,</span>
<span id="cb66-108"><a href="figure-2.html#cb66-108" tabindex="-1"></a>          <span class="st">&quot;Biosynthesis of other secondary metabolites&quot;</span><span class="ot">=</span><span class="st">&quot;#A6761D&quot;</span>,</span>
<span id="cb66-109"><a href="figure-2.html#cb66-109" tabindex="-1"></a>          <span class="st">&quot;Xenobiotics biodegradation and metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#666666&quot;</span>)</span>
<span id="cb66-110"><a href="figure-2.html#cb66-110" tabindex="-1"></a></span>
<span id="cb66-111"><a href="figure-2.html#cb66-111" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(da_filter)<span class="sc">+</span></span>
<span id="cb66-112"><a href="figure-2.html#cb66-112" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Pathway,<span class="at">y=</span>DA_score,<span class="at">size=</span><span class="fu">log2</span>(Measured_members_num),<span class="at">color=</span><span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb66-113"><a href="figure-2.html#cb66-113" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x=</span>Pathway,<span class="at">y=</span>DA_score,<span class="at">ymin=</span><span class="dv">0</span>,<span class="at">ymax=</span>DA_score,<span class="at">color=</span><span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb66-114"><a href="figure-2.html#cb66-114" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>colp)<span class="sc">+</span></span>
<span id="cb66-115"><a href="figure-2.html#cb66-115" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb66-116"><a href="figure-2.html#cb66-116" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb66-117"><a href="figure-2.html#cb66-117" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb66-118"><a href="figure-2.html#cb66-118" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure2/2E_DAscore_BCPvsT-ALL.pdf&quot;</span>,p,<span class="at">width=</span><span class="dv">8</span>,<span class="at">height =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure2/2E.png" width="533" style="display: block; margin: auto;" /></p>
</div>
<div id="s3-a-correlation-within-bmmc-samples" class="section level2 hasAnchor" number="17.5">
<h2><span class="header-section-number">17.5</span> (S3 A) Correlation Within BMMC Samples<a href="figure-2.html#s3-a-correlation-within-bmmc-samples" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>The correlation coefficient (R) plot among BMMC samples</strong>, calculated using metabolites abundance. The lower R value is considered as reflecting higher heterogeneity within a given sample pool, and the R of 0.8 is highlighted on the y-axis with a brown line. The median R of each box is 0.863, 0.890, and 0.859, respectively. Statistical significance was determined using Wilcoxon test. **** P &lt; 0.0001.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="figure-2.html#cb67-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb67-2"><a href="figure-2.html#cb67-2" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb67-3"><a href="figure-2.html#cb67-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb67-4"><a href="figure-2.html#cb67-4" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb67-5"><a href="figure-2.html#cb67-5" tabindex="-1"></a></span>
<span id="cb67-6"><a href="figure-2.html#cb67-6" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb67-7"><a href="figure-2.html#cb67-7" tabindex="-1"></a><span class="co">#  Step 1: Load data and set parameters</span></span>
<span id="cb67-8"><a href="figure-2.html#cb67-8" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb67-9"><a href="figure-2.html#cb67-9" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-10"><a href="figure-2.html#cb67-10" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb67-11"><a href="figure-2.html#cb67-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(METc_BM_D0_ID))</span>
<span id="cb67-12"><a href="figure-2.html#cb67-12" tabindex="-1"></a></span>
<span id="cb67-13"><a href="figure-2.html#cb67-13" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-14"><a href="figure-2.html#cb67-14" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb67-15"><a href="figure-2.html#cb67-15" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>)</span>
<span id="cb67-16"><a href="figure-2.html#cb67-16" tabindex="-1"></a>  </span>
<span id="cb67-17"><a href="figure-2.html#cb67-17" tabindex="-1"></a>sample_b <span class="ot">&lt;-</span> sample_info <span class="sc">%&gt;%</span></span>
<span id="cb67-18"><a href="figure-2.html#cb67-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Lineage<span class="sc">==</span><span class="st">&quot;B&quot;</span>)</span>
<span id="cb67-19"><a href="figure-2.html#cb67-19" tabindex="-1"></a>sample_t <span class="ot">&lt;-</span> sample_info <span class="sc">%&gt;%</span></span>
<span id="cb67-20"><a href="figure-2.html#cb67-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Lineage<span class="sc">==</span><span class="st">&quot;T&quot;</span>)</span>
<span id="cb67-21"><a href="figure-2.html#cb67-21" tabindex="-1"></a></span>
<span id="cb67-22"><a href="figure-2.html#cb67-22" tabindex="-1"></a>dat_b <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb67-23"><a href="figure-2.html#cb67-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample_b<span class="sc">$</span>METc_BM_D0_ID) <span class="sc">%&gt;%</span></span>
<span id="cb67-24"><a href="figure-2.html#cb67-24" tabindex="-1"></a>  <span class="fu">log1p</span>()</span>
<span id="cb67-25"><a href="figure-2.html#cb67-25" tabindex="-1"></a><span class="fu">dim</span>(dat_b)</span>
<span id="cb67-26"><a href="figure-2.html#cb67-26" tabindex="-1"></a></span>
<span id="cb67-27"><a href="figure-2.html#cb67-27" tabindex="-1"></a>dat_t <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb67-28"><a href="figure-2.html#cb67-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample_t<span class="sc">$</span>METc_BM_D0_ID) <span class="sc">%&gt;%</span></span>
<span id="cb67-29"><a href="figure-2.html#cb67-29" tabindex="-1"></a>  <span class="fu">log1p</span>()</span>
<span id="cb67-30"><a href="figure-2.html#cb67-30" tabindex="-1"></a><span class="fu">dim</span>(dat_t)</span>
<span id="cb67-31"><a href="figure-2.html#cb67-31" tabindex="-1"></a></span>
<span id="cb67-32"><a href="figure-2.html#cb67-32" tabindex="-1"></a>dat_all <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb67-33"><a href="figure-2.html#cb67-33" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample_info<span class="sc">$</span>METc_BM_D0_ID) <span class="sc">%&gt;%</span></span>
<span id="cb67-34"><a href="figure-2.html#cb67-34" tabindex="-1"></a>  <span class="fu">log1p</span>()</span>
<span id="cb67-35"><a href="figure-2.html#cb67-35" tabindex="-1"></a><span class="fu">dim</span>(dat_all)</span>
<span id="cb67-36"><a href="figure-2.html#cb67-36" tabindex="-1"></a></span>
<span id="cb67-37"><a href="figure-2.html#cb67-37" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb67-38"><a href="figure-2.html#cb67-38" tabindex="-1"></a><span class="co">#  Step 2: Spearman</span></span>
<span id="cb67-39"><a href="figure-2.html#cb67-39" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb67-40"><a href="figure-2.html#cb67-40" tabindex="-1"></a>cor_b <span class="ot">&lt;-</span> <span class="fu">cor</span>(dat_b,<span class="at">method=</span><span class="st">&quot;spearman&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-41"><a href="figure-2.html#cb67-41" tabindex="-1"></a>  reshape2<span class="sc">::</span><span class="fu">melt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb67-42"><a href="figure-2.html#cb67-42" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Var1 <span class="sc">!=</span> Var2) <span class="sc">%&gt;%</span></span>
<span id="cb67-43"><a href="figure-2.html#cb67-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Var1=</span><span class="fu">as.character</span>(Var1)) <span class="sc">%&gt;%</span></span>
<span id="cb67-44"><a href="figure-2.html#cb67-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Var2=</span><span class="fu">as.character</span>(Var2)) <span class="sc">%&gt;%</span></span>
<span id="cb67-45"><a href="figure-2.html#cb67-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sample1=</span><span class="fu">ifelse</span>(Var1 <span class="sc">&gt;</span> Var2,Var1,Var2)) <span class="sc">%&gt;%</span></span>
<span id="cb67-46"><a href="figure-2.html#cb67-46" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sample2=</span><span class="fu">ifelse</span>(Var1 <span class="sc">&gt;</span> Var2,Var2,Var1)) <span class="sc">%&gt;%</span></span>
<span id="cb67-47"><a href="figure-2.html#cb67-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample1,sample2,value) <span class="sc">%&gt;%</span></span>
<span id="cb67-48"><a href="figure-2.html#cb67-48" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb67-49"><a href="figure-2.html#cb67-49" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">type=</span><span class="st">&quot;BCP-ALL&quot;</span>)</span>
<span id="cb67-50"><a href="figure-2.html#cb67-50" tabindex="-1"></a></span>
<span id="cb67-51"><a href="figure-2.html#cb67-51" tabindex="-1"></a>cor_t <span class="ot">&lt;-</span> <span class="fu">cor</span>(dat_t,<span class="at">method=</span><span class="st">&quot;spearman&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-52"><a href="figure-2.html#cb67-52" tabindex="-1"></a>  reshape2<span class="sc">::</span><span class="fu">melt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb67-53"><a href="figure-2.html#cb67-53" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Var1 <span class="sc">!=</span> Var2) <span class="sc">%&gt;%</span></span>
<span id="cb67-54"><a href="figure-2.html#cb67-54" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Var1=</span><span class="fu">as.character</span>(Var1)) <span class="sc">%&gt;%</span></span>
<span id="cb67-55"><a href="figure-2.html#cb67-55" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Var2=</span><span class="fu">as.character</span>(Var2)) <span class="sc">%&gt;%</span></span>
<span id="cb67-56"><a href="figure-2.html#cb67-56" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sample1=</span><span class="fu">ifelse</span>(Var1 <span class="sc">&gt;</span> Var2,Var1,Var2)) <span class="sc">%&gt;%</span></span>
<span id="cb67-57"><a href="figure-2.html#cb67-57" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sample2=</span><span class="fu">ifelse</span>(Var1 <span class="sc">&gt;</span> Var2,Var2,Var1)) <span class="sc">%&gt;%</span></span>
<span id="cb67-58"><a href="figure-2.html#cb67-58" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample1,sample2,value) <span class="sc">%&gt;%</span></span>
<span id="cb67-59"><a href="figure-2.html#cb67-59" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb67-60"><a href="figure-2.html#cb67-60" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">type=</span><span class="st">&quot;T-ALL&quot;</span>)</span>
<span id="cb67-61"><a href="figure-2.html#cb67-61" tabindex="-1"></a></span>
<span id="cb67-62"><a href="figure-2.html#cb67-62" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;b&quot;</span>)</span>
<span id="cb67-63"><a href="figure-2.html#cb67-63" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">median</span>(cor_b<span class="sc">$</span>value))</span>
<span id="cb67-64"><a href="figure-2.html#cb67-64" tabindex="-1"></a></span>
<span id="cb67-65"><a href="figure-2.html#cb67-65" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;t&quot;</span>)</span>
<span id="cb67-66"><a href="figure-2.html#cb67-66" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">median</span>(cor_t<span class="sc">$</span>value))</span>
<span id="cb67-67"><a href="figure-2.html#cb67-67" tabindex="-1"></a></span>
<span id="cb67-68"><a href="figure-2.html#cb67-68" tabindex="-1"></a>cor_all <span class="ot">&lt;-</span> <span class="fu">cor</span>(<span class="at">x=</span>dat_b,<span class="at">y=</span>dat_t,<span class="at">method=</span><span class="st">&quot;spearman&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-69"><a href="figure-2.html#cb67-69" tabindex="-1"></a>  reshape2<span class="sc">::</span><span class="fu">melt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb67-70"><a href="figure-2.html#cb67-70" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Var1=</span><span class="fu">as.character</span>(Var1)) <span class="sc">%&gt;%</span></span>
<span id="cb67-71"><a href="figure-2.html#cb67-71" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Var2=</span><span class="fu">as.character</span>(Var2)) <span class="sc">%&gt;%</span></span>
<span id="cb67-72"><a href="figure-2.html#cb67-72" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sample1=</span><span class="fu">ifelse</span>(Var1 <span class="sc">&gt;</span> Var2,Var1,Var2)) <span class="sc">%&gt;%</span></span>
<span id="cb67-73"><a href="figure-2.html#cb67-73" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sample2=</span><span class="fu">ifelse</span>(Var1 <span class="sc">&gt;</span> Var2,Var2,Var1)) <span class="sc">%&gt;%</span></span>
<span id="cb67-74"><a href="figure-2.html#cb67-74" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample1,sample2,value) <span class="sc">%&gt;%</span></span>
<span id="cb67-75"><a href="figure-2.html#cb67-75" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb67-76"><a href="figure-2.html#cb67-76" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">type=</span><span class="st">&quot;ALL-BvsT&quot;</span>)</span>
<span id="cb67-77"><a href="figure-2.html#cb67-77" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;B-T&quot;</span>)</span>
<span id="cb67-78"><a href="figure-2.html#cb67-78" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">median</span>(cor_all<span class="sc">$</span>value))</span>
<span id="cb67-79"><a href="figure-2.html#cb67-79" tabindex="-1"></a></span>
<span id="cb67-80"><a href="figure-2.html#cb67-80" tabindex="-1"></a>cor_result <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cor_b,cor_t,cor_all)</span>
<span id="cb67-81"><a href="figure-2.html#cb67-81" tabindex="-1"></a></span>
<span id="cb67-82"><a href="figure-2.html#cb67-82" tabindex="-1"></a>comparisons <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="fu">c</span>(<span class="st">&quot;ALL-BvsT&quot;</span>, <span class="st">&quot;BCP-ALL&quot;</span>),</span>
<span id="cb67-83"><a href="figure-2.html#cb67-83" tabindex="-1"></a>                     <span class="fu">c</span>(<span class="st">&quot;BCP-ALL&quot;</span>, <span class="st">&quot;T-ALL&quot;</span>),<span class="fu">c</span>(<span class="st">&quot;ALL-BvsT&quot;</span>, <span class="st">&quot;T-ALL&quot;</span>) )</span>
<span id="cb67-84"><a href="figure-2.html#cb67-84" tabindex="-1"></a></span>
<span id="cb67-85"><a href="figure-2.html#cb67-85" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb67-86"><a href="figure-2.html#cb67-86" tabindex="-1"></a><span class="co">#  Step 3: Boxplot</span></span>
<span id="cb67-87"><a href="figure-2.html#cb67-87" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb67-88"><a href="figure-2.html#cb67-88" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(cor_result,<span class="fu">aes</span>(type,value))<span class="sc">+</span></span>
<span id="cb67-89"><a href="figure-2.html#cb67-89" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">size=</span>.<span class="dv">3</span>,<span class="at">width=</span>.<span class="dv">2</span>,<span class="at">color=</span><span class="st">&quot;gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb67-90"><a href="figure-2.html#cb67-90" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">color=</span><span class="st">&quot;#D01910&quot;</span>,<span class="at">outlier.colour =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb67-91"><a href="figure-2.html#cb67-91" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">comparisons =</span> comparisons)<span class="sc">+</span></span>
<span id="cb67-92"><a href="figure-2.html#cb67-92" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb67-93"><a href="figure-2.html#cb67-93" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="fl">0.65</span>,<span class="fl">1.08</span>))<span class="sc">+</span></span>
<span id="cb67-94"><a href="figure-2.html#cb67-94" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>,<span class="at">y=</span><span class="st">&quot;Correlation coefficient&quot;</span>,<span class="at">title=</span><span class="st">&quot;Metabolism&quot;</span>)</span>
<span id="cb67-95"><a href="figure-2.html#cb67-95" tabindex="-1"></a></span>
<span id="cb67-96"><a href="figure-2.html#cb67-96" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure2/S3A_Correlation_boxplot.pdf&quot;</span>,p,<span class="at">width=</span><span class="dv">4</span>,<span class="at">height =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure2/S3A.png" width="302" style="display: block; margin: auto;" /></p>
</div>
<div id="s3-b-correlation-between-hc-pmmc-and-all-bmmc-mrd-" class="section level2 hasAnchor" number="17.6">
<h2><span class="header-section-number">17.6</span> (S3 B) Correlation Between HC PMMC And ALL BMMC MRD-<a href="figure-2.html#s3-b-correlation-between-hc-pmmc-and-all-bmmc-mrd-" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>The metabolome correlation between HC PMMC (n=12) and ALL BMMC MRD- (n=9)</strong> reveals BM MRD- was a transition state for patients to be recognized as near healthy.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="figure-2.html#cb68-1" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb68-2"><a href="figure-2.html#cb68-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb68-3"><a href="figure-2.html#cb68-3" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb68-4"><a href="figure-2.html#cb68-4" tabindex="-1"></a></span>
<span id="cb68-5"><a href="figure-2.html#cb68-5" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb68-6"><a href="figure-2.html#cb68-6" tabindex="-1"></a><span class="co">#  Step 1: Load data and set parameters</span></span>
<span id="cb68-7"><a href="figure-2.html#cb68-7" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb68-8"><a href="figure-2.html#cb68-8" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-9"><a href="figure-2.html#cb68-9" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb68-10"><a href="figure-2.html#cb68-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">label=</span>stringr<span class="sc">::</span><span class="fu">str_to_title</span>(label)) <span class="sc">%&gt;%</span></span>
<span id="cb68-11"><a href="figure-2.html#cb68-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(label,<span class="fu">contains</span>(<span class="st">&quot;H0&quot;</span>),<span class="fu">contains</span>(<span class="st">&quot;MRD&quot;</span>))</span>
<span id="cb68-12"><a href="figure-2.html#cb68-12" tabindex="-1"></a><span class="fu">dim</span>(dat)</span>
<span id="cb68-13"><a href="figure-2.html#cb68-13" tabindex="-1"></a></span>
<span id="cb68-14"><a href="figure-2.html#cb68-14" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb68-15"><a href="figure-2.html#cb68-15" tabindex="-1"></a><span class="co">#  Step 2: Correlation between HC PMMC and ALL BMMC MRD-</span></span>
<span id="cb68-16"><a href="figure-2.html#cb68-16" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb68-17"><a href="figure-2.html#cb68-17" tabindex="-1"></a>dat_BM_HC <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb68-18"><a href="figure-2.html#cb68-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;MRD&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb68-19"><a href="figure-2.html#cb68-19" tabindex="-1"></a>  <span class="fu">log1p</span>()</span>
<span id="cb68-20"><a href="figure-2.html#cb68-20" tabindex="-1"></a><span class="fu">dim</span>(dat_BM_HC)</span>
<span id="cb68-21"><a href="figure-2.html#cb68-21" tabindex="-1"></a></span>
<span id="cb68-22"><a href="figure-2.html#cb68-22" tabindex="-1"></a>dat_PB_HC <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb68-23"><a href="figure-2.html#cb68-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;H0&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb68-24"><a href="figure-2.html#cb68-24" tabindex="-1"></a>  <span class="fu">log1p</span>()</span>
<span id="cb68-25"><a href="figure-2.html#cb68-25" tabindex="-1"></a><span class="fu">dim</span>(dat_PB_HC)</span>
<span id="cb68-26"><a href="figure-2.html#cb68-26" tabindex="-1"></a></span>
<span id="cb68-27"><a href="figure-2.html#cb68-27" tabindex="-1"></a>PB_HC_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(dat_PB_HC,<span class="dv">1</span>,mean)</span>
<span id="cb68-28"><a href="figure-2.html#cb68-28" tabindex="-1"></a>BM_HC_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(dat_BM_HC,<span class="dv">1</span>,mean)</span>
<span id="cb68-29"><a href="figure-2.html#cb68-29" tabindex="-1"></a></span>
<span id="cb68-30"><a href="figure-2.html#cb68-30" tabindex="-1"></a>dat_mean <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">PBMC=</span>PB_HC_mean,<span class="at">BMMC=</span>BM_HC_mean)</span>
<span id="cb68-31"><a href="figure-2.html#cb68-31" tabindex="-1"></a></span>
<span id="cb68-32"><a href="figure-2.html#cb68-32" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggscatter</span>(dat_mean,<span class="at">x=</span><span class="st">&quot;PBMC&quot;</span>,<span class="at">y=</span><span class="st">&quot;BMMC&quot;</span>,<span class="at">color =</span> <span class="st">&quot;#00599F&quot;</span>,</span>
<span id="cb68-33"><a href="figure-2.html#cb68-33" tabindex="-1"></a><span class="at">add.params =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;#555555&quot;</span>),<span class="at">add=</span><span class="st">&quot;reg.line&quot;</span>,<span class="at">conf.int=</span><span class="cn">TRUE</span>,<span class="at">cor.coef=</span><span class="cn">TRUE</span>,<span class="at">cor.method=</span><span class="st">&quot;spearman&quot;</span>)<span class="sc">+</span></span>
<span id="cb68-34"><a href="figure-2.html#cb68-34" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">16</span>))<span class="sc">+</span></span>
<span id="cb68-35"><a href="figure-2.html#cb68-35" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">16</span>))<span class="sc">+</span></span>
<span id="cb68-36"><a href="figure-2.html#cb68-36" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;HC PBMC&quot;</span>)<span class="sc">+</span></span>
<span id="cb68-37"><a href="figure-2.html#cb68-37" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;MRD- BMMC&quot;</span>)</span>
<span id="cb68-38"><a href="figure-2.html#cb68-38" tabindex="-1"></a></span>
<span id="cb68-39"><a href="figure-2.html#cb68-39" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure2/S3B_HCvsMRD_cor.pdf&quot;</span>,p,<span class="at">width=</span><span class="fl">5.5</span>,<span class="at">height =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure2/S3B.png" width="346" style="display: block; margin: auto;" /></p>
</div>
<div id="s3-c-correlation-between-bmmc-and-pbmc" class="section level2 hasAnchor" number="17.7">
<h2><span class="header-section-number">17.7</span> (S3 C) Correlation Between BMMC And PBMC<a href="figure-2.html#s3-c-correlation-between-bmmc-and-pbmc" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <strong>metabolome correlation between BMMC (n=100) and PBMC (PB blast% &gt; 90%, n=6)</strong> indicates a high level of similarity between their intracellular metabolic features in patients with ALL.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="figure-2.html#cb69-1" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb69-2"><a href="figure-2.html#cb69-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb69-3"><a href="figure-2.html#cb69-3" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb69-4"><a href="figure-2.html#cb69-4" tabindex="-1"></a></span>
<span id="cb69-5"><a href="figure-2.html#cb69-5" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb69-6"><a href="figure-2.html#cb69-6" tabindex="-1"></a><span class="co">#  Step 1: Load data and set parameters</span></span>
<span id="cb69-7"><a href="figure-2.html#cb69-7" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb69-8"><a href="figure-2.html#cb69-8" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-9"><a href="figure-2.html#cb69-9" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb69-10"><a href="figure-2.html#cb69-10" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>)</span>
<span id="cb69-11"><a href="figure-2.html#cb69-11" tabindex="-1"></a></span>
<span id="cb69-12"><a href="figure-2.html#cb69-12" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb69-13"><a href="figure-2.html#cb69-13" tabindex="-1"></a><span class="co">#  Step 2: Correlation between BMMC and PBMC</span></span>
<span id="cb69-14"><a href="figure-2.html#cb69-14" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb69-15"><a href="figure-2.html#cb69-15" tabindex="-1"></a>dat_PB <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb69-16"><a href="figure-2.html#cb69-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;PB_D0&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb69-17"><a href="figure-2.html#cb69-17" tabindex="-1"></a>  <span class="fu">log1p</span>()</span>
<span id="cb69-18"><a href="figure-2.html#cb69-18" tabindex="-1"></a><span class="fu">dim</span>(dat_PB)</span>
<span id="cb69-19"><a href="figure-2.html#cb69-19" tabindex="-1"></a></span>
<span id="cb69-20"><a href="figure-2.html#cb69-20" tabindex="-1"></a>dat_BM <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb69-21"><a href="figure-2.html#cb69-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;BM_D0&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb69-22"><a href="figure-2.html#cb69-22" tabindex="-1"></a>  <span class="fu">log1p</span>()</span>
<span id="cb69-23"><a href="figure-2.html#cb69-23" tabindex="-1"></a><span class="fu">dim</span>(dat_BM)</span>
<span id="cb69-24"><a href="figure-2.html#cb69-24" tabindex="-1"></a></span>
<span id="cb69-25"><a href="figure-2.html#cb69-25" tabindex="-1"></a>PB_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(dat_PB,<span class="dv">1</span>,mean)</span>
<span id="cb69-26"><a href="figure-2.html#cb69-26" tabindex="-1"></a>BM_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(dat_BM,<span class="dv">1</span>,mean)</span>
<span id="cb69-27"><a href="figure-2.html#cb69-27" tabindex="-1"></a></span>
<span id="cb69-28"><a href="figure-2.html#cb69-28" tabindex="-1"></a>dat_mean <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">PBMC=</span>PB_mean,<span class="at">BMMC=</span>BM_mean)</span>
<span id="cb69-29"><a href="figure-2.html#cb69-29" tabindex="-1"></a></span>
<span id="cb69-30"><a href="figure-2.html#cb69-30" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggscatter</span>(dat_mean,<span class="at">x=</span><span class="st">&quot;PBMC&quot;</span>,<span class="at">y=</span><span class="st">&quot;BMMC&quot;</span>,<span class="at">color =</span> <span class="st">&quot;brown&quot;</span>,</span>
<span id="cb69-31"><a href="figure-2.html#cb69-31" tabindex="-1"></a>               <span class="at">add=</span><span class="st">&quot;reg.line&quot;</span>,<span class="at">conf.int=</span><span class="cn">TRUE</span>,<span class="at">cor.coef=</span><span class="cn">TRUE</span>,<span class="at">cor.method=</span><span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb69-32"><a href="figure-2.html#cb69-32" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure2/S3C_PBMCvsBMMC_cor.pdf&quot;</span>,p,<span class="at">width=</span><span class="fl">5.5</span>,<span class="at">height =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure2/S3C.png" width="357" style="display: block; margin: auto;" /></p>
</div>
<div id="s3-d-differential-analyses" class="section level2 hasAnchor" number="17.8">
<h2><span class="header-section-number">17.8</span> (S3 D) Differential Analyses<a href="figure-2.html#s3-d-differential-analyses" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Differential analyses</strong> were conducted in HC PBMC (n=12) and ALL PBMC/BMMC (n=106). The significant differential metabolites were identified using the criteria: P &lt; 0.05, log2(Fold change) &gt; abs(0.26).</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="figure-2.html#cb70-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb70-2"><a href="figure-2.html#cb70-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb70-3"><a href="figure-2.html#cb70-3" tabindex="-1"></a></span>
<span id="cb70-4"><a href="figure-2.html#cb70-4" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb70-5"><a href="figure-2.html#cb70-5" tabindex="-1"></a><span class="co">#  Step 1: Set parameters</span></span>
<span id="cb70-6"><a href="figure-2.html#cb70-6" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb70-7"><a href="figure-2.html#cb70-7" tabindex="-1"></a>mark_gene <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(<span class="st">&quot;Malonic Acid&quot;</span>,<span class="st">&quot;Cdp&quot;</span>,<span class="st">&quot;Dtmp&quot;</span>,<span class="st">&quot;Cytosine&quot;</span>,<span class="st">&quot;Damp&quot;</span>,<span class="st">&quot;Adp&quot;</span>,<span class="st">&quot;Gdp&quot;</span>,<span class="st">&quot;Deoxyadenosine&quot;</span>, <span class="st">&quot;Udp&quot;</span>,<span class="st">&quot;L-Glutamine&quot;</span>,<span class="st">&quot;Nicotinamide Ribotide&quot;</span>,<span class="st">&quot;Fgar&quot;</span>,<span class="st">&quot;Xmp&quot;</span>,<span class="st">&quot;Ribulose 5-Phosphate&quot;</span> ,<span class="st">&quot;Xylulose 5-Phosphate&quot;</span>,<span class="st">&quot;Fmn&quot;</span>,<span class="st">&quot;Adp&quot;</span>,<span class="st">&quot;Fumaric Acid&quot;</span>,<span class="st">&quot;L-Malic Acid&quot;</span>,<span class="st">&quot;Citric Acid&quot;</span>,<span class="st">&quot;Sn-Glycero-3-Phosphate&quot;</span>,<span class="st">&quot;Ribulose 5-Phosphate&quot;</span>,<span class="st">&quot;Xylulose 5-Phosphate&quot;</span>))</span>
<span id="cb70-8"><a href="figure-2.html#cb70-8" tabindex="-1"></a></span>
<span id="cb70-9"><a href="figure-2.html#cb70-9" tabindex="-1"></a><span class="do">## Differential analysis visualization</span></span>
<span id="cb70-10"><a href="figure-2.html#cb70-10" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure2/1.BMMCvsHC.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-11"><a href="figure-2.html#cb70-11" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb70-12"><a href="figure-2.html#cb70-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Condition=</span><span class="fu">ifelse</span>(logFC <span class="sc">&gt;</span> <span class="fl">0.26</span> <span class="sc">&amp;</span> P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>,<span class="st">&quot;Up&quot;</span>,</span>
<span id="cb70-13"><a href="figure-2.html#cb70-13" tabindex="-1"></a>                          <span class="fu">ifelse</span>(logFC <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.26</span> <span class="sc">&amp;</span> P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>,<span class="st">&quot;Down&quot;</span>,<span class="st">&quot;Not Sig&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb70-14"><a href="figure-2.html#cb70-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Condition=</span><span class="fu">factor</span>(Condition,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Up&quot;</span>,<span class="st">&quot;Down&quot;</span>,<span class="st">&quot;Not Sig&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb70-15"><a href="figure-2.html#cb70-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name=</span>stringr<span class="sc">::</span><span class="fu">str_to_title</span>(name)) <span class="sc">%&gt;%</span></span>
<span id="cb70-16"><a href="figure-2.html#cb70-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">label=</span><span class="fu">ifelse</span>(name <span class="sc">%in%</span> mark_gene,name,<span class="cn">NA</span>))</span>
<span id="cb70-17"><a href="figure-2.html#cb70-17" tabindex="-1"></a></span>
<span id="cb70-18"><a href="figure-2.html#cb70-18" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb70-19"><a href="figure-2.html#cb70-19" tabindex="-1"></a><span class="co">#  Step 2: Volcano plot</span></span>
<span id="cb70-20"><a href="figure-2.html#cb70-20" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb70-21"><a href="figure-2.html#cb70-21" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mydata,<span class="fu">aes</span>(logFC,<span class="sc">-</span><span class="fu">log10</span>(P.Value)))<span class="sc">+</span></span>
<span id="cb70-22"><a href="figure-2.html#cb70-22" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Condition),<span class="at">size=</span><span class="dv">2</span>,<span class="at">alpha=</span><span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb70-23"><a href="figure-2.html#cb70-23" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.26</span>,<span class="fl">0.26</span>), <span class="at">linetype =</span> <span class="st">&#39;dashed&#39;</span>,<span class="at">color=</span><span class="st">&quot;gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb70-24"><a href="figure-2.html#cb70-24" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fu">log10</span>(<span class="fl">0.05</span>),<span class="at">linetype=</span><span class="st">&#39;dashed&#39;</span>,<span class="at">color=</span><span class="st">&quot;gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb70-25"><a href="figure-2.html#cb70-25" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label=</span>label),<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb70-26"><a href="figure-2.html#cb70-26" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Up&quot;</span><span class="ot">=</span><span class="st">&quot;#FD6AB0&quot;</span>,<span class="st">&quot;Not Sig&quot;</span><span class="ot">=</span><span class="st">&quot;gray&quot;</span>,<span class="st">&quot;Down&quot;</span><span class="ot">=</span><span class="st">&quot;#00AE4C&quot;</span>))<span class="sc">+</span></span>
<span id="cb70-27"><a href="figure-2.html#cb70-27" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb70-28"><a href="figure-2.html#cb70-28" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb70-29"><a href="figure-2.html#cb70-29" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;log2(Fold Change)&quot;</span>,<span class="at">y=</span><span class="st">&quot;-log10(P Value)&quot;</span>)</span>
<span id="cb70-30"><a href="figure-2.html#cb70-30" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure2/S3D_Diff.pdf&quot;</span>,p,<span class="at">width=</span><span class="dv">5</span>,<span class="at">height =</span> <span class="fl">4.5</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure2/S3D.png" width="348" style="display: block; margin: auto;" /></p>
</div>
<div id="s3-e-volcano-plot-of-bmmc-d0-vs.-mrd-" class="section level2 hasAnchor" number="17.9">
<h2><span class="header-section-number">17.9</span> (S3 E) Volcano Plot of BMMC-D0 vs. MRD-<a href="figure-2.html#s3-e-volcano-plot-of-bmmc-d0-vs.-mrd-" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <strong>volcano plot of BMMC-D0 vs. MRD-</strong>, most of the differential metabolites are consistent with panel d.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="figure-2.html#cb71-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb71-2"><a href="figure-2.html#cb71-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb71-3"><a href="figure-2.html#cb71-3" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb71-4"><a href="figure-2.html#cb71-4" tabindex="-1"></a></span>
<span id="cb71-5"><a href="figure-2.html#cb71-5" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb71-6"><a href="figure-2.html#cb71-6" tabindex="-1"></a><span class="co">#  Step 1: Load data and set parameters</span></span>
<span id="cb71-7"><a href="figure-2.html#cb71-7" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb71-8"><a href="figure-2.html#cb71-8" tabindex="-1"></a>sample <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-9"><a href="figure-2.html#cb71-9" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb71-10"><a href="figure-2.html#cb71-10" tabindex="-1"></a></span>
<span id="cb71-11"><a href="figure-2.html#cb71-11" tabindex="-1"></a>sample_D0 <span class="ot">&lt;-</span> sample <span class="sc">%&gt;%</span></span>
<span id="cb71-12"><a href="figure-2.html#cb71-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(METc_BM_D0_ID))</span>
<span id="cb71-13"><a href="figure-2.html#cb71-13" tabindex="-1"></a></span>
<span id="cb71-14"><a href="figure-2.html#cb71-14" tabindex="-1"></a>sample_MRD <span class="ot">&lt;-</span> sample <span class="sc">%&gt;%</span></span>
<span id="cb71-15"><a href="figure-2.html#cb71-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">METc_BM_MRD-_ID</span><span class="st">`</span>))</span>
<span id="cb71-16"><a href="figure-2.html#cb71-16" tabindex="-1"></a></span>
<span id="cb71-17"><a href="figure-2.html#cb71-17" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-18"><a href="figure-2.html#cb71-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(label,<span class="fu">all_of</span>(sample_D0<span class="sc">$</span>METc_BM_D0_ID),<span class="fu">all_of</span>(sample_MRD<span class="sc">$</span><span class="st">`</span><span class="at">METc_BM_MRD-_ID</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb71-19"><a href="figure-2.html#cb71-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">RJ-19004_METc_BM_MRD-</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb71-20"><a href="figure-2.html#cb71-20" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>)</span>
<span id="cb71-21"><a href="figure-2.html#cb71-21" tabindex="-1"></a></span>
<span id="cb71-22"><a href="figure-2.html#cb71-22" tabindex="-1"></a><span class="do">## Differential analysis</span></span>
<span id="cb71-23"><a href="figure-2.html#cb71-23" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">log2</span>(dat<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb71-24"><a href="figure-2.html#cb71-24" tabindex="-1"></a></span>
<span id="cb71-25"><a href="figure-2.html#cb71-25" tabindex="-1"></a>group <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;tumor&quot;</span>,<span class="dv">100</span>),<span class="fu">rep</span>(<span class="st">&quot;normal&quot;</span>,<span class="dv">9</span>))</span>
<span id="cb71-26"><a href="figure-2.html#cb71-26" tabindex="-1"></a></span>
<span id="cb71-27"><a href="figure-2.html#cb71-27" tabindex="-1"></a>metabolite_all <span class="ot">&lt;-</span> <span class="fu">mlimma</span>(dat,group)</span>
<span id="cb71-28"><a href="figure-2.html#cb71-28" tabindex="-1"></a></span>
<span id="cb71-29"><a href="figure-2.html#cb71-29" tabindex="-1"></a>metabolite_diff <span class="ot">&lt;-</span> metabolite_all <span class="sc">%&gt;%</span></span>
<span id="cb71-30"><a href="figure-2.html#cb71-30" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(logFC) <span class="sc">&gt;</span> <span class="fl">0.26</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-31"><a href="figure-2.html#cb71-31" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb71-32"><a href="figure-2.html#cb71-32" tabindex="-1"></a></span>
<span id="cb71-33"><a href="figure-2.html#cb71-33" tabindex="-1"></a>mark_gene <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(<span class="st">&quot;Cytosine&quot;</span>,<span class="st">&quot;Adp&quot;</span>, <span class="st">&quot;Xmp&quot;</span>,<span class="st">&quot;Nicotinamide Ribotide&quot;</span>,<span class="st">&quot;Fumaric Acid&quot;</span>))</span>
<span id="cb71-34"><a href="figure-2.html#cb71-34" tabindex="-1"></a></span>
<span id="cb71-35"><a href="figure-2.html#cb71-35" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> metabolite_all <span class="sc">%&gt;%</span></span>
<span id="cb71-36"><a href="figure-2.html#cb71-36" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb71-37"><a href="figure-2.html#cb71-37" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Condition=</span><span class="fu">ifelse</span>(logFC <span class="sc">&gt;</span> <span class="fl">0.26</span> <span class="sc">&amp;</span> P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>,<span class="st">&quot;Up&quot;</span>,</span>
<span id="cb71-38"><a href="figure-2.html#cb71-38" tabindex="-1"></a>                          <span class="fu">ifelse</span>(logFC <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.26</span> <span class="sc">&amp;</span> P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>,<span class="st">&quot;Down&quot;</span>,<span class="st">&quot;Not Sig&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb71-39"><a href="figure-2.html#cb71-39" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Condition=</span><span class="fu">factor</span>(Condition,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Up&quot;</span>,<span class="st">&quot;Down&quot;</span>,<span class="st">&quot;Not Sig&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb71-40"><a href="figure-2.html#cb71-40" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name=</span>stringr<span class="sc">::</span><span class="fu">str_to_title</span>(name)) <span class="sc">%&gt;%</span></span>
<span id="cb71-41"><a href="figure-2.html#cb71-41" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">label=</span><span class="fu">ifelse</span>(name <span class="sc">%in%</span> mark_gene,name,<span class="cn">NA</span>))</span>
<span id="cb71-42"><a href="figure-2.html#cb71-42" tabindex="-1"></a></span>
<span id="cb71-43"><a href="figure-2.html#cb71-43" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb71-44"><a href="figure-2.html#cb71-44" tabindex="-1"></a><span class="co">#  Step 2: Volcano plot</span></span>
<span id="cb71-45"><a href="figure-2.html#cb71-45" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb71-46"><a href="figure-2.html#cb71-46" tabindex="-1"></a>p <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(mydata,ggplot2<span class="sc">::</span><span class="fu">aes</span>(logFC,<span class="sc">-</span><span class="fu">log10</span>(P.Value)))<span class="sc">+</span></span>
<span id="cb71-47"><a href="figure-2.html#cb71-47" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color=</span>Condition),<span class="at">size=</span><span class="dv">2</span>,<span class="at">alpha=</span><span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb71-48"><a href="figure-2.html#cb71-48" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.26</span>,<span class="fl">0.26</span>), <span class="at">linetype =</span> <span class="st">&#39;dashed&#39;</span>,<span class="at">color=</span><span class="st">&quot;gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb71-49"><a href="figure-2.html#cb71-49" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fu">log10</span>(<span class="fl">0.05</span>),<span class="at">linetype=</span><span class="st">&#39;dashed&#39;</span>,<span class="at">color=</span><span class="st">&quot;gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb71-50"><a href="figure-2.html#cb71-50" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">label=</span>label),<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb71-51"><a href="figure-2.html#cb71-51" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Up&quot;</span><span class="ot">=</span><span class="st">&quot;#D01910&quot;</span>,<span class="st">&quot;Not Sig&quot;</span><span class="ot">=</span><span class="st">&quot;gray&quot;</span>,<span class="st">&quot;Down&quot;</span><span class="ot">=</span><span class="st">&quot;#00599F&quot;</span>))<span class="sc">+</span></span>
<span id="cb71-52"><a href="figure-2.html#cb71-52" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb71-53"><a href="figure-2.html#cb71-53" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid.major =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),<span class="at">panel.grid.minor =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb71-54"><a href="figure-2.html#cb71-54" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;log2(Fold Change)&quot;</span>,<span class="at">y=</span><span class="st">&quot;-log10(P Value)&quot;</span>)</span>
<span id="cb71-55"><a href="figure-2.html#cb71-55" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure2/S3E_Volcano.pdf&quot;</span>,p,<span class="at">width=</span><span class="dv">5</span>,<span class="at">height =</span> <span class="fl">4.5</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure2/S3E.png" width="354" style="display: block; margin: auto;" /></p>
</div>
<div id="s3-f-abundance-boxplot" class="section level2 hasAnchor" number="17.10">
<h2><span class="header-section-number">17.10</span> (S3 F) Abundance Boxplot<a href="figure-2.html#s3-f-abundance-boxplot" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <strong>abundance boxplots</strong> for significantly disturbed metabolites identified in energy, nucleotide and glycerolipid metabolism.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="figure-2.html#cb72-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb72-2"><a href="figure-2.html#cb72-2" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb72-3"><a href="figure-2.html#cb72-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb72-4"><a href="figure-2.html#cb72-4" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb72-5"><a href="figure-2.html#cb72-5" tabindex="-1"></a></span>
<span id="cb72-6"><a href="figure-2.html#cb72-6" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb72-7"><a href="figure-2.html#cb72-7" tabindex="-1"></a><span class="co">#  Step 1: Load data and conduct mlimma</span></span>
<span id="cb72-8"><a href="figure-2.html#cb72-8" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb72-9"><a href="figure-2.html#cb72-9" tabindex="-1"></a><span class="do">## BMMC vs HC</span></span>
<span id="cb72-10"><a href="figure-2.html#cb72-10" tabindex="-1"></a>sample_info_temp <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-11"><a href="figure-2.html#cb72-11" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb72-12"><a href="figure-2.html#cb72-12" tabindex="-1"></a>sample_info_BH <span class="ot">&lt;-</span> sample_info_temp <span class="sc">%&gt;%</span></span>
<span id="cb72-13"><a href="figure-2.html#cb72-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(METc_BM_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb72-14"><a href="figure-2.html#cb72-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(METc_BM_D0_ID) <span class="sc">%&gt;%</span></span>
<span id="cb72-15"><a href="figure-2.html#cb72-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;id&quot;</span><span class="ot">=</span><span class="st">&quot;METc_BM_D0_ID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-16"><a href="figure-2.html#cb72-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id)</span>
<span id="cb72-17"><a href="figure-2.html#cb72-17" tabindex="-1"></a></span>
<span id="cb72-18"><a href="figure-2.html#cb72-18" tabindex="-1"></a>dat_filter_BH <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-19"><a href="figure-2.html#cb72-19" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-20"><a href="figure-2.html#cb72-20" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-21"><a href="figure-2.html#cb72-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample_info_BH<span class="sc">$</span>id,<span class="fu">starts_with</span>(<span class="st">&quot;H&quot;</span>))</span>
<span id="cb72-22"><a href="figure-2.html#cb72-22" tabindex="-1"></a></span>
<span id="cb72-23"><a href="figure-2.html#cb72-23" tabindex="-1"></a>dat_filter_BH <span class="ot">&lt;-</span> <span class="fu">log2</span>(dat_filter_BH<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb72-24"><a href="figure-2.html#cb72-24" tabindex="-1"></a><span class="fu">dim</span>(dat_filter_BH)</span>
<span id="cb72-25"><a href="figure-2.html#cb72-25" tabindex="-1"></a></span>
<span id="cb72-26"><a href="figure-2.html#cb72-26" tabindex="-1"></a>matching_columns <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;BM&quot;</span>,<span class="fu">colnames</span>(dat_filter_BH),<span class="at">value =</span> T)</span>
<span id="cb72-27"><a href="figure-2.html#cb72-27" tabindex="-1"></a><span class="fu">length</span>(matching_columns)</span>
<span id="cb72-28"><a href="figure-2.html#cb72-28" tabindex="-1"></a><span class="fu">length</span>(dat_filter_BH)</span>
<span id="cb72-29"><a href="figure-2.html#cb72-29" tabindex="-1"></a></span>
<span id="cb72-30"><a href="figure-2.html#cb72-30" tabindex="-1"></a>group_BH <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;tumor&quot;</span>,<span class="dv">100</span>),<span class="fu">rep</span>(<span class="st">&quot;normal&quot;</span>,<span class="dv">12</span>))</span>
<span id="cb72-31"><a href="figure-2.html#cb72-31" tabindex="-1"></a><span class="fu">table</span>(group_BH)</span>
<span id="cb72-32"><a href="figure-2.html#cb72-32" tabindex="-1"></a></span>
<span id="cb72-33"><a href="figure-2.html#cb72-33" tabindex="-1"></a>metabolite_BH <span class="ot">&lt;-</span> <span class="fu">mlimma</span>(dat_filter_BH,group_BH)</span>
<span id="cb72-34"><a href="figure-2.html#cb72-34" tabindex="-1"></a></span>
<span id="cb72-35"><a href="figure-2.html#cb72-35" tabindex="-1"></a><span class="fu">write.table</span>(metabolite_BH,<span class="st">&quot;result/Figure2/S3F_BMMCvsHC.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb72-36"><a href="figure-2.html#cb72-36" tabindex="-1"></a></span>
<span id="cb72-37"><a href="figure-2.html#cb72-37" tabindex="-1"></a><span class="do">## PBMC vs HC</span></span>
<span id="cb72-38"><a href="figure-2.html#cb72-38" tabindex="-1"></a>sample_info_temp <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-39"><a href="figure-2.html#cb72-39" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb72-40"><a href="figure-2.html#cb72-40" tabindex="-1"></a>sample_info_PH <span class="ot">&lt;-</span> sample_info_temp <span class="sc">%&gt;%</span></span>
<span id="cb72-41"><a href="figure-2.html#cb72-41" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(METc_PB_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb72-42"><a href="figure-2.html#cb72-42" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(METc_PB_D0_ID) <span class="sc">%&gt;%</span></span>
<span id="cb72-43"><a href="figure-2.html#cb72-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;id&quot;</span><span class="ot">=</span><span class="st">&quot;METc_PB_D0_ID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-44"><a href="figure-2.html#cb72-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id)</span>
<span id="cb72-45"><a href="figure-2.html#cb72-45" tabindex="-1"></a></span>
<span id="cb72-46"><a href="figure-2.html#cb72-46" tabindex="-1"></a>dat_filter_PH <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-47"><a href="figure-2.html#cb72-47" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-48"><a href="figure-2.html#cb72-48" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-49"><a href="figure-2.html#cb72-49" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample_info_PH<span class="sc">$</span>id,<span class="fu">starts_with</span>(<span class="st">&quot;H&quot;</span>))</span>
<span id="cb72-50"><a href="figure-2.html#cb72-50" tabindex="-1"></a></span>
<span id="cb72-51"><a href="figure-2.html#cb72-51" tabindex="-1"></a>dat_filter_PH <span class="ot">&lt;-</span> <span class="fu">log2</span>(dat_filter_PH<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb72-52"><a href="figure-2.html#cb72-52" tabindex="-1"></a><span class="fu">dim</span>(dat_filter_PH)</span>
<span id="cb72-53"><a href="figure-2.html#cb72-53" tabindex="-1"></a>matching_columns <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;H&quot;</span>,<span class="fu">colnames</span>(dat_filter_PH),<span class="at">value =</span> T)</span>
<span id="cb72-54"><a href="figure-2.html#cb72-54" tabindex="-1"></a><span class="fu">length</span>(matching_columns)</span>
<span id="cb72-55"><a href="figure-2.html#cb72-55" tabindex="-1"></a><span class="fu">length</span>(dat_filter_PH)</span>
<span id="cb72-56"><a href="figure-2.html#cb72-56" tabindex="-1"></a></span>
<span id="cb72-57"><a href="figure-2.html#cb72-57" tabindex="-1"></a>group_PH <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;tumor&quot;</span>,<span class="dv">6</span>),<span class="fu">rep</span>(<span class="st">&quot;normal&quot;</span>,<span class="dv">12</span>))</span>
<span id="cb72-58"><a href="figure-2.html#cb72-58" tabindex="-1"></a><span class="fu">table</span>(group_PH)</span>
<span id="cb72-59"><a href="figure-2.html#cb72-59" tabindex="-1"></a></span>
<span id="cb72-60"><a href="figure-2.html#cb72-60" tabindex="-1"></a>metabolite_PH <span class="ot">&lt;-</span> <span class="fu">mlimma</span>(dat_filter_PH,group_PH)</span>
<span id="cb72-61"><a href="figure-2.html#cb72-61" tabindex="-1"></a></span>
<span id="cb72-62"><a href="figure-2.html#cb72-62" tabindex="-1"></a><span class="fu">write.table</span>(metabolite_PH,<span class="st">&quot;result/Figure2/S3F_PBMCvsHC.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb72-63"><a href="figure-2.html#cb72-63" tabindex="-1"></a></span>
<span id="cb72-64"><a href="figure-2.html#cb72-64" tabindex="-1"></a><span class="do">## BMMC vs PBMC</span></span>
<span id="cb72-65"><a href="figure-2.html#cb72-65" tabindex="-1"></a>sample_info_temp <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-66"><a href="figure-2.html#cb72-66" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb72-67"><a href="figure-2.html#cb72-67" tabindex="-1"></a></span>
<span id="cb72-68"><a href="figure-2.html#cb72-68" tabindex="-1"></a>sample_info_BM <span class="ot">&lt;-</span> sample_info_temp <span class="sc">%&gt;%</span></span>
<span id="cb72-69"><a href="figure-2.html#cb72-69" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>((<span class="sc">!</span><span class="fu">is.na</span>(METc_BM_D0_ID))) <span class="sc">%&gt;%</span></span>
<span id="cb72-70"><a href="figure-2.html#cb72-70" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(METc_BM_D0_ID) <span class="sc">%&gt;%</span></span>
<span id="cb72-71"><a href="figure-2.html#cb72-71" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;id&quot;</span><span class="ot">=</span><span class="st">&quot;METc_BM_D0_ID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-72"><a href="figure-2.html#cb72-72" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id)</span>
<span id="cb72-73"><a href="figure-2.html#cb72-73" tabindex="-1"></a></span>
<span id="cb72-74"><a href="figure-2.html#cb72-74" tabindex="-1"></a>sample_info_PB <span class="ot">&lt;-</span> sample_info_temp <span class="sc">%&gt;%</span></span>
<span id="cb72-75"><a href="figure-2.html#cb72-75" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(METc_PB_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb72-76"><a href="figure-2.html#cb72-76" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(METc_PB_D0_ID) <span class="sc">%&gt;%</span></span>
<span id="cb72-77"><a href="figure-2.html#cb72-77" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;id&quot;</span><span class="ot">=</span><span class="st">&quot;METc_PB_D0_ID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-78"><a href="figure-2.html#cb72-78" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id)</span>
<span id="cb72-79"><a href="figure-2.html#cb72-79" tabindex="-1"></a></span>
<span id="cb72-80"><a href="figure-2.html#cb72-80" tabindex="-1"></a>sample_info_BP <span class="ot">&lt;-</span> <span class="fu">rbind</span>(sample_info_BM,sample_info_PB)</span>
<span id="cb72-81"><a href="figure-2.html#cb72-81" tabindex="-1"></a></span>
<span id="cb72-82"><a href="figure-2.html#cb72-82" tabindex="-1"></a>dat_filter_BP <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-83"><a href="figure-2.html#cb72-83" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-84"><a href="figure-2.html#cb72-84" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-85"><a href="figure-2.html#cb72-85" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample_info_BP<span class="sc">$</span>id)</span>
<span id="cb72-86"><a href="figure-2.html#cb72-86" tabindex="-1"></a>dat_filter_BP <span class="ot">&lt;-</span> <span class="fu">log2</span>(dat_filter_BP<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb72-87"><a href="figure-2.html#cb72-87" tabindex="-1"></a></span>
<span id="cb72-88"><a href="figure-2.html#cb72-88" tabindex="-1"></a>matching_columns <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;BM&quot;</span>, <span class="fu">colnames</span>(dat_filter_BP), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-89"><a href="figure-2.html#cb72-89" tabindex="-1"></a><span class="fu">length</span>(matching_columns)</span>
<span id="cb72-90"><a href="figure-2.html#cb72-90" tabindex="-1"></a><span class="fu">length</span>(dat_filter_BP)</span>
<span id="cb72-91"><a href="figure-2.html#cb72-91" tabindex="-1"></a></span>
<span id="cb72-92"><a href="figure-2.html#cb72-92" tabindex="-1"></a>group_BP <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;tumor&quot;</span>,<span class="dv">100</span>),<span class="fu">rep</span>(<span class="st">&quot;normal&quot;</span>,<span class="dv">6</span>))</span>
<span id="cb72-93"><a href="figure-2.html#cb72-93" tabindex="-1"></a><span class="fu">table</span>(group_BP)</span>
<span id="cb72-94"><a href="figure-2.html#cb72-94" tabindex="-1"></a></span>
<span id="cb72-95"><a href="figure-2.html#cb72-95" tabindex="-1"></a>metabolite_BP <span class="ot">&lt;-</span> <span class="fu">mlimma</span>(dat_filter_BP,group_BP)</span>
<span id="cb72-96"><a href="figure-2.html#cb72-96" tabindex="-1"></a></span>
<span id="cb72-97"><a href="figure-2.html#cb72-97" tabindex="-1"></a><span class="fu">write.table</span>(metabolite_BP,<span class="st">&quot;result/Figure2/S3F_BMMCvsPBMC.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb72-98"><a href="figure-2.html#cb72-98" tabindex="-1"></a></span>
<span id="cb72-99"><a href="figure-2.html#cb72-99" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb72-100"><a href="figure-2.html#cb72-100" tabindex="-1"></a><span class="co">#  Step 2: Select significantly disturbed metabolites</span></span>
<span id="cb72-101"><a href="figure-2.html#cb72-101" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb72-102"><a href="figure-2.html#cb72-102" tabindex="-1"></a><span class="do">## Significantly disturbed metabolites</span></span>
<span id="cb72-103"><a href="figure-2.html#cb72-103" tabindex="-1"></a>name1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Fructose 1,6-Bisphosphate&quot;</span>,<span class="st">&quot;Citric Acid&quot;</span>,<span class="st">&quot;Adp&quot;</span>,<span class="st">&quot;Nicotinamide Ribotide&quot;</span>)</span>
<span id="cb72-104"><a href="figure-2.html#cb72-104" tabindex="-1"></a>name2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Gdp&quot;</span>,<span class="st">&quot;Udp&quot;</span>,<span class="st">&quot;Xmp&quot;</span>,<span class="st">&quot;Cytosine&quot;</span>)</span>
<span id="cb72-105"><a href="figure-2.html#cb72-105" tabindex="-1"></a>name3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Udp-Glucose&quot;</span>,<span class="st">&quot;Sn-Glycero-3-Phosphate&quot;</span>,<span class="st">&quot;Glucose 1-Phosphate&quot;</span>,<span class="st">&quot;Dihydroxyacetone Phosphate&quot;</span>)</span>
<span id="cb72-106"><a href="figure-2.html#cb72-106" tabindex="-1"></a>met_name <span class="ot">&lt;-</span> <span class="fu">c</span>(name1,name2,name3)</span>
<span id="cb72-107"><a href="figure-2.html#cb72-107" tabindex="-1"></a></span>
<span id="cb72-108"><a href="figure-2.html#cb72-108" tabindex="-1"></a><span class="do">## BMMC vs HC</span></span>
<span id="cb72-109"><a href="figure-2.html#cb72-109" tabindex="-1"></a>meta_filter_BH <span class="ot">&lt;-</span> metabolite_BH <span class="sc">%&gt;%</span> </span>
<span id="cb72-110"><a href="figure-2.html#cb72-110" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name=</span>stringr<span class="sc">::</span><span class="fu">str_to_title</span>(name)) <span class="sc">%&gt;%</span></span>
<span id="cb72-111"><a href="figure-2.html#cb72-111" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name <span class="sc">%in%</span> met_name) <span class="sc">%&gt;%</span></span>
<span id="cb72-112"><a href="figure-2.html#cb72-112" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(P.Value,name) <span class="sc">%&gt;%</span></span>
<span id="cb72-113"><a href="figure-2.html#cb72-113" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">group=</span><span class="fu">rep</span>(<span class="st">&quot;BH&quot;</span>,<span class="dv">12</span>))</span>
<span id="cb72-114"><a href="figure-2.html#cb72-114" tabindex="-1"></a></span>
<span id="cb72-115"><a href="figure-2.html#cb72-115" tabindex="-1"></a><span class="do">## PBMC vs HC</span></span>
<span id="cb72-116"><a href="figure-2.html#cb72-116" tabindex="-1"></a>meta_filter_PH <span class="ot">&lt;-</span> metabolite_PH <span class="sc">%&gt;%</span> </span>
<span id="cb72-117"><a href="figure-2.html#cb72-117" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name=</span>stringr<span class="sc">::</span><span class="fu">str_to_title</span>(name)) <span class="sc">%&gt;%</span></span>
<span id="cb72-118"><a href="figure-2.html#cb72-118" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name <span class="sc">%in%</span> met_name) <span class="sc">%&gt;%</span></span>
<span id="cb72-119"><a href="figure-2.html#cb72-119" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(P.Value,name) <span class="sc">%&gt;%</span></span>
<span id="cb72-120"><a href="figure-2.html#cb72-120" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">group=</span><span class="fu">rep</span>(<span class="st">&quot;PH&quot;</span>,<span class="dv">12</span>))</span>
<span id="cb72-121"><a href="figure-2.html#cb72-121" tabindex="-1"></a></span>
<span id="cb72-122"><a href="figure-2.html#cb72-122" tabindex="-1"></a><span class="do">## BMMC vs PBMC</span></span>
<span id="cb72-123"><a href="figure-2.html#cb72-123" tabindex="-1"></a>meta_filter_BP <span class="ot">&lt;-</span> metabolite_BP <span class="sc">%&gt;%</span> </span>
<span id="cb72-124"><a href="figure-2.html#cb72-124" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name=</span>stringr<span class="sc">::</span><span class="fu">str_to_title</span>(name)) <span class="sc">%&gt;%</span></span>
<span id="cb72-125"><a href="figure-2.html#cb72-125" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name <span class="sc">%in%</span> met_name) <span class="sc">%&gt;%</span></span>
<span id="cb72-126"><a href="figure-2.html#cb72-126" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(P.Value,name) <span class="sc">%&gt;%</span></span>
<span id="cb72-127"><a href="figure-2.html#cb72-127" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">group=</span><span class="fu">rep</span>(<span class="st">&quot;BP&quot;</span>,<span class="dv">12</span>))</span>
<span id="cb72-128"><a href="figure-2.html#cb72-128" tabindex="-1"></a></span>
<span id="cb72-129"><a href="figure-2.html#cb72-129" tabindex="-1"></a>meta_filter_all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(meta_filter_BH,meta_filter_BP,meta_filter_PH) <span class="sc">%&gt;%</span></span>
<span id="cb72-130"><a href="figure-2.html#cb72-130" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name=</span><span class="fu">factor</span>(name,<span class="at">levels =</span> met_name)) <span class="sc">%&gt;%</span></span>
<span id="cb72-131"><a href="figure-2.html#cb72-131" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(name)</span>
<span id="cb72-132"><a href="figure-2.html#cb72-132" tabindex="-1"></a><span class="fu">write.table</span>(meta_filter_all,<span class="st">&quot;result/Figure2/S3F_meta_groupcomparison.txt&quot;</span>,<span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,<span class="at">quote =</span> F,<span class="at">row.names =</span> F)</span>
<span id="cb72-133"><a href="figure-2.html#cb72-133" tabindex="-1"></a></span>
<span id="cb72-134"><a href="figure-2.html#cb72-134" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb72-135"><a href="figure-2.html#cb72-135" tabindex="-1"></a><span class="co">#  Step 3: Boxplot</span></span>
<span id="cb72-136"><a href="figure-2.html#cb72-136" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb72-137"><a href="figure-2.html#cb72-137" tabindex="-1"></a><span class="do">## Load data and set parameters</span></span>
<span id="cb72-138"><a href="figure-2.html#cb72-138" tabindex="-1"></a>sample_info1 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-139"><a href="figure-2.html#cb72-139" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-140"><a href="figure-2.html#cb72-140" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(METc_BM_D0_ID))</span>
<span id="cb72-141"><a href="figure-2.html#cb72-141" tabindex="-1"></a>sample_info2 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-142"><a href="figure-2.html#cb72-142" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-143"><a href="figure-2.html#cb72-143" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(METc_PB_D0_ID))</span>
<span id="cb72-144"><a href="figure-2.html#cb72-144" tabindex="-1"></a></span>
<span id="cb72-145"><a href="figure-2.html#cb72-145" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-146"><a href="figure-2.html#cb72-146" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-147"><a href="figure-2.html#cb72-147" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-148"><a href="figure-2.html#cb72-148" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(sample_info1<span class="sc">$</span>METc_BM_D0_ID),<span class="fu">all_of</span>(sample_info2<span class="sc">$</span>METc_PB_D0_ID),<span class="fu">starts_with</span>(<span class="st">&quot;H&quot;</span>))</span>
<span id="cb72-149"><a href="figure-2.html#cb72-149" tabindex="-1"></a></span>
<span id="cb72-150"><a href="figure-2.html#cb72-150" tabindex="-1"></a>group <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;A&quot;</span>,<span class="fu">length</span>(sample_info1<span class="sc">$</span>METc_BM_D0_ID)),</span>
<span id="cb72-151"><a href="figure-2.html#cb72-151" tabindex="-1"></a>           <span class="fu">rep</span>(<span class="st">&quot;P&quot;</span>,<span class="fu">length</span>(sample_info2<span class="sc">$</span>METc_PB_D0_ID)),</span>
<span id="cb72-152"><a href="figure-2.html#cb72-152" tabindex="-1"></a>           <span class="fu">rep</span>(<span class="st">&quot;HC&quot;</span>,<span class="fu">length</span>(<span class="fu">grep</span>(<span class="st">&quot;H&quot;</span>,<span class="fu">names</span>(dat)))))</span>
<span id="cb72-153"><a href="figure-2.html#cb72-153" tabindex="-1"></a></span>
<span id="cb72-154"><a href="figure-2.html#cb72-154" tabindex="-1"></a>dat_filter <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb72-155"><a href="figure-2.html#cb72-155" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb72-156"><a href="figure-2.html#cb72-156" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">label=</span>stringr<span class="sc">::</span><span class="fu">str_to_title</span>(label)) <span class="sc">%&gt;%</span></span>
<span id="cb72-157"><a href="figure-2.html#cb72-157" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(label <span class="sc">%in%</span> <span class="fu">c</span>(name1,name2,name3)) <span class="sc">%&gt;%</span> </span>
<span id="cb72-158"><a href="figure-2.html#cb72-158" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>)</span>
<span id="cb72-159"><a href="figure-2.html#cb72-159" tabindex="-1"></a></span>
<span id="cb72-160"><a href="figure-2.html#cb72-160" tabindex="-1"></a>dat_filter <span class="ot">&lt;-</span> <span class="fu">myscale</span>(<span class="fu">log2</span>(dat_filter<span class="sc">+</span><span class="dv">1</span>),<span class="at">method=</span><span class="st">&quot;raw_zscore&quot;</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb72-161"><a href="figure-2.html#cb72-161" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb72-162"><a href="figure-2.html#cb72-162" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb72-163"><a href="figure-2.html#cb72-163" tabindex="-1"></a>dat_filter<span class="sc">$</span>group <span class="ot">&lt;-</span> group</span>
<span id="cb72-164"><a href="figure-2.html#cb72-164" tabindex="-1"></a></span>
<span id="cb72-165"><a href="figure-2.html#cb72-165" tabindex="-1"></a>dat_melt <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(dat_filter,<span class="at">id=</span><span class="st">&quot;group&quot;</span>)</span>
<span id="cb72-166"><a href="figure-2.html#cb72-166" tabindex="-1"></a></span>
<span id="cb72-167"><a href="figure-2.html#cb72-167" tabindex="-1"></a>my_comparisons <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="fu">c</span>(<span class="st">&quot;HC&quot;</span>, <span class="st">&quot;P&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;HC&quot;</span>, <span class="st">&quot;A&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;P&quot;</span>, <span class="st">&quot;A&quot;</span>) )</span>
<span id="cb72-168"><a href="figure-2.html#cb72-168" tabindex="-1"></a></span>
<span id="cb72-169"><a href="figure-2.html#cb72-169" tabindex="-1"></a><span class="do">## Boxplot</span></span>
<span id="cb72-170"><a href="figure-2.html#cb72-170" tabindex="-1"></a>plot_list <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb72-171"><a href="figure-2.html#cb72-171" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(met_name)) {</span>
<span id="cb72-172"><a href="figure-2.html#cb72-172" tabindex="-1"></a>  dat_melt_filter <span class="ot">&lt;-</span> dat_melt <span class="sc">%&gt;%</span></span>
<span id="cb72-173"><a href="figure-2.html#cb72-173" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(variable<span class="sc">==</span>met_name[i]) <span class="sc">%&gt;%</span></span>
<span id="cb72-174"><a href="figure-2.html#cb72-174" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">group=</span><span class="fu">factor</span>(group,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;HC&quot;</span>,<span class="st">&quot;P&quot;</span>,<span class="st">&quot;A&quot;</span>)))</span>
<span id="cb72-175"><a href="figure-2.html#cb72-175" tabindex="-1"></a>  </span>
<span id="cb72-176"><a href="figure-2.html#cb72-176" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat_melt_filter, <span class="fu">aes</span>(<span class="at">x=</span>group,<span class="at">y =</span> value,<span class="at">fill=</span>group)) <span class="sc">+</span></span>
<span id="cb72-177"><a href="figure-2.html#cb72-177" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb72-178"><a href="figure-2.html#cb72-178" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="st">&quot;jitter&quot;</span>,<span class="at">size=</span><span class="fl">0.2</span>,<span class="at">alpha=</span><span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb72-179"><a href="figure-2.html#cb72-179" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;#007DDB&quot;</span>,<span class="st">&quot;#D01910&quot;</span>,<span class="st">&quot;purple&quot;</span>))<span class="sc">+</span></span>
<span id="cb72-180"><a href="figure-2.html#cb72-180" tabindex="-1"></a>    <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb72-181"><a href="figure-2.html#cb72-181" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>)<span class="sc">+</span><span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">7</span>,<span class="dv">7</span>)<span class="sc">+</span></span>
<span id="cb72-182"><a href="figure-2.html#cb72-182" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>,<span class="at">y=</span><span class="cn">NULL</span>,<span class="at">title =</span> <span class="fu">unique</span>(dat_melt_filter<span class="sc">$</span>variable))</span>
<span id="cb72-183"><a href="figure-2.html#cb72-183" tabindex="-1"></a>  plot_list[[i]] <span class="ot">&lt;-</span> p </span>
<span id="cb72-184"><a href="figure-2.html#cb72-184" tabindex="-1"></a>}</span>
<span id="cb72-185"><a href="figure-2.html#cb72-185" tabindex="-1"></a></span>
<span id="cb72-186"><a href="figure-2.html#cb72-186" tabindex="-1"></a>plot_grid <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> plot_list, <span class="at">nrow =</span> <span class="dv">3</span>)  </span>
<span id="cb72-187"><a href="figure-2.html#cb72-187" tabindex="-1"></a></span>
<span id="cb72-188"><a href="figure-2.html#cb72-188" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure2/S3F_AbunBoxplot.pdf&quot;</span>,plot_grid,<span class="at">width=</span><span class="dv">12</span>,<span class="at">height =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure2/S3F.png" width="681" style="display: block; margin: auto;" /></p>
</div>
<div id="s3-g-wgcna" class="section level2 hasAnchor" number="17.11">
<h2><span class="header-section-number">17.11</span> (S3 G) WGCNA<a href="figure-2.html#s3-g-wgcna" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>(left) WGCNA identified 13 metabolite modules (ME01–13) enriched in intracellular metabolomic data for ALL samples. Each network node represents one metabolite, color-coded by the different modules.<br />
(right) Overlay of significantly upregulated/downregulated metabolites between ALL and HC onto the network nodes.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="figure-2.html#cb73-1" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb73-2"><a href="figure-2.html#cb73-2" tabindex="-1"></a><span class="co">#  Step 1: WGCNA identified 13 metabolite modules (ME01–13) enriched in intracellular metabolomic data for ALL samples. </span></span>
<span id="cb73-3"><a href="figure-2.html#cb73-3" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb73-4"><a href="figure-2.html#cb73-4" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb73-5"><a href="figure-2.html#cb73-5" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb73-6"><a href="figure-2.html#cb73-6" tabindex="-1"></a><span class="do">## data</span></span>
<span id="cb73-7"><a href="figure-2.html#cb73-7" tabindex="-1"></a>node.data <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/node_position.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-8"><a href="figure-2.html#cb73-8" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb73-9"><a href="figure-2.html#cb73-9" tabindex="-1"></a>edge.data <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/edge_result.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-10"><a href="figure-2.html#cb73-10" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb73-11"><a href="figure-2.html#cb73-11" tabindex="-1"></a>color.module <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#CCCCCC&quot;</span>,<span class="st">&quot;#ecb888&quot;</span>,<span class="st">&quot;#af88bb&quot;</span>,<span class="st">&quot;#a032cb&quot;</span>,<span class="st">&quot;#efbed6&quot;</span>,<span class="st">&quot;#fc496a&quot;</span>,<span class="st">&quot;#b6d37f&quot;</span>,<span class="st">&quot;#589336&quot;</span>,<span class="st">&quot;#7fd68e&quot;</span>,<span class="st">&quot;#52c465&quot;</span>,</span>
<span id="cb73-12"><a href="figure-2.html#cb73-12" tabindex="-1"></a>                           <span class="st">&quot;#3372e0&quot;</span>,<span class="st">&quot;#84d7f6&quot;</span>,<span class="st">&quot;#5394c3&quot;</span>,<span class="st">&quot;#6376b3&quot;</span>,<span class="st">&quot;#7f6cd7&quot;</span>,<span class="st">&quot;#c4ceff&quot;</span>,<span class="st">&quot;#fc9d40&quot;</span>,<span class="st">&quot;#5c95e0&quot;</span>,<span class="st">&quot;#cd7560&quot;</span>,</span>
<span id="cb73-13"><a href="figure-2.html#cb73-13" tabindex="-1"></a>                           <span class="st">&quot;#ff70e4&quot;</span>, <span class="st">&quot;#ff8738&quot;</span>, <span class="st">&quot;#ffcead&quot;</span>,<span class="st">&quot;#1cbf8b&quot;</span>, <span class="st">&quot;#b76d38&quot;</span>, <span class="st">&quot;#1584ff&quot;</span>, <span class="st">&quot;#7f006d&quot;</span>, <span class="st">&quot;#ffd35f&quot;</span>,<span class="st">&quot;#E66F73&quot;</span>,</span>
<span id="cb73-14"><a href="figure-2.html#cb73-14" tabindex="-1"></a>                           <span class="st">&quot;#F57F20&quot;</span>,<span class="st">&quot;#1DBB95&quot;</span>,<span class="st">&quot;#9CB79F&quot;</span>,<span class="st">&quot;#F0B8D2&quot;</span>,<span class="st">&quot;#A0485E&quot;</span>,<span class="st">&quot;#A0688E&quot;</span>,<span class="st">&quot;#C7E1DF&quot;</span>,<span class="st">&quot;#51B1DF&quot;</span>,<span class="st">&quot;#6D97D7&quot;</span>,<span class="st">&quot;#5D6193&quot;</span>,</span>
<span id="cb73-15"><a href="figure-2.html#cb73-15" tabindex="-1"></a>                           <span class="st">&quot;#CEC3E0&quot;</span>,<span class="st">&quot;#A9917E&quot;</span>,<span class="st">&quot;#7C7D80&quot;</span>,<span class="st">&quot;#F4E192&quot;</span>,<span class="st">&quot;#ADD666&quot;</span>)</span>
<span id="cb73-16"><a href="figure-2.html#cb73-16" tabindex="-1"></a></span>
<span id="cb73-17"><a href="figure-2.html#cb73-17" tabindex="-1"></a>color.module <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#CCCCCC&quot;</span>,<span class="st">&quot;#ecb888&quot;</span>,<span class="st">&quot;#af88bb&quot;</span>,<span class="st">&quot;#a032cb&quot;</span>,<span class="st">&quot;#efbed6&quot;</span>,<span class="st">&quot;#fc496a&quot;</span>,<span class="st">&quot;#1584ff&quot;</span>,<span class="st">&quot;#ffd35f&quot;</span>,<span class="st">&quot;#7fd68e&quot;</span>,<span class="st">&quot;#52c465&quot;</span>,</span>
<span id="cb73-18"><a href="figure-2.html#cb73-18" tabindex="-1"></a>                           <span class="st">&quot;#F57F20&quot;</span>,<span class="st">&quot;#84d7f6&quot;</span>,<span class="st">&quot;#5394c3&quot;</span>,<span class="st">&quot;#6376b3&quot;</span>,<span class="st">&quot;#7f6cd7&quot;</span>,<span class="st">&quot;#c4ceff&quot;</span>,<span class="st">&quot;#A0485E&quot;</span>)</span>
<span id="cb73-19"><a href="figure-2.html#cb73-19" tabindex="-1"></a><span class="fu">names</span>(color.module) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;ME&quot;</span>, <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">length</span>(color.module)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb73-20"><a href="figure-2.html#cb73-20" tabindex="-1"></a><span class="do">## plot network </span></span>
<span id="cb73-21"><a href="figure-2.html#cb73-21" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()</span>
<span id="cb73-22"><a href="figure-2.html#cb73-22" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> from.x, <span class="at">y =</span> from.y, <span class="at">xend =</span> to.x, <span class="at">yend =</span> to.y),</span>
<span id="cb73-23"><a href="figure-2.html#cb73-23" tabindex="-1"></a>                        <span class="at">color =</span> <span class="st">&quot;#CCCCCC&quot;</span>, <span class="at">size =</span> <span class="fl">0.01</span>, <span class="at">data =</span> edge.data) <span class="co"># draw a straight line</span></span>
<span id="cb73-24"><a href="figure-2.html#cb73-24" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> pos.x, <span class="at">y =</span> pos.y, <span class="at">color =</span> Module), </span>
<span id="cb73-25"><a href="figure-2.html#cb73-25" tabindex="-1"></a>                      <span class="at">size =</span> <span class="dv">4</span>, <span class="at">data =</span> node.data) <span class="co"># add point</span></span>
<span id="cb73-26"><a href="figure-2.html#cb73-26" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>) <span class="sc">*</span> <span class="dv">2</span>) <span class="co"># specifies the minimum and maximum size </span></span>
<span id="cb73-27"><a href="figure-2.html#cb73-27" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">theme_void</span>()</span>
<span id="cb73-28"><a href="figure-2.html#cb73-28" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">&quot;MMI&quot;</span>))</span>
<span id="cb73-29"><a href="figure-2.html#cb73-29" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> color.module)</span>
<span id="cb73-30"><a href="figure-2.html#cb73-30" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;result/Figure2/S3G_WGCNA-Vasualization.pdf&quot;</span>), gg, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb73-31"><a href="figure-2.html#cb73-31" tabindex="-1"></a></span>
<span id="cb73-32"><a href="figure-2.html#cb73-32" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb73-33"><a href="figure-2.html#cb73-33" tabindex="-1"></a><span class="co">#  Step 2: verlay of significantly upregulated/downregulated metabolites between ALL and HC onto the network nodes. </span></span>
<span id="cb73-34"><a href="figure-2.html#cb73-34" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb73-35"><a href="figure-2.html#cb73-35" tabindex="-1"></a><span class="do">## data</span></span>
<span id="cb73-36"><a href="figure-2.html#cb73-36" tabindex="-1"></a>result_all <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure2/1.BMMCvsHC.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-37"><a href="figure-2.html#cb73-37" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb73-38"><a href="figure-2.html#cb73-38" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Type=</span><span class="fu">ifelse</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> logFC<span class="sc">&gt;</span><span class="dv">0</span>,<span class="st">&quot;Up&quot;</span>,</span>
<span id="cb73-39"><a href="figure-2.html#cb73-39" tabindex="-1"></a>                            <span class="fu">ifelse</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> logFC <span class="sc">&lt;</span> <span class="dv">0</span>,<span class="st">&quot;Down&quot;</span>,<span class="st">&quot;No-Sig&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb73-40"><a href="figure-2.html#cb73-40" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name,Type)</span>
<span id="cb73-41"><a href="figure-2.html#cb73-41" tabindex="-1"></a></span>
<span id="cb73-42"><a href="figure-2.html#cb73-42" tabindex="-1"></a>node.data <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/node_position.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-43"><a href="figure-2.html#cb73-43" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb73-44"><a href="figure-2.html#cb73-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(result_all,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;label&quot;</span><span class="ot">=</span><span class="st">&quot;name&quot;</span>))</span>
<span id="cb73-45"><a href="figure-2.html#cb73-45" tabindex="-1"></a></span>
<span id="cb73-46"><a href="figure-2.html#cb73-46" tabindex="-1"></a>edge.data <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/edge_result.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-47"><a href="figure-2.html#cb73-47" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb73-48"><a href="figure-2.html#cb73-48" tabindex="-1"></a></span>
<span id="cb73-49"><a href="figure-2.html#cb73-49" tabindex="-1"></a><span class="do">## plot network </span></span>
<span id="cb73-50"><a href="figure-2.html#cb73-50" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()</span>
<span id="cb73-51"><a href="figure-2.html#cb73-51" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> from.x, <span class="at">y =</span> from.y, <span class="at">xend =</span> to.x, <span class="at">yend =</span> to.y),</span>
<span id="cb73-52"><a href="figure-2.html#cb73-52" tabindex="-1"></a>                        <span class="at">color =</span> <span class="st">&quot;#CCCCCC&quot;</span>, <span class="at">size =</span> <span class="fl">0.01</span>, <span class="at">data =</span> edge.data) <span class="co"># draw a straight line</span></span>
<span id="cb73-53"><a href="figure-2.html#cb73-53" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> pos.x, <span class="at">y =</span> pos.y, <span class="at">color =</span> Type), <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb73-54"><a href="figure-2.html#cb73-54" tabindex="-1"></a>                      <span class="at">data =</span> node.data[<span class="fu">which</span>(node.data<span class="sc">$</span>Type <span class="sc">==</span> <span class="st">&quot;No-Sig&quot;</span>), ])</span>
<span id="cb73-55"><a href="figure-2.html#cb73-55" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> pos.x, <span class="at">y =</span> pos.y, <span class="at">color =</span> Type), <span class="at">size =</span> <span class="fl">4.5</span>,</span>
<span id="cb73-56"><a href="figure-2.html#cb73-56" tabindex="-1"></a>                      <span class="at">data =</span> node.data[<span class="fu">which</span>(node.data<span class="sc">$</span>Type <span class="sc">!=</span> <span class="st">&quot;No-Sig&quot;</span>), ])</span>
<span id="cb73-57"><a href="figure-2.html#cb73-57" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Down&quot;</span><span class="ot">=</span><span class="st">&quot;#00599F&quot;</span>,<span class="st">&quot;Up&quot;</span><span class="ot">=</span><span class="st">&quot;#D01910&quot;</span>,<span class="st">&quot;No-Sig&quot;</span><span class="ot">=</span><span class="st">&quot;#AAAAAA&quot;</span>))</span>
<span id="cb73-58"><a href="figure-2.html#cb73-58" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>) <span class="sc">*</span> <span class="dv">2</span>) <span class="co"># specifies the minimum and maximum size </span></span>
<span id="cb73-59"><a href="figure-2.html#cb73-59" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">theme_void</span>()</span>
<span id="cb73-60"><a href="figure-2.html#cb73-60" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">&quot;MMI&quot;</span>))</span>
<span id="cb73-61"><a href="figure-2.html#cb73-61" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;result/Figure2/S3G_WGCNA-Vasualization-diff.pdf&quot;</span>), gg, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure2/S3G.png" width="983" /></p>
</div>
<div id="s3-h-bar-plot" class="section level2 hasAnchor" number="17.12">
<h2><span class="header-section-number">17.12</span> (S3 H) bar plot<a href="figure-2.html#s3-h-bar-plot" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The proportion of metabolites annotated category at each cluster in (g).</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="figure-2.html#cb74-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb74-2"><a href="figure-2.html#cb74-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb74-3"><a href="figure-2.html#cb74-3" tabindex="-1"></a></span>
<span id="cb74-4"><a href="figure-2.html#cb74-4" tabindex="-1"></a>kid <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/Supplementary Tables.xlsx&quot;</span>,<span class="at">sheet=</span><span class="dv">7</span>,<span class="at">skip=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-5"><a href="figure-2.html#cb74-5" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb74-6"><a href="figure-2.html#cb74-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Refmet_name,<span class="st">`</span><span class="at">Annotated category</span><span class="st">`</span>)</span>
<span id="cb74-7"><a href="figure-2.html#cb74-7" tabindex="-1"></a>module <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/2.metabolite_module.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-8"><a href="figure-2.html#cb74-8" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb74-9"><a href="figure-2.html#cb74-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(kid,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;V1&quot;</span><span class="ot">=</span><span class="st">&quot;Refmet_name&quot;</span>))</span>
<span id="cb74-10"><a href="figure-2.html#cb74-10" tabindex="-1"></a></span>
<span id="cb74-11"><a href="figure-2.html#cb74-11" tabindex="-1"></a>module_sum <span class="ot">&lt;-</span> module <span class="sc">%&gt;%</span></span>
<span id="cb74-12"><a href="figure-2.html#cb74-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(moduleLabels,<span class="st">`</span><span class="at">Annotated category</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-13"><a href="figure-2.html#cb74-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb74-14"><a href="figure-2.html#cb74-14" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb74-15"><a href="figure-2.html#cb74-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(moduleLabels <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-16"><a href="figure-2.html#cb74-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(moduleLabels)) <span class="sc">%&gt;%</span></span>
<span id="cb74-17"><a href="figure-2.html#cb74-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">moduleLabels=</span><span class="fu">paste0</span>(<span class="st">&quot;ME&quot;</span>,moduleLabels)) <span class="sc">%&gt;%</span></span>
<span id="cb74-18"><a href="figure-2.html#cb74-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">moduleLabels=</span><span class="fu">factor</span>(moduleLabels,<span class="at">levels=</span><span class="fu">unique</span>(moduleLabels)))</span>
<span id="cb74-19"><a href="figure-2.html#cb74-19" tabindex="-1"></a></span>
<span id="cb74-20"><a href="figure-2.html#cb74-20" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Amino acids and peptides&quot;</span> <span class="ot">=</span><span class="st">&quot;#1B9E77&quot;</span>,</span>
<span id="cb74-21"><a href="figure-2.html#cb74-21" tabindex="-1"></a>          <span class="at">Carbohydrates=</span><span class="st">&quot;#D95F02&quot;</span>,<span class="st">&quot;Cofactors and Vitamins&quot;</span><span class="ot">=</span><span class="st">&quot;#7570B3&quot;</span>,</span>
<span id="cb74-22"><a href="figure-2.html#cb74-22" tabindex="-1"></a>          <span class="at">Energy=</span><span class="st">&quot;#E7298A&quot;</span>,<span class="at">Lipids=</span><span class="st">&quot;#66A61E&quot;</span>,<span class="st">&quot;Nucleic acids&quot;</span><span class="ot">=</span><span class="st">&quot;#E6AB02&quot;</span>,</span>
<span id="cb74-23"><a href="figure-2.html#cb74-23" tabindex="-1"></a>          <span class="at">Other=</span><span class="st">&quot;#A6761D&quot;</span>,<span class="at">Xenobiotics=</span><span class="st">&quot;#666666&quot;</span>)</span>
<span id="cb74-24"><a href="figure-2.html#cb74-24" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(module_sum,<span class="fu">aes</span>(<span class="at">x=</span>moduleLabels,<span class="at">y=</span>n,<span class="at">fill=</span><span class="st">`</span><span class="at">Annotated category</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb74-25"><a href="figure-2.html#cb74-25" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,<span class="at">position =</span> <span class="st">&quot;fill&quot;</span>)<span class="sc">+</span></span>
<span id="cb74-26"><a href="figure-2.html#cb74-26" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb74-27"><a href="figure-2.html#cb74-27" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> cols)<span class="sc">+</span></span>
<span id="cb74-28"><a href="figure-2.html#cb74-28" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb74-29"><a href="figure-2.html#cb74-29" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>,<span class="at">y=</span><span class="cn">NULL</span>)</span>
<span id="cb74-30"><a href="figure-2.html#cb74-30" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure2/S3H_module-metabolite-annotation.pdf&quot;</span>,p,<span class="at">width=</span><span class="dv">5</span>,<span class="at">height =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure2/S3H.png" width="616" style="display: block; margin: auto;" /></p>
</div>
<div id="s3-i-venn-diagram" class="section level2 hasAnchor" number="17.13">
<h2><span class="header-section-number">17.13</span> (S3 I) Venn Diagram<a href="figure-2.html#s3-i-venn-diagram" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <strong>Venn diagram</strong> shows the significantly differential metabolites among defined groups.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="figure-2.html#cb75-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb75-2"><a href="figure-2.html#cb75-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb75-3"><a href="figure-2.html#cb75-3" tabindex="-1"></a><span class="fu">library</span>(ComplexHeatmap)</span>
<span id="cb75-4"><a href="figure-2.html#cb75-4" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb75-5"><a href="figure-2.html#cb75-5" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb75-6"><a href="figure-2.html#cb75-6" tabindex="-1"></a></span>
<span id="cb75-7"><a href="figure-2.html#cb75-7" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb75-8"><a href="figure-2.html#cb75-8" tabindex="-1"></a><span class="co">#  Step 1: Load data and set parameters</span></span>
<span id="cb75-9"><a href="figure-2.html#cb75-9" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb75-10"><a href="figure-2.html#cb75-10" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/sample_clinical_201_info.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-11"><a href="figure-2.html#cb75-11" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb75-12"><a href="figure-2.html#cb75-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Subtype <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Ph&quot;</span>,<span class="st">&quot;non_Ph&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb75-13"><a href="figure-2.html#cb75-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(METc_BM_D0_ID))</span>
<span id="cb75-14"><a href="figure-2.html#cb75-14" tabindex="-1"></a></span>
<span id="cb75-15"><a href="figure-2.html#cb75-15" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-16"><a href="figure-2.html#cb75-16" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb75-17"><a href="figure-2.html#cb75-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(label,<span class="fu">all_of</span>(sample_info<span class="sc">$</span>METc_BM_D0_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb75-18"><a href="figure-2.html#cb75-18" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>)</span>
<span id="cb75-19"><a href="figure-2.html#cb75-19" tabindex="-1"></a></span>
<span id="cb75-20"><a href="figure-2.html#cb75-20" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb75-21"><a href="figure-2.html#cb75-21" tabindex="-1"></a><span class="co">#  Step 2: Differential analysis of ph and ph-</span></span>
<span id="cb75-22"><a href="figure-2.html#cb75-22" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb75-23"><a href="figure-2.html#cb75-23" tabindex="-1"></a>group <span class="ot">&lt;-</span> sample_info<span class="sc">$</span>Subtype</span>
<span id="cb75-24"><a href="figure-2.html#cb75-24" tabindex="-1"></a>group[<span class="fu">which</span>(group<span class="sc">==</span><span class="st">&quot;Ph&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;tumor&quot;</span></span>
<span id="cb75-25"><a href="figure-2.html#cb75-25" tabindex="-1"></a>group[<span class="fu">which</span>(group<span class="sc">==</span><span class="st">&quot;non_Ph&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;normal&quot;</span></span>
<span id="cb75-26"><a href="figure-2.html#cb75-26" tabindex="-1"></a>metabolite_all <span class="ot">&lt;-</span> <span class="fu">mlimma</span>(<span class="fu">log2</span>(dat<span class="sc">+</span><span class="dv">1</span>),group)</span>
<span id="cb75-27"><a href="figure-2.html#cb75-27" tabindex="-1"></a>metabolite_diff <span class="ot">&lt;-</span> metabolite_all <span class="sc">%&gt;%</span></span>
<span id="cb75-28"><a href="figure-2.html#cb75-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(logFC) <span class="sc">&gt;</span> <span class="fl">0.26</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-29"><a href="figure-2.html#cb75-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb75-30"><a href="figure-2.html#cb75-30" tabindex="-1"></a></span>
<span id="cb75-31"><a href="figure-2.html#cb75-31" tabindex="-1"></a><span class="fu">write.table</span>(metabolite_all,<span class="st">&quot;result/Figure2/3.PhvsPh-_all.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb75-32"><a href="figure-2.html#cb75-32" tabindex="-1"></a><span class="fu">write.table</span>(metabolite_diff,<span class="st">&quot;result/Figure2/3.PhvsPh-_diff.txt&quot;</span>,<span class="at">quote=</span>F,<span class="at">row.names=</span>F,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb75-33"><a href="figure-2.html#cb75-33" tabindex="-1"></a></span>
<span id="cb75-34"><a href="figure-2.html#cb75-34" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb75-35"><a href="figure-2.html#cb75-35" tabindex="-1"></a><span class="co">#  Step 3: Venn Diagram</span></span>
<span id="cb75-36"><a href="figure-2.html#cb75-36" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb75-37"><a href="figure-2.html#cb75-37" tabindex="-1"></a><span class="fu">library</span>(VennDiagram)</span>
<span id="cb75-38"><a href="figure-2.html#cb75-38" tabindex="-1"></a></span>
<span id="cb75-39"><a href="figure-2.html#cb75-39" tabindex="-1"></a>BMMCvsHC <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure2/1.BMMCvsHC.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-40"><a href="figure-2.html#cb75-40" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb75-41"><a href="figure-2.html#cb75-41" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(logFC) <span class="sc">&gt;</span> <span class="fl">0.26</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-42"><a href="figure-2.html#cb75-42" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb75-43"><a href="figure-2.html#cb75-43" tabindex="-1"></a>BvsT <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure2/2E_BvsT_all.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-44"><a href="figure-2.html#cb75-44" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb75-45"><a href="figure-2.html#cb75-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(logFC) <span class="sc">&gt;</span> <span class="fl">0.26</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-46"><a href="figure-2.html#cb75-46" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb75-47"><a href="figure-2.html#cb75-47" tabindex="-1"></a>Ph <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure2/3.PhvsPh-_all.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-48"><a href="figure-2.html#cb75-48" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb75-49"><a href="figure-2.html#cb75-49" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(logFC) <span class="sc">&gt;</span> <span class="fl">0.26</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-50"><a href="figure-2.html#cb75-50" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb75-51"><a href="figure-2.html#cb75-51" tabindex="-1"></a></span>
<span id="cb75-52"><a href="figure-2.html#cb75-52" tabindex="-1"></a>venn.plot <span class="ot">&lt;-</span> <span class="fu">venn.diagram</span>(</span>
<span id="cb75-53"><a href="figure-2.html#cb75-53" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">list</span>(<span class="at">BMMCvsHC =</span> BMMCvsHC<span class="sc">$</span>name,<span class="at">BvsT =</span> BvsT<span class="sc">$</span>name,<span class="at">Ph =</span> Ph<span class="sc">$</span>name),</span>
<span id="cb75-54"><a href="figure-2.html#cb75-54" tabindex="-1"></a>  <span class="at">filename =</span> <span class="cn">NULL</span>,</span>
<span id="cb75-55"><a href="figure-2.html#cb75-55" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">&quot;transparent&quot;</span>,<span class="at">fill =</span> <span class="fu">c</span>(<span class="st">&quot;#E6AB02&quot;</span>, <span class="st">&quot;#1F78B4&quot;</span>, <span class="st">&quot;#E7298A&quot;</span>),</span>
<span id="cb75-56"><a href="figure-2.html#cb75-56" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb75-57"><a href="figure-2.html#cb75-57" tabindex="-1"></a>  <span class="at">label.col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>,<span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>),</span>
<span id="cb75-58"><a href="figure-2.html#cb75-58" tabindex="-1"></a>  <span class="at">cex =</span> <span class="fl">2.5</span>,</span>
<span id="cb75-59"><a href="figure-2.html#cb75-59" tabindex="-1"></a>  <span class="at">fontfamily =</span> <span class="st">&quot;serif&quot;</span>,</span>
<span id="cb75-60"><a href="figure-2.html#cb75-60" tabindex="-1"></a>  <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>,</span>
<span id="cb75-61"><a href="figure-2.html#cb75-61" tabindex="-1"></a>  <span class="at">cat.default.pos =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb75-62"><a href="figure-2.html#cb75-62" tabindex="-1"></a>  <span class="at">cat.col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>),</span>
<span id="cb75-63"><a href="figure-2.html#cb75-63" tabindex="-1"></a>  <span class="at">cat.cex =</span> <span class="fl">2.5</span>,</span>
<span id="cb75-64"><a href="figure-2.html#cb75-64" tabindex="-1"></a>  <span class="at">cat.fontfamily =</span> <span class="st">&quot;serif&quot;</span>,</span>
<span id="cb75-65"><a href="figure-2.html#cb75-65" tabindex="-1"></a>  <span class="at">cat.dist =</span> <span class="fu">c</span>(<span class="fl">0.06</span>, <span class="fl">0.06</span>, <span class="fl">0.03</span>),</span>
<span id="cb75-66"><a href="figure-2.html#cb75-66" tabindex="-1"></a>  <span class="at">cat.pos =</span> <span class="dv">0</span>)</span>
<span id="cb75-67"><a href="figure-2.html#cb75-67" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;result/Figure2/S3I_Venn.pdf&quot;</span>,<span class="at">width=</span><span class="dv">10</span>,<span class="at">height =</span> <span class="dv">10</span>)</span>
<span id="cb75-68"><a href="figure-2.html#cb75-68" tabindex="-1"></a><span class="fu">grid.draw</span>(venn.plot)</span>
<span id="cb75-69"><a href="figure-2.html#cb75-69" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p><img src="Figure-1025/Figure2/S3I.png" width="308" style="display: block; margin: auto;" /></p>
</div>
<div id="s3-j-boxplot" class="section level2 hasAnchor" number="17.14">
<h2><span class="header-section-number">17.14</span> (S3 J) Boxplot<a href="figure-2.html#s3-j-boxplot" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <strong>boxplots</strong> depict the normalized peak area of these intersecting metabolites.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="figure-2.html#cb76-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb76-2"><a href="figure-2.html#cb76-2" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb76-3"><a href="figure-2.html#cb76-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb76-4"><a href="figure-2.html#cb76-4" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb76-5"><a href="figure-2.html#cb76-5" tabindex="-1"></a></span>
<span id="cb76-6"><a href="figure-2.html#cb76-6" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb76-7"><a href="figure-2.html#cb76-7" tabindex="-1"></a><span class="co">#  Step 1: Load data and conduct mlimma</span></span>
<span id="cb76-8"><a href="figure-2.html#cb76-8" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb76-9"><a href="figure-2.html#cb76-9" tabindex="-1"></a><span class="do">## Significantly differential metabolites among defined groups</span></span>
<span id="cb76-10"><a href="figure-2.html#cb76-10" tabindex="-1"></a>BMMCvsHC <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure2/1.BMMCvsHC.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-11"><a href="figure-2.html#cb76-11" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-12"><a href="figure-2.html#cb76-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(logFC) <span class="sc">&gt;</span> <span class="fl">0.26</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-13"><a href="figure-2.html#cb76-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb76-14"><a href="figure-2.html#cb76-14" tabindex="-1"></a>BvsT <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure2/2E_BvsT_all.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-15"><a href="figure-2.html#cb76-15" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-16"><a href="figure-2.html#cb76-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(logFC) <span class="sc">&gt;</span> <span class="fl">0.26</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-17"><a href="figure-2.html#cb76-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb76-18"><a href="figure-2.html#cb76-18" tabindex="-1"></a>Ph <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure2/3.PhvsPh-_all.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-19"><a href="figure-2.html#cb76-19" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-20"><a href="figure-2.html#cb76-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(logFC) <span class="sc">&gt;</span> <span class="fl">0.26</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-21"><a href="figure-2.html#cb76-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb76-22"><a href="figure-2.html#cb76-22" tabindex="-1"></a>met_name <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">intersect</span>(BMMCvsHC<span class="sc">$</span>name,BvsT<span class="sc">$</span>name),Ph<span class="sc">$</span>name)</span>
<span id="cb76-23"><a href="figure-2.html#cb76-23" tabindex="-1"></a><span class="fu">table</span>(met_name)</span>
<span id="cb76-24"><a href="figure-2.html#cb76-24" tabindex="-1"></a></span>
<span id="cb76-25"><a href="figure-2.html#cb76-25" tabindex="-1"></a><span class="do">## BMMC vs HC</span></span>
<span id="cb76-26"><a href="figure-2.html#cb76-26" tabindex="-1"></a>meta_filter_BH <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure2/S3F_BMMCvsHC.txt&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-27"><a href="figure-2.html#cb76-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name <span class="sc">%in%</span> met_name) <span class="sc">%&gt;%</span></span>
<span id="cb76-28"><a href="figure-2.html#cb76-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(P.Value,name) <span class="sc">%&gt;%</span></span>
<span id="cb76-29"><a href="figure-2.html#cb76-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">group=</span><span class="fu">rep</span>(<span class="st">&quot;BH&quot;</span>,<span class="dv">4</span>))</span>
<span id="cb76-30"><a href="figure-2.html#cb76-30" tabindex="-1"></a></span>
<span id="cb76-31"><a href="figure-2.html#cb76-31" tabindex="-1"></a><span class="do">## PBMC vs HC</span></span>
<span id="cb76-32"><a href="figure-2.html#cb76-32" tabindex="-1"></a>meta_filter_PH <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure2/S3F_PBMCvsHC.txt&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-33"><a href="figure-2.html#cb76-33" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name <span class="sc">%in%</span> met_name) <span class="sc">%&gt;%</span></span>
<span id="cb76-34"><a href="figure-2.html#cb76-34" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(P.Value,name) <span class="sc">%&gt;%</span></span>
<span id="cb76-35"><a href="figure-2.html#cb76-35" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">group=</span><span class="fu">rep</span>(<span class="st">&quot;PH&quot;</span>,<span class="dv">4</span>))</span>
<span id="cb76-36"><a href="figure-2.html#cb76-36" tabindex="-1"></a></span>
<span id="cb76-37"><a href="figure-2.html#cb76-37" tabindex="-1"></a><span class="do">## BMMC vs PBMC</span></span>
<span id="cb76-38"><a href="figure-2.html#cb76-38" tabindex="-1"></a>meta_filter_BP <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure2/S3F_BMMCvsPBMC.txt&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-39"><a href="figure-2.html#cb76-39" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name <span class="sc">%in%</span> met_name) <span class="sc">%&gt;%</span></span>
<span id="cb76-40"><a href="figure-2.html#cb76-40" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(P.Value,name) <span class="sc">%&gt;%</span></span>
<span id="cb76-41"><a href="figure-2.html#cb76-41" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">group=</span><span class="fu">rep</span>(<span class="st">&quot;BP&quot;</span>,<span class="dv">4</span>))</span>
<span id="cb76-42"><a href="figure-2.html#cb76-42" tabindex="-1"></a></span>
<span id="cb76-43"><a href="figure-2.html#cb76-43" tabindex="-1"></a>meta_filter_all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(meta_filter_BH,meta_filter_BP,meta_filter_PH) <span class="sc">%&gt;%</span></span>
<span id="cb76-44"><a href="figure-2.html#cb76-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name=</span><span class="fu">factor</span>(name,<span class="at">levels=</span>met_name)) <span class="sc">%&gt;%</span></span>
<span id="cb76-45"><a href="figure-2.html#cb76-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(name)</span>
<span id="cb76-46"><a href="figure-2.html#cb76-46" tabindex="-1"></a><span class="fu">write.table</span>(meta_filter_all,<span class="st">&quot;result/Figure2/S3J_meta_groupcomparison.txt&quot;</span>,<span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,<span class="at">quote =</span> F,<span class="at">row.names =</span> F)</span>
<span id="cb76-47"><a href="figure-2.html#cb76-47" tabindex="-1"></a></span>
<span id="cb76-48"><a href="figure-2.html#cb76-48" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb76-49"><a href="figure-2.html#cb76-49" tabindex="-1"></a><span class="co">#  Step 2: Boxplot</span></span>
<span id="cb76-50"><a href="figure-2.html#cb76-50" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb76-51"><a href="figure-2.html#cb76-51" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;raw_data/cell_dat_final_reuslt_v0329.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-52"><a href="figure-2.html#cb76-52" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-53"><a href="figure-2.html#cb76-53" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-54"><a href="figure-2.html#cb76-54" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(sample_info1<span class="sc">$</span>METc_BM_D0_ID),<span class="fu">all_of</span>(sample_info2<span class="sc">$</span>METc_PB_D0_ID),<span class="fu">starts_with</span>(<span class="st">&quot;H&quot;</span>))</span>
<span id="cb76-55"><a href="figure-2.html#cb76-55" tabindex="-1"></a></span>
<span id="cb76-56"><a href="figure-2.html#cb76-56" tabindex="-1"></a>group <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;A&quot;</span>,<span class="fu">length</span>(sample_info1<span class="sc">$</span>METc_BM_D0_ID)),<span class="fu">rep</span>(<span class="st">&quot;P&quot;</span>,<span class="fu">length</span>(sample_info2<span class="sc">$</span>METc_PB_D0_ID)),</span>
<span id="cb76-57"><a href="figure-2.html#cb76-57" tabindex="-1"></a>           <span class="fu">rep</span>(<span class="st">&quot;HC&quot;</span>,<span class="fu">length</span>(<span class="fu">grep</span>(<span class="st">&quot;H&quot;</span>,<span class="fu">names</span>(dat)))))</span>
<span id="cb76-58"><a href="figure-2.html#cb76-58" tabindex="-1"></a></span>
<span id="cb76-59"><a href="figure-2.html#cb76-59" tabindex="-1"></a>dat_filter <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb76-60"><a href="figure-2.html#cb76-60" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;label&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-61"><a href="figure-2.html#cb76-61" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(label <span class="sc">%in%</span> met_name) <span class="sc">%&gt;%</span> </span>
<span id="cb76-62"><a href="figure-2.html#cb76-62" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;label&quot;</span>)</span>
<span id="cb76-63"><a href="figure-2.html#cb76-63" tabindex="-1"></a></span>
<span id="cb76-64"><a href="figure-2.html#cb76-64" tabindex="-1"></a>dat_filter <span class="ot">&lt;-</span> <span class="fu">myscale</span>(<span class="fu">log2</span>(dat_filter<span class="sc">+</span><span class="dv">1</span>),<span class="at">method=</span><span class="st">&quot;raw_zscore&quot;</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb76-65"><a href="figure-2.html#cb76-65" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-66"><a href="figure-2.html#cb76-66" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb76-67"><a href="figure-2.html#cb76-67" tabindex="-1"></a>dat_filter<span class="sc">$</span>group <span class="ot">&lt;-</span> group</span>
<span id="cb76-68"><a href="figure-2.html#cb76-68" tabindex="-1"></a></span>
<span id="cb76-69"><a href="figure-2.html#cb76-69" tabindex="-1"></a>dat_melt <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(dat_filter,<span class="at">id=</span><span class="st">&quot;group&quot;</span>)</span>
<span id="cb76-70"><a href="figure-2.html#cb76-70" tabindex="-1"></a></span>
<span id="cb76-71"><a href="figure-2.html#cb76-71" tabindex="-1"></a>plot_list <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb76-72"><a href="figure-2.html#cb76-72" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(met_name)) {</span>
<span id="cb76-73"><a href="figure-2.html#cb76-73" tabindex="-1"></a>  dat_melt_filter <span class="ot">&lt;-</span> dat_melt <span class="sc">%&gt;%</span></span>
<span id="cb76-74"><a href="figure-2.html#cb76-74" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(variable<span class="sc">==</span>met_name[i]) <span class="sc">%&gt;%</span></span>
<span id="cb76-75"><a href="figure-2.html#cb76-75" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">group=</span><span class="fu">factor</span>(group,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;HC&quot;</span>,<span class="st">&quot;P&quot;</span>,<span class="st">&quot;A&quot;</span>)))</span>
<span id="cb76-76"><a href="figure-2.html#cb76-76" tabindex="-1"></a>  </span>
<span id="cb76-77"><a href="figure-2.html#cb76-77" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat_melt_filter, <span class="fu">aes</span>(<span class="at">x=</span>group,<span class="at">y =</span> value,<span class="at">fill=</span>group)) <span class="sc">+</span></span>
<span id="cb76-78"><a href="figure-2.html#cb76-78" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb76-79"><a href="figure-2.html#cb76-79" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="st">&quot;jitter&quot;</span>,<span class="at">size=</span><span class="fl">0.5</span>,<span class="at">alpha=</span><span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb76-80"><a href="figure-2.html#cb76-80" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;#007DDB&quot;</span>,<span class="st">&quot;#D01910&quot;</span>,<span class="st">&quot;purple&quot;</span>))<span class="sc">+</span></span>
<span id="cb76-81"><a href="figure-2.html#cb76-81" tabindex="-1"></a>    <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb76-82"><a href="figure-2.html#cb76-82" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>)<span class="sc">+</span><span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">7</span>,<span class="dv">7</span>)<span class="sc">+</span></span>
<span id="cb76-83"><a href="figure-2.html#cb76-83" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>,<span class="at">y=</span><span class="cn">NULL</span>,<span class="at">title =</span> <span class="fu">unique</span>(dat_melt_filter<span class="sc">$</span>variable))</span>
<span id="cb76-84"><a href="figure-2.html#cb76-84" tabindex="-1"></a>  plot_list[[i]] <span class="ot">&lt;-</span> p </span>
<span id="cb76-85"><a href="figure-2.html#cb76-85" tabindex="-1"></a>}</span>
<span id="cb76-86"><a href="figure-2.html#cb76-86" tabindex="-1"></a></span>
<span id="cb76-87"><a href="figure-2.html#cb76-87" tabindex="-1"></a>plot_grid <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> plot_list, <span class="at">nrow =</span> <span class="dv">1</span>)  </span>
<span id="cb76-88"><a href="figure-2.html#cb76-88" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure2/S3J_boxplot.pdf&quot;</span>,plot_grid,<span class="at">width=</span><span class="dv">8</span>,<span class="at">height =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure2/S3J.png" width="606" style="display: block; margin: auto;" /></p>
</div>
<div id="s3-k-pathway-based-analysis" class="section level2 hasAnchor" number="17.15">
<h2><span class="header-section-number">17.15</span> (S3 K) Pathway-based Analysis<a href="figure-2.html#s3-k-pathway-based-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Pathway-based analysis</strong> of metabolic changes between Ph+ BCP-ALL and Ph- BCP-ALL.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="figure-2.html#cb77-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-2"><a href="figure-2.html#cb77-2" tabindex="-1"></a><span class="fu">library</span>(MNet)</span>
<span id="cb77-3"><a href="figure-2.html#cb77-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb77-4"><a href="figure-2.html#cb77-4" tabindex="-1"></a><span class="fu">library</span>(tidymass)</span>
<span id="cb77-5"><a href="figure-2.html#cb77-5" tabindex="-1"></a></span>
<span id="cb77-6"><a href="figure-2.html#cb77-6" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb77-7"><a href="figure-2.html#cb77-7" tabindex="-1"></a><span class="co">#  Step 1: Load data and set parameters</span></span>
<span id="cb77-8"><a href="figure-2.html#cb77-8" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb77-9"><a href="figure-2.html#cb77-9" tabindex="-1"></a>metabolite_all <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;result/Figure2/3.PhvsPh-_all.txt&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-10"><a href="figure-2.html#cb77-10" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb77-11"><a href="figure-2.html#cb77-11" tabindex="-1"></a>metabolite_diff <span class="ot">&lt;-</span> metabolite_all <span class="sc">%&gt;%</span></span>
<span id="cb77-12"><a href="figure-2.html#cb77-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(logFC) <span class="sc">&gt;</span> <span class="fl">0.26</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-13"><a href="figure-2.html#cb77-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb77-14"><a href="figure-2.html#cb77-14" tabindex="-1"></a></span>
<span id="cb77-15"><a href="figure-2.html#cb77-15" tabindex="-1"></a>kid <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;raw_data/cell_metabolite_info_all_v1109.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-16"><a href="figure-2.html#cb77-16" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb77-17"><a href="figure-2.html#cb77-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(refmet_name,KEGG)</span>
<span id="cb77-18"><a href="figure-2.html#cb77-18" tabindex="-1"></a></span>
<span id="cb77-19"><a href="figure-2.html#cb77-19" tabindex="-1"></a>data_all <span class="ot">&lt;-</span> metabolite_all <span class="sc">%&gt;%</span> </span>
<span id="cb77-20"><a href="figure-2.html#cb77-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(kid,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span><span class="ot">=</span><span class="st">&quot;refmet_name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-21"><a href="figure-2.html#cb77-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(KEGG<span class="sc">!=</span><span class="st">&quot;None&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-22"><a href="figure-2.html#cb77-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(KEGG)</span>
<span id="cb77-23"><a href="figure-2.html#cb77-23" tabindex="-1"></a></span>
<span id="cb77-24"><a href="figure-2.html#cb77-24" tabindex="-1"></a>dat <span class="ot">&lt;-</span> metabolite_all <span class="sc">%&gt;%</span> </span>
<span id="cb77-25"><a href="figure-2.html#cb77-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(kid,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span><span class="ot">=</span><span class="st">&quot;refmet_name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-26"><a href="figure-2.html#cb77-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(KEGG<span class="sc">!=</span><span class="st">&quot;None&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-27"><a href="figure-2.html#cb77-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb77-28"><a href="figure-2.html#cb77-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">change=</span><span class="fu">ifelse</span>(logFC <span class="sc">&gt;</span> <span class="fl">0.26</span>,<span class="st">&quot;increase&quot;</span>,</span>
<span id="cb77-29"><a href="figure-2.html#cb77-29" tabindex="-1"></a>                       <span class="fu">ifelse</span>(logFC <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.26</span>,<span class="st">&quot;decrease&quot;</span>,<span class="st">&quot;no sig&quot;</span>)))</span>
<span id="cb77-30"><a href="figure-2.html#cb77-30" tabindex="-1"></a>data_increase <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb77-31"><a href="figure-2.html#cb77-31" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(change<span class="sc">==</span><span class="st">&quot;increase&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-32"><a href="figure-2.html#cb77-32" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(KEGG)</span>
<span id="cb77-33"><a href="figure-2.html#cb77-33" tabindex="-1"></a>data_decrease <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb77-34"><a href="figure-2.html#cb77-34" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(change<span class="sc">==</span><span class="st">&quot;decrease&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-35"><a href="figure-2.html#cb77-35" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(KEGG)</span>
<span id="cb77-36"><a href="figure-2.html#cb77-36" tabindex="-1"></a></span>
<span id="cb77-37"><a href="figure-2.html#cb77-37" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb77-38"><a href="figure-2.html#cb77-38" tabindex="-1"></a><span class="co">#  Step 2: DA-score</span></span>
<span id="cb77-39"><a href="figure-2.html#cb77-39" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb77-40"><a href="figure-2.html#cb77-40" tabindex="-1"></a>da_result <span class="ot">&lt;-</span> <span class="fu">ePDAlyser</span>(data_increase,data_decrease,data_all,<span class="at">sort_plot=</span><span class="st">&quot;category&quot;</span>,</span>
<span id="cb77-41"><a href="figure-2.html#cb77-41" tabindex="-1"></a>                     <span class="at">min_measured_num =</span> <span class="dv">2</span>,<span class="at">out=</span><span class="st">&quot;metabolite&quot;</span>)</span>
<span id="cb77-42"><a href="figure-2.html#cb77-42" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(da_result<span class="sc">$</span>p,<span class="at">filename =</span> <span class="st">&quot;result/Figure2/S3K_DA_score_all.pdf&quot;</span>,</span>
<span id="cb77-43"><a href="figure-2.html#cb77-43" tabindex="-1"></a>                <span class="at">width=</span><span class="dv">13</span>,<span class="at">height=</span><span class="dv">9</span>)</span>
<span id="cb77-44"><a href="figure-2.html#cb77-44" tabindex="-1"></a>openxlsx<span class="sc">::</span><span class="fu">write.xlsx</span>(da_result<span class="sc">$</span>result,<span class="at">file=</span><span class="st">&quot;result/Figure2/S3K_DA_score_all.xlsx&quot;</span>,<span class="at">rowNames =</span> <span class="cn">FALSE</span>)</span>
<span id="cb77-45"><a href="figure-2.html#cb77-45" tabindex="-1"></a></span>
<span id="cb77-46"><a href="figure-2.html#cb77-46" tabindex="-1"></a>diff.kid <span class="ot">&lt;-</span> metabolite_all <span class="sc">%&gt;%</span> </span>
<span id="cb77-47"><a href="figure-2.html#cb77-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(P.Value <span class="sc">&lt;</span><span class="fl">0.05</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb77-48"><a href="figure-2.html#cb77-48" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(logFC <span class="sc">&gt;</span> <span class="fl">0.26</span> <span class="sc">|</span> logFC <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.26</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-49"><a href="figure-2.html#cb77-49" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(kid,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;name&quot;</span><span class="ot">=</span><span class="st">&quot;refmet_name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-50"><a href="figure-2.html#cb77-50" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(KEGG<span class="sc">!=</span><span class="st">&quot;None&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb77-51"><a href="figure-2.html#cb77-51" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(KEGG) <span class="sc">%&gt;%</span> </span>
<span id="cb77-52"><a href="figure-2.html#cb77-52" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb77-53"><a href="figure-2.html#cb77-53" tabindex="-1"></a></span>
<span id="cb77-54"><a href="figure-2.html#cb77-54" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;kegg_hsa_pathway&quot;</span>, <span class="at">package =</span> <span class="st">&quot;metpath&quot;</span>)</span>
<span id="cb77-55"><a href="figure-2.html#cb77-55" tabindex="-1"></a><span class="co">#Remove the disease pathway</span></span>
<span id="cb77-56"><a href="figure-2.html#cb77-56" tabindex="-1"></a>pathway_class <span class="ot">=</span> metpath<span class="sc">::</span><span class="fu">pathway_class</span>(kegg_hsa_pathway)</span>
<span id="cb77-57"><a href="figure-2.html#cb77-57" tabindex="-1"></a>remain_idx <span class="ot">=</span> pathway_class <span class="sc">%&gt;%</span></span>
<span id="cb77-58"><a href="figure-2.html#cb77-58" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">%&gt;%</span></span>
<span id="cb77-59"><a href="figure-2.html#cb77-59" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_detect</span>(<span class="st">&quot;Disease&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-60"><a href="figure-2.html#cb77-60" tabindex="-1"></a>  <span class="st">`</span><span class="at">!</span><span class="st">`</span>() <span class="sc">%&gt;%</span></span>
<span id="cb77-61"><a href="figure-2.html#cb77-61" tabindex="-1"></a>  <span class="fu">which</span>()</span>
<span id="cb77-62"><a href="figure-2.html#cb77-62" tabindex="-1"></a>pathway_database <span class="ot">=</span> kegg_hsa_pathway[remain_idx]</span>
<span id="cb77-63"><a href="figure-2.html#cb77-63" tabindex="-1"></a></span>
<span id="cb77-64"><a href="figure-2.html#cb77-64" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb77-65"><a href="figure-2.html#cb77-65" tabindex="-1"></a><span class="co">#  Step 3: MSEA</span></span>
<span id="cb77-66"><a href="figure-2.html#cb77-66" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb77-67"><a href="figure-2.html#cb77-67" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">enrich_kegg</span>(<span class="at">query_id =</span> diff.kid, </span>
<span id="cb77-68"><a href="figure-2.html#cb77-68" tabindex="-1"></a>                      <span class="at">query_type =</span> <span class="st">&quot;compound&quot;</span>, </span>
<span id="cb77-69"><a href="figure-2.html#cb77-69" tabindex="-1"></a>                      <span class="at">id_type =</span> <span class="st">&quot;KEGG&quot;</span>,<span class="at">method =</span> <span class="st">&quot;hypergeometric&quot;</span>,</span>
<span id="cb77-70"><a href="figure-2.html#cb77-70" tabindex="-1"></a>                      <span class="at">pathway_database =</span> pathway_database, </span>
<span id="cb77-71"><a href="figure-2.html#cb77-71" tabindex="-1"></a>                      <span class="at">p_cutoff =</span> <span class="fl">0.05</span>, </span>
<span id="cb77-72"><a href="figure-2.html#cb77-72" tabindex="-1"></a>                      <span class="at">p_adjust_method =</span> <span class="st">&quot;BH&quot;</span>, </span>
<span id="cb77-73"><a href="figure-2.html#cb77-73" tabindex="-1"></a>                      <span class="at">threads =</span> <span class="dv">5</span>)</span>
<span id="cb77-74"><a href="figure-2.html#cb77-74" tabindex="-1"></a>msea_table <span class="ot">&lt;-</span> result<span class="sc">@</span>result <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(p_value) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb77-75"><a href="figure-2.html#cb77-75" tabindex="-1"></a>tablefilter <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(msea_table,p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb77-76"><a href="figure-2.html#cb77-76" tabindex="-1"></a><span class="fu">write.csv</span>(msea_table,<span class="st">&quot;result/Figure2/S3K_MSEA_all.csv&quot;</span>)</span>
<span id="cb77-77"><a href="figure-2.html#cb77-77" tabindex="-1"></a></span>
<span id="cb77-78"><a href="figure-2.html#cb77-78" tabindex="-1"></a><span class="do">## Enrichment pathway visualization</span></span>
<span id="cb77-79"><a href="figure-2.html#cb77-79" tabindex="-1"></a>da_filter <span class="ot">&lt;-</span> da_result<span class="sc">$</span>result <span class="sc">%&gt;%</span></span>
<span id="cb77-80"><a href="figure-2.html#cb77-80" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(KEGG_pathwayid <span class="sc">%in%</span> tablefilter<span class="sc">$</span>pathway_id) <span class="sc">%&gt;%</span></span>
<span id="cb77-81"><a href="figure-2.html#cb77-81" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-82"><a href="figure-2.html#cb77-82" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Pathway=</span><span class="fu">factor</span>(Pathway,<span class="at">levels =</span> Pathway))</span>
<span id="cb77-83"><a href="figure-2.html#cb77-83" tabindex="-1"></a></span>
<span id="cb77-84"><a href="figure-2.html#cb77-84" tabindex="-1"></a>pathway_data <span class="ot">&lt;-</span> PathwayExtendData <span class="sc">%&gt;%</span></span>
<span id="cb77-85"><a href="figure-2.html#cb77-85" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;metabolite&quot;</span>)</span>
<span id="cb77-86"><a href="figure-2.html#cb77-86" tabindex="-1"></a></span>
<span id="cb77-87"><a href="figure-2.html#cb77-87" tabindex="-1"></a>colp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Amino acid metabolism&quot;</span> <span class="ot">=</span><span class="st">&quot;#1B9E77&quot;</span>,</span>
<span id="cb77-88"><a href="figure-2.html#cb77-88" tabindex="-1"></a>          <span class="st">&quot;Carbohydrate metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#D95F02&quot;</span>,</span>
<span id="cb77-89"><a href="figure-2.html#cb77-89" tabindex="-1"></a>          <span class="st">&quot;Glycan biosynthesis and metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#1F78B4&quot;</span>, </span>
<span id="cb77-90"><a href="figure-2.html#cb77-90" tabindex="-1"></a>          <span class="st">&quot;Metabolism of cofactors and vitamins&quot;</span><span class="ot">=</span><span class="st">&quot;#7570B3&quot;</span>,</span>
<span id="cb77-91"><a href="figure-2.html#cb77-91" tabindex="-1"></a>          <span class="st">&quot;Metabolism of terpenoids and polyketides&quot;</span><span class="ot">=</span><span class="st">&quot;#BC80BD&quot;</span>,</span>
<span id="cb77-92"><a href="figure-2.html#cb77-92" tabindex="-1"></a>          <span class="st">&quot;Metabolism of other amino acids&quot;</span><span class="ot">=</span><span class="st">&quot;#8DD3C7&quot;</span>,</span>
<span id="cb77-93"><a href="figure-2.html#cb77-93" tabindex="-1"></a>          <span class="st">&quot;Energy metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#E7298A&quot;</span>,</span>
<span id="cb77-94"><a href="figure-2.html#cb77-94" tabindex="-1"></a>          <span class="st">&quot;Lipid metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#66A61E&quot;</span>,</span>
<span id="cb77-95"><a href="figure-2.html#cb77-95" tabindex="-1"></a>          <span class="st">&quot;Nucleotide metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#E6AB02&quot;</span>,</span>
<span id="cb77-96"><a href="figure-2.html#cb77-96" tabindex="-1"></a>          <span class="st">&quot;Biosynthesis of other secondary metabolites&quot;</span><span class="ot">=</span><span class="st">&quot;#A6761D&quot;</span>,</span>
<span id="cb77-97"><a href="figure-2.html#cb77-97" tabindex="-1"></a>          <span class="st">&quot;Xenobiotics biodegradation and metabolism&quot;</span><span class="ot">=</span><span class="st">&quot;#666666&quot;</span>)</span>
<span id="cb77-98"><a href="figure-2.html#cb77-98" tabindex="-1"></a></span>
<span id="cb77-99"><a href="figure-2.html#cb77-99" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(da_filter)<span class="sc">+</span></span>
<span id="cb77-100"><a href="figure-2.html#cb77-100" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Pathway,<span class="at">y=</span>DA_score,<span class="at">size=</span><span class="fu">log2</span>(Measured_members_num),<span class="at">color=</span><span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb77-101"><a href="figure-2.html#cb77-101" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x=</span>Pathway,<span class="at">y=</span>DA_score,<span class="at">ymin=</span><span class="dv">0</span>,<span class="at">ymax=</span>DA_score,<span class="at">color=</span><span class="st">`</span><span class="at">Pathway Category</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb77-102"><a href="figure-2.html#cb77-102" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>colp)<span class="sc">+</span></span>
<span id="cb77-103"><a href="figure-2.html#cb77-103" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb77-104"><a href="figure-2.html#cb77-104" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb77-105"><a href="figure-2.html#cb77-105" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb77-106"><a href="figure-2.html#cb77-106" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;result/Figure2/S3K_PHpathway.pdf&quot;</span>,p,<span class="at">width=</span><span class="dv">8</span>,<span class="at">height =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="Figure-1025/Figure2/S3K.png" width="431" style="display: block; margin: auto;" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="figure-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="figure-3.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/16-Figure2.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
